(function(t){function e(e){for(var n,i,o=e[0],c=e[1],u=e[2],l=0,m=[];l<o.length;l++)i=o[l],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&m.push(r[i][0]),r[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);h&&h(e);while(m.length)m.shift()();return s.push.apply(s,u||[]),a()}function a(){for(var t,e=0;e<s.length;e++){for(var a=s[e],n=!0,i=1;i<a.length;i++){var c=a[i];0!==r[c]&&(n=!1)}n&&(s.splice(e--,1),t=o(o.s=a[0]))}return t}var n={},r={app:0},s=[];function i(t){return o.p+"js/"+({}[t]||t)+"."+{"chunk-2d0e6259":"659353d3","chunk-2d20fcfa":"abc26475"}[t]+".js"}function o(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.e=function(t){var e=[],a=r[t];if(0!==a)if(a)e.push(a[2]);else{var n=new Promise((function(e,n){a=r[t]=[e,n]}));e.push(a[2]=n);var s,c=document.createElement("script");c.charset="utf-8",c.timeout=120,o.nc&&c.setAttribute("nonce",o.nc),c.src=i(t);var u=new Error;s=function(e){c.onerror=c.onload=null,clearTimeout(l);var a=r[t];if(0!==a){if(a){var n=e&&("load"===e.type?"missing":e.type),s=e&&e.target&&e.target.src;u.message="Loading chunk "+t+" failed.\n("+n+": "+s+")",u.name="ChunkLoadError",u.type=n,u.request=s,a[1](u)}r[t]=void 0}};var l=setTimeout((function(){s({type:"timeout",target:c})}),12e4);c.onerror=c.onload=s,document.head.appendChild(c)}return Promise.all(e)},o.m=t,o.c=n,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(a,n,function(e){return t[e]}.bind(null,n));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/controls-js/",o.oe=function(t){throw console.error(t),t};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var h=u;s.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"006d":function(t,e,a){"use strict";a("6180")},1:function(t,e){},10:function(t,e){},2:function(t,e){},3:function(t,e){},4:function(t,e){},5:function(t,e){},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",{directives:[{name:"resize",rawName:"v-resize",value:t.onResize,expression:"onResize"}]},[a("Drawer",{ref:"drawer"}),a("Toolbar",{on:{toggleDrawer:t.toggleDrawer}}),a("v-main",[t.loading?a("v-row",{staticStyle:{height:"100%"},attrs:{align:"center",justify:"center"}},[a("v-progress-circular",{attrs:{size:40,color:"blue",indeterminate:""}})],1):a("router-view",{key:t.$route.path})],1),a("notifications",{attrs:{group:"alert",position:"bottom center",width:"400px",closeOnClick:"",max:3,classes:"notification-style"}})],1)},s=[],i=a("2f9d"),o=a.n(i),c=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app-bar",{attrs:{app:"","clipped-left":"","clipped-right":"",color:t.color,dark:t.dark,dense:""}},[t.showBack?a("v-toolbar-items",{staticStyle:{"margin-left":"0px"}},[a("v-btn",{staticClass:"mr-2",attrs:{icon:""},on:{click:t.navback}},[a("v-icon",{attrs:{small:""}},[t._v("fas fa-chevron-left")])],1)],1):a("v-app-bar-nav-icon",{on:{click:function(e){return e.stopPropagation(),t.$emit("toggleDrawer")}}}),a("v-toolbar-title",{staticClass:"headline"},[a("span",{staticClass:"font-weight-light"},[t._v(t._s(t.title))])]),a("v-spacer"),a("v-toolbar-items",[a("v-btn",{attrs:{href:"https://github.com/BertrandBev/controls-js",target:"_blank",text:""}},[a("span",{staticClass:"mr-2"},[t._v("Github")]),a("v-icon",[t._v("mdi-open-in-new")])],1)],1),t.showRightDrawer?a("v-btn",{attrs:{icon:"",dark:""},on:{click:function(e){return e.stopPropagation(),t.$bus.$emit("toggleDrawer")}}},[a("v-icon",[t._v("mdi-tune")])],1):t._e()],1)},u=[],l=(a("99af"),a("b0c0"),a("2ef0")),h=a.n(l),m=a("ade3"),d=(a("cb29"),a("4160"),a("d81d"),a("2af1"),a("dca8"),a("d3b7"),a("498a"),a("159b"),a("2909")),p=a("5530"),f=a("d4ec"),v=a("bee2"),y=a("262e"),g=a("2caf"),b=a("fcf4"),x=(a("a434"),a("3835")),w=function(){function t(e,a,n){Object(f["a"])(this,t),this.states=e,this.commands=a,this.shape=[this.states.length,this.commands.length],this.statesCommands=[].concat(Object(d["a"])(e),Object(d["a"])(a)),this.params=n;var r=n.x0?new o.a.Matrix(n.x0):this.trim().x;this.setState(r),this.graphics={}}return Object(v["a"])(t,[{key:"delete",value:function(){o.a.GC.popException(this.x)}},{key:"trim",value:function(){return{x:new o.a.Matrix(this.shape[0],1),u:new o.a.Matrix(this.shape[1],1)}}},{key:"setState",value:function(t){o.a.GC.set(this,"x",t)}},{key:"bound",value:function(e){e.clampSelf(-t.STATE_BOUNDS,t.STATE_BOUNDS)}},{key:"dynamics",value:function(t,e){throw new Error("Must be overridden")}},{key:"xNext",value:function(t,e,a){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=this.dynamics(t,e),s=t.matAdd(r.mul(a));return n&&this.bound(s),s}},{key:"step",value:function(t,e){var a=this.xNext(this.x,t,e);this.setState(a)}},{key:"reverse",value:function(t){var e=this,a=t.map((function(t){return o.a.Matrix(t)}));a.reverse();for(var n=Object(x["a"])(this.shape,2),r=n[0],s=n[1],i=function(t){if(t>0){var n=a[t].block(r,0,s,1);a[t-1].setBlock(r,0,n)}e.statesCommands.forEach((function(e,n){e.derivative&&a[t].set(n,-a[t].get(n))}))},c=0;c<a.length;c++)i(c);var u=Object(d["a"])(t);return u.splice(t.length-1,1),[].concat(Object(d["a"])(u),Object(d["a"])(a))}},{key:"simulate",value:function(t,e,a,n){for(var r=new o.a.Matrix(e),s=[],i=0;i<n;i+=a){var c=t.getCommand(r,i),u=this.dynamics(r,c);s.push(r.vcat(c)),r.matAddSelf(u.mul(a))}return s}}]),t}();Object(m["a"])(w,"STATE_BOUNDS",1e3);var k=w;function j(t){var e=(t+Math.PI)%(2*Math.PI);return e<0&&(e+=2*Math.PI),e-Math.PI}function M(t){return Math.pow(t,2)}function S(t){for(var e=t.length,a=Object(d["a"])(Array(e)).map((function(){return Object(d["a"])(Array(e)).map((function(){return 0}))})),n=0;n<e;n++)a[n][n]=t[n];return a}function O(t,e){var a=new o.a.Matrix(t.rows(),1),n=o.a.Random.normal(a,e,1);t.matAddSelf(n)}var P=function(){function t(e,a){Object(f["a"])(this,t),this.setMean(e),this.setCov(a)}return Object(v["a"])(t,[{key:"setMean",value:function(t){o.a.GC.set(this,"mean",t)}},{key:"setCov",value:function(t){this.absDet=Math.abs(t.det());var e=t.inverse();o.a.GC.set(this,"invCov",e)}},{key:"delete",value:function(){o.a.GC.popException(this.mean),o.a.GC.popException(this.invCov)}},{key:"density",value:function(t){var e=this.mean.rows(),a=t.matSub(this.mean),n=a.transpose().matMul(this.invCov).matMul(a).get(0,0);return Math.exp(-.5*n)/Math.sqrt(Math.pow(2*Math.PI,e)*this.absDet)}}]),t}();function A(t,e){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-8,n=[],r=0;r<t.length;r++){var s=t[(r+1)%t.length].matSub(t[r%t.length]).div(e);n.push(s)}return C(n,e,a)}function C(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-8,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(0===t.length)return[];for(var r=Math.exp(-2*Math.PI*e/a),s=t[0],i=[],o=0;o<(n?2:1)*t.length;o++)s=s.mul(r).matAdd(t[o%t.length].mul(1-r)),(!n||o>=t.length)&&i.push(s);return i}var _={dt:.04472625790685786,x:[[-2,0,5],[-1.9947,.2294,5],[-1.979,.4587,5],[-1.9527,.6881,5],[-1.9158,.9175,5],[-1.8685,1.1468,5],[-1.8106,1.3762,5],[-1.7422,1.6056,5],[-1.6633,1.8349,5],[-1.5739,2.0643,5],[-1.4739,2.2937,5],[-1.3634,2.523,5],[-1.2424,2.7524,5],[-1.1109,2.9818,5],[-.9689,3.2111,5],[-.8163,3.4405,5],[-.6532,3.6698,5],[-.4796,3.8992,5],[-.2955,4.1286,5],[-.1008,4.3579,5],[.1008,4.3579,-5],[.2955,4.1286,-5],[.4796,3.8992,-5],[.6532,3.6698,-5],[.8163,3.4405,-5],[.9689,3.2111,-5],[1.1109,2.9818,-5],[1.2424,2.7524,-5],[1.3634,2.523,-5],[1.4739,2.2937,-5],[1.5739,2.0643,-5],[1.6633,1.8349,-5],[1.7422,1.6056,-5],[1.8106,1.3762,-5],[1.8685,1.1468,-5],[1.9158,.9175,-5],[1.9527,.6881,-5],[1.979,.4587,-5],[1.9947,.2294,-5],[2,0,-5],[1.9947,-.2294,-5],[1.979,-.4587,-5],[1.9527,-.6881,-5],[1.9158,-.9175,-5],[1.8685,-1.1468,-5],[1.8106,-1.3762,-5],[1.7422,-1.6056,-5],[1.6633,-1.8349,-5],[1.5739,-2.0643,-5],[1.4739,-2.2937,-5],[1.3634,-2.523,-5],[1.2424,-2.7524,-5],[1.1109,-2.9818,-5],[.9689,-3.2111,-5],[.8163,-3.4405,-5],[.6532,-3.6698,-5],[.4796,-3.8992,-5],[.2955,-4.1286,-5],[.1008,-4.3579,5],[-.1008,-4.3579,5],[-.2955,-4.1286,5],[-.4796,-3.8992,5],[-.6532,-3.6698,5],[-.8163,-3.4405,5],[-.9689,-3.2111,5],[-1.1109,-2.9818,5],[-1.2424,-2.7524,5],[-1.3634,-2.523,5],[-1.4739,-2.2937,5],[-1.5739,-2.0643,5],[-1.6633,-1.8349,5],[-1.7422,-1.6056,5],[-1.8106,-1.3762,5],[-1.8685,-1.1468,5],[-1.9158,-.9175,5],[-1.9527,-.6881,5],[-1.979,-.4587,5],[-1.9947,-.2294,5],[-2,0,5]]};function T(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.makeGroup();if(n>0){var s=t.makeCircle(0,0,e);s.stroke=a,s.linewidth=n,r.add(s)}for(var i=0;i<4;i++){var o=i*Math.PI/2,c=(i+1)*Math.PI/2,u=t.makeArcSegment(0,0,0,e,o,c);u.fill=i%2===0?"#ffffff":a,u.noStroke(),r.add(u)}return r}function E(t,e,a){var n=-5*Math.PI/4,r=Math.PI/4,s=n,i=e,o=t.makeArcSegment(0,0,i,i,r,s);o.stroke=a,o.linewidth=2,o.noFill();var c=t.makePolygon(0,0,6,3);c.fill=a;var u=t.makeGroup(o,c),l=function(t){if(u.visible=!!t,t){var e=Math.min(Math.abs(t)/10,1);o.opacity=e,c.opacity=e;var a=t<0?r:s;c.rotation=a+(t<0?Math.PI:0),c.translation.set(i*Math.cos(a),i*Math.sin(a))}};return l(0),{force:u,setControl:l}}function I(t,e){var a={data:[]};return a.lines=Object(d["a"])(Array(e)).map((function(){var e=t.makeLine(0,0,0,0);return e})),a.update=function(t){a.data.forEach((function(e,n){var r=t(e);a.lines[n].vertices[0].x=r[0],a.lines[n].vertices[0].y=r[1],a.lines[n].vertices[1].x=r[0],a.lines[n].vertices[1].y=r[1],n>0&&(a.lines[n-1].vertices[1].x=r[0],a.lines[n-1].vertices[1].y=r[1])}))},a}var $=function(t){Object(y["a"])(n,t);var e=Object(g["a"])(n);function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(f["a"])(this,n),e.call(this,n.STATES,n.COMMANDS,Object(p["a"])(Object(p["a"])({},t),{},{m:1}))}return Object(v["a"])(n,[{key:"bound",value:function(t){}},{key:"dynamics",value:function(t,e){return new o.a.Matrix([t.get(1),e.get(0)/this.params.m])}},{key:"xJacobian",value:function(t,e){return new o.a.Matrix([[0,1],[0,0]])}},{key:"uJacobian",value:function(t,e){return new o.a.Matrix([[0],[1/this.params.m]])}},{key:"trackMouse",value:function(t,e){var a=this.trim(),n=a.u,r=this.dynamics(this.x,n),s=10*(t[0]-this.x.get(0));this.x.set(1,h.a.clamp(s,-15,15)),r.set(0,this.x.get(1));var i=this.x.matAdd(r.mul(e));return this.bound(i),this.setState(i),{u:n}}},{key:"createGraphics",value:function(t,e){var a=this,n={cartWidth:e,cartHeight:e/2,mr:e/10},r=t.makeRectangle(0,0,n.cartWidth,n.cartHeight);r.fill=b["a"].teal.base,r.linewidth=2;var s=[-n.cartWidth/2,n.cartWidth/2].map((function(e){var a=t.makeLine(e,0,e,0);a.linewidth=2,a.stroke=b["a"].red.base;var n=t.makePolygon(0,0,6,3);return n.rotation=Math.PI/2*Math.sign(e),n.fill=b["a"].red.base,{group:t.makeGroup(a,n),fLine:a,fHead:n}}));this.graphics.showControl=!0,this.graphics.setControl=function(t){s.forEach((function(e,r){var s=h.a.clamp(5*t.get(0),-100,100);e.group.visible=a.graphics.showControl&&(r-.5)*s>0&&Math.abs(s)>.1,e.fHead.translation.x=Math.sign(s)*n.cartWidth/2+s,e.fLine.vertices[1].x=e.fHead.translation.x}))},this.graphics.cart=t.makeGroup(r,s[0].group,s[1].group);var i=T(t,n.mr,b["a"].green.darken4,4);this.graphics.cart.add(i),this.graphics.traj=I(t,this.mpcParams().nPts)}},{key:"updateGraphics",value:function(t,e){var a,n=e.u,r=this.x;(a=this.graphics.cart.translation).set.apply(a,Object(d["a"])(t([r.get(0),0]))),n&&this.graphics.setControl(n),this.graphics.cart.opacity=e.ghost?.3:1,this.graphics.traj.update((function(e){return t([e.get(0),.1])}))}},{key:"lqrParams",value:function(){return{x0:[-2,0],Q:S([10,1]),R:S([1]),simEps:1,simDuration:4,disengage:!1,divergenceThres:1e10}}},{key:"valueIterationParams",value:function(){return{x:{min:[-5,-2],max:[5,2],nPts:[100,100],targets:[[0,0]]},u:{min:[-2],max:[2],nPts:[2]},dt:.05,x0:[-2,0],dump:function(){return a.e("chunk-2d20fcfa").then(a.t.bind(null,"b4e7",3))}}}},{key:"directCollocationParams",value:function(){return{nPts:20,uBounds:{min:[-5],max:[5]},anchors:[{t:0,x:[-2,0]},{t:1,x:[2,0]}],reverse:!0,traj:_}}},{key:"mpcParams",value:function(){return{nPts:10,uBounds:{min:[-10],max:[10]},dt:.1,traj:_}}},{key:"kalmanFilterParams",value:function(){function t(t,e){var a=new o.a.Matrix(t.pos),n=new o.a.Matrix([e.get(0),0]),r=a.matSub(n).norm();return new o.a.Matrix([r])}return{covariance:[[5,0],[0,5]],processNoise:[[0,0],[0,0]],inputNoise:[[0,0],[0,0]],sensors:[{type:"radar",dt:1,pos:[-2,2],measurement:t,noise:[[5]]}]}}}]),n}(k);Object(m["a"])($,"NAME","second order"),Object(m["a"])($,"TAG","secondOrder"),Object(m["a"])($,"STATES",Object.freeze([{name:"x",show:!0},{name:"xDot",show:!0,derivative:!0}])),Object(m["a"])($,"COMMANDS",Object.freeze([{name:"force"}]));var D=$,V=a("45eb"),G=a("7e84"),B={dt:.10915679928353673,x:[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,5],[.031,.5376,5],[.1178,.981,5],[.2472,1.2832,5],[.4014,1.4195,5],[.5407,.8422,-5],[.5692,-.3306,-5],[.4697,-1.4049,-5],[.2599,-2.2674,-5],[-.0306,-2.8188,-5],[-.3628,-3.0037,-5],[-.6958,-2.8435,-5],[-.9954,-2.4296,-5],[-1.2393,-1.8763,-5],[-1.4126,-1.1475,-2.669],[-1.4783,.1174,5],[-1.3732,1.7272,5],[-1.0933,3.1987,5],[-.6608,4.4,5],[-.118,5.1155,5],[.4702,5.1955,5],[1.0344,4.7275,5],[1.5278,3.9923,5],[1.9367,3.268,5],[2.2726,2.7184,5],[2.5597,2.4095,5],[2.8132,2.0054,-1.3786],[3.0015,1.3015,-5],[3.1071,.5949,-5],[3.14,0,-5],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,0],[3.14,0,-5],[3.14,0,-5],[3.1071,-.5949,-5],[3.0015,-1.3015,-1.3786],[2.8132,-2.0054,5],[2.5597,-2.4095,5],[2.2726,-2.7184,5],[1.9367,-3.268,5],[1.5278,-3.9923,5],[1.0344,-4.7275,5],[.4702,-5.1955,5],[-.118,-5.1155,5],[-.6608,-4.4,5],[-1.0933,-3.1987,5],[-1.3732,-1.7272,5],[-1.4783,-.1174,-2.669],[-1.4126,1.1475,-5],[-1.2393,1.8763,-5],[-.9954,2.4296,-5],[-.6958,2.8435,-5],[-.3628,3.0037,-5],[-.0306,2.8188,-5],[.2599,2.2674,-5],[.4697,1.4049,-5],[.5692,.3306,-5],[.5407,-.8422,5],[.4014,-1.4195,5],[.2472,-1.2832,5],[.1178,-.981,5],[.031,-.5376,5],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]]},N=(a("ddb0"),a("6149")),R=a.n(N),L=function(t){Object(y["a"])(a,t);var e=Object(g["a"])(a);function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(f["a"])(this,a);var n=t["n"]||3,r=Object(d["a"])(Array(2*n).keys()).map((function(t){return{name:t<n?"theta".concat(t):"theta".concat(t-n,"Dot"),show:t<n,derivative:t>=n}})),s=Object(d["a"])(Array(n).keys()).map((function(t){return{name:"t".concat(t)}}));return e.call(this,r,s,Object(p["a"])({m:1,l:1,g:9.8,n:n,mu:.4},t))}return Object(v["a"])(a,[{key:"trim",value:function(){var t=this.params.n,e=Object(d["a"])(Array(2*t).keys()).map((function(t){return 0==t?Math.PI:0})),a=Object(d["a"])(Array(t).keys()).map((function(){return 0}));return{x:new o.a.Matrix(e),u:new o.a.Matrix(a)}}},{key:"bound",value:function(t){Object(V["a"])(Object(G["a"])(a.prototype),"bound",this).call(this,t);for(var e=0;e<this.params.n;e++)t.set(e,j(t.get(e)))}},{key:"jacobians",value:function(t){for(var e=[],a=[],n=0;n<this.params.n;n++){var r=Math.cos(t.get(n)),s=Math.sin(t.get(n)),i=this.params.l;e.push(new o.a.Matrix([[r,-s,r*i],[s,r,s*i],[0,0,1]])),a.push(new o.a.Matrix([[-s,-r,-s*i],[r,-s,r*i],[0,0,0]]))}for(var c=[],u=new o.a.Matrix([0,0,1]),l=[],h=0;h<this.params.n;h++)l.push(o.a.Matrix.identity(3,3));for(var m=0;m<this.params.n;m++){c.push(o.a.Matrix(3,0));for(var d=0;d<this.params.n;d++)l[d].matMulSelf(d==m?a[m]:e[m]),c[m]=c[m].hcat(l[d].matMul(u).mul(d>m?0:1))}return c}},{key:"dynamics",value:function(t,e){for(var a=this.jacobians(t),n=[],r=1e-10,s=0;s<this.params.n;s++)n.push(o.a.Matrix(3,this.params.n));for(var i=0;i<this.params.n;i++){var c=o.a.Matrix(t);c.set(i,c.get(i)+r);for(var u=this.jacobians(c),l=t.get(this.params.n+i),h=0;h<this.params.n;h++)n[h].matAddSelf(u[h].matSub(a[h]).mul(l/r))}for(var m=o.a.Matrix(this.params.n,this.params.n),d=o.a.Matrix(this.params.n,this.params.n),p=o.a.Matrix(this.params.n,1),f=o.a.Matrix(this.params.n,1),v=o.a.Matrix(this.params.n,1),y=new o.a.Matrix([9.81,0,1]),g=0;g<this.params.n;g++){var b=a[g].transpose();m.matAddSelf(b.matMul(a[g]).mul(this.params.m)),d.matAddSelf(b.matMul(n[g]).mul(this.params.m)),p.matAddSelf(b.matMul(y).mul(this.params.m)),f.set(g,1);var x=t.get(this.params.n+g)*this.params.mu;v.matAddSelf(f.mul(e.get(g)-x))}var w=t.block(this.params.n,0,this.params.n,1),k=m.inverse(),j=d.matMul(w),M=k.matMul(p.matAdd(v).matSub(j));return w.vcat(M)}},{key:"xJacobian",value:function(t,e){}},{key:"uJacobian",value:function(t,e){}},{key:"trackMouse",value:function(t,e){for(var a=this.trim(),n=a.u,r=this.dynamics(this.x,n),s=Math.atan2(t[1],t[0])+Math.PI/2,i=0;i<this.params.n;i++){var o=0==i?s:0,c=this.x.get(i);this.x.set(this.params.n+i,10*j(o-c)),r.set(i,this.x.get(this.params.n+i)),r.set(this.params.n+i,0)}var u=this.x.matAdd(r.mul(e));return this.bound(u),this.setState(u),{u:n}}},{key:"createGraphics",value:function(t,e){var n={length:e,radius:14,thickness:8};this.graphics=a.createArm(t,n,b["a"].purple.lighten2,b["a"].indigo.darken4,this.params.n)}},{key:"updateGraphics",value:function(t,e){e.y,e.xRef;var n=e.u;a.updateArm(this.graphics,t,this.x,n)}},{key:"lqrParams",value:function(){var t=this,e=Object(d["a"])(Array(2*this.params.n).keys()).map((function(t){return(0==t?Math.PI:0)+Math.PI/8})),a=Object(d["a"])(Array(2*this.params.n).keys()).map((function(e){return e<t.params.n?10:1})),n=Object(d["a"])(Array(this.params.n).keys()).map((function(t){return 1}));return{x0:e,Q:S(a),R:S(n),simEps:.1,simDuration:3,disengage:!0,divergenceThres:500}}},{key:"rrtParams",value:function(){var t=this.params.n,e=Object(d["a"])(Array(t)).map((function(t){return-Math.PI})),a=Object(d["a"])(Array(t)).map((function(t){return Math.PI})),n=Object(d["a"])(Array(t)).map((function(t){return!0})),r=Object(d["a"])(Array(t)).map((function(t){return Math.PI/10}));return{nPts:400,n:t,xMin:e,xMax:a,wrap:n,deltas:r}}}],[{key:"createPole",value:function(t,e,a){var n=t.makeRectangle(0,e.length/2,e.thickness,e.length+e.thickness);n.fill=a,n.linewidth=2;var r=t.makeCircle(0,e.length,e.radius);return r.fill=R()(a).darken(1),r.linewidth=2,t.makeGroup(n,r)}},{key:"createArm",value:function(t,e,n,r,s){for(var i=[],o=null,c=0;c<s;c++){var u=a.createPole(t,e,n);o?(o.translation.set(0,e.length),o=t.makeGroup(o,u)):o=u;var l=E(t,3*e.radius/2,b["a"].red.base),h=l.force,m=l.setControl;o=t.makeGroup(o,h),i.push({arm:o,setControl:m})}var d=T(t,2*e.radius/3,r,5);return i.push(t.makeGroup(o,d)),i.reverse(),i}},{key:"updateArm",value:function(t,e,a,n){var r;(r=t[0].translation).set.apply(r,Object(d["a"])(e([0,0])));for(var s=0;s<t.length-1;s++)t[s+1].setControl(n?n.get(s):null),t[s+1].arm.rotation=-a.get(s)}}]),a}(k);Object(m["a"])(L,"NAME","arm"),Object(m["a"])(L,"TAG","arm");var F=L,z=function(t){Object(y["a"])(n,t);var e=Object(g["a"])(n);function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(f["a"])(this,n),e.call(this,n.STATES,n.COMMANDS,Object(p["a"])(Object(p["a"])({},t),{},{g:9.81,l:1,m:1,mu:.5}))}return Object(v["a"])(n,[{key:"trim",value:function(){return{x:new o.a.Matrix([Math.PI,0]),u:new o.a.Matrix([0])}}},{key:"bound",value:function(t){Object(V["a"])(Object(G["a"])(n.prototype),"bound",this).call(this,t),t.set(0,j(t.get(0)))}},{key:"dynamics",value:function(t,e){var a=this.params,n=new o.a.Matrix(2,1),r=Math.sin(t.get(0)),s=(-a.m*a.g*a.l*r-a.mu*t.get(1)+e.get(0))/(a.m*Math.pow(a.l,2));return n.set(0,t.get(1)),n.set(1,s),n}},{key:"xJacobian",value:function(t,e){var a=this.params,n=Math.cos(t.get(0));return new o.a.Matrix([[0,1],[-a.g/a.l*n,-a.mu/a.m*a.l]])}},{key:"uJacobian",value:function(t,e){var a=this.params;return new o.a.Matrix([[0],[1/a.m/M(a.l)]])}},{key:"trackMouse",value:function(t,e){var a=this.trim(),n=a.u,r=this.dynamics(this.x,n),s=Math.atan2(t[1],t[0])+Math.PI/2;this.x.set(1,10*j(s-this.x.get(0))),r.set(0,this.x.get(1)),r.set(1,0);var i=this.x.matAdd(r.mul(e));return this.bound(i),this.setState(i),{u:n}}},{key:"createGraphics",value:function(t,e){var a={length:e,thickness:8,radius:16};this.graphics.arm=F.createArm(t,a,b["a"].green.lighten2,b["a"].green.darken4,1),this.graphics.scale=e,this.graphics.traj=I(t,this.mpcParams().nPts)}},{key:"updateGraphics",value:function(t,e){var a=this,n=e.u,r=e.ghost;F.updateArm(this.graphics.arm,t,this.x,n),this.graphics.arm[0].opacity=r?.3:1;var s=t([0,0]);this.graphics.traj.update((function(t){return[s[0]+a.graphics.scale*Math.sin(t.get(0)),s[1]+a.graphics.scale*Math.cos(t.get(0))]}))}},{key:"lqrParams",value:function(){return{Q:S([10,1]),R:S([1]),simEps:.1,simDuration:3,disengage:!1,divergenceThres:500}}},{key:"valueIterationParams",value:function(){var t=2*Math.sqrt(this.params.g/this.params.l);return{x:{min:[-Math.PI,-t],max:[Math.PI,t],nPts:[100,100],targets:[[Math.PI,0],[-Math.PI,0]]},u:{min:[-2],max:[2],nPts:[2]},dt:.06,x0:[0,0],dump:function(){return a.e("chunk-2d0e6259").then(a.t.bind(null,"9804",3))}}}},{key:"directCollocationParams",value:function(){return{nPts:30,uBounds:{min:[-5],max:[5]},anchors:[{t:0,x:[0,0]},{t:1,x:[3.14,0]}],holdTime:1,reverse:!0,traj:B}}},{key:"mpcParams",value:function(){return{nPts:10,uBounds:{min:[-5],max:[5]},dt:.1,traj:B}}}]),n}(k);Object(m["a"])(z,"NAME","simple pendulum"),Object(m["a"])(z,"TAG","simplePendulum"),Object(m["a"])(z,"STATES",Object.freeze([{name:"theta",show:!0},{name:"thetaDot",show:!0,derivative:!0}])),Object(m["a"])(z,"COMMANDS",Object.freeze([{name:"torque"}]));var W=z,U={dt:.08968001145385139,x:[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,-5.7017,0],[-.0047,.0045,.109,-.1137,7.8064,0],[.0295,-.0295,.5188,-.5007,2.0357,0],[.0634,-.0591,.0305,.0427,-9.3072,0],[.0057,.0065,-1.4032,1.4821,-20,0],[-.1928,.2033,-2.6864,2.4833,-20,0],[-.4538,.4105,-2.8027,1.788,-15.6632,0],[-.6802,.5133,-1.8248,.3797,18.3396,0],[-.7713,.4941,-.1341,-.7166,20,0],[-.7016,.3807,1.6774,-1.8077,20,0],[-.4419,.1227,4.1189,-4.096,20,0],[.0631,-.384,6.0305,-5.7228,20,0],[.5701,-.7571,5.0727,-2.3249,20,0],[1.0464,-.8252,5.3283,.9074,20,0],[1.565,-.5798,5.7731,4.3402,20,0],[2.0712,-.0636,4.7821,6.3804,4.335,0],[2.4221,.5407,2.8478,6.4709,18.6823,0],[2.6023,1.1161,.9821,5.88,1.4458,0],[2.6249,1.633,-.2238,5.2374,20,0],[2.603,2.0735,-.073,4.148,20,0],[2.6419,2.3794,1.021,2.3707,20,0],[2.8013,2.5116,2.4247,.5172,20,0],[3.0556,2.5206,2.7142,.033,-7.9654,0],[3.2713,2.5456,1.8743,.5155,-20,0],[3.4025,2.6096,.9948,.8066,-20,0],[3.4603,2.6899,.2623,.9171,-20,0],[3.4511,2.7817,-.4742,1.0909,-20,0],[3.3665,2.9025,-1.407,1.6047,-20,0],[3.2146,3.0639,-1.4885,1.5341,10.0599,0],[3.14,3.14,0,0,20,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,20,0],[3.14,3.14,0,0,10.0599,0],[3.2146,3.0639,1.4885,-1.5341,-20,0],[3.3665,2.9025,1.407,-1.6047,-20,0],[3.4511,2.7817,.4742,-1.0909,-20,0],[3.4603,2.6899,-.2623,-.9171,-20,0],[3.4025,2.6096,-.9948,-.8066,-20,0],[3.2713,2.5456,-1.8743,-.5155,-7.9654,0],[3.0556,2.5206,-2.7142,-.033,20,0],[2.8013,2.5116,-2.4247,-.5172,20,0],[2.6419,2.3794,-1.021,-2.3707,20,0],[2.603,2.0735,.073,-4.148,20,0],[2.6249,1.633,.2238,-5.2374,1.4458,0],[2.6023,1.1161,-.9821,-5.88,18.6823,0],[2.4221,.5407,-2.8478,-6.4709,4.335,0],[2.0712,-.0636,-4.7821,-6.3804,20,0],[1.565,-.5798,-5.7731,-4.3402,20,0],[1.0464,-.8252,-5.3283,-.9074,20,0],[.5701,-.7571,-5.0727,2.3249,20,0],[.0631,-.384,-6.0305,5.7228,20,0],[-.4419,.1227,-4.1189,4.096,20,0],[-.7016,.3807,-1.6774,1.8077,20,0],[-.7713,.4941,.1341,.7166,18.3396,0],[-.6802,.5133,1.8248,-.3797,-15.6632,0],[-.4538,.4105,2.8027,-1.788,-20,0],[-.1928,.2033,2.6864,-2.4833,-20,0],[.0057,.0065,1.4032,-1.4821,-9.3072,0],[.0634,-.0591,-.0305,-.0427,2.0357,0],[.0295,-.0295,-.5188,.5007,7.8064,0],[-.0047,.0045,-.109,.1137,-5.7017,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]]},J={dt:.07214248870903087,x:[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,13.9654,0],[.0337,-.0332,.8431,-.8203,10.109,0],[.1152,-.1099,1.301,-1.1782,8.6174,0],[.1967,-.1771,.5906,-.3445,-18.5342,0],[.181,-.1426,-1.0296,1.2858,-20,0],[.0425,.0153,-2.6732,2.9274,-20,0],[-.1926,.2592,-3.4667,3.3495,-20,0],[-.4472,.4747,-3.3579,2.3634,-18.2052,0],[-.6914,.605,-3.2815,1.152,-19.9604,0],[-.9263,.6433,-2.9372,-.0949,3.8244,0],[-1.1085,.6023,-1.8817,-.9105,19.6717,0],[-1.1954,.5224,-.453,-1.1934,20,0],[-1.1748,.4282,1.0105,-1.3762,20,0],[-1.0451,.3092,2.5152,-1.9506,20,0],[-.7942,.1144,4.3996,-3.5809,20,0],[-.3554,-.2823,7.3986,-7.0289,20,0],[.1777,-.7333,6.4889,-4.2167,20,0],[.6353,-.9139,6.091,-.7257,18.1196,0],[1.0923,-.8401,6.2202,2.6889,7.3802,0],[1.5417,-.5323,5.8012,5.4497,9.8245,0],[1.9263,-.0693,4.439,6.8081,9.5708,0],[2.1824,.4426,2.4344,6.8786,7.7052,0],[2.2923,.939,.6365,6.5332,15.5142,0],[2.2917,1.4122,-.5447,6.2676,20,0],[2.2303,1.8618,-.9495,5.778,20,0],[2.1806,2.2419,-.2525,4.3728,20,0],[2.1985,2.5081,.7095,2.8831,20,0],[2.2801,2.6778,1.4705,1.7468,20,0],[2.4147,2.7692,2.1771,.7182,20,0],[2.6046,2.7817,2.9759,-.3991,18.3944,0],[2.8462,2.7211,3.4005,-1.0547,4.1372,0],[3.0827,2.6551,2.8403,-.5793,-13.8352,0],[3.2585,2.6394,1.922,.1124,-20,0],[3.3705,2.6642,1.1408,.5069,-20,0],[3.4307,2.7098,.4983,.7081,-20,0],[3.4451,2.7684,-.1101,.8817,-20,0],[3.413,2.843,-.7773,1.1695,-20,0],[3.3253,2.949,-1.6416,1.7666,-20,0],[3.1945,3.0847,-1.4742,1.5052,18.2226,0],[3.14,3.14,0,0,20,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,0,0],[3.14,3.14,0,0,20,0],[3.14,3.14,0,0,18.2226,0],[3.1945,3.0847,1.4742,-1.5052,-20,0],[3.3253,2.949,1.6416,-1.7666,-20,0],[3.413,2.843,.7773,-1.1695,-20,0],[3.4451,2.7684,.1101,-.8817,-20,0],[3.4307,2.7098,-.4983,-.7081,-20,0],[3.3705,2.6642,-1.1408,-.5069,-20,0],[3.2585,2.6394,-1.922,-.1124,-13.8352,0],[3.0827,2.6551,-2.8403,.5793,4.1372,0],[2.8462,2.7211,-3.4005,1.0547,18.3944,0],[2.6046,2.7817,-2.9759,.3991,20,0],[2.4147,2.7692,-2.1771,-.7182,20,0],[2.2801,2.6778,-1.4705,-1.7468,20,0],[2.1985,2.5081,-.7095,-2.8831,20,0],[2.1806,2.2419,.2525,-4.3728,20,0],[2.2303,1.8618,.9495,-5.778,20,0],[2.2917,1.4122,.5447,-6.2676,15.5142,0],[2.2923,.939,-.6365,-6.5332,7.7052,0],[2.1824,.4426,-2.4344,-6.8786,9.5708,0],[1.9263,-.0693,-4.439,-6.8081,9.8245,0],[1.5417,-.5323,-5.8012,-5.4497,7.3802,0],[1.0923,-.8401,-6.2202,-2.6889,18.1196,0],[.6353,-.9139,-6.091,.7257,20,0],[.1777,-.7333,-6.4889,4.2167,20,0],[-.3554,-.2823,-7.3986,7.0289,20,0],[-.7942,.1144,-4.3996,3.5809,20,0],[-1.0451,.3092,-2.5152,1.9506,20,0],[-1.1748,.4282,-1.0105,1.3762,20,0],[-1.1954,.5224,.453,1.1934,19.6717,0],[-1.1085,.6023,1.8817,.9105,3.8244,0],[-.9263,.6433,2.9372,.0949,-19.9604,0],[-.6914,.605,3.2815,-1.152,-18.2052,0],[-.4472,.4747,3.3579,-2.3634,-20,0],[-.1926,.2592,3.4667,-3.3495,-20,0],[.0425,.0153,2.6732,-2.9274,-20,0],[.181,-.1426,1.0296,-1.2858,-18.5342,0],[.1967,-.1771,-.5906,.3445,8.6174,0],[.1152,-.1099,-1.301,1.1782,10.109,0],[.0337,-.0332,-.8431,.8203,13.9654,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]]},H=function(t){Object(y["a"])(a,t);var e=Object(g["a"])(a);function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(f["a"])(this,a),e.call(this,a.STATES,a.COMMANDS,Object(p["a"])({m1:1,l1:1,m2:1,l2:1,g:9.8,mu:.2,s2:0},t))}return Object(v["a"])(a,[{key:"trim",value:function(){return{x:new o.a.Matrix([Math.PI,Math.PI,0,0]),u:new o.a.Matrix([0,0])}}},{key:"bound",value:function(t){Object(V["a"])(Object(G["a"])(a.prototype),"bound",this).call(this,t),t.set(0,j(t.get(0))),t.set(1,j(t.get(1)))}},{key:"dynamics",value:function(t,e){var a=this.params,n=[t.get(0),t.get(1),t.get(2),t.get(3)],r=n[0],s=n[1],i=n[2],c=n[3],u=[Math.sin(t.get(0)),Math.sin(t.get(1))],l=u[0],h=u[1],m=r-s,d=[Math.cos(m),Math.sin(m)],p=d[0],f=d[1],v=a.m2/(a.m1+a.m2),y=a.l2/a.l1,g=y*v*p,b=p/y,x=-a.mu*i+e.get(0),w=-a.mu*(c-i)+a.s2*e.get(1),k=-y*v*M(c)*f-a.g/a.l1*l+x/M(a.l1)/(a.m1+a.m2),j=M(i)*f/y-a.g/a.l2*h+w/a.m2/M(a.l2),S=(k-g*j)/(1-g*b),O=(-b*k+j)/(1-g*b);return new o.a.Matrix([i,c,S,O])}},{key:"xJacobian",value:function(t,e){var a=this.params,n=[t.get(0),t.get(1),t.get(2),t.get(3)],r=n[0],s=n[1],i=n[2],c=n[3],u=[e.get(0),e.get(1)],l=u[0],h=u[1];h*=a.s2;var m=[Math.sin(t.get(0)),Math.sin(t.get(1))],d=m[0],p=m[1],f=r-s,v=[Math.cos(f),Math.sin(f)],y=v[0],g=v[1],b=Math.cos(2*r-2*s),x=Math.sin(2*r-2*s),w=Math.cos(r-2*s),k=[Math.cos(r),Math.cos(s)],j=k[0],S=k[1],O=(a.g*j/a.l1+a.m2*M(i)*M(y)/(a.m1+a.m2)-a.l2*a.m2*g*((h+a.mu*(i-c))/(M(a.l2)*a.m2)-a.g*p/a.l2+a.l1*M(i)*g/a.l2)/(a.l1*(a.m1+a.m2))+a.l2*a.m2*M(c)*y/(a.l1*(a.m1+a.m2)))/(a.m2*M(y)/(a.m1+a.m2)-1)+2*a.m2*y*g*(a.g*d/a.l1-(l-a.mu*i)/(M(a.l1)*(a.m1+a.m2))+a.l2*a.m2*y*((h+a.mu*(i-c))/(M(a.l2)*a.m2)-a.g*p/a.l2+a.l1*M(i)*g/a.l2)/(a.l1*(a.m1+a.m2))+a.l2*a.m2*M(c)*g/(a.l1*(a.m1+a.m2)))/(M(a.m2*M(y)/(a.m1+a.m2)-1)*(a.m1+a.m2)),P=2*(a.m2*y*M(a.l2)*M(c)+a.l1*a.m2*b*a.l2*M(i)+a.g*a.m2*w*a.l2-a.mu*g*i+a.mu*g*c-h*g)/(a.l1*a.l2*(2*a.m1+a.m2-a.m2*b))-2*a.m2*y*g*(a.m1+a.m2)*(a.g*d/a.l1-(l-a.mu*i)/(M(a.l1)*(a.m1+a.m2))+y*(a.l1*a.l2*a.m2*g*M(i)+a.mu*i+h-a.mu*c-a.g*a.l2*a.m2*p)/(a.l1*a.l2*(a.m1+a.m2))+a.l2*a.m2*M(c)*g/(a.l1*(a.m1+a.m2)))/M(-a.m2*M(y)+a.m1+a.m2),A=-(a.l2*a.m2*i*x*M(a.l1)+a.mu*y*a.l1+a.l2*a.mu)/(M(a.l1)*a.l2*(a.m1+a.m2-a.m2*M(y))),C=(-2*a.m2*c*g*M(a.l2)+a.mu*y)/(a.l1*a.l2*(a.m1+a.m2-a.m2*M(y))),_=-(a.l1*y*(a.l2*a.m2*y*M(c)/(a.l1*(a.m1+a.m2))+a.g*j/a.l1)/a.l2-a.l1*g*(a.l2*a.m2*g*M(c)/(a.l1*(a.m1+a.m2))+a.g*d/a.l1-(l-a.mu*i)/(M(a.l1)*(a.m1+a.m2)))/a.l2+a.l1*M(i)*y/a.l2)/(a.m2*M(y)/(a.m1+a.m2)-1)-2*a.m2*y*g*((h+a.mu*(i-c))/(M(a.l2)*a.m2)-a.g*p/a.l2+a.l1*y*(a.l2*a.m2*g*M(c)/(a.l1*(a.m1+a.m2))+a.g*d/a.l1-(l-a.mu*i)/(M(a.l1)*(a.m1+a.m2)))/a.l2+a.l1*M(i)*g/a.l2)/(M(a.m2*M(y)/(a.m1+a.m2)-1)*(a.m1+a.m2)),T=(a.g*S/a.l2-a.l1*g*(a.l2*a.m2*g*M(c)/(a.l1*(a.m1+a.m2))+a.g*d/a.l1-(l-a.mu*i)/(M(a.l1)*(a.m1+a.m2)))/a.l2+a.l1*M(i)*y/a.l2+a.m2*M(c)*M(y)/(a.m1+a.m2))/(a.m2*M(y)/(a.m1+a.m2)-1)+2*a.m2*y*g*((h+a.mu*(i-c))/(M(a.l2)*a.m2)-a.g*p/a.l2+a.l1*y*(a.l2*a.m2*g*M(c)/(a.l1*(a.m1+a.m2))+a.g*d/a.l1-(l-a.mu*i)/(M(a.l1)*(a.m1+a.m2)))/a.l2+a.l1*M(i)*g/a.l2)/(M(a.m2*M(y)/(a.m1+a.m2)-1)*(a.m1+a.m2)),E=((a.m1+a.m2)*(a.mu/(M(a.l2)*a.m2)+2*a.l1*i*g/a.l2)+a.mu*y/(a.l1*a.l2))/(a.m1+a.m2-a.m2*M(y)),I=-(-c*x*M(a.l2)*M(a.m2)+a.mu*a.m2+a.m1*a.mu)/(M(a.l2)*a.m2*(a.m1+a.m2-a.m2*M(y)));return new o.a.Matrix([[0,0,1,0],[0,0,0,1],[O,P,A,C],[_,T,E,I]])}},{key:"uJacobian",value:function(t,e){var a=this.params,n=[t.get(0),t.get(1)],r=n[0],s=n[1],i=r-s,c=Math.cos(i),u=1/(M(a.l1)*(a.m1+a.m2-a.m2*M(c))),l=-c/(a.l1*a.l2*(a.m1+a.m2-a.m2*M(c))),h=-c/(a.l1*a.l2*(a.m1+a.m2-a.m2*M(c))),m=(a.m1+a.m2)/(M(a.l2)*a.m2*(a.m1+a.m2-a.m2*M(c)));return new o.a.Matrix([[0,0],[0,0],[u,l*a.s2],[h,m*a.s2]])}},{key:"trackMouse",value:function(t,e){var a=this.trim(),n=a.u,r=this.dynamics(this.x,n),s=Math.atan2(t[1],t[0])+Math.PI/2;this.x.set(2,10*j(s-this.x.get(0))),this.x.set(3,10*j(this.x.get(0)-this.x.get(1))),r.set(0,this.x.get(2)),r.set(2,0);var i=this.x.matAdd(r.mul(e));return this.bound(i),this.setState(i),{u:n}}},{key:"createGraphics",value:function(t,e){var a={length:e,radius:14,thickness:8};this.graphics.arm=F.createArm(t,a,b["a"].indigo.lighten2,b["a"].indigo.darken4,2),this.graphics.scale=e,this.graphics.traj=I(t,this.mpcParams().nPts),this.graphics.trajSup=I(t,this.mpcParams().nPts)}},{key:"updateGraphics",value:function(t,e){var a=this,n=(e.y,e.xRef,e.u),r=e.ghost,s=o.a.Matrix(this.x);s.set(1,s.get(1)-s.get(0)),this.graphics.arm[0].opacity=r?.3:1,F.updateArm(this.graphics.arm,t,s,n);var i=t([0,0]);this.graphics.traj.update((function(t){return[i[0]+a.graphics.scale*Math.sin(t.get(0)),i[1]+a.graphics.scale*Math.cos(t.get(0))]})),this.graphics.trajSup.data=this.graphics.traj.data,this.graphics.trajSup.update((function(t){return[i[0]+a.graphics.scale*(Math.sin(t.get(0))+Math.sin(t.get(1))),i[1]+a.graphics.scale*(Math.cos(t.get(0))+Math.cos(t.get(1)))]}))}},{key:"lqrParams",value:function(){return{Q:S([10,10,1,1]),R:S([1,1]),simEps:.1,simDuration:4,disengage:!0,divergenceThres:500}}},{key:"directCollocationParams",value:function(){return{nPts:30,uBounds:{min:[-20,-0],max:[20,0]},anchors:[{t:0,x:[0,0,0,0]},{t:1,x:[3.14,3.14,0,0]}],holdTime:1,reverse:!0,traj:U}}},{key:"mpcParams",value:function(){return{nPts:20,uBounds:{min:[-20,-0],max:[20,0]},dt:.1,traj:J}}}]),a}(k);Object(m["a"])(H,"NAME","double pendulum"),Object(m["a"])(H,"TAG","doublePendulum"),Object(m["a"])(H,"STATES",Object.freeze([{name:"theta1",show:!0},{name:"theta2",show:!0},{name:"theta1Dot",derivative:!0},{name:"theta2Dot",derivative:!0}])),Object(m["a"])(H,"COMMANDS",Object.freeze([{name:"t1"},{name:"t2"}]));var q=H,Q={dt:.08630639823503299,x:[[-2,0,0,0,0,0,0,20],[-1.9994,.042,-.0413,.025,.9254,-.9085,0,20],[-1.9909,.1679,-.1651,.1996,1.8416,-1.817,0,20],[-1.9542,.3751,-.3714,.6682,2.7025,-2.7255,0,20],[-1.8569,.6539,-.6603,1.5504,3.3924,-3.634,0,20],[-1.6584,.9802,-1.0317,2.8945,3.7083,-4.5424,0,20],[-1.3391,1.3017,-1.4754,3.95,3.2212,-5.1115,0,5.0571],[-.9664,1.5536,-1.9467,4.1779,2.3161,-5.2264,0,0],[-.5855,1.7226,-2.4223,4.2191,1.3907,-5.2533,0,1.1845],[-.2004,1.8058,-2.9012,4.2474,.4541,-5.2802,0,0],[.1855,1.8054,-3.3803,4.2444,-.476,-5.2606,.8645,0],[.5701,1.7192,-3.8569,4.2258,-1.4087,-5.2377,.1429,0],[.9538,1.5505,-4.3326,4.2209,-2.304,-5.2344,0,0],[1.3301,1.2997,-4.8045,3.9851,-3.2105,-5.1156,5.2343,0],[1.652,.9791,-5.2483,2.9205,-3.699,-4.5424,20,0],[1.8528,.6534,-5.6197,1.5726,-3.3875,-3.634,20,0],[1.9519,.3749,-5.9086,.6853,-2.7003,-2.7255,20,0],[1.9899,.1679,-6.1149,.2111,-1.8409,-1.817,20,0],[1.9992,.042,-6.2387,.0308,-.9253,-.9085,20,0],[2,0,-6.28,0,0,0,20,0],[1.9992,.042,-6.2387,-.0308,.9253,.9085,20,0],[1.9899,.1679,-6.1149,-.2111,1.8409,1.817,20,0],[1.9519,.3749,-5.9086,-.6853,2.7003,2.7255,20,0],[1.8528,.6534,-5.6197,-1.5726,3.3875,3.634,20,0],[1.652,.9791,-5.2483,-2.9205,3.699,4.5424,5.2343,0],[1.3301,1.2997,-4.8045,-3.9851,3.2105,5.1156,0,0],[.9538,1.5505,-4.3326,-4.2209,2.304,5.2344,.1429,0],[.5701,1.7192,-3.8569,-4.2258,1.4087,5.2377,.8645,0],[.1855,1.8054,-3.3803,-4.2444,.476,5.2606,0,0],[-.2004,1.8058,-2.9012,-4.2474,-.4541,5.2802,0,1.1845],[-.5855,1.7226,-2.4223,-4.2191,-1.3907,5.2533,0,0],[-.9664,1.5536,-1.9467,-4.1779,-2.3161,5.2264,0,5.0571],[-1.3391,1.3017,-1.4754,-3.95,-3.2212,5.1115,0,20],[-1.6584,.9802,-1.0317,-2.8945,-3.7083,4.5424,0,20],[-1.8569,.6539,-.6603,-1.5504,-3.3924,3.634,0,20],[-1.9542,.3751,-.3714,-.6682,-2.7025,2.7255,0,20],[-1.9909,.1679,-.1651,-.1996,-1.8416,1.817,0,20],[-1.9994,.042,-.0413,-.025,-.9254,.9085,0,20],[-2,0,0,0,0,0,0,20]]},K={dt:.07917123999790385,x:[[-2,0,0,0,0,0,11.7191,0],[-2.0002,.0125,.0229,-.0096,.3757,.5924,17.015,0],[-2.0027,.053,.0889,-.0501,.4262,.8638,0,3.8536],[-2.0102,.0836,.1456,-.1632,.5069,.4152,0,17.9013],[-2.0328,.152,.1495,-.3862,1.1475,-.3181,0,17.6678],[-2.0728,.2729,.0932,-.5702,1.7863,-1.0479,0,17.729],[-2.1234,.4478,-.0237,-.629,2.4656,-1.7931,0,18.416],[-2.1702,.6819,-.2038,-.4561,3.2291,-2.5852,0,20],[-2.189,.9801,-.451,.0642,3.9808,-3.4099,0,20],[-2.1483,1.3329,-.7662,.9956,4.5247,-4.2346,0,20],[-2.0136,1.7154,-1.1495,2.3311,4.6664,-5.0593,0,20],[-1.7562,2.0854,-1.6007,3.9335,4.1846,-5.884,0,20],[-1.3656,2.3838,-2.12,5.4992,2.9189,-6.7087,0,20],[-.8603,2.5438,-2.691,6.6544,.8247,-6.942,15.5805,6.8996],[-.2952,2.5243,-3.2506,6.9091,-1.094,-6.6507,5.45,0],[.2717,2.3888,-3.7929,6.8452,-2.1166,-6.5383,0,0],[.8191,2.1679,-4.3213,6.1901,-3.3406,-6.1477,18.9482,0],[1.2679,1.8447,-4.7964,4.6819,-4.3766,-5.3778,18.3892,0],[1.5916,1.4649,-5.2078,3.1793,-4.724,-4.5864,20,0],[1.7985,1.0811,-5.552,1.8961,-4.5097,-3.7617,20,0],[1.9147,.7305,-5.8282,.9849,-3.9502,-2.937,20,0],[1.9707,.4344,-6.0364,.4278,-3.2099,-2.1123,20,0],[1.9929,.203,-6.1766,.1474,-2.395,-1.2876,20,0],[1.9993,.0485,-6.2531,.0265,-1.2477,-.6184,20,7.5437],[2,0,-6.28,0,0,0,20,7.5437],[1.9993,.0485,-6.2531,-.0265,1.2477,.6184,20,0],[1.9929,.203,-6.1766,-.1474,2.395,1.2876,20,0],[1.9707,.4344,-6.0364,-.4278,3.2099,2.1123,20,0],[1.9147,.7305,-5.8282,-.9849,3.9502,2.937,20,0],[1.7985,1.0811,-5.552,-1.8961,4.5097,3.7617,20,0],[1.5916,1.4649,-5.2078,-3.1793,4.724,4.5864,18.3892,0],[1.2679,1.8447,-4.7964,-4.6819,4.3766,5.3778,18.9482,0],[.8191,2.1679,-4.3213,-6.1901,3.3406,6.1477,0,0],[.2717,2.3888,-3.7929,-6.8452,2.1166,6.5383,5.45,0],[-.2952,2.5243,-3.2506,-6.9091,1.094,6.6507,15.5805,6.8996],[-.8603,2.5438,-2.691,-6.6544,-.8247,6.942,0,20],[-1.3656,2.3838,-2.12,-5.4992,-2.9189,6.7087,0,20],[-1.7562,2.0854,-1.6007,-3.9335,-4.1846,5.884,0,20],[-2.0136,1.7154,-1.1495,-2.3311,-4.6664,5.0593,0,20],[-2.1483,1.3329,-.7662,-.9956,-4.5247,4.2346,0,20],[-2.189,.9801,-.451,-.0642,-3.9808,3.4099,0,20],[-2.1702,.6819,-.2038,.4561,-3.2291,2.5852,0,18.416],[-2.1234,.4478,-.0237,.629,-2.4656,1.7931,0,17.729],[-2.0728,.2729,.0932,.5702,-1.7863,1.0479,0,17.6678],[-2.0328,.152,.1495,.3862,-1.1475,.3181,0,17.9013],[-2.0102,.0836,.1456,.1632,-.5069,-.4152,0,3.8536],[-2.0027,.053,.0889,.0501,-.4262,-.8638,17.015,0],[-2.0002,.0125,.0229,.0096,-.3757,-.5924,11.7191,0],[-2,0,0,0,0,0,11.7191,0]]},Y=function(t){Object(y["a"])(a,t);var e=Object(g["a"])(a);function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(f["a"])(this,a),e.call(this,a.STATES,a.COMMANDS,Object(p["a"])({g:9.81,l:1,m:1,I:1},t))}return Object(v["a"])(a,[{key:"trim",value:function(){var t=this.params.g*this.params.m/2;return{x:new o.a.Matrix(6,1),u:new o.a.Matrix([t,t])}}},{key:"bound",value:function(t){t.set(2,j(t.get(2)))}},{key:"dynamics",value:function(t,e){var a=this.params,n=[Math.cos(t.get(2)),Math.sin(t.get(2))],r=n[0],s=n[1],i=[e.get(0),e.get(1)],c=i[0],u=i[1],l=new o.a.Matrix([-(c+u)*s/a.m,(c+u)*r/a.m-a.g,a.l/2*(c-u)/a.I]),h=t.block(3,0,3,1);return h.vcat(l)}},{key:"xJacobian",value:function(t,e){var a=this.params,n=[Math.cos(t.get(2)),Math.sin(t.get(2))],r=n[0],s=n[1],i=[e.get(0),e.get(1)],c=i[0],u=i[1],l=-(c+u)*r/a.m,h=-(c+u)*s/a.m;return new o.a.Matrix([[0,0,0,1,0,0],[0,0,0,0,1,0],[0,0,0,0,0,1],[0,0,l,0,0,0],[0,0,h,0,0,0],[0,0,0,0,0,0]])}},{key:"uJacobian",value:function(t,e){var a=this.params,n=[Math.cos(t.get(2)),Math.sin(t.get(2))],r=n[0],s=n[1],i=-s/a.m,c=r/a.m,u=a.l/2/a.I;return new o.a.Matrix([[0,0],[0,0],[0,0],[i,i],[c,c],[u,-u]])}},{key:"trackMouse",value:function(t,e){var a=this.trim(),n=a.u;n.mulSelf(0);var r=new o.a.Matrix([t[0]-this.x.get(0),t[1]-this.x.get(1),-this.x.get(2)]).mul(10).clamp(-10,10),s=r.vcat(new o.a.Matrix(3,1));this.x.setBlock(3,0,r.block(0,0,3,1));var i=this.x.matAdd(s.mul(e));return this.bound(i),this.setState(i),{u:n}}},{key:"createGraphics",value:function(t,e){var a={thickness:8,length:e,mr:e/10},n=t.makeRectangle(0,0,a.length,a.thickness);n.fill=b["a"].blue.base,n.linewidth=2;var r=-1.5*a.thickness,s=a.length/4;this.graphics.force=[null,null];var i=[3*a.length/7,-3*a.length/7].map((function(e){var a=t.makeLine(e-s,r,e+s,r);a.linewidth=3,a.fill=b["a"].green.base;var n=t.makeLine(e,-3,e,r);n.linewidth=2,n.fill=b["a"].green.base;var i=t.makeLine(e,r,e,r-10);i.linewidth=2,i.stroke=b["a"].red.base;var o=t.makePolygon(e,r-10,6,3);return o.fill=b["a"].red.base,{prop:t.makeGroup(a,n,i,o),fLine:i,fHead:o}}));this.graphics.setControl=function(t){i.forEach((function(e,a){if(e.fHead.visible=e.fLine.visible=!!t,t){var n=h.a.clamp(5*t.get(a),-100,100);e.fHead.translation.y=r-n,e.fHead.rotation=n>0?0:Math.PI,e.fLine.vertices[1].y=e.fHead.translation.y}}))},this.graphics.system=t.makeGroup(n,i[0].prop,i[1].prop);var o=T(t,a.mr,b["a"].blue.darken4,4);this.graphics.system.add(o),this.graphics.traj=I(t,this.mpcParams().nPts)}},{key:"updateGraphics",value:function(t,e){var a,n=e.u,r=this.x;(a=this.graphics.system.translation).set.apply(a,Object(d["a"])(t([r.get(0),r.get(1)]))),this.graphics.system.rotation=-r.get(2),this.graphics.setControl(n),this.graphics.system.opacity=e.ghost?.3:1,this.graphics.traj.update((function(e){return t([e.get(0),e.get(1)])}))}},{key:"differentialFlatness",value:function(t,e){var a=this.params;t=C(t,e,1);var n=A(t,e,1,!0),r=A(n,e,1,!0),s=r.map((function(t){var e=Math.atan(-t.get(0)/(t.get(1)+a.g));return new o.a.Matrix([e])})),i=A(s,e,1,!0),c=A(i,e,1,!0);return t.map((function(t,e){var u=a.m*Math.sqrt(M(r[e].get(0))+M(r[e].get(1)+a.g))/2,l=a.I*c[e].get(0)/a.l,h=new o.a.Matrix([u+l,u-l]);return t.vcat(s[e]).vcat(n[e]).vcat(i[e]).vcat(h)}))}},{key:"lqrParams",value:function(){return{x0:[-2,0,0,0,0,0],Q:S([10,10,10,1,1,1]),R:S([1,1]),simEps:.1,simDuration:5,disengage:!1,divergenceThres:100}}},{key:"directCollocationParams",value:function(){return{nPts:20,uBounds:{min:[0,0],max:[20,20]},anchors:[{t:0,x:[-2,0,0,0,0,0]},{t:1,x:[2,0,-6.28,0,0,0]}],holdTime:0,reverse:!0,traj:Q}}},{key:"mpcParams",value:function(){return{nPts:10,uBounds:{min:[-10,-10],max:[25,25]},dt:.1,traj:K}}}]),a}(k);Object(m["a"])(Y,"NAME","quadrotor"),Object(m["a"])(Y,"TAG","quadrotor2D"),Object(m["a"])(Y,"STATES",Object.freeze([{name:"x",show:!0},{name:"y",show:!0},{name:"theta",show:!0},{name:"yDot",derivative:!0},{name:"xDot",derivative:!0},{name:"thetaDot",derivative:!0}])),Object(m["a"])(Y,"COMMANDS",Object.freeze([{name:"t1"},{name:"t2"}]));var X=Y,Z={dt:.09926270822947234,x:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,-10],[-.0526,.0522,-1.023,1.0051,-10],[-.2091,.2017,-2.017,1.8711,-10],[-.4643,.4262,-2.9376,2.4411,-10],[-.8021,.6832,-3.5616,2.4463,-5.8533],[-1.163,.896,-3.2328,1.5154,9.833],[-1.4483,.9822,-2.3738,.1949,6.9799],[-1.6507,.9362,-1.5185,-1.1202,10],[-1.7531,.7473,-.4587,-2.5749,10],[-1.7409,.4045,.7104,-4.1004,10],[-1.6085,-.0865,1.8278,-5.358,10],[-1.4042,-.6394,1.8607,-5.0605,-4.2416],[-1.2613,-1.0893,.8576,-3.6672,-10],[-1.2192,-1.4005,.0961,-2.4585,-2.8066],[-1.2238,-1.6,-.1438,-1.4358,-1.0141],[-1.2274,-1.6948,.2396,-.3919,10],[-1.1577,-1.678,1.1162,.7169,10],[-.9996,-1.5496,1.9529,1.7663,10],[-.789,-1.3166,1.8412,2.8126,-10],[-.6567,-.9594,.702,4.1958,-10],[-.6521,-.4447,-.6321,5.8482,-10],[-.7799,.2278,-1.7546,7.0568,-10],[-.9524,.9249,-1.2237,6.1475,10],[-1.0038,1.4776,.1753,4.7203,10],[-.9253,1.9143,1.3216,3.8731,10],[-.7364,2.2901,2.3474,3.5291,10],[-.4649,2.6398,2.7277,3.1765,-2.9038],[-.212,2.9206,2.0705,2.2083,-10],[-.0528,3.0866,1.0303,1.0494,-10],[0,3.14,0,0,-10],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,-10],[0,3.14,0,0,-10],[-.0528,3.0866,1.0303,1.0494,-10],[-.212,2.9206,2.0705,2.2083,-2.9038],[-.4649,2.6398,2.7277,3.1765,10],[-.7364,2.2901,2.3474,3.5291,10],[-.9253,1.9143,1.3216,3.8731,10],[-1.0038,1.4776,.1753,4.7203,10],[-.9524,.9249,-1.2237,6.1475,-10],[-.7799,.2278,-1.7546,7.0568,-10],[-.6521,-.4447,-.6321,5.8482,-10],[-.6567,-.9594,.702,4.1958,-10],[-.789,-1.3166,1.8412,2.8126,10],[-.9996,-1.5496,1.9529,1.7663,10],[-1.1577,-1.678,1.1162,.7169,10],[-1.2274,-1.6948,.2396,-.3919,-1.0141],[-1.2238,-1.6,-.1438,-1.4358,-2.8066],[-1.2192,-1.4005,.0961,-2.4585,-10],[-1.2613,-1.0893,.8576,-3.6672,-4.2416],[-1.4042,-.6394,1.8607,-5.0605,10],[-1.6085,-.0865,1.8278,-5.358,10],[-1.7409,.4045,.7104,-4.1004,10],[-1.7531,.7473,-.4587,-2.5749,10],[-1.6507,.9362,-1.5185,-1.1202,6.9799],[-1.4483,.9822,-2.3738,.1949,9.833],[-1.163,.896,-3.2328,1.5154,-5.8533],[-.8021,.6832,-3.5616,2.4463,-10],[-.4643,.4262,-2.9376,2.4411,-10],[-.2091,.2017,-2.017,1.8711,-10],[-.0526,.0522,-1.023,1.0051,-10],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]},tt={dt:.12169516451329707,x:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,-10],[-.0777,.0767,-1.241,1.2087,-10],[-.258,.2427,-1.2431,1.0193,9.2645],[-.3361,.2753,.0063,-.5154,10],[-.2544,.1144,1.3007,-2.0356,10],[-.0141,-.2187,2.5254,-3.2053,10],[.3506,-.6387,3.1599,-3.2877,3.7714],[.7242,-.9827,2.584,-2.0345,-10],[.9706,-1.1324,1.3831,-.3863,-10],[1.071,-1.0808,.2199,1.2208,-10],[1.0206,-.8224,-1.0592,2.9524,-10],[.798,-.3359,-2.5255,4.8374,-10],[.3996,.3581,-3.7484,6.0397,-10],[-.0659,1.0706,-3.3462,5.0316,7.302],[-.4006,1.6013,-2.0263,3.5639,10],[-.5769,1.9836,-.8274,2.6472,10],[-.611,2.2818,.2758,2.2069,10],[-.5078,2.5535,1.3847,2.227,10],[-.2887,2.8354,1.9232,2.1718,-.3442],[-.0781,3.0608,1.2539,1.2871,-10],[0,3.14,0,0,-10],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,0],[0,3.14,0,0,-10],[-.0781,3.0608,-1.2539,-1.2871,-10],[-.286,2.8381,-1.8587,-2.1082,.7075],[-.4919,2.5694,-1.2602,-2.0957,10],[-.5799,2.3161,-.1569,-2.0392,10],[-.5318,2.0425,.9308,-2.4151,10],[-.3448,1.6949,2.0871,-3.2331,10],[-.0117,1.2141,3.2186,-4.5469,5.3899],[.4257,.5665,3.5018,-5.5923,-10],[.806,-.1028,2.4832,-4.8765,-10],[1.0281,-.6065,1.0626,-3.1269,-10],[1.0762,-.8831,-.2655,-1.3242,-10],[.9666,-.9413,-1.4835,.3854,-10],[.7044,-.7855,-2.7363,2.1263,-10],[.3229,-.4427,-3.0159,3.0282,8.5836],[.0071,-.0982,-1.9831,2.3503,10],[-.1629,.1188,-.7305,1.0718,10],[-.1743,.1623,.5499,-.3828,10],[-.0639,.063,.9104,-.8828,-4.6821],[0,0,0,0,-10],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]]},et=function(t){Object(y["a"])(a,t);var e=Object(g["a"])(a);function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(f["a"])(this,a),e.call(this,a.STATES,a.COMMANDS,Object(p["a"])(Object(p["a"])({},t),{},{g:9.81,l:1,mp:.2,mc:1,mu:.5}))}return Object(v["a"])(a,[{key:"trim",value:function(){return{x:new o.a.Matrix([0,Math.PI,0,0]),u:new o.a.Matrix([0])}}},{key:"bound",value:function(t){Object(V["a"])(Object(G["a"])(a.prototype),"bound",this).call(this,t),t.set(1,j(t.get(1)))}},{key:"dynamics",value:function(t,e){var a=this.params,n=[Math.cos(t.get(1)),Math.sin(t.get(1))],r=n[0],s=n[1],i=t.block(2,0,2,1),c=a.mc+a.mp*M(s),u=new o.a.Matrix([(e.get(0)+a.mp*s*(a.l*M(t.get(3))+a.g*r))/c,-(e.get(0)*r+a.mp*a.l*M(t.get(3))*r*s+(a.mp+a.mc)*a.g*s)/a.l/c]);return i.vcat(u)}},{key:"xJacobian",value:function(t,e){var a=this.params,n=t.get(3),r=e.get(0),s=[Math.cos(t.get(1)),Math.sin(t.get(1))],i=s[0],c=s[1],u=[M(i),M(c),M(n)],l=u[0],h=u[1],m=u[2],d=a.mp*h+a.mc,p=(a.mp*i*(a.l*m+a.g*i)-a.g*a.mp*h)/d-2*a.mp*i*c*(r+a.mp*c*(a.l*m+a.g*i))/M(d),f=2*a.l*a.mp*n*c/d,v=(r*c-a.g*i*(a.mc+a.mp)-a.l*a.mp*m*l+a.l*a.mp*m*h)/(a.l*d)+2*a.mp*i*c*(a.l*a.mp*i*c*m+r*i+a.g*c*(a.mc+a.mp))/(a.l*M(d)),y=-2*a.mp*n*i*c/d;return new o.a.Matrix([[0,0,1,0],[0,0,0,1],[0,p,0,f],[0,v,0,y]])}},{key:"uJacobian",value:function(t,e){var a=this.params,n=[Math.cos(t.get(1)),Math.sin(t.get(1))],r=n[0],s=n[1],i=M(s),c=1/(a.mp*i+a.mc),u=-r/(a.l*(a.mp*i+a.mc));return new o.a.Matrix([[0],[0],[c],[u]])}},{key:"trackMouse",value:function(t,e){var a=this.trim(),n=a.u,r=this.dynamics(this.x,n),s=10*(t[0]-this.x.get(0)),i=10*j(Math.PI-this.x.get(1));this.x.set(2,h.a.clamp(s,-15,15)),this.x.set(3,i),r.set(0,this.x.get(2)),r.set(1,this.x.get(3)),r.set(2,0),r.set(3,0);var o=this.x.matAdd(r.mul(e));return this.bound(o),this.setState(o),{u:n}}},{key:"createGraphics",value:function(t,e){var a="#00897B",n="#1565C0",r="#F44336",s={thickness:8,radius:14,length:e,cartWidth:96,cartHeight:48},i=t.makeRectangle(0,0,s.cartWidth,s.cartHeight);i.fill=n,i.linewidth=2;var o=t.makeRectangle(0,s.length/2,s.thickness,s.length+s.thickness);o.fill=a,o.linewidth=2;var c=t.makeCircle(0,s.length,s.radius);c.fill=n,c.linewidth=2;var u=t.makeGroup(o,c),l=T(t,2*s.radius/3,b["a"].indigo.darken4,5),m=[-s.cartWidth/2,s.cartWidth/2].map((function(e){var a=t.makeLine(e,0,e,0);a.linewidth=2,a.stroke=r;var n=t.makePolygon(0,0,6,3);n.rotation=Math.PI/2*Math.sign(e),n.fill=r;var s=t.makeGroup(a,n);return s.visible=!1,{group:s,fLine:a,fHead:n}})),d=function(t){t&&m.forEach((function(e,a){var n=h.a.clamp(5*t.get(0),-100,100);e.group.visible=(a-.5)*n>.01,e.fHead.translation.x=Math.sign(n)*s.cartWidth/2+n,e.fLine.vertices[1].x=e.fHead.translation.x}))};this.graphics={setControl:d,cart:t.makeGroup(i,u,l,m[0].group,m[1].group),pole:u},this.graphics.scale=s.length,this.graphics.traj=I(t,this.mpcParams().nPts)}},{key:"updateGraphics",value:function(t,e){var a,n=this,r=e.u,s=e.ghost,i=this.x;this.graphics.cart.opacity=s?.3:1,this.graphics.pole.rotation=-i.get(1),(a=this.graphics.cart.translation).set.apply(a,Object(d["a"])(t([i.get(0),0]))),this.graphics.setControl(r),this.graphics.traj.update((function(e){var a=t([e.get(0),0]);return[a[0]+n.graphics.scale*Math.sin(e.get(1)),a[1]+n.graphics.scale*Math.cos(e.get(1))]}))}},{key:"lqrParams",value:function(){return{x0:[-2,Math.PI,0,0],Q:S([10,10,1,1]),R:S([1]),simEps:.1,simDuration:5,disengage:!1,divergenceThres:500}}},{key:"directCollocationParams",value:function(){return{nPts:30,uBounds:{min:[-10],max:[10]},anchors:[{t:0,x:[0,0,0,0]},{t:1,x:[0,3.14,0,0]}],holdTime:1,traj:Z}}},{key:"mpcParams",value:function(){return{nPts:20,uBounds:{min:[-10],max:[10]},dt:.1,traj:tt,xWeight:[100,100,.1,.1]}}}]),a}(k);Object(m["a"])(et,"NAME","cart pole"),Object(m["a"])(et,"TAG","cartPole"),Object(m["a"])(et,"STATES",Object.freeze([{name:"x",show:!0},{name:"theta",angle:!0,min:-Math.PI,max:Math.PI,show:!0},{name:"xDot"},{name:"thetaDot"}])),Object(m["a"])(et,"COMMANDS",Object.freeze([{name:"force"}]));var at=et,nt=a("f077"),rt=function(t){Object(y["a"])(a,t);var e=Object(g["a"])(a);function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(f["a"])(this,a),e.call(this,a.STATES,a.COMMANDS,Object(p["a"])(Object(p["a"])({},t),{},{l:1,mu:.5,maxAccel:20,maxDelta:Math.PI/4}))}return Object(v["a"])(a,[{key:"trim",value:function(){return{x:new o.a.Matrix([0,0,Math.PI/2,0]),u:new o.a.Matrix([0,0])}}},{key:"bound",value:function(t){Object(V["a"])(Object(G["a"])(a.prototype),"bound",this).call(this,t),t.set(2,j(t.get(2)))}},{key:"dynamics",value:function(t,e){var a=this.params,n=t.get(2),r=t.get(3),s=e.get(1);return new o.a.Matrix([Math.cos(n)*r,Math.sin(n)*r,r*Math.tan(s)/a.l,e.get(0)-r*a.mu])}},{key:"trackMouse",value:function(t,e){var a=this.params,n=[this.x.get(0),this.x.get(1)],r=n[0],s=n[1],i=[this.x.get(2),this.x.get(3)],c=i[0],u=i[1],l=[t[0],t[1]],m=l[0],d=l[1],p=Math.sqrt(Math.pow(m-r,2)+Math.pow(d-s,2)),f=[Math.cos(c),Math.sin(c)],v=f[0],y=f[1],g=v*(m-r)+y*(d-s),b=v*(d-s)-y*(m-r),x=g<0?Math.sign(b)*a.maxDelta:Math.asin(b/Math.max(p,.001)),w=Math.max(p-.1,0),k=h.a.clamp(10*(w-.5*u),-a.maxAccel,a.maxAccel),j=h.a.clamp(x,-a.maxDelta,a.maxDelta),M=new o.a.Matrix([k,j]);return this.step(M,e),{u:M}}},{key:"createGraphics",value:function(t,e){var a=this,n={l:e/2,w:3*e/10,a1:.6,a2:.4,b:.6,c:.3,lw:e/4,ww:e/12,mr:e/12},r=[[-n.l,n.w*n.a1],[-n.l*n.b,n.w*n.a1],[-n.l*n.c,n.w],[n.l*n.c,n.w],[n.l*n.b,n.w*n.a2],[n.l,n.w*n.a2]];r=r.concat(r.map((function(t){var e=Object(x["a"])(t,2),a=e[0],n=e[1];return[a,-n]})).reverse());var s=t.makePath.apply(t,Object(d["a"])(h.a.flatten(r)).concat([!1]));s.automatic=!1,s.fill=b["a"].blue.base,s.stroke=b["a"].blue.darken4,s.linewidth=3,this.graphics.car=t.makeGroup(s);var i=T(t,n.mr,b["a"].blue.darken4,5);this.graphics.car.add(i),this.graphics.wheels=[];var o=[[-1,-1],[-1,1],[1,-1],[1,1]];o.forEach((function(e,r){var s=Object(x["a"])(e,2),i=s[0],o=s[1],c=t.makeRectangle(0,0,n.lw,n.ww);c.translation.set(i*(n.l-n.lw/6),o*(n.w-n.ww/2)),c.noStroke(),c.fill="#000000",a.graphics.wheels[r]=c,a.graphics.car.add(c)})),this.graphics.showControl=!0,this.graphics.setControl=function(t){var e=t.get(1);a.graphics.wheels[2].rotation=-e,a.graphics.wheels[3].rotation=-e}}},{key:"updateGraphics",value:function(t,e){var a,n=e.u,r=this.x;(a=this.graphics.car.translation).set.apply(a,Object(d["a"])(t([r.get(0),r.get(1)]))),this.graphics.car.rotation=-r.get(2),this.graphics.setControl(n)}},{key:"kalmanFilterParams",value:function(){function t(t,e){var a=new o.a.Matrix(t.pos),n=a.matSub(e.block(0,0,2,1)).norm();return new o.a.Matrix([n])}return{covariance:[[5,0,0,0],[0,5,0,0],[0,0,0,0],[0,0,0,0]],processNoise:[[.1,0,0,0],[0,.1,0,0],[0,0,.02,0],[0,0,0,0]],inputNoise:[[0,0],[0,0]],sensors:[{type:"radar",dt:1,pos:[-2,2],measurement:t,noise:[[1]]},{type:"radar",dt:1,pos:[2,2],measurement:t,noise:[[1]]}]}}},{key:"particleFilterParams",value:function(){function t(t,e){var a=new o.a.Matrix(t.pos),n=a.matSub(e.block(0,0,2,1)).norm();return new o.a.Matrix([n])}return{nPts:30,dt:1,distribution:"exact",processNoise:[[.02,0,0,0],[0,.02,0,0],[0,0,.1,0],[0,0,0,.1]],range:{min:[-3,-3,-Math.PI,0],max:[3,3,Math.PI,10]},type:"2d",sensors:[{type:"radar",dt:1,pos:[-4,4],measurement:t,noise:[[2]]},{type:"radar",dt:1,pos:[-4,-4],measurement:t,noise:[[2]]},{type:"radar",dt:1,pos:[4,-4],measurement:t,noise:[[2]]},{type:"radar",dt:1,pos:[4,4],measurement:t,noise:[[2]]}]}}}]),a}(k);Object(m["a"])(rt,"TAG","car"),Object(m["a"])(rt,"NAME","car"),Object(m["a"])(rt,"STATES",Object.freeze([{name:"x",show:!0},{name:"y",show:!0},{name:"theta",show:!0},{name:"v",show:!1}])),Object(m["a"])(rt,"COMMANDS",Object.freeze([{name:"accel"},{name:"delta"}]));var st,it=rt,ot=(st={},Object(m["a"])(st,D.TAG,D),Object(m["a"])(st,W.TAG,W),Object(m["a"])(st,q.TAG,q),Object(m["a"])(st,X.TAG,X),Object(m["a"])(st,at.TAG,at),Object(m["a"])(st,F.TAG,F),Object(m["a"])(st,it.TAG,it),st),ct=ot,ut={props:{},computed:{title:function(){var t=this.$route.meta.title,e=this.$route.params;if(e.systemName){var a=ct[e.systemName];return"".concat(t," - ").concat(a.NAME)}return this.$route.name},showBack:function(){return!1},dark:function(){return!0},routeName:function(){return h.a.get(this.$route,"name")},color:function(){return h.a.get({home:"#004D40"},this.routeName,"primary")},routeQuery:function(){return h.a.get(this.$route,"query",{})},showRightDrawer:function(){return h.a.get(this.$route,"meta.rightDrawer",!1)}},created:function(){},methods:{navback:function(){this.$bus.$emit("navback")}}},lt=ut,ht=a("2877"),mt=a("6544"),dt=a.n(mt),pt=a("40dc"),ft=a("5bc1"),vt=a("8336"),yt=a("132d"),gt=a("2fa4"),bt=a("2a7f"),xt=Object(ht["a"])(lt,c,u,!1,null,null,null),wt=xt.exports;dt()(xt,{VAppBar:pt["a"],VAppBarNavIcon:ft["a"],VBtn:vt["a"],VIcon:yt["a"],VSpacer:gt["a"],VToolbarItems:bt["a"],VToolbarTitle:bt["b"]});var kt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-navigation-drawer",{attrs:{app:"",clipped:""},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[a("v-list",{attrs:{dense:""}},[a("v-list-item",{on:{click:t.navHome}},[a("v-list-item-icon",[a("v-icon",[t._v("mdi-home")])],1),a("v-list-item-title",[t._v("Home")])],1),a("v-divider"),t._l(t.envRoutes,(function(e,n){return a("v-list-group",{key:"env_"+n,attrs:{"prepend-icon":e.meta.icon,value:t.isEnv(e.name)},scopedSlots:t._u([{key:"activator",fn:function(){return[a("v-list-item-title",[t._v(t._s(e.meta.title))])]},proxy:!0}],null,!0)},t._l(e.meta.systems,(function(r,s){return a("v-list-item",{key:"env_"+n+"_system_"+s,staticClass:"ml-3",class:{active:t.isActive(e,r)},on:{click:function(){return t.navSystem(e,r)}}},[a("v-list-item-title",[t._v(t._s(r.NAME))]),a("v-list-item-icon",[a("v-icon",[t._v(t._s(t.icons[s]))])],1)],1)})),1)}))],2),a("v-divider"),a("v-list",{staticStyle:{flex:"0 0 auto"},attrs:{dense:""}},[a("v-list-item",{on:{click:t.github}},[a("v-list-item-action",[a("v-icon",[t._v("mdi-github")])],1),a("v-list-item-content",[a("v-list-item-title",[t._v("Github")])],1)],1)],1)],1)},jt=[],Mt=a("8c4f"),St=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{display:"flex","flex-direction":"column","align-items":"center"}},[a("div",{style:t.divStyle},[a("Demo",{staticStyle:{position:"absolute"}}),t._m(0)],1),a("div",{staticStyle:{width:"100%","max-width":"960px",padding:"40px"},domProps:{innerHTML:t._s(t.markdownHtml)}})])},Ot=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{position:"absolute",display:"flex",width:"100%","justify-content":"center"}},[a("span",{staticClass:"display-1 blue--text",staticStyle:{"margin-top":"32px"}},[t._v("Controls JS")])])}],Pt='[![Website shields.io](https://img.shields.io/website-up-down-green-red/http/shields.io.svg)](https://bertrandbev.github.io/controls-js/#/)\n[![GitHub license](https://img.shields.io/github/license/Naereen/StrapDown.js.svg)](https://github.com/Naereen/StrapDown.js/blob/master/LICENSE)\n\n<p align="center">\n  <img width="340" src="/src/assets/logo.png">\n</p>\n\n# Controls.js\n\nControls.js is a sandbox showcasing a few modern controls techiques directly in the browser.\n\nIt harnesses [eigen-js](https://github.com/BertrandBev/eigen-js) for all linear algebra and quadratic programming, and [nlopt-js](https://github.com/BertrandBev/nlopt-js) for non-linear optimization.\n\n[Home](https://bertrandbev.github.io/controls-js/#/)\n\n## Environments\n\n![alt text](https://api.iconify.design/mdi-matrix.svg?color=purple&width=25&height=25) &nbsp;   [Linear quadratic regulation](https://bertrandbev.github.io/controls-js/#/lqr/cartPole)\n\n> This environment demonstrates [linear quadratic regulation](https://en.wikipedia.org/wiki/Linear%E2%80%93quadratic_regulator) of a few test systems around unstable trim points\n\n![alt text](https://api.iconify.design/mdi-restore.svg?color=purple&width=25&height=25) &nbsp;   [Value iteration](https://bertrandbev.github.io/controls-js/#/valueIteration/simplePendulum)\n\n> A simple pendulum dynamics phase plane is discretized and [the value iteration](https://en.wikipedia.org/wiki/Markov_decision_process#Value_iteration) algorithm is run to obtain a swingup policy\n\n![alt text](https://api.iconify.design/mdi-infinity.svg?color=purple&width=25&height=25) &nbsp;   [Differential flatness](https://bertrandbev.github.io/controls-js/#/flatness/quadrotor2D)\n\n> A [differentially flat](https://en.wikipedia.org/wiki/Flatness_(systems_theory)) system, a 2D quadcopter, follows a custom spatial trajectory\n\n![alt text](https://api.iconify.design/mdi-vector-curve.svg?color=purple&width=25&height=25) &nbsp;   [Direct collocation](https://bertrandbev.github.io/controls-js/#/directCollocation/cartPole)\n\n> Nonlinear trajectory optimisation is demonstrated on a few dynamical systems using [direct collocation](https://en.wikipedia.org/wiki/Trajectory_optimization)\n\n![alt text](https://api.iconify.design/mdi-camera-timer.svg?color=purple&width=25&height=25) &nbsp;   [Model predictive control](https://bertrandbev.github.io/controls-js/#/mpc/cartPole)\n\n> [Model predictive control](https://en.wikipedia.org/wiki/Model_predictive_control) is used to dynamically stabilize the systems in the previous section around their optimized trajectories for robust tracking.\n\n![alt text](https://api.iconify.design/mdi-chart-bell-curve.svg?color=purple&width=25&height=25) &nbsp;   [Kalman Filter](https://bertrandbev.github.io/controls-js/#/kalmanFilter/car)\n\n> A [kalman filter](https://en.wikipedia.org/wiki/Kalman_filter) estimator tracks a 2d top down car\'s state based on radar measurements\n\n![alt text](https://api.iconify.design/mdi-dots-hexagon.svg?color=purple&width=25&height=25) &nbsp;   [Particle Filter](https://bertrandbev.github.io/controls-js/#/particleFilter/car)\n\n> A [particle filter](https://en.wikipedia.org/wiki/Particle_filter) estimator tracks a 2d top down car\'s state based on radar measurements using a swarm of simulated particles\n',At=a("d4cd"),Ct=a.n(At),_t=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"canvas",style:t.canvasStyle},[a("div",{ref:"canvas",staticClass:"canvas"}),a("DirectCollocationPlugin",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"plugin",attrs:{system:t.system,disableMouse:!0},on:{activate:function(){}}})],1)},Tt=[],Et=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{style:t.containerStyle},[a("div",{ref:"canvas",style:t.canvasStyle},[t._t("canvas")],2),a("div",{style:t.overlayStyle},[t._t("overlay")],2),t.noSheet?t._e():a("div",{ref:"sheet",staticClass:"blue",style:t.sheetStyle},[a("div",{staticClass:"bottomBar"},[t._t("bar"),a("v-spacer"),a("v-btn",{attrs:{dark:"",text:""},on:{click:function(e){t.sheet=!t.sheet}}},[a("v-icon",{staticClass:"mr-1",attrs:{dark:""}},[t._v(t._s(t.sheet?"mdi-chevron-down":"mdi-chevron-up"))]),t._v(t._s(t.sheet?"close":"open"))],1)],2),t._t("sheet")],2),a("v-navigation-drawer",{attrs:{app:"",clipped:"",right:"",width:"300px"},model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}},[t._t("drawer")],2)],1)},It=[],$t=a("1209"),Dt={components:{},props:{noSheet:Boolean},data:function(){return{sheet:!0,drawer:null}},watch:{sheet:function(){Object($t["a"])({targets:this.$refs.sheet,translateY:this.sheet?0:this.sheetHeight,easing:"easeInOutCubic",duration:300}),Object($t["a"])({targets:this.$refs.canvas,translateY:this.sheet?-this.sheetHeight/2:0,easing:"easeInOutCubic",duration:300})}},computed:{sheetHeight:function(){return this.$store.windowSize.y/2},overlayStyle:function(){return{position:"absolute",top:"0px",left:"0px",width:"100%"}},sheetStyle:function(){var t=0;return{width:"100%",height:"".concat(this.sheetHeight,"px"),position:"absolute",bottom:"0px",transform:"translateY(".concat(t,"px)")}},canvasStyle:function(){var t=-this.sheetHeight/2;return{position:"relative",width:"100%",height:"".concat(this.$store.windowSize.y,"px"),transform:"translateY(".concat(t,"px)"),background:'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAATUlEQVRYR+3VMQoAMAhD0Xq3HNs75QgtdOqsg1C+u5C8JWF7r8ELAiCAAAIIIIBARyAz75BLKg96a47HA5RrP48tAQIggAACCCDwhcABvG5/oRsc6n0AAAAASUVORK5CYII=")',center:"center",display:"flex","flex-direction":"row","justify-content":"center","align-items":"center"}},containerStyle:function(){return{width:"100%",height:"".concat(this.$store.windowSize.y,"px"),display:"flex","flex-direction":"row","justify-content":"center","align-items":"center",background:"#00796B",position:"relative",overflow:"hidden"}}},mounted:function(){this.$bus.$on("toggleDrawer",this.toggleDrawer),this.$nextTick((function(){}))},beforeDestroy:function(){this.$bus.$off("toggleDrawer",this.toggleDrawer)},methods:{toggleDrawer:function(){this.drawer=!this.drawer}}},Vt=Dt,Gt=(a("b6dd"),a("f774")),Bt=Object(ht["a"])(Vt,Et,It,!1,null,null,null),Nt=Bt.exports;dt()(Bt,{VBtn:vt["a"],VIcon:yt["a"],VNavigationDrawer:Gt["a"],VSpacer:gt["a"]});var Rt=.98,Lt="#455A64",Ft={data:function(){return{fps:60,lastUpdate:Date.now(),t:0,two:null,mouseTarget:null,loop:null}},computed:{mouseDragging:function(){return null!==this.mouseTarget},canvas:function(){throw new Error("This method must be overidden")},height:function(){return this.canvas.parentElement.clientHeight},width:function(){return this.canvas.parentElement.clientWidth},scale:function(){throw new Error("This method must be overidden")},dt:function(){throw new Error("This method must be overidden")}},mounted:function(){var t=this,e=this.$refs.canvas,a={width:this.width,height:this.height};this.two=new nt["a"](a).appendTo(e),this.two.scale=this.scale,this.two.canvas=e,this.two.worldToCanvas=this.worldToCanvas,this.two.canvasToWorld=this.canvasToWorld,document.addEventListener("mouseup",(function(e){t.dragging=!1,t.mouseTarget=null})),e.addEventListener("mousedown",(function(e){t.dragging=!0,t.mouseTarget=t.canvasToWorld([e.offsetX,e.offsetY])})),e.addEventListener("mousemove",(function(e){t.dragging&&(t.mouseTarget=t.canvasToWorld([e.offsetX,e.offsetY]))}));var n=this.two.makeGroup(this.two.makeLine(-this.width/3,0,this.width/3,0),this.two.makeLine(0,-this.width/6,0,this.width/6));n.translation.set(this.width/2,this.height/2),n.fill=Lt;var r=function e(){var a=Date.now();t.t+=t.dt;try{t.update()}catch(i){console.error(i)}t.two.update();var n=(Date.now()-t.lastUpdate)/1e3;t.fps=t.fps*Rt+(1-Rt)/n,t.lastUpdate=Date.now();var r=Date.now()-a,s=Math.max(0,1e3*t.dt-r);t.loop=setTimeout(e,s)};this.$nextTick((function(){r()}))},beforeDestroy:function(){clearTimeout(this.loop)},methods:{canvasToWorld:function(t){return[(t[0]-this.width/2)/this.scale,-(t[1]-this.height/2)/this.scale]},worldToCanvas:function(t){return[t[0]*this.scale+this.width/2,-t[1]*this.scale+this.height/2]},update:function(){throw new Error("This method must be overidden")},reset:function(){this.t=0}}},zt={data:function(){return{system:null,isMounted:!1}},computed:{},mounted:function(){this.isMounted=!0,this.createGraphics()},methods:{createGraphics:function(){this.system.createGraphics(this.two,this.scale);var t=this.$refs.plugin;t.createGraphics(this.two)},reset:function(){this.$refs.plugin.reset()},update:function(){var t=this.$refs.plugin,e={},a=!t||t.stepSystem(),n=!t||t.mouseTargetEnabled;n&&this.mouseTarget&&a?e=this.system.trackMouse(this.mouseTarget,this.dt):t&&t.ready()?e=t.updateSystem(this.t,this.dt):a&&(e=this.system.trim(),this.system.step(e.u,this.dt)),e.t=this.t,e.dt=this.dt,t&&t.update(e),this.system.updateGraphics(this.worldToCanvas,e),o.a.GC.flush()}}},Wt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Section",{attrs:{title:"Direct Collocation"}},[a("ValueInput",{ref:"nPts",attrs:{value:t.params.nPts,label:"Point count"},on:{"update:value":function(e){return t.$set(t.params,"nPts",e)}}}),a("div",{staticClass:"mb-3 mt-3",staticStyle:{display:"flex","align-items":"center"}},[a("ArrayInput",{ref:"uMin",staticStyle:{flex:"1 0 auto",width:"0px"},attrs:{array:t.params.uBounds.min,label:"uMin"},on:{"update:array":function(e){return t.$set(t.params.uBounds,"min",e)}}}),a("ArrayInput",{ref:"uMax",staticClass:"ml-2",staticStyle:{flex:"1 0 auto",width:"0px"},attrs:{array:t.params.uBounds.max,label:"uMax"},on:{"update:array":function(e){return t.$set(t.params.uBounds,"max",e)}}})],1),t._l(t.params.anchors,(function(e,n){return a("div",{key:"anchor_"+(e.key||n),staticClass:"mb-3",staticStyle:{display:"flex","align-items":"center"}},[a("ValueInput",{ref:"time_"+n,refInFor:!0,staticStyle:{flex:"0 0 auto",width:"48px"},attrs:{value:e.t,label:"t"},on:{"update:value":function(a){return t.$set(e,"t",a)}}}),a("ArrayInput",{ref:"anchor_"+n,refInFor:!0,staticClass:"ml-2",staticStyle:{flex:"1 0 auto",width:"0px"},attrs:{array:e.x,label:"x"},on:{"update:array":function(a){return t.$set(e,"x",a)}}}),a("v-btn",{attrs:{icon:"",color:"red"},on:{click:function(e){return t.deleteAnchor(n)}}},[a("v-icon",[t._v("mdi-delete")])],1)],1)})),a("v-btn",{attrs:{outlined:"",color:"green"},on:{click:t.addAnchor}},[t._v("+ add")]),a("v-btn",{staticClass:"mt-2",attrs:{outlined:"",disabled:t.running,loading:t.running,color:"primary"},on:{click:t.runCollocation}},[t._v("run collocation")]),a("v-btn",{staticClass:"mt-2",attrs:{outlined:"",color:"primary"},on:{click:t.download}},[t._v("Download")])],2)},Ut=[],Jt=(a("a623"),a("4de4"),a("a0fe")),Ht=a.n(Jt),qt={maxTime:60,maxEval:1e6},Qt=function(){function t(e){Object(f["a"])(this,t),this.system=e}return Object(v["a"])(t,[{key:"setParams",value:function(t){var e=this;console.assert(t.nPts>=2,"The number of points must be positive"),this.params=Object(p["a"])(Object(p["a"])({},qt),t),this.n=t.nPts,this.shape=this.system.shape,this.dim=(this.shape[0]+this.shape[1])*this.n+1;var a=Ht.a.Algorithm.LD_SLSQP;this.opt=new Ht.a.Optimize(a,this.dim),this.opt.setMinObjective((function(t,a){var n=t[e.dim-1];if(a){for(var r=0;r<e.dim-1;r++)a[r]=0;a[e.dim-1]=1}return n}),1e-5),this.addDynamicContraints(),this.setBounds(t.uBounds,t.anchors)}},{key:"delete",value:function(){Ht.a.GC.flush()}},{key:"setBounds",value:function(t,e){var a=this,n=[],r=[],s=[],i=this.n*this.shape[0],o=this.dim-1,c=Infinity;function u(t,e,a){n.push(t),r.push(e),s.push(a)}for(var l=0;l<this.dim;l++)if(l<i)u(-c,c,0);else if(l<o){var m=t.min[(l-i)%this.shape[1]],d=t.max[(l-i)%this.shape[1]];u(m,d,(m+d)/2)}else u(.1,c,1);e.forEach((function(t){var e=h.a.clamp(Math.floor(t.t*a.n),0,a.n-1)*a.shape[0];console.log(t.x);for(var i=0;i<a.shape[0];i++)isNaN(t.x[i])||(r[e+i]=t.x[i],n[e+i]=t.x[i],s[e+i]=t.x[i])})),this.opt.setLowerBounds(n),this.opt.setUpperBounds(r),this.x0=s}},{key:"getVector",value:function(t,e,a){for(var n=new o.a.Matrix(a,1),r=0;r<a;r++)n.set(r,t[e+r]);return n}},{key:"constraint",value:function(t,e,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=this.shape[0],s=this.shape[1],i=(this.n-1)*r,c=Date.now(),u=1/(this.n-1),l=t[this.dim-1]*u,h=0,m=r*this.n,d=this.getVector(t,0,r),p=this.getVector(t,r*this.n,s),f=this.system.dynamics(d,p),v=e?this.system.xJacobian(d,p):null,y=e?this.system.uJacobian(d,p):null;if(e)for(var g=0;g<i*this.dim;g++)e[g]=0;for(var b=0,x=0;x<this.n-1;x++){for(var w=this.getVector(t,h+r,r),k=this.getVector(t,m+s,s),j=this.system.dynamics(w,k),M=d.matAdd(w).div(2).matAdd(f.matSub(j).mul(l/8)),S=p.matAdd(k).div(2),O=this.system.dynamics(M,S),P=d.matSub(w).matAdd(f.matAdd(O.mul(4)).matAdd(j).mul(l/6)),A=0;A<r;A++){var C=x*r+A;a[C]=0!==n?-Math.sign(n)*P.get(A):P.get(A),b=Math.max(b,Math.pow(P.get(A),2))}if(e){for(var _=this.system.xJacobian(w,k),T=this.system.uJacobian(w,k),E=this.system.xJacobian(M,S),I=this.system.uJacobian(M,S),$=o.a.Matrix.identity(r,r),D=$.div(2).matAdd(v.mul(l/8)),V=$.div(2).matSub(_.mul(l/8)),G=y.mul(l/8),B=T.mul(-l/8),N=f.matSub(j).div(8),R=$.matAdd(v.matAdd(E.matMul(D).mul(4)).mul(l/6)),L=$.mul(-1).matAdd(_.matAdd(E.matMul(V).mul(4)).mul(l/6)),F=y.matAdd(E.matMul(G).mul(4)).matAdd(I.mul(2)).mul(l/6),z=T.matAdd(E.matMul(B).mul(4)).matAdd(I.mul(2)).mul(l/6),W=f.matAdd(O.mul(4)).matAdd(j).div(6).matAdd(E.matMul(N).mul(4*l/6)),U=0;U<r;U++){for(var J=x*r+U,H=0;H<r;H++)e[J*this.dim+h+H]=R.get(U,H),e[J*this.dim+h+r+H]=L.get(U,H);for(var q=0;q<s;q++)e[J*this.dim+m+q]=F.get(U,q),e[J*this.dim+m+s+q]=z.get(U,q);e[J*this.dim+this.dim-1]=W.get(U,0)*u}v=_,y=T}d=w,p=k,f=j,h+=r,m+=s}console.log("iteration time",Date.now()-c)}},{key:"testGrad",value:function(){var t=this.shape[0],e=(this.shape[1],(this.n-1)*t),a=Object(d["a"])(Array(this.dim)).map((function(t,e){return e+1})),n=Object(d["a"])(Array(this.dim*e)).map((function(){return 0})),r=Object(d["a"])(Array(e)).map((function(){return 0}));this.constraint(a,n,r);for(var s=1e-8,i=Object(d["a"])(Array(this.dim*e)).map((function(){return 0})),o=0;o<this.dim;o++){var c=Object(d["a"])(a),u=Object(d["a"])(n).map((function(){return 0})),l=Object(d["a"])(r).map((function(){return 0}));c[o]+=s,this.constraint(c,u,l);for(var h=0;h<e;h++)i[h*this.dim+o]=(l[h]-r[h])/s}for(var m=[],p=0;p<this.dim*e;p++)m.push(Math.abs(i[p]-n[p])<1e-4?0:i[p]-n[p]);console.log("function tested"),console.log("x0",a),console.log("ret0",r),console.log("grad0",n),console.log("grad",i),console.log("diff",m)}},{key:"addDynamicContraints",value:function(){var t=this,e=Object(x["a"])(this.shape,2),a=e[0],n=(e[1],(this.n-1)*a),r=Object(d["a"])(Array(n)).map((function(){return 1e-4}));this.opt.addEqualityMConstraint((function(e,a,n){t.constraint(e,a,n)}),r)}},{key:"optimize",value:function(){this.opt.setMaxtime(this.params.maxTime),this.opt.setMaxeval(this.params.maxEval);var t=this.opt.optimize(this.x0);if(console.log("Optimization returned ",t,t.x),!t.success)return console.log("Optimization failed"),null;var e=this.unpack(t.x),a=Object(x["a"])(e,3),n=a[0],r=a[1],s=a[2];console.log("tEnd",s);var i=n.map((function(t,e){return new o.a.Matrix(t).vcat(new o.a.Matrix(r[e]))}));s=Math.max(s,.1);for(var c=s/n.length,u=o.a.Matrix(i[0]),l=o.a.Matrix(i[i.length-1]),h=Object(x["a"])(this.shape,2),m=h[0],d=h[1],p=m;p<m+d;p++)u.set(p,0),l.set(p,0);for(var f=0;f<this.params.holdTime/c;f++)i.unshift(u),i.push(l);return this.params.reverse&&(i=this.system.reverse(i)),{x:i,dt:c}}},{key:"unpack",value:function(t){var e=[],a=[],n=t[this.dim-1],r=this.n*this.shape[0];this.dim;function s(e,a){return Object(d["a"])(Array(a)).map((function(a,n){return t[e+n]}))}for(var i=0;i<r;i+=this.shape[0])e.push(s(i,this.shape[0]));for(var o=r;o<this.dim-1;o+=this.shape[1])a.push(s(o,this.shape[1]));return[e,a,n]}}]),t}();Object(m["a"])(Qt,"FREE",NaN);var Kt=Qt,Yt=(a("b680"),a("6062"),a("3ca3"),function(){function t(e){var a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(f["a"])(this,t),this.array=[],this.loop=a,this.watchers=new Set,this.system=e}return Object(v["a"])(t,[{key:"getLegend",value:function(){return this.system.statesCommands}},{key:"ready",value:function(){return this.array.length>0}},{key:"dim",value:function(){return this.ready()?this.array[0].rows():0}},{key:"reset",value:function(t){this.tStart=t}},{key:"clear",value:function(){this.array=[]}},{key:"addWatcher",value:function(t){this.watchers.add(t)}},{key:"removeWatcher",value:function(t){this.watchers.delete(t)}},{key:"set",value:function(t,e){o.a.GC.popException(this.array),console.assert(e>0,"The time must be positive"),console.assert(t.length>0,"The array must have at least one element");var a=this.system.shape[0]+this.system.shape[1];t.forEach((function(t){console.assert(t.rows()===a&&1===t.cols(),"The values must be of shape [x; u]; expected ".concat([a,1],", got ").concat([t.rows(),t.cols()]))})),o.a.GC.set(this,"array",t),this.dt=e,this.tStart=0,this.duration=(this.array.length-1)*this.dt,this.watchers.forEach((function(t){return t()}))}},{key:"get",value:function(t){t-=this.tStart;var e=Math.max(0,Math.floor(t/this.dt));e=this.loop?e%this.array.length:Math.min(this.array.length-1,e);var a=(e+1)%this.array.length;!this.loop&&a<e&&(a=e);var n=(t-e*this.dt)/this.dt;return n-=Math.floor(n),this.array.length<2?this.array[0]:this.array[e].mul(1-n).matAdd(this.array[a].mul(n))}},{key:"getState",value:function(t){return this.get(t).block(0,0,this.system.shape[0],1)}},{key:"getCommand",value:function(t){return this.get(t).block(this.system.shape[0],0,this.system.shape[1],1)}},{key:"delete",value:function(){o.a.GC.popException(this.array),this.array=null}},{key:"load",value:function(t){this.set(t.x.map((function(t){return new o.a.Matrix(t)})),t.dt)}},{key:"dump",value:function(){var t=this,e="dt: ".concat(this.dt,",\n")+"x: [";return this.array.forEach((function(a,n){e+="[";for(var r=0;r<a.length();r+=1)e+="".concat(a.get(r).toFixed(4))+(r<a.length()-1?",":"");e+="]"+(n===t.array.length-1?"]":",\n")})),e}}]),t}());var Xt=Yt,Zt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"pa-2",staticStyle:{display:"flex","flex-direction":"column"}},[a("div",{staticClass:"mb-2",staticStyle:{display:"flex","align-items":"center"}},[a("v-divider",{staticClass:"mr-2"}),a("span",[t._v(t._s(t.title))]),a("v-divider",{staticClass:"ml-2"})],1),t._t("default")],2)},te=[],ee={props:{title:String}},ae=ee,ne=a("ce7e"),re=Object(ht["a"])(ae,Zt,te,!1,null,null,null),se=re.exports;dt()(re,{VDivider:ne["a"]});var ie=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-text-field",{attrs:{label:t.label,outlined:"",dense:"","hide-details":""},model:{value:t.model,callback:function(e){t.model=e},expression:"model"}})},oe=[],ce=(a("a15b"),a("ac1f"),a("1276"),{props:{array:Array,label:String},data:function(){return{model:"",error:null}},created:function(){this.model=this.arrToStr(this.array)},watch:{model:function(){this.parseModel()}},methods:{validate:function(){return this.error&&this.$bus.notify("error",this.error),!this.error},parseModel:function(){this.error=null;try{var t=this.strToArr(this.model);t.length!==this.array.length?this.error='The array "'.concat(this.label,'" [').concat(this.model,"] should have ").concat(this.array.length," elements"):this.$emit("update:array",t)}catch(e){this.error='The array "'.concat(this.label,'" [').concat(this.model,"] could not be parsed")}},strToArr:function(t){return t.split(",").map((function(t){return parseFloat(t)}))},arrToStr:function(t){return t.join(", ")}}}),ue=ce,le=a("8654"),he=Object(ht["a"])(ue,ie,oe,!1,null,null,null),me=he.exports;dt()(he,{VTextField:le["a"]});var de=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-text-field",{attrs:{label:t.label,outlined:"",dense:"","hide-details":""},model:{value:t.model,callback:function(e){t.model=t._n(e)},expression:"model"}})},pe=[],fe=(a("a9e3"),{props:{value:Number,label:String},data:function(){return{model:0,error:null}},created:function(){this.model=this.value},watch:{model:function(){this.parseModel()}},methods:{validate:function(){return this.error&&this.$bus.notify("error",this.error),!this.error},parseModel:function(){this.error=null,isNaN(parseFloat(this.model))?this.error='The value "'.concat(this.label,'" should be defined'):this.$emit("update:value",this.model)}}}),ve=fe,ye=Object(ht["a"])(ve,de,pe,!1,null,null,null),ge=ye.exports;dt()(ye,{VTextField:le["a"]});var be={data:function(){return{active:!1}},computed:{name:function(){return this.$options.name},mouseTargetEnabled:function(){return!0}},methods:{createGraphics:function(t){},update:function(t,e){},stepSystem:function(){return!0},reset:function(){throw new Error("must be overridden")},ready:function(){throw new Error("must be overridden")},updateSystem:function(t,e){throw new Error("must be overridden")}}},xe={name:"DirectCollocationPlugin",mixins:[be],components:{Section:se,ArrayInput:me,ValueInput:ge},props:{system:Object,disableMouse:Boolean},data:function(){return{collocation:null,running:!1,simTraj:null,params:{}}},computed:{trajectories:function(){return[this.simTraj]},mouseTargetEnabled:function(){return!this.disableMouse}},created:function(){this.params=h.a.cloneDeep(this.system.directCollocationParams()),this.collocation=new Kt(this.system),this.simTraj=new Xt(this.system,!0),this.params.traj&&(this.simTraj.load(this.params.traj),this.reset())},methods:{reset:function(){if(this.simTraj.ready()){var t=this.simTraj.getState(0);this.system.setState(t)}},ready:function(){return this.simTraj.ready()},updateSystem:function(t,e){if(this.ready()){var a=this.simTraj.getCommand(t),n=this.simTraj.getState(t);return this.system.setState(n),{u:a}}},addAnchor:function(){var t=this.system.shape[0],e=Object(d["a"])(Array(t)).map((function(){return 0}));this.params.anchors.push({t:0,x:e,key:Math.random()})},deleteAnchor:function(t){this.params.anchors.splice(t,1)},runCollocation:function(){var t=this;this.running=!0,setTimeout((function(){t.optimize(),t.running=!1,t.$emit("activate",t)}),25)},optimize:function(){var t=h.a.values(this.$refs).filter((function(t){return t.validate})).map((function(t){return t.validate()}));if(h.a.every(t)){this.collocation.setParams(this.params);var e=this.collocation.optimize();e?(this.simTraj.set(e.x,e.dt),this.reset()):this.$bus.notify("error","Optimization failed")}},download:function(){var t=this.simTraj.dump();console.log(t),navigator.clipboard.writeText(t).then((function(){console.log("Async: Copying to clipboard was successful!")}),(function(t){console.error("Async: Could not copy text: ",t)}))}}},we=xe,ke=Object(ht["a"])(we,Wt,Ut,!1,null,null,null),je=ke.exports;dt()(ke,{VBtn:vt["a"],VIcon:yt["a"]});var Me={name:"demo",components:{ModelLayout:Nt,DirectCollocationPlugin:je},mixins:[Ft,zt],props:{systemName:String},data:function(){return{}},created:function(){var t=ct.cartPole;this.system=new t},mounted:function(){},computed:{canvas:function(){return this.$refs.canvas},scale:function(){return 96},dt:function(){return 1/60},canvasStyle:function(){return{width:"100%",background:'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAATUlEQVRYR+3VMQoAMAhD0Xq3HNs75QgtdOqsg1C+u5C8JWF7r8ELAiCAAAIIIIBARyAz75BLKg96a47HA5RrP48tAQIggAACCCDwhcABvG5/oRsc6n0AAAAASUVORK5CYII=")',center:"center",display:"flex","flex-direction":"row","justify-content":"center","align-items":"center"}}},methods:{reset:function(){Ft.methods.reset.call(this),zt.methods.reset.call(this)}}},Se=Me,Oe=Object(ht["a"])(Se,_t,Tt,!1,null,null,null),Pe=Oe.exports,Ae={components:{Demo:Pe},data:function(){return{markdown:Pt}},computed:{markdownHtml:function(){var t=function(t,a){return'<pre class="hljs"><span>'+e.utils.escapeHtml(t)+"</span></pre>"},e=new Ct.a({highlight:t,html:!0});return e.render(Pt)},divStyle:function(){return{width:"100%",height:"".concat(this.$store.windowSize.y,"px"),position:"relative"}}},mounted:function(){},methods:{}},Ce=Ae,_e=Object(ht["a"])(Ce,St,Ot,!1,null,null,null),Te=_e.exports,Ee=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ModelLayout",{scopedSlots:t._u([{key:"canvas",fn:function(){return[a("div",{ref:"canvas",staticClass:"canvas"})]},proxy:!0},{key:"overlay",fn:function(){return[a("div",{staticStyle:{display:"flex"}},[a("v-chip",{staticClass:"ma-2",attrs:{label:"",color:"red","text-color":"white"}},[t._v("Dynamic")]),a("v-spacer"),a("span",{staticClass:"ma-2"},[t._v("fps: "+t._s(t.fps.toFixed(0)))])],1)]},proxy:!0},{key:"drawer",fn:function(){return[a("LQRPlugin",{ref:"plugin",attrs:{system:t.system},on:{activate:function(){}}})]},proxy:!0},t.isMounted?{key:"sheet",fn:function(){return[a("TrajPlot",{attrs:{trajectories:t.$refs.plugin.trajectories}})]},proxy:!0}:null,{key:"bar",fn:function(){return[a("v-btn",{attrs:{text:"",dark:""},on:{click:t.reset}},[t._v("reset")])]},proxy:!0}],null,!0)})},Ie=[],$e=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{width:"100%",height:"100%"}},[a("div",{ref:"div",staticStyle:{width:"100%",height:"100%"}})])},De=[],Ve=a("61cc"),Ge=a.n(Ve),Be={name:"TrajPlot",props:{trajectories:Array},data:function(){return{series:[]}},computed:{},watch:{trajectories:{handler:function(t,e){var a=this;e&&e.forEach((function(t){return t.removeWatcher(a.update)})),t&&t.forEach((function(t){return t.addWatcher(a.update)})),this.update()},immediate:!0}},mounted:function(){var t={displaylogo:!1,displayModeBar:!1,scrollZoom:!1,showAxisDragHandles:!1,responsive:!0};Ge.a.newPlot(this.$refs.div,[],[],t),this.update()},beforeDestroy:function(){var t=this;this.trajectories.forEach((function(e){return e.removeWatcher(t.update)}))},methods:{getSeries:function(t,e){var a=[],n=[];return t.array.forEach((function(r,s){n.push(s*t.dt),a.push(r.get(e))})),[n,a]},update:function(){var t=this,e=[];if(this.$refs.div){this.trajectories.forEach((function(a,n){if(a.ready())for(var r=a.dim(),s=0;s<r;s++){var i=t.getSeries(a,s),o=Object(x["a"])(i,2),c=o[0],u=o[1],l=h.a.get(a.getLegend(),"[".concat(s,"].name"),"".concat(s));l=t.trajectories.length>0?"t".concat(n,"_").concat(l):l;var m=h.a.get(a.getLegend(),"[".concat(s,"].show"),!1);e.push({x:c,y:u,type:"scatter",name:l,hoverinfo:"skip",line:{dash:n>0?"dashdot":"solid"},visible:m||"legendonly"})}}));var a={xaxis:{title:"time (t)",fixedrange:!0},yaxis:{fixedrange:!0},margin:{l:40,r:100,b:60,t:30,pad:10}};Ge.a.react(this.$refs.div,e,a)}}}},Ne=Be,Re=Object(ht["a"])(Ne,$e,De,!1,null,null,null),Le=Re.exports,Fe=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Section",{attrs:{title:"LQR"}},[a("MatrixInput",{attrs:{matrix:t.params.Q,label:"Q"}}),a("MatrixInput",{staticClass:"mt-2",attrs:{matrix:t.params.R,label:"R"}}),a("ValueInput",{staticClass:"mt-3",attrs:{value:t.params.simDuration,label:"Sim duration"},on:{"update:value":function(e){return t.$set(t.params,"simDuration",e)}}}),a("ValueInput",{staticClass:"mt-3",attrs:{value:t.params.simEps,label:"Sim disturbance"},on:{"update:value":function(e){return t.$set(t.params,"simEps",e)}}}),a("div",{staticClass:"mt-3",staticStyle:{display:"flex","align-items":"center"}},[a("v-checkbox",{staticClass:"pa-0 pb-4",attrs:{label:"Auto disengage","hide-details":"",small:""},model:{value:t.params.disengage,callback:function(e){t.$set(t.params,"disengage",e)},expression:"params.disengage"}}),a("v-btn",{staticClass:"ml-3",attrs:{outlined:"",color:"red",disabled:t.enabled},on:{click:function(e){t.enabled=!0}}},[t._v("Engage")])],1),a("v-btn",{staticClass:"mt-2",attrs:{outlined:"",color:"primary"},on:{click:t.runLQR}},[t._v("update LQR")])],1)},ze=[],We=a("257e"),Ue=function t(e){Object(f["a"])(this,t),this.system=e},Je=Ue,He=function(t){Object(y["a"])(a,t);var e=Object(g["a"])(a);function a(t,n,r,s,i,c){var u;return Object(f["a"])(this,a),u=e.call(this,i,c,{}),o.a.GC.set(Object(We["a"])(u),"x0",t),o.a.GC.set(Object(We["a"])(u),"u0",n),o.a.GC.set(Object(We["a"])(u),"A",r),o.a.GC.set(Object(We["a"])(u),"B",s),u}return Object(v["a"])(a,[{key:"delete",value:function(){var t=this;["x0","u0","A","B"].forEach((function(e){return o.a.GC.popException(t[e])}))}},{key:"trim",value:function(){return{x:new o.a.Matrix(this.shape[0],1),u:new o.a.Matrix(this.shape[1],1)}}},{key:"dynamics",value:function(t,e){var a=t.matSub(this.x0),n=e.matSub(this.u0);return this.A.matMul(a).matAdd(this.B.matMul(n))}}],[{key:"fromModel",value:function(t,e,n){var r=a.linearizeSystem(t,e,n),s=Object(x["a"])(r,2),i=s[0],o=s[1];return new a(e,n,i,o,t.states,t.commands)}},{key:"linearize",value:function(t,e){var a=1e-8,n=t(e),r=[n.rows(),e.rows()],s=r[0],i=r[1];function c(t,e,a){for(var n=0;n<a.rows();n++)t.set(n,e,a.get(n))}for(var u=new o.a.Matrix(s,i),l=0;l<i;l+=1){var h=new o.a.Matrix(e);h.set(l,h.get(l)+a);var m=t(h).matSub(n).div(a);c(u,l,m)}return u}},{key:"linearizeSystem",value:function(t,e,n){var r=a.linearize((function(e){return t.dynamics(e,n)}),e),s=a.linearize((function(a){return t.dynamics(e,a)}),n);return[r,s]}},{key:"testJacobian",value:function(t){for(var e=Object(x["a"])(t.shape,2),n=e[0],r=e[1],s=new o.a.Matrix(n,1),i=0;i<n;i++)s.set(i,2.8*i+13.7);for(var c=new o.a.Matrix(r,1),u=0;u<r;u++)c.set(u,2.8*u+13.7);var l=a.linearizeSystem(t,s,c),h=Object(x["a"])(l,2),m=h[0],d=h[1],p=t.xJacobian(s,c),f=t.uJacobian(s,c);p.matSub(m).print("Jx diff"),f.matSub(d).print("Ju diff")}}]),a}(k),qe=He,Qe=function(t){Object(y["a"])(a,t);var e=Object(g["a"])(a);function a(t,n,r){var s;Object(f["a"])(this,a),s=e.call(this,t),s.system=t,o.a.GC.set(Object(We["a"])(s),"x0",n),o.a.GC.set(Object(We["a"])(s),"u0",r);var i=Object(x["a"])(s.system.shape,2);i[0],i[1];return s}return Object(v["a"])(a,[{key:"ready",value:function(){return!!this.K}},{key:"solve",value:function(t){var e=qe.linearizeSystem(this.system,this.x0,this.u0),a=Object(x["a"])(e,2),n=a[0],r=a[1],s=new o.a.Matrix(t.Q),i=new o.a.Matrix(t.R),c=o.a.Solvers.careSolve(n,r,s,i);o.a.GC.set(this,"K",c.K)}},{key:"simulate",value:function(t,e,a){var n=this.system.shape[0],r=this.x0.matAdd(o.a.Matrix.ones(n,1).mul(t)),s=this.system.simulate(this,r,e,a),i=this.x0.vcat(this.u0);return s.forEach((function(t){return t.matSubSelf(i)})),s}},{key:"linearSimulate",value:function(t,e,a){var n=qe.fromModel(this.system,this.x0,this.u0),r=this.system.shape[0],s=this.x0.matAdd(o.a.Matrix.ones(r,1).mul(t)),i=n.simulate(this,s,e,a),c=this.x0.vcat(this.u0);return i.forEach((function(t){return t.matSubSelf(c)})),n.delete(),i}},{key:"getCommand",value:function(t,e){var a=this.x0.matSub(t||this.system.x);return this.system.bound(a),this.K.matMul(a).matAdd(this.u0).clamp(-1e3,1e3)}}]),a}(Je),Ke=Qe,Ye=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{display:"flex","flex-direction":"column"}},[a("div",{staticStyle:{display:"flex","justify-content":"center"}},[a("span",{staticClass:"ml-2 black--text",staticStyle:{"align-self":"center"}},[t._v(t._s(t.label)+":")]),a("v-spacer"),a("v-btn",{attrs:{small:"",color:"blue",dark:"",depressed:t.diagonal,outlined:!t.diagonal},on:{click:function(e){t.diagonal=!0}}},[t._v("diagonal")]),a("v-btn",{staticClass:"ml-1",attrs:{small:"",color:"blue",dark:"",depressed:!t.diagonal,outlined:t.diagonal},on:{click:function(e){t.diagonal=!1}}},[t._v("full")])],1),t.matrix?a("div",{staticStyle:{display:"flex","flex-direction":"column"}},[t.diagonal?a("ArrayInput",{staticClass:"mt-1",staticStyle:{display:"flex"},attrs:{array:t.diagArray},on:{"update:array":function(e){t.diagArray=e}}}):t._l(t.rows,(function(e){return a("ArrayInput",{key:"row_"+e,staticClass:"mt-1",staticStyle:{display:"flex"},attrs:{array:t.matrix[e-1]},on:{"update:array":function(a){return t.$set(t.matrix,e-1,a)}}})}))],2):t._e()])},Xe=[],Ze={components:{ArrayInput:me},data:function(){return{diagonal:!0,diagArray:[]}},props:{matrix:Array,label:String},created:function(){var t=this;this.diagArray=Object(d["a"])(Array(this.matrix.length)).map((function(e,a){return t.matrix[a][a]}))},watch:{diagArray:function(){var t=this;this.diagArray.forEach((function(e,a){return t.matrix[a][a]=e}))},diagonal:function(){if(this.diagonal)for(var t=0;t<this.matrix.length;t++){for(var e=t+1;e<this.matrix[0].length;e++)this.matrix[t][e]=0,this.matrix[e][t]=0;this.diagArray[t]=this.matrix[t][t]}}},computed:{rows:function(){return this.diagonal?1:this.matrix.length}},methods:{}},ta=Ze,ea=Object(ht["a"])(ta,Ye,Xe,!1,null,null,null),aa=ea.exports;dt()(ea,{VBtn:vt["a"],VSpacer:gt["a"]});var na=1/60,ra={name:"LQRPlugin",mixins:[be],components:{Section:se,MatrixInput:aa,ValueInput:ge},props:{system:Object},data:function(){return{controller:null,linearTraj:null,simTraj:null,params:{},enabled:!0}},computed:{trajectories:function(){return[this.linearTraj,this.simTraj]},controllerEnabled:function(){return!this.params.disengage||this.enabled}},created:function(){var t=this.system.trim(),e=t.x,a=t.u;this.params=h.a.cloneDeep(this.system.lqrParams()),this.controller=new Ke(this.system,e,a),this.simTraj=new Xt(this.system,!1),this.linearTraj=new Xt(this.system,!1),this.runLQR(),this.params.x0&&this.system.setState(new o.a.Matrix(this.params.x0))},methods:{reset:function(){var t=this.system.trim(),e=t.x;this.system.setState(e),this.enabled=!0},ready:function(){return this.controllerEnabled&&this.controller.ready()},updateSystem:function(t,e){if(this.ready()){var a=this.controller.getCommand(this.system.x,t);return this.params.disengage&&a.norm()>this.params.divergenceThres&&(this.enabled=!1),this.system.step(a,e),{u:a}}},runLQR:function(){this.controller.solve(this.params);var t=this.params.simDuration,e=this.params.simEps,a=this.controller.simulate(e,na,t);this.simTraj.set(a,na),a=this.controller.linearSimulate(e,na,t),this.linearTraj.set(a,na),this.$emit("activate",this)}}},sa=ra,ia=a("ac7c"),oa=Object(ht["a"])(sa,Fe,ze,!1,null,null,null),ca=oa.exports;dt()(oa,{VBtn:vt["a"],VCheckbox:ia["a"]});var ua={name:"lqr",meta:{title:"LQR",icon:"mdi-matrix",systems:[ct.secondOrder,ct.arm,ct.cartPole,ct.quadrotor2D]},components:{ModelLayout:Nt,TrajPlot:Le,LQRPlugin:ca},mixins:[Ft,zt],props:{systemName:String},data:function(){return{}},computed:{canvas:function(){return this.$refs.canvas},scale:function(){return 96},dt:function(){return 1/60}},created:function(){var t=ct[this.systemName];t?this.system=new t:console.error("Unsupported system",this.systemName)},mounted:function(){},methods:{reset:function(){Ft.methods.reset.call(this),zt.methods.reset.call(this)}}},la=ua,ha=a("cc20"),ma=Object(ht["a"])(la,Ee,Ie,!1,null,null,null),da=ma.exports;dt()(ma,{VBtn:vt["a"],VChip:ha["a"],VSpacer:gt["a"]});var pa=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ModelLayout",{scopedSlots:t._u([{key:"canvas",fn:function(){return[a("div",{ref:"canvas",staticClass:"canvas"})]},proxy:!0},{key:"overlay",fn:function(){return[a("div",{staticStyle:{display:"flex"}},[a("v-chip",{staticClass:"ma-2",attrs:{label:"",color:"blue","text-color":"white"}},[t._v("Kinematic")]),a("v-spacer"),a("span",{staticClass:"ma-2"},[t._v("fps: "+t._s(t.fps.toFixed(0)))])],1)]},proxy:!0},{key:"drawer",fn:function(){return[a("ValueIterationPlugin",{ref:"plugin",attrs:{system:t.system}})]},proxy:!0},t.mounted?{key:"sheet",fn:function(){return[a("ValueIterationPlot",{attrs:{valueIterationPlanner:t.$refs.plugin.viPlanner,trajectory:t.$refs.plugin.trajectory},on:{onclick:t.onclick}})]},proxy:!0}:null,{key:"bar",fn:function(){return[a("v-btn",{attrs:{text:"",dark:""},on:{click:t.reset}},[t._v("reset")])]},proxy:!0}],null,!0)})},fa=[],va=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"div",staticStyle:{width:"100%",height:"100%"}})},ya=[],ga={name:"ValueIterationPlot",props:{valueIterationPlanner:Object,trajectory:Object},data:function(){return{series:[]}},computed:{names:function(){return this.valueIterationPlanner.system.states.map((function(t){return t.name}))}},watch:{trajectory:{handler:function(t,e){e&&e.removeWatcher(this.update),t&&t.addWatcher(this.update),this.update()},immediate:!0}},mounted:function(){var t=this,e={displaylogo:!1,displayModeBar:!1,scrollZoom:!1,showAxisDragHandles:!1,responsive:!0};Ge.a.newPlot(this.$refs.div,[],[],e),this.$refs.div.on("plotly_click",(function(e){t.onclick(e)})),this.valueIterationPlanner.addWatcher(this.update),this.update()},beforeDestroy:function(){this.valueIterationPlanner.removeWatcher(this.update),this.trajectory.removeWatcher(this.update)},methods:{onclick:function(t){if(t.points&&t.points.length>0){var e=t.points[0];this.$emit("onclick",[e.x,e.y])}},getXY:function(){var t=[],e=[];return this.trajectory.array.forEach((function(a,n){t.push(a.get(0)),e.push(a.get(1))})),[t,e]},update:function(){if(this.$refs.div&&this.valueIterationPlanner.V){var t=this.valueIterationPlanner,e=t.V[0].map((function(e,a){return t.V.map((function(t){return t[a]}))})),a=[{z:e,x0:t.xMin,dx:(t.xMax-t.xMin)/t.xn,y0:t.yMin,dy:(t.yMax-t.yMin)/t.xn,type:"heatmap"}];if(this.trajectory&&this.trajectory.ready()){var n=this.getXY(),r=Object(x["a"])(n,2),s=r[0],i=r[1],o={x:s,y:i,type:"scatter",line:{color:"white"},hoverinfo:"skip"};a.push(o)}var c={xaxis:{title:this.names[0],fixedrange:!0},yaxis:{title:this.names[1],fixedrange:!0},margin:{l:70,r:100,b:60,t:30,pad:10}};Ge.a.react(this.$refs.div,a,c)}}}},ba=ga,xa=Object(ht["a"])(ba,va,ya,!1,null,null,null),wa=xa.exports,ka=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Section",{attrs:{title:"Value Iteration"}},[a("ValueInput",{ref:"dt",attrs:{value:t.params.dt,label:"Timestep"},on:{"update:value":function(e){return t.$set(t.params,"dt",e)}}}),a("ArrayInput",{ref:"pointCount",staticClass:"mt-3",attrs:{array:t.params.x.nPts,label:"State point count"},on:{"update:array":function(e){return t.$set(t.params.x,"nPts",e)}}}),a("ArrayInput",{ref:"uMin",staticClass:"mt-3",attrs:{array:t.params.u.min,label:"uMin"},on:{"update:array":function(e){return t.$set(t.params.u,"min",e)}}}),a("ArrayInput",{ref:"uMax",staticClass:"mt-3",attrs:{array:t.params.u.max,label:"uMax"},on:{"update:array":function(e){return t.$set(t.params.u,"max",e)}}}),a("ArrayInput",{ref:"uPointCount",staticClass:"mt-3",attrs:{array:t.params.u.nPts,label:"u point count"},on:{"update:array":function(e){return t.$set(t.params.u,"nPts",e)}}}),a("v-btn",{staticClass:"mt-3",attrs:{outlined:"",disabled:t.running,loading:t.running,color:"primary"},on:{click:t.runValueIteration}},[t._v("run value iteration")])],1)},ja=[],Ma=(a("96cf"),a("1da1")),Sa=a("53ca");a("13d5");var Oa=function(){function t(e){Object(f["a"])(this,t),this.system=e,this.watchers=new Set,this.V=[[]],this.bounds={}}return Object(v["a"])(t,[{key:"addWatcher",value:function(t){this.watchers.add(t)}},{key:"removeWatcher",value:function(t){this.watchers.delete(t)}},{key:"getMatrix",value:function(){return this.V}},{key:"setParams",value:function(t){var e=this;this.params=t,this.xMin=this.params.x.min[0],this.xMax=this.params.x.max[0],this.yMin=this.params.x.min[1],this.yMax=this.params.x.max[1],this.xn=this.params.x.nPts[0],this.yn=this.params.x.nPts[1],this.un=this.params.u.nPts[0],this.dt=this.params.dt,this.tableI=[],this.tableJ=[],this.V=Object(d["a"])(Array(this.xn)).map((function(){return Object(d["a"])(Array(e.yn)).map((function(){return null}))})),this.policy=Object(d["a"])(Array(this.xn)).map((function(){return Object(d["a"])(Array(e.yn)).map((function(){return 0}))}));for(var a=0;a<this.un;a++)this.tableI.push(Object(d["a"])(Array(this.xn)).map((function(){return Object(d["a"])(Array(e.yn)).map((function(){return null}))}))),this.tableJ.push(Object(d["a"])(Array(this.xn)).map((function(){return Object(d["a"])(Array(e.yn)).map((function(){return null}))})));this.points=[];for(var n=0;n<this.xn;n++)for(var r=0;r<this.yn;r++)this.points.push({i:n,j:r});var s=this.params.u.min[0],i=this.params.u.max[0];if(this.U=Object(d["a"])(Array(this.un).keys()).map((function(t){return new o.a.Matrix([s+t*(i-s)])})),!this.params.x.targets)throw new Error("The system must define valid targets");this.params.x.targets.forEach((function(t){var a=e.pack(new o.a.Matrix(t));e.V[a.i][a.j]=0}))}},{key:"unpackU",value:function(t){var e=this.params.u.min[0]+t/(this.un-1)*(this.params.u.max[0]-this.params.u.min[0]);return new o.a.Matrix([e])}},{key:"pack",value:function(t){var e=(t.get(0)-this.xMin)/(this.xMax-this.xMin);e=Math.max(0,Math.min(this.xn-1,Math.floor(e*this.xn)));var a=(t.get(1)-this.yMin)/(this.yMax-this.yMin);return a=Math.max(0,Math.min(this.yn-1,Math.floor(a*this.yn))),{i:e,j:a}}},{key:"unpackPt",value:function(t){return this.unpack(t.i,t.j)}},{key:"unpack",value:function(t,e){return new o.a.Matrix([this.xMin+(t+.5)/this.xn*(this.xMax-this.xMin),this.yMin+(e+.5)/this.yn*(this.yMax-this.yMin)])}},{key:"smoothTable",value:function(t){for(var e=this,a=t.map((function(t){return t.map((function(t){return t.map((function(t){return null!==t&&void 0!==t?t:0}))}))})),n=0;n<100;n++){for(var r=0,s=0;s<this.un;s++)for(var i=0;i<this.points.length;i++){var o=this.points[i];if(null==t[s][o.i][o.j]){var c=0,u=0;o.i>0&&(u+=1,c+=a[s][o.i-1][o.j]),o.i<this.xn-1&&(u+=1,c+=a[s][o.i+1][o.j]),o.j>0&&(u+=1,c+=a[s][o.i][o.j-1]),o.j<this.yn-1&&(u+=1,c+=a[s][o.i][o.j+1]),c/=Math.max(u,1),r=Math.max(r,Math.abs(a[s][o.i][o.j]-c)),a[s][o.i][o.j]=c}}if(r<.1)break}for(var l=function(n){e.points.forEach((function(e){var r=a[n][e.i][e.j];null==t[n][e.i][e.j]&&(t[n][e.i][e.j]=Math.floor(r))}))},h=0;h<this.un;h++)l(h)}},{key:"createTransitionTable",value:function(){for(var t=this,e=(Date.now(),0),a=function(a){var n=t.U[a];t.points.forEach((function(r){var s=t.unpack(r.i,r.j),i=t.system.xNext(s,n,t.dt,!1),o=t.pack(i),c=o.i!=r.i||o.j!=r.j;c?(t.tableI[a][r.i][r.j]=o.i,t.tableJ[a][r.i][r.j]=o.j):e+=1}))},n=0;n<this.un;n++)a(n);var r=100*e/(this.points.length*this.un);if(console.log("Stationnary ratio: ".concat(r.toFixed(2),"%")),r>80)return!1;this.smoothTable(this.tableI),this.smoothTable(this.tableJ)}},{key:"cost",value:function(){return this.dt}},{key:"runValueIteration",value:function(){for(var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,a=function(e){var a=0;if(t.points.forEach((function(e){for(var n,r,s=t.V[e.i][e.j],i=s,o=0;o<t.un;o++){var c=t.tableI[o][e.i][e.j],u=t.tableJ[o][e.i][e.j];if((c!=e.i||u!=e.j)&&null!=t.V[c][u]){var l=t.cost()+t.V[c][u];(null==i||l<i)&&(i=l,t.policy[e.i][e.j]=o)}}var h=Math.abs((null!==(n=t.V[e.i][e.j])&&void 0!==n?n:0)-(null!==(r=i)&&void 0!==r?r:0));a=Math.max(a,h),t.V[e.i][e.j]=i})),a<.001)return console.log("Successfully converged in ".concat(e," iterations")),{v:!0}},n=0;n<e;n++){var r=a(n);if("object"===Object(Sa["a"])(r))return r.v}return console.log("Could not converge after ".concat(e," iterations")),!1}},{key:"run",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.setParams(t),this.createTransitionTable(),this.runValueIteration(e),this.watchers.forEach((function(t){return t()})),this.dump()}},{key:"dump",value:function(){navigator.clipboard.writeText(JSON.stringify({V:this.V.map((function(t){return t.map((function(t){return t.toFixed(2)}))})),tableI:this.tableI,tableJ:this.tableJ,policy:this.policy})).then((function(){return console.log("dumped to clipboard")}))}},{key:"parse",value:function(t,e){this.setParams(t),this.V=e.V.map((function(t){return t.map((function(t){return parseFloat(t)}))})),this.tableI=e.tableI,this.tableJ=e.tableJ,this.policy=e.policy,this.watchers.forEach((function(t){return t()}))}},{key:"getControl",value:function(t){t=this.V.clamp(t);var e=this.V.pack(t);return this.U.unpack(this.policy[e])}},{key:"simulate",value:function(t,e,a){var n,r=this,s=[],i=1/0;if(this.points.forEach((function(e){var a=r.unpackPt(e),s=t.matSub(a).normSqr();s<i&&(i=s,n=e)})),null!=n){for(var o=new Set,c=0;c<=a;c+=this.dt){var u=this.policy[n.i][n.j],l=this.tableI[u][n.i][n.j],h=this.tableJ[u][n.i][n.j],m={i:l,j:h};if(o.has(m))break;var d=this.unpack(l,h),p=this.unpackU(u);s.push(d.vcat(p));var f=this.V[l][h];if(0==f)break;n=m,o.add(m)}var v=s[s.length-1];s.push(v),e.set(s,this.dt)}}}]),t}(),Pa=Oa,Aa={name:"ValueIterationPlugin",mixins:[be],components:{Section:se,ValueInput:ge,ArrayInput:me},props:{system:Object},data:function(){return{viPlanner:null,running:!1,xPrev:null,params:{}}},computed:{},created:function(){this.viPlanner=new Pa(this.system),this.trajectory=new Xt(this.system,!1),this.params=h.a.cloneDeep(this.system.valueIterationParams()),this.loadDump()},methods:{loadDump:function(){var t=this;return Object(Ma["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.params.dump();case 2:a=e.sent,t.viPlanner.parse(t.params,a.default),t.simulate();case 5:case"end":return e.stop()}}),e)})))()},ready:function(){return this.trajectory.ready()},reset:function(){if(this.ready())this.trajectory.reset(0);else{var t=this.system.trim(),e=t.x;this.system.setState(e)}},simulate:function(t){var e;t||(t=new o.a.Matrix(this.params.x0)),this.viPlanner.simulate(t,this.trajectory,30),this.trajectory.reset(null!==(e=this.t)&&void 0!==e?e:0)},updateSystem:function(t,e){if(this.ready()){this.t=t,this.xPrev&&this.system.x!==this.xPrev&&(console.log("Delta detected, re-run"),this.simulate(this.system.x));var a=this.trajectory.getCommand(t),n=this.trajectory.getState(t);return o.a.GC.set(this,"xPrev",n),this.system.setState(n),{u:a}}return{u:new o.a.Matrix([0])}},runValueIteration:function(){this.running=!0;try{var t=this.viPlanner.run(this.params);t&&this.simulate()}catch(e){console.log(e)}this.running=!1}}},Ca=Aa,_a=Object(ht["a"])(Ca,ka,ja,!1,null,null,null),Ta=_a.exports;dt()(_a,{VBtn:vt["a"]});var Ea={name:"valueIteration",meta:{title:"Value iteration",icon:"mdi-restore",systems:[ct.simplePendulum]},components:{ModelLayout:Nt,ValueIterationPlot:wa,ValueIterationPlugin:Ta},mixins:[Ft,zt],props:{systemName:String},data:function(){return{mounted:!1}},computed:{canvas:function(){return this.$refs.canvas},scale:function(){return 96},dt:function(){return 1/60}},created:function(){var t=ct[this.systemName];t?this.system=new t:console.error("Unsupported system",this.systemName)},mounted:function(){this.createGraphics(),this.mounted=!0},methods:{reset:function(){Ft.methods.reset.call(this),zt.methods.reset.call(this)},update:function(){zt.methods.update.call(this)},onclick:function(t){console.log("onclick",t),this.$refs.plugin.simulate(new o.a.Matrix(t))}}},Ia=Ea,$a=Object(ht["a"])(Ia,pa,fa,!1,null,null,null),Da=$a.exports;dt()($a,{VBtn:vt["a"],VChip:ha["a"],VSpacer:gt["a"]});var Va=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ModelLayout",{scopedSlots:t._u([{key:"canvas",fn:function(){return[a("div",{ref:"canvas",staticClass:"canvas"})]},proxy:!0},{key:"overlay",fn:function(){return[a("span",{staticClass:"ma-2"},[t._v("fps: "+t._s(t.fps.toFixed(0)))])]},proxy:!0},{key:"drawer",fn:function(){return[a("RRTPlugin",{ref:"plugin",attrs:{system:t.system},on:{activate:function(){}}})]},proxy:!0},t.isMounted?{key:"sheet",fn:function(){return[a("RRTPlot",{attrs:{rrt:t.$refs.plugin.rrt}})]},proxy:!0}:null,{key:"bar",fn:function(){return[a("v-btn",{attrs:{text:"",dark:""},on:{click:t.reset}},[t._v("reset")])]},proxy:!0}],null,!0)})},Ga=[],Ba=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"div",staticStyle:{width:"100%",height:"100%"}})},Na=[],Ra={name:"RRTPlot",props:{rrt:Object},data:function(){return{series:[]}},computed:{names:function(){return["x axis","y axis"]}},watch:{},mounted:function(){var t=this,e={displaylogo:!1,displayModeBar:!1,scrollZoom:!1,showAxisDragHandles:!1,responsive:!0};Ge.a.newPlot(this.$refs.div,[],[],e),this.$refs.div.addEventListener("click",(function(e){var a=e.clientX,n=e.clientY,r=(a-88)/777,s=(n-679)/472,i=3*(2*r-1),c=3*-(2*s-1);t.rrt.extend(new o.a.Matrix([i,c])),t.update()})),this.rrt.addWatcher(this.update),this.update()},beforeDestroy:function(){this.rrt.removeWatcher(this.update)},methods:{createLine:function(t,e){return{type:"line",opacity:.7,line:{color:"red",width:2.5},x0:t.get(0),y0:t.get(1),x1:e.get(0),y1:e.get(1)}},appendLinesRec:function(t,e){var a=this;e&&e.next.forEach((function(n){for(var r=e.x,s=n.x,i=s.matSub(r),c=new o.a.Matrix(r),u=new o.a.Matrix(s),l=!1,h=0;h<2;h++)if(a.rrt.params.wrap[h]){var m=a.rrt.params.xMax[h]-a.rrt.params.xMin[h],d=Math.abs(i.get(h));d>m/2&&(c.set(h,c.get(h)+Math.sign(i.get(h))*m),u.set(h,u.get(h)-Math.sign(i.get(h))*m),l=!0)}l?(t.push(a.createLine(r,u)),t.push(a.createLine(s,c))):t.push(a.createLine(r,s)),a.appendLinesRec(t,n)}))},update:function(){var t=[];this.appendLinesRec(t,this.rrt.nodes[0]);var e={xaxis:{title:this.names[0],range:[this.rrt.params.xMin[0],this.rrt.params.xMax[0]],fixedrange:!0},yaxis:{title:this.names[1],range:[this.rrt.params.xMin[1],this.rrt.params.xMax[1]],fixedrange:!0},shapes:t,margin:{l:70,r:100,b:60,t:30,pad:10}};Ge.a.react(this.$refs.div,[],e)}}},La=Ra,Fa=Object(ht["a"])(La,Ba,Na,!1,null,null,null),za=Fa.exports,Wa=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Section",{attrs:{title:"RRT"}},[a("Blocks",{ref:"blocks",staticClass:"mt-2",attrs:{initBlocks:t.initBlocks}}),a("ValueInput",{ref:"nPts",staticClass:"mt-2",attrs:{value:t.params.nPts,label:"Point count"},on:{"update:value":function(e){return t.$set(t.params,"nPts",e)}}}),a("v-btn",{staticClass:"mt-2",attrs:{outlined:"",color:"primary"},on:{click:t.runRRT}},[t._v("run RRT")])],1)},Ua=[],Ja=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{display:"flex","flex-direction":"column"}},[a("span",{staticClass:"font-weight-light mt-2"},[t._v("Blocks")]),t._l(t.blocks,(function(e,n){return a("div",{key:"block_"+(e.key||n),staticClass:"mb-3 mt-2",staticStyle:{display:"flex","align-items":"center"}},[a("span",{staticClass:"font-weight-light"},[t._v(t._s(n)+" -")]),a("ValueInput",{ref:"time_"+n,refInFor:!0,staticClass:"ml-2",attrs:{value:e.size,label:"size"},on:{"update:value":function(a){return t.$set(e,"size",a)}}}),a("v-btn",{attrs:{icon:"",color:"red"},on:{click:function(e){return t.deleteBlock(n)}}},[a("v-icon",[t._v("mdi-delete")])],1)],1)})),a("v-btn",{attrs:{outlined:"",color:"green"},on:{click:t.addBlock}},[t._v("+ add")])],2)},Ha=[];a("45fc");function qa(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t._renderer.elem;a.addEventListener("mousemove",(function(n){t.scale=e.scale||1.5,a.style.cursor="pointer"})),a.addEventListener("mouseleave",(function(e){t.scale=1})),a.addEventListener("mousedown",(function(a){a.preventDefault();var n=[a.clientX,a.clientY];function r(a){a.preventDefault(),t.translation.x+=a.clientX-n[0],t.translation.y+=a.clientY-n[1],n=[a.clientX,a.clientY],t.scale=e.scale||1.5;var r=[t.translation.x,t.translation.y];e.mousemove&&e.mousemove(r)}function s(a){a.preventDefault(),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",s),t.scale=1,e.mouseup&&e.mouseup()}window.addEventListener("mousemove",r),window.addEventListener("mouseup",s),e.mousedown&&e.mousedown()}))}var Qa={components:{ValueInput:ge},data:function(){return{two:null,blocks:[]}},props:{initBlocks:Array},computed:{blockDragged:function(){return h.a.some(this.blocks.map((function(t){return t.dragged})))}},created:function(){this.reset()},methods:{reset:function(){this.blocks.forEach((function(t){t.tPrev=0}))},createGraphics:function(t){var e=this;this.two=t,this.blocks=h.a.cloneDeep(this.initBlocks),this.blocks.forEach((function(t){return e.createBlock(t)})),this.labelBlocks(),this.reset()},addBlock:function(){var t={pos:[0,0],size:32};this.createBlock(t),this.blocks.push(t),this.labelBlocks()},deleteBlock:function(t){this.two.remove(this.blocks[t].graphics),this.blocks.splice(t,1),this.labelBlocks()},createBlock:function(t){var e,a=this,n=t.size,r=4,s=this.two.makeRoundedRectangle(0,0,n,n,r),i=this.two.makeText("",0,1.5);i.size=14,i.weight="bolder",i.fill="#ffffff",s.linewidth=3,s.stroke=b["a"].blueGrey.darken4,s.fill=b["a"].blueGrey.base;var o=this.two.makeGroup(s,i),c=this.two.worldToCanvas(t.pos);(e=o.translation).set.apply(e,Object(d["a"])(c)),t.graphics=o,t.text=i,this.two.update();var u={scale:1.1,mousedown:function(){a.$set(t,"dragged",!0)},mouseup:function(){a.$set(t,"dragged",!1)},mousemove:function(e){t.pos=a.two.canvasToWorld(e)}};this.$nextTick((function(){qa(o,u)}))},labelBlocks:function(){this.blocks.forEach((function(t,e){t.text.value="".concat(e)}))},update:function(t){}}},Ka=Qa,Ya=Object(ht["a"])(Ka,Ja,Ha,!1,null,null,null),Xa=Ya.exports;dt()(Ya,{VBtn:vt["a"],VIcon:yt["a"]});var Za=function(){function t(e){Object(f["a"])(this,t),this.system=e,this.params=e.rrtParams(),this.watchers=new Set,this.clear()}return Object(v["a"])(t,[{key:"addWatcher",value:function(t){this.watchers.add(t)}},{key:"removeWatcher",value:function(t){this.watchers.delete(t)}},{key:"sample",value:function(){for(var t=this.system.shape[0]/2,e=o.a.Matrix.random(t,1),a=this.params.xMin,n=this.params.xMax,r=0;r<t;r++)e.set(r,a[r]+(e.get(r)+1)/2*(n[r]-a[r]));return e}},{key:"step",value:function(t,e){for(var a=e.matSub(t),n=new o.a.Matrix(e),r=0;r<a.length();r++)if(this.params.wrap[r]){var s=this.params.xMax[r]-this.params.xMin[r],i=Math.abs(a.get(r));i>s/2&&n.set(r,n.get(r)-Math.sign(a.get(r))*s)}a=n.matSub(t);for(var c=a.norm(),u=o.a.Matrix(t),l=0;l<a.length();l++){var h=Math.min(this.params.deltas[l],c);u.set(l,u.get(l)+a.get(l)/c*h)}return this.system.bound(u),u}},{key:"dist",value:function(t,e){for(var a=e.matSub(t),n=0;n<a.length();n++)if(this.params.wrap[n]){var r=this.params.xMax[n]-this.params.xMin[n],s=Math.abs(a.get(n));s>r/2&&a.set(n,r-s)}return a.norm()}},{key:"findClosestNode",value:function(t){var e=this,a=1/0,n=null;return this.nodes.forEach((function(r){var s=e.dist(t,r.x);s<a&&(n=r,a=s)})),n}},{key:"append",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a={next:[]};o.a.GC.set(a,"x",t),e&&e.next.push(a),this.nodes.push(a)}},{key:"clear",value:function(){o.a.GC.popException(this.nodes),this.nodes=[],this.append(this.system.x.block(0,0,this.params.n,1))}},{key:"extend",value:function(t){var e=this.findClosestNode(t);if(e){var a=this.step(e.x,t);this.append(a,e)}else this.append(t)}},{key:"run",value:function(t,e){this.clear();for(var a=0;a<e;a++){var n=this.sample();t(n)&&this.extend(n)}console.log("nodes",this.nodes),this.watchers.forEach((function(t){return t()}))}}]),t}(),tn=Za,en={name:"RRTPlugin",mixins:[be],components:{Section:se,MatrixInput:aa,ValueInput:ge,Blocks:Xa},props:{system:Object},data:function(){return{params:{},rrt:null}},computed:{initBlocks:function(){return[{pos:[1,1],size:32}]},mouseTargetEnabled:function(){return!this.$refs.blocks.blockDragged}},created:function(){this.rrt=new tn(this.system),this.params=this.system.rrtParams()},methods:{runRRT:function(){this.rrt.run((function(){return!0}),this.params.nPts)},createGraphics:function(t){this.$refs.blocks.createGraphics(t)},reset:function(){var t=this.system.trim(),e=t.x;t.u;this.system.setState(e)},ready:function(){return!1},updateSystem:function(t,e){return{}}}},an=en,nn=Object(ht["a"])(an,Wa,Ua,!1,null,null,null),rn=nn.exports;dt()(nn,{VBtn:vt["a"]});var sn={name:"rrt",meta:{title:"RRT",icon:"mdi-robot-industrial",systems:[ct.arm]},components:{ModelLayout:Nt,RRTPlot:za,RRTPlugin:rn},mixins:[Ft,zt],props:{systemName:String},data:function(){return{}},computed:{canvas:function(){return this.$refs.canvas},scale:function(){return 96},dt:function(){return 1/60}},created:function(){var t=ct[this.systemName];t?this.system=new t:console.error("Unsupported system",this.systemName)},methods:{reset:function(){Ft.methods.reset.call(this),zt.methods.reset.call(this)}}},on=sn,cn=Object(ht["a"])(on,Va,Ga,!1,null,null,null);cn.exports;dt()(cn,{VBtn:vt["a"]});var un=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ModelLayout",{scopedSlots:t._u([{key:"canvas",fn:function(){return[a("div",{ref:"canvas",staticClass:"canvas"})]},proxy:!0},{key:"overlay",fn:function(){return[a("div",{staticStyle:{display:"flex"}},[a("v-chip",{staticClass:"ma-2",attrs:{label:"",color:"blue","text-color":"white"}},[t._v("Kinematic")]),a("v-spacer"),a("span",{staticClass:"ma-2"},[t._v("fps: "+t._s(t.fps.toFixed(0)))])],1)]},proxy:!0},{key:"drawer",fn:function(){return[a("FlatnessPlugin",{ref:"plugin",attrs:{system:t.system,interactivePath:t.interactivePath},on:{activate:function(){}}})]},proxy:!0},t.isMounted?{key:"sheet",fn:function(){return[a("TrajPlot",{attrs:{trajectories:t.$refs.plugin.trajectories}})]},proxy:!0}:null,{key:"bar",fn:function(){return[a("v-btn",{attrs:{text:"",dark:""},on:{click:t.reset}},[t._v("reset")])]},proxy:!0}],null,!0)})},ln=[],hn=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Section",{attrs:{title:"Diff. Flatness"}},[a("ValueInput",{staticClass:"mt-3",attrs:{value:t.params.duration,label:"Travel duration"},on:{"update:value":function(e){return t.$set(t.params,"duration",e)}}}),a("v-btn",{staticClass:"mt-2",attrs:{outlined:"",color:"primary"},on:{click:t.buildTraj}},[t._v("update trajectory")])],1)},mn=[],dn=1/60,pn={name:"FlatnessPlugin",mixins:[be],components:{Section:se,MatrixInput:aa,ValueInput:ge},props:{system:Object,interactivePath:Object},data:function(){return{simTraj:null,params:{duration:5}}},computed:{trajectories:function(){return[this.simTraj]}},created:function(){var t=this.system.trim();t.x,t.u;this.simTraj=new Xt(this.system,!0)},mounted:function(){var t=this;this.$nextTick((function(){return t.buildTraj()}))},watch:{interactivePath:function(){this.interactivePath&&this.interactivePath.addUpdateListener(this.pathUpdated)}},methods:{pathUpdated:function(){this.simTraj.clear()},reset:function(){this.buildTraj()},ready:function(){return this.simTraj.ready()},stepSystem:function(){return!1},updateSystem:function(t,e){if(this.ready()){var a=this.simTraj.getCommand(t),n=this.simTraj.getState(t);return this.system.setState(n),{u:a}}},buildTraj:function(){this.simTraj.clear();var t=this.interactivePath.getTraj(this.params.duration/dn),e=this.system.differentialFlatness(t,dn);this.simTraj.set(e,dn)}}},fn=pn,vn=Object(ht["a"])(fn,hn,mn,!1,null,null,null),yn=vn.exports;dt()(vn,{VBtn:vt["a"]});var gn=function(){function t(e,a,r){var s=this;Object(f["a"])(this,t),this.worldToCanvas=a,this.canvasToWorld=r,this.updateListeners=[];var i=300,o=100,c=140;this.path=new nt["a"].Path([new nt["a"].Anchor(-i,0,0,o,0,-o,nt["a"].Commands.curve),new nt["a"].Anchor(0,0,-c,-c,c,c,nt["a"].Commands.curve),new nt["a"].Anchor(i,0,0,o,0,-o,nt["a"].Commands.curve),new nt["a"].Anchor(0,0,c,-c,-c,c,nt["a"].Commands.curve),new nt["a"].Anchor(-i,0,0,o,0,-o,nt["a"].Commands.curve)],!1),this.path.automatic=!1,this.path.noFill(),this.path.stroke=b["a"].purple.base,this.path.linewidth=3,this.group=e.makeGroup(this.path);for(var u=this.path.vertices,l=function(t){var a=u[t],r=20,i=b["a"].red.base,o=e.makeCircle(0,0,r/4),c=e.makeCircle(0,0,r/4);o.translation.copy(a),c.translation.copy(a.controls.left).addSelf(a),o.noStroke().fill=c.noStroke().fill=i;var l=new nt["a"].Path([(new nt["a"].Anchor).copy(o.translation),(new nt["a"].Anchor).copy(c.translation)]);l.noFill().stroke=i,s.group.add(l,o,c);var h=s;o.translation.bind(nt["a"].Events.change,(function(){a.copy(this),c.translation.copy(a.controls.left).addSelf(this),l.vertices[0].copy(this),l.vertices[1].copy(c.translation),t===u.length-1&&u[0].copy(this),h.onUpdate()})),c.translation.bind(nt["a"].Events.change,(function(){a.controls.left.copy(this).subSelf(a);var e=t===u.length-1?u[0].controls.right:a.controls.right;e.copy(this).subSelf(a).multiplyScalar(-1),l.vertices[1].copy(this),h.onUpdate()})),n["default"].nextTick((function(){qa(o),qa(c)}))},h=1;h<u.length;h++)l(h);var m=a([0,0]),d=Object(x["a"])(m,2),p=d[0],v=d[1];this.group.translation.set(p,v)}return Object(v["a"])(t,[{key:"addUpdateListener",value:function(t){this.updateListeners.push(t)}},{key:"onUpdate",value:function(){this.updateListeners.forEach((function(t){return t()}))}},{key:"discretize",value:function(t){for(var e=[],a=0;a<t;a++){var n=a/t;e.push(this.path.getPointAt(n))}return e}},{key:"getTraj",value:function(t){var e=this,a=this.worldToCanvas([0,0]),n=Object(x["a"])(a,2),r=n[0],s=n[1];return this.discretize(t).map((function(t){return new o.a.Matrix(e.canvasToWorld([t.x+r,t.y+s]))}))}}]),t}(),bn=gn,xn={name:"flatness",meta:{title:"Flatness",icon:"mdi-infinity",systems:[ct.quadrotor2D]},components:{ModelLayout:Nt,TrajPlot:Le,FlatnessPlugin:yn},mixins:[Ft,zt],props:{systemName:String},data:function(){return{interactivePath:null}},computed:{canvas:function(){return this.$refs.canvas},scale:function(){return 96},dt:function(){return 1/60}},created:function(){var t=ct[this.systemName];t?this.system=new t:console.error("Unsupported system",this.systemName)},mounted:function(){this.interactivePath=new bn(this.two,this.worldToCanvas,this.canvasToWorld)},methods:{reset:function(){Ft.methods.reset.call(this),zt.methods.reset.call(this)}}},wn=xn,kn=Object(ht["a"])(wn,un,ln,!1,null,null,null),jn=kn.exports;dt()(kn,{VBtn:vt["a"],VChip:ha["a"],VSpacer:gt["a"]});var Mn=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ModelLayout",{scopedSlots:t._u([{key:"canvas",fn:function(){return[a("div",{ref:"canvas",staticClass:"canvas"})]},proxy:!0},{key:"overlay",fn:function(){return[a("div",{staticStyle:{display:"flex"}},[a("v-chip",{staticClass:"ma-2",attrs:{label:"",color:"blue","text-color":"white"}},[t._v("Kinematic")]),a("v-spacer"),a("span",{staticClass:"ma-2"},[t._v("fps: "+t._s(t.fps.toFixed(0)))])],1)]},proxy:!0},{key:"drawer",fn:function(){return[a("DirectCollocationPlugin",{ref:"plugin",attrs:{system:t.system},on:{activate:function(){}}})]},proxy:!0},t.isMounted?{key:"sheet",fn:function(){return[a("TrajPlot",{attrs:{trajectories:t.$refs.plugin.trajectories}})]},proxy:!0}:null,{key:"bar",fn:function(){return[a("v-btn",{attrs:{text:"",dark:""},on:{click:t.reset}},[t._v("reset")])]},proxy:!0}],null,!0)})},Sn=[],On={name:"directCollocation",meta:{title:"Direct Collocation",icon:"mdi-vector-curve",systems:[ct.secondOrder,ct.simplePendulum,ct.doublePendulum,ct.cartPole,ct.quadrotor2D]},components:{ModelLayout:Nt,TrajPlot:Le,DirectCollocationPlugin:je},mixins:[Ft,zt],props:{systemName:String},data:function(){return{}},computed:{canvas:function(){return this.$refs.canvas},scale:function(){return 96},dt:function(){return 1/60}},created:function(){var t=ct[this.systemName];t?this.system=new t:console.error("Unsupported system",this.systemName)},mounted:function(){},methods:{reset:function(){Ft.methods.reset.call(this),zt.methods.reset.call(this)}}},Pn=On,An=Object(ht["a"])(Pn,Mn,Sn,!1,null,null,null),Cn=An.exports;dt()(An,{VBtn:vt["a"],VChip:ha["a"],VSpacer:gt["a"]});var _n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ModelLayout",{scopedSlots:t._u([{key:"canvas",fn:function(){return[a("div",{ref:"canvas",staticClass:"canvas"})]},proxy:!0},{key:"overlay",fn:function(){return[a("div",{staticStyle:{display:"flex"}},[a("v-chip",{staticClass:"ma-2",attrs:{label:"",color:"red","text-color":"white"}},[t._v("Dynamic")]),a("v-spacer"),a("span",{staticClass:"ma-2"},[t._v("fps: "+t._s(t.fps.toFixed(0)))])],1)]},proxy:!0},{key:"drawer",fn:function(){return[a("MPCPlugin",{ref:"plugin",attrs:{system:t.system,systemRef:t.systemRef},on:{activate:function(){}}})]},proxy:!0},t.isMounted?{key:"sheet",fn:function(){return[a("TrajPlot",{attrs:{trajectories:t.$refs.plugin.trajectories}})]},proxy:!0}:null,{key:"bar",fn:function(){return[a("v-btn",{attrs:{text:"",dark:""},on:{click:t.reset}},[t._v("reset")])]},proxy:!0}],null,!0)})},Tn=[],En=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Section",{attrs:{title:"MPC"}},[a("ValueInput",{ref:"nPts",attrs:{value:t.params.nPts,label:"Point count"},on:{"update:value":function(e){return t.$set(t.params,"nPts",e)}}}),a("div",{staticClass:"mb-3 mt-3",staticStyle:{display:"flex","align-items":"center"}},[a("ArrayInput",{ref:"uMin",staticStyle:{flex:"1 0 auto",width:"0px"},attrs:{array:t.params.uBounds.min,label:"uMin"},on:{"update:array":function(e){return t.$set(t.params.uBounds,"min",e)}}}),a("ArrayInput",{ref:"uMax",staticClass:"ml-2",staticStyle:{flex:"1 0 auto",width:"0px"},attrs:{array:t.params.uBounds.max,label:"uMax"},on:{"update:array":function(e){return t.$set(t.params.uBounds,"max",e)}}})],1),a("ValueInput",{ref:"dt",staticStyle:{flex:"0 0 auto",width:"48px"},attrs:{value:t.params.dt,label:"dt"},on:{"update:value":function(e){return t.$set(t.params,"dt",e)}}}),a("v-btn",{staticClass:"mt-2",attrs:{outlined:"",color:"primary"},on:{click:t.runMPC}},[t._v("run MPC optimisation")])],1)},In=[],$n=function(t){Object(y["a"])(a,t);var e=Object(g["a"])(a);function a(t,n,r,s,i){var o;return Object(f["a"])(this,a),o=e.call(this,t),o.system=t,o.trajectory=n,o.dt=r,o.n=a.DEBUG?3:s,o.uBounds=i,o.params=o.system.mpcParams(),o}return Object(v["a"])(a,[{key:"optimizeInner",value:function(t,e,n){Date.now();for(var r=Object(x["a"])(this.system.shape,2),s=r[0],i=r[1],c=(s+i)*this.n,u=o.a.SparseMatrix.identity(c,c).mul(1),l=0;l<s*this.n;l+=1)this.params.xWeight?u.set(l,l,this.params.xWeight[l%s]):l%s<s/2&&u.set(l,l,100);for(var h=s*this.n;h<c;h++)u.set(h,h,.01);for(var m=new o.a.Matrix(c,1),d=new o.a.TripletVector(20),p=o.a.Matrix.identity(s,s),f=o.a.Matrix.ones(s,1).mul(-1),v=0;v<this.n;v++){var y=e[v],g=y.block(0,0,s,1),b=y.block(s,0,i,1);if(!(v>=this.n-1)){var w=this.system.xJacobian(g,b).mul(this.dt).matAdd(p),k=this.system.uJacobian(g,b).mul(this.dt);a.DEBUG&&(g.print("x0"),b.print("u0"),w.print("A_".concat(v)),k.print("B_".concat(v))),d.addBlock(v*s,v*s,w),d.addDiag(v*s,(v+1)*s,f),d.addBlock(v*s,this.n*s+v*i,k),a.DEBUG&&(console.log("=== testing jacobian"),qe.testJacobian(this.system),console.log("=== jacobian tested!"))}}d.addDiag((this.n-1)*s,0,f.mul(-1));var j=o.a.Matrix.ones(i*this.n,1);d.addDiag(this.n*s,this.n*s,j);var M=new o.a.SparseMatrix(c,c,d),S=new o.a.Matrix(c,1),O=new o.a.Matrix(c,1);this.system.bound(n),S.setBlock((this.n-1)*s,0,n),O.setBlock((this.n-1)*s,0,n);for(var P=this.n*s;P<c;P++)S.set(P,this.uBounds.min[P%i]),O.set(P,this.uBounds.max[P%i]);var A=o.a.Solvers.quadProgSolve(u,m,M,S,O);a.DEBUG&&(n.print("dx0"),new o.a.SparseMatrix(u).print("P"),m.print("q"),new o.a.SparseMatrix(M).print("A"),S.print("lb"),O.print("ub"),A.print("result"));for(var C=[],_=0;_<this.n;_+=1){var T=t[_],E=T.block(0,0,s,1),I=T.block(s,0,i,1),$=A.block(_*s,0,s,1).matAdd(E),D=A.block(this.n*s+_*i,0,i,1).matAdd(I);C.push($.vcat(D))}return C}},{key:"optimize",value:function(t){for(var e=[],a=0;a<this.n;a++){var n=this.trajectory.get(t+a*this.dt);e.push(n)}var r=Object(x["a"])(this.system.shape,2),s=r[0],i=(r[1],e[0].block(0,0,s,1)),o=this.system.x.matSub(i);return this.optimizeInner(e,e,o)}}]),a}(Je);Object(m["a"])($n,"DEBUG",!1);var Dn=$n,Vn={name:"MPCPlugin",mixins:[be],components:{Section:se,ArrayInput:me,ValueInput:ge},props:{system:Object,systemRef:Object},data:function(){return{mpc:null,trajectory:null,params:{}}},computed:{trajectories:function(){return[this.trajectory]}},created:function(){this.params=h.a.cloneDeep(this.system.mpcParams()),this.trajectory=new Xt(this.system,!0),this.trajectory.load(this.params.traj),this.mpc=new Dn(this.system,this.trajectory,this.params.dt,this.params.nPts,this.params.uBounds),this.reset()},methods:{reset:function(){if(this.trajectory.ready()){var t=this.trajectory.getState(0);this.system.setState(t)}},ready:function(){return this.trajectory.ready()},runMPC:function(){this.mpc.optimize(0)},updateSystem:function(t,e){if(this.ready()&&!Dn.DEBUG){var a=this.trajectory.getState(t);this.systemRef.setState(a);var n=Object(x["a"])(this.system.shape,2),r=n[0],s=n[1],i=this.mpc.optimize(t),o=i[0].block(r,0,s,1);return this.system.step(o,e),this.system.graphics.traj&&(this.system.graphics.traj.data=i),{u:o}}return{}}}},Gn=Vn,Bn=Object(ht["a"])(Gn,En,In,!1,null,null,null),Nn=Bn.exports;dt()(Bn,{VBtn:vt["a"]});var Rn={name:"mpc",meta:{title:"MPC",icon:"mdi-camera-timer",systems:[ct.secondOrder,ct.simplePendulum,ct.doublePendulum,ct.cartPole,ct.quadrotor2D]},components:{ModelLayout:Nt,TrajPlot:Le,MPCPlugin:Nn},mixins:[Ft,zt],props:{systemName:String},data:function(){return{systemRef:null}},computed:{canvas:function(){return this.$refs.canvas},scale:function(){return 96},dt:function(){return 1/60}},created:function(){var t=ct[this.systemName];if(!t)throw new Error("Unsupported system",this.systemName);this.system=new t,this.systemRef=new t},mounted:function(){this.systemRef.createGraphics(this.two,this.scale)},methods:{reset:function(){Ft.methods.reset.call(this),zt.methods.reset.call(this)},update:function(){zt.methods.update.call(this),this.systemRef.updateGraphics(this.worldToCanvas,{ghost:!0})}}},Ln=Rn,Fn=Object(ht["a"])(Ln,_n,Tn,!1,null,null,null),zn=Fn.exports;dt()(Fn,{VBtn:vt["a"],VChip:ha["a"],VSpacer:gt["a"]});var Wn=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ModelLayout",{scopedSlots:t._u([{key:"canvas",fn:function(){return[a("div",{ref:"canvas",staticClass:"canvas"})]},proxy:!0},{key:"overlay",fn:function(){return[a("span",{staticClass:"ma-2"},[t._v("fps: "+t._s(t.fps.toFixed(0)))])]},proxy:!0},{key:"drawer",fn:function(){return[a("KalmanFilterPlugin",{ref:"plugin",attrs:{system:t.system},on:{activate:function(){}}})]},proxy:!0},t.isMounted?{key:"sheet",fn:function(){return[a("KalmanPlot",{attrs:{kalmanFilter:t.$refs.plugin.kalmanFilter}})]},proxy:!0}:null,{key:"bar",fn:function(){return[a("v-btn",{attrs:{text:"",dark:""},on:{click:t.reset}},[t._v("reset")])]},proxy:!0}],null,!0)})},Un=[],Jn=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{width:"100%",height:"100%"}},[a("div",{ref:"div",staticStyle:{width:"100%",height:"100%"}})])},Hn=[],qn={name:"KalmanPlot",props:{kalmanFilter:Object},data:function(){return{tPrev:0}},computed:{},watch:{},mounted:function(){var t=this,e={displaylogo:!1,displayModeBar:!1,scrollZoom:!1,showAxisDragHandles:!1,responsive:!0};Ge.a.newPlot(this.$refs.div,[],[],e),this.kalmanFilter.addWatcher((function(){t.update()}))},beforeDestroy:function(){},methods:{getGaussian:function(t,e,a){for(var n=1/(e*Math.sqrt(2*Math.PI)),r=[],s=[],i=6*e/a,o=t-3*e;o<t+3*e;o+=i){var c=n*Math.exp(-.5*Math.pow((o-t)/e,2));r.push(o),s.push(c)}return{x:r,y:s}},update:function(){var t=this;if(this.$refs.div&&this.kalmanFilter.ready()&&!(Date.now()-this.tPrev<200)){this.tPrev=Date.now();var e=this.kalmanFilter.system,a=this.kalmanFilter.x,n=this.kalmanFilter.P,r=e.states.map((function(e,r){var s=t.getGaussian(a.get(r),n.get(r,r),40),i=s.x,o=s.y;return{x:i,y:o,name:e.name,type:"scatter"}})),s={xaxis:{zeroline:!1},margin:{l:40,r:100,b:60,t:30,pad:10}};Ge.a.react(this.$refs.div,r,s)}}}},Qn=qn,Kn=Object(ht["a"])(Qn,Jn,Hn,!1,null,null,null),Yn=Kn.exports,Xn=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Section",{attrs:{title:"Kalman Filter"}},[a("MatrixInput",{staticClass:"mt-2",attrs:{label:"Init. covariance",matrix:t.params.covariance},on:{"update:matrix":function(e){return t.$set(t.params,"covariance",e)}}}),a("MatrixInput",{staticClass:"mt-2",attrs:{label:"Process noise",matrix:t.params.processNoise},on:{"update:matrix":function(e){return t.$set(t.params,"processNoise",e)}}}),a("MatrixInput",{staticClass:"mt-2",attrs:{label:"Input noise",matrix:t.params.inputNoise},on:{"update:matrix":function(e){return t.$set(t.params,"inputNoise",e)}}}),a("Sensors",{ref:"sensors",attrs:{system:t.system,params:t.params},on:{update:t.sensorUpdate}}),a("v-btn",{staticClass:"mt-2",attrs:{outlined:"",color:"primary"},on:{click:t.reset}},[t._v("reset filter")])],1)},Zn=[],tr=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{display:"flex","flex-direction":"column"}},[a("span",{staticClass:"font-weight-light mt-2"},[t._v("Sensors")]),t._l(t.sensors,(function(e,n){return a("div",{key:"sensor_"+(e.key||n),staticClass:"mb-3 mt-2",staticStyle:{display:"flex","align-items":"center"}},[a("span",{staticClass:"font-weight-light"},[t._v(t._s(n)+" -")]),a("ValueInput",{ref:"time_"+n,refInFor:!0,staticClass:"ml-2",attrs:{value:e.dt,label:"dt"},on:{"update:value":function(a){return t.$set(e,"dt",a)}}}),a("v-btn",{attrs:{icon:"",color:"red"},on:{click:function(e){return t.deleteSensor(n)}}},[a("v-icon",[t._v("mdi-delete")])],1)],1)})),a("v-btn",{attrs:{outlined:"",disabled:0===t.params.sensors.length,color:"green"},on:{click:t.addSensor}},[t._v("+ add")])],2)},er=[],ar={components:{ValueInput:ge},data:function(){return{two:null,sensors:[]}},props:{params:Object,system:Object},computed:{sensorDragged:function(){return h.a.some(this.sensors.map((function(t){return t.dragged})))}},created:function(){this.reset()},methods:{reset:function(){this.sensors.forEach((function(t){t.tPrev=0}))},createGraphics:function(t){var e=this;this.two=t,this.sensors=h.a.cloneDeep(this.params.sensors),this.sensors.forEach((function(t){return e.createSensor(t)})),this.labelSensors(),this.reset()},addSensor:function(){if(0!==this.params.sensors.length){var t=h.a.cloneDeep(this.params.sensors[0]);t.pos=[0,0],this.createSensor(t),this.sensors.push(t),this.labelSensors()}},deleteSensor:function(t){this.two.remove(this.sensors[t].graphics),this.sensors.splice(t,1),this.labelSensors()},createRadarSensor:function(t){var e,a=this,n=18,r=this.two.makeCircle(0,0,n),s=this.two.makeText("",0,1.5);s.size=14,s.weight="bolder",s.fill="#ffffff",r.linewidth=3,r.stroke=b["a"].green.darken4,r.fill=b["a"].green.base;var i=this.two.makeGroup(r,s),o=this.two.worldToCanvas(t.pos);(e=i.translation).set.apply(e,Object(d["a"])(o)),t.graphics=i,t.text=s,t.anim=function(){Object($t["a"])({targets:i,scale:1.2,round:1e3,direction:"alternate",easing:"easeInOutSine",duration:200,update:function(){return a.two.update()}})},this.two.update();var c={scale:1.1,mousedown:function(){a.$set(t,"dragged",!0)},mouseup:function(){a.$set(t,"dragged",!1)},mousemove:function(e){t.pos=a.two.canvasToWorld(e)}};this.$nextTick((function(){qa(i,c)}))},createSensor:function(t){switch(t.type){case"radar":this.createRadarSensor(t)}},labelSensors:function(){this.sensors.forEach((function(t,e){t.text.value="".concat(e)}))},update:function(t){var e=this;this.sensors.filter((function(e){var a=e.tPrev||0;return t-a>e.dt})).forEach((function(a){e.$emit("update",a),a.anim(),a.tPrev=t}))}}},nr=ar,rr=Object(ht["a"])(nr,tr,er,!1,null,null,null),sr=rr.exports;dt()(rr,{VBtn:vt["a"],VIcon:yt["a"]});var ir=function(){function t(e){Object(f["a"])(this,t),this.system=e,this.watchers=new Set}return Object(v["a"])(t,[{key:"ready",value:function(){return!!this.P&&!!this.Q}},{key:"reset",value:function(t,e){var a=new o.a.Matrix(this.system.x);o.a.GC.set(this,"x",a),o.a.GC.set(this,"P",t),o.a.GC.set(this,"Q",e)}},{key:"predict",value:function(t,e){var a=qe.linearizeSystem(this.system,this.x,t),n=Object(x["a"])(a,2),r=n[0],s=(n[1],this.system.dynamics(this.x,t).mul(e));this.x.matAddSelf(s),this.system.bound(this.x);var i=r.matMul(this.P).matMul(r.transpose()).matAdd(this.Q).mul(e);this.P.matAddSelf(i),this.watchers.forEach((function(t){return t()}))}},{key:"update",value:function(t){var e=t.measurement(t,this.system.x),a=t.measurement(t,this.x),n=new o.a.Matrix(t.noise);O(e,n);var r=qe.linearize((function(e){return t.measurement(t,e)}),this.x),s=new o.a.Matrix(t.noise),i=this.P.matMul(r.transpose()),c=i.matMul(r.matMul(i).matAdd(s).inverse());this.x.matAddSelf(c.matMul(e.matSub(a))),this.P.matSubSelf(c.matMul(r).matMul(this.P)),this.watchers.forEach((function(t){return t()}))}},{key:"addWatcher",value:function(t){this.watchers.add(t)}},{key:"removeWatcher",value:function(t){this.watchers.delete(t)}}]),t}(),or=ir,cr={name:"KalmanFilterPlugin",mixins:[be],components:{Section:se,ValueInput:ge,MatrixInput:aa,ArrayInput:me,Sensors:sr},props:{system:Object},data:function(){return{two:null,sigma:null,kalmanFilter:null,params:{}}},computed:{mouseTargetEnabled:function(){return!this.$refs.sensors.sensorDragged}},created:function(){this.kalmanFilter=new or(this.system),this.params=this.system.kalmanFilterParams()},mounted:function(){console.log("sensors",this.$refs.sensors),this.reset()},watch:{},methods:{createGraphics:function(t){this.two=t,console.log("create graphics",this.$refs.sensors),this.$refs.sensors.createGraphics(t);var e=t.canvas.parentNode;this.sigma=document.createElement("div"),this.sigma.style.width="0px",this.sigma.style.height="0px",this.sigma.style.position="absolute",this.sigma.style.background="radial-gradient(closest-side, #1f96f2 0%, rgba(0, 174, 255, 0) 100%)",e.insertBefore(this.sigma,e.childNodes[0])},updateSigma:function(){if(this.sigma){var t=2,e=this.kalmanFilter.P.block(0,0,2,2),a=this.kalmanFilter.x.block(0,0,2,1),n=this.two.worldToCanvas([a.get(0),a.get(1)]),r=this.two.worldToCanvas([0,0]);n[0]-=r[0],n[1]-=r[1];var s=o.a.Decompositions.svd(e,!0),i=Math.sign(s.U.det()),c=Math.atan2(s.U.get(0,1),s.U.get(0,0))*i,u=[s.sv.get(0)*this.two.scale*t,s.sv.get(1)*this.two.scale*t];this.sigma.style["pointer-events"]="none",this.sigma.style.left="calc(50% + ".concat(n[0]-u[0]/2,"px)"),this.sigma.style.top="calc(50% + ".concat(n[1]-u[1]/2,"px)"),this.sigma.style.width="".concat(u[0],"px"),this.sigma.style.height="".concat(u[1],"px"),this.sigma.style.transform="rotate(".concat(c,"rad)")}},reset:function(){var t=new o.a.Matrix(this.params.covariance),e=new o.a.Matrix(this.params.processNoise);this.kalmanFilter.reset(t,e),this.$refs.sensors.reset()},update:function(t){var e=new o.a.Matrix(2,1),a=new o.a.Matrix(this.params.inputNoise),n=o.a.Random.normal(e,a,1),r=t.u.matAdd(n);this.kalmanFilter.predict(r,t.dt),this.$refs.sensors.update(t.t),this.updateSigma()},sensorUpdate:function(t){this.kalmanFilter.update(t)},ready:function(){return!1},updateSystem:function(t,e){}}},ur=cr,lr=Object(ht["a"])(ur,Xn,Zn,!1,null,null,null),hr=lr.exports;dt()(lr,{VBtn:vt["a"]});var mr={name:"kalmanFilter",meta:{title:"Kalman Filter",icon:"mdi-chart-bell-curve",systems:[ct.car]},components:{ModelLayout:Nt,TrajPlot:Le,KalmanPlot:Yn,KalmanFilterPlugin:hr},mixins:[Ft,zt],props:{systemName:String},data:function(){return{}},computed:{canvas:function(){return this.$refs.canvas},scale:function(){return 96},dt:function(){return 1/60}},created:function(){var t=ct[this.systemName];t?this.system=new t:console.error("Unsupported system",this.systemName)},mounted:function(){},methods:{reset:function(){Ft.methods.reset.call(this),zt.methods.reset.call(this)}}},dr=mr,pr=Object(ht["a"])(dr,Wn,Un,!1,null,null,null),fr=pr.exports;dt()(pr,{VBtn:vt["a"]});var vr=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ModelLayout",{scopedSlots:t._u([{key:"canvas",fn:function(){return[a("div",{ref:"canvas",staticClass:"canvas"})]},proxy:!0},{key:"overlay",fn:function(){return[a("span",{staticClass:"ma-2"},[t._v("fps: "+t._s(t.fps.toFixed(0)))])]},proxy:!0},{key:"drawer",fn:function(){return[a("ParticleFilterPlugin",{ref:"plugin",attrs:{system:t.system},on:{activate:function(){}}})]},proxy:!0},t.isMounted?{key:"sheet",fn:function(){return[a("ParticlePlot",{attrs:{particleFilter:t.$refs.plugin.particleFilter}})]},proxy:!0}:null,{key:"bar",fn:function(){return[a("v-btn",{attrs:{text:"",dark:""},on:{click:t.reset}},[t._v("reset")])]},proxy:!0}],null,!0)})},yr=[],gr=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{width:"100%",height:"100%"}},[a("div",{ref:"div",staticStyle:{width:"100%",height:"100%"}})])},br=[],xr={name:"ParticlePlot",props:{particleFilter:Object},data:function(){return{tPrev:0}},computed:{},watch:{},mounted:function(){var t=this,e={displaylogo:!1,displayModeBar:!1,scrollZoom:!1,showAxisDragHandles:!1,responsive:!0};Ge.a.newPlot(this.$refs.div,[],[],e),this.particleFilter.addWatcher((function(){t.update()}))},beforeDestroy:function(){},methods:{update:function(){if(this.$refs.div&&this.particleFilter.ready()&&!(Date.now()-this.tPrev<500)){this.tPrev=Date.now();var t=this.particleFilter.particles,e=[],a=[];t.forEach((function(t){e.push(t.system.x.get(0)),a.push(t.system.x.get(1))}));var n=[{x:e,type:"histogram",opacity:.5,marker:{color:"green"},name:"x"},{x:a,type:"histogram",opacity:.5,marker:{color:"red"},name:"y"}],r={xaxis:{zeroline:!1},margin:{l:40,r:100,b:60,t:30,pad:10}};Ge.a.react(this.$refs.div,n,r)}}}},wr=xr,kr=Object(ht["a"])(wr,gr,br,!1,null,null,null),jr=kr.exports,Mr=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Section",{attrs:{title:"Particle Filter"}},[a("ValueInput",{attrs:{value:t.params.nPts,label:"Point number"},on:{"update:value":function(e){return t.$set(t.params,"nPts",e)}}}),a("ValueInput",{staticClass:"mt-2",attrs:{value:t.params.dt,label:"Resampling period"},on:{"update:value":function(e){return t.$set(t.params,"dt",e)}}}),a("MatrixInput",{staticClass:"mt-2",attrs:{matrix:t.params.processNoise,label:"Process noise"},on:{"update:matrix":function(e){return t.$set(t.params,"processNoise",e)}}}),a("Sensors",{ref:"sensors",staticClass:"mt-2",attrs:{system:t.system,params:t.params},on:{update:t.sensorUpdate}}),a("v-btn",{staticClass:"mt-2",attrs:{outlined:"",color:"purple"},on:{click:t.resample}},[t._v("resample")]),a("v-btn",{staticClass:"mt-2",attrs:{outlined:"",color:"primary"},on:{click:t.reset}},[t._v("reset filter")])],1)},Sr=[],Or=function(){function t(e,a){switch(Object(f["a"])(this,t),this.params=a,this.system=new e.constructor,this.weight=1,a.distribution){case"exact":this.system.setState(e.x);break;case"uniform":for(var n=o.a.Matrix.random(e.shape[0],1),r=0;r<n.rows();r++){var s=a.range.min[r],i=a.range.max[r];this.system.x.set(r,s+(i-s)*n.get(r))}break;case"normal":break}}return Object(v["a"])(t,[{key:"clone",value:function(){var e=new t(this.system,this.params);return e.system.setState(this.system.x),e}},{key:"delete",value:function(){this.system.delete()}},{key:"predict",value:function(t,e){this.system.step(t,e);var a=new o.a.Matrix(this.params.processNoise).mul(e);O(this.system.x,a)}},{key:"update",value:function(t,e){var a=t.measurement(t,this.system.x);if(!t.gaussian){var n=new o.a.Matrix(a.rows(),1),r=new o.a.Matrix(t.noise);t.gaussian=new P(n,r)}var s=t.gaussian.density(a.matSub(e));this.weight*=s}}]),t}(),Pr=function(){function t(e){Object(f["a"])(this,t),this.system=e,this.particles=[],this.watchers=new Set}return Object(v["a"])(t,[{key:"ready",value:function(){return!0}},{key:"reset",value:function(t){this.params=h.a.cloneDeep(t),this.particles.forEach((function(t){return t.delete()})),this.particles=[];for(var e=0;e<t.nPts;e++){var a=new Or(this.system,t);this.particles.push(a)}this.normalizeWeights()}},{key:"predict",value:function(t,e){this.particles.forEach((function(a){return a.predict(t,e)})),this.watchers.forEach((function(t){return t()}))}},{key:"normalizeWeights",value:function(){var t=this.particles.map((function(t){return t.weight})),e=h.a.max(t),a=e;this.particles.forEach((function(t){return t.weight/=a}))}},{key:"update",value:function(t){var e=t.measurement(t,this.system.x),a=new o.a.Matrix(t.noise);O(e,a),this.particles.forEach((function(a){return a.update(t,e)})),this.normalizeWeights(),this.watchers.forEach((function(t){return t()}))}},{key:"resample",value:function(){for(var t=this.particles.length,e=[],a=Math.floor(Math.random()*t),n=0,r=this.particles.map((function(t){return t.weight})),s=h.a.max(r),i=0;i<t;i++){n+=2*Math.random()*s;while(n>r[a])n-=r[a],a=(a+1)%t;var o=this.particles[a].clone();e.push(o)}this.particles.forEach((function(t){return t.delete()})),this.particles=e}},{key:"addWatcher",value:function(t){this.watchers.add(t)}},{key:"removeWatcher",value:function(t){this.watchers.delete(t)}}]),t}(),Ar=Pr,Cr={name:"ParticleFilterPlugin",mixins:[be],components:{Section:se,ValueInput:ge,MatrixInput:aa,ArrayInput:me,Sensors:sr},props:{system:Object,interactivePath:Object},data:function(){return{two:null,particleGraphics:[],params:{},tResample:0}},computed:{sensors:function(){return this.$refs.sensors},mouseTargetEnabled:function(){return!this.sensors.sensorDragged}},created:function(){this.particleFilter=new Ar(this.system),this.params=this.system.particleFilterParams()},mounted:function(){this.reset()},watch:{},methods:{createGraphics:function(t){this.two=t,this.sensors.createGraphics(t),this.updateGraphics()},createParticleGraphic:function(){if(this.two)switch(this.params.type){case"2d":var t=8,e=this.two.makeCircle(0,0,t);e.noStroke();var a=this.two.makeLine(0,0,t,0);a.stroke="#000000";var n=this.two.makeGroup(e,a),r=R.a.scale([b["a"].red.base,b["a"].green.base]),s=function(t){e.fill=r(t)};this.particleGraphics.push({group:n,setColor:s});break;default:throw new Error(this.params.type+" unsupported")}},updateParticleGraphic:function(t,e){switch(this.params.type){case"2d":var a,n=t.system.x,r=this.two.worldToCanvas([n.get(0),n.get(1)]);(a=e.group.translation).set.apply(a,Object(d["a"])(r)),e.group.rotation=-n.get(2),e.setColor(t.weight);break}},updateGraphics:function(){for(var t=this,e=50,a=this.particleFilter.particles,n=Math.min(e,a.length),r=this.particleGraphics.length;r<n;r++)this.createParticleGraphic();for(var s=this.particleGraphics.length-1;s>=a.length;s--)this.two.remove(this.particleGraphics[s].group),this.particleGraphics.splice(s,1);this.particleGraphics.forEach((function(e,n){var r=a[n];t.updateParticleGraphic(r,e)}))},reset:function(){this.particleFilter.reset(this.params),this.sensors.reset()},resample:function(){this.particleFilter.resample()},update:function(t){this.particleFilter.predict(t.u,t.dt),this.updateGraphics(),this.sensors.update(t.t);var e=Date.now()/1e3;e-this.tResample>this.params.dt&&(this.resample(),this.tResample=e)},sensorUpdate:function(t){this.particleFilter.update(t)},ready:function(){return!1},updateSystem:function(t,e){}}},_r=Cr,Tr=Object(ht["a"])(_r,Mr,Sr,!1,null,null,null),Er=Tr.exports;dt()(Tr,{VBtn:vt["a"]});var Ir={name:"particleFilter",meta:{title:"Particle Filter",icon:"mdi-dots-hexagon",systems:[ct.car]},components:{ModelLayout:Nt,ParticlePlot:jr,ParticleFilterPlugin:Er},mixins:[Ft,zt],props:{systemName:String},data:function(){return{}},computed:{canvas:function(){return this.$refs.canvas},scale:function(){return 48},dt:function(){return 1/60}},created:function(){var t=ct[this.systemName];t?this.system=new t:console.error("Unsupported system",this.systemName)},mounted:function(){},methods:{reset:function(){Ft.methods.reset.call(this),zt.methods.reset.call(this)}}},$r=Ir,Dr=Object(ht["a"])($r,vr,yr,!1,null,null,null),Vr=Dr.exports;dt()(Dr,{VBtn:vt["a"]}),n["default"].use(Mt["a"]);var Gr=[da,Da,jn,Cn,zn,fr,Vr],Br=Gr.map((function(t){return{component:t,name:t.name,path:"/".concat(t.name,"/:systemName"),props:!0,meta:Object(p["a"])(Object(p["a"])({},t.meta),{},{rightDrawer:!0})}})),Nr=[{path:"/",component:Te}].concat(Object(d["a"])(Br)),Rr=new Mt["a"]({base:"/controls-js/",routes:Nr}),Lr=Rr,Fr=["mdi-alpha","mdi-beta","mdi-gamma","mdi-delta","mdi-epsilon"],zr={data:function(){return{drawer:null,envRoutes:Br,icons:Fr}},props:{value:Boolean},computed:{},mounted:function(){this.$nextTick((function(){}))},methods:{navHome:function(){this.$router.push({path:"/"})},toggle:function(){this.drawer=!this.drawer},github:function(){window.open("https://github.com/BertrandBev/controls-js","_blank")},isEnv:function(t){return this.$route.name===t},isActive:function(t,e){return this.isEnv(t.name)&&this.$route.params.systemName===e.TAG},navSystem:function(t,e){this.isActive(t,e)||this.$router.push({name:t.name,params:{systemName:e.TAG}})}}},Wr=zr,Ur=(a("006d"),a("8860")),Jr=a("56b0"),Hr=a("da13"),qr=a("1800"),Qr=a("5d23"),Kr=a("34c3"),Yr=Object(ht["a"])(Wr,kt,jt,!1,null,"bff60a68",null),Xr=Yr.exports;dt()(Yr,{VDivider:ne["a"],VIcon:yt["a"],VList:Ur["a"],VListGroup:Jr["a"],VListItem:Hr["a"],VListItemAction:qr["a"],VListItemContent:Qr["a"],VListItemIcon:Kr["a"],VListItemTitle:Qr["b"],VNavigationDrawer:Gt["a"]});var Zr={name:"App",components:{Toolbar:wt,Drawer:Xr},data:function(){return{loading:!0}},created:function(){var t=this;o.a.ready.then((function(){t.loading=!1}))},mounted:function(){this.onResize()},methods:{onResize:function(){this.$store.windowSize.x=window.innerWidth-this.$vuetify.application.left-this.$vuetify.application.right,this.$store.windowSize.y=window.innerHeight-this.$vuetify.application.top},toggleDrawer:function(){this.$refs.drawer.toggle()}}},ts=Zr,es=(a("5c0b"),a("7496")),as=a("f6c4"),ns=a("490a"),rs=a("0fd9"),ss=a("269a"),is=a.n(ss),os=a("dc22"),cs=Object(ht["a"])(ts,r,s,!1,null,null,null),us=cs.exports;dt()(cs,{VApp:es["a"],VMain:as["a"],VProgressCircular:ns["a"],VRow:rs["a"]}),is()(cs,{Resize:os["a"]});var ls=a("f309");n["default"].use(ls["a"]);var hs=new ls["a"]({}),ms=a("ee98"),ds=a.n(ms),ps=new n["default"]({data:function(){return{windowSize:{x:0,y:0}}}});n["default"].prototype.$store=ps;var fs=new n["default"];n["default"].prototype.$bus=fs,n["default"].use(ds.a),fs.notify=function(t,e){n["default"].notify({group:"alert",title:{error:"Error",success:"Success"}[t],text:e,type:{error:"type-error",success:"type-success"}[t],duration:6e3})},n["default"].config.productionTip=!1,new n["default"]({router:Lr,store:ps,vuetify:hs,render:function(t){return t(us)}}).$mount("#app")},"5c0b":function(t,e,a){"use strict";a("9c0c")},6:function(t,e){},6180:function(t,e,a){},7:function(t,e){},8:function(t,e){},9:function(t,e){},"9c0c":function(t,e,a){},a917:function(t,e,a){},b6dd:function(t,e,a){"use strict";a("a917")}});
//# sourceMappingURL=app.2de7489c.js.map