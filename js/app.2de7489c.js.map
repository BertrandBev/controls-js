{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/components/nav/Drawer.vue?128c","webpack:///./src/App.vue?ab6a","webpack:///./src/components/nav/Toolbar.vue?cdcb","webpack:///./src/components/models/model.js","webpack:///./src/components/math.js","webpack:///./src/components/models/secondOrder/trajectories.js","webpack:///./src/components/models/utils.js","webpack:///./src/components/models/secondOrder/secondOrder.js","webpack:///./src/components/models/simplePendulum/trajectories.js","webpack:///./src/components/models/arm/arm.js","webpack:///./src/components/models/simplePendulum/simplePendulum.js","webpack:///./src/components/models/doublePendulum/trajectories.js","webpack:///./src/components/models/doublePendulum/doublePendulum.js","webpack:///./src/components/models/quadrotor2D/trajectories.js","webpack:///./src/components/models/quadrotor2D/quadrotor2D.js","webpack:///./src/components/models/cartPole/trajectory.js","webpack:///./src/components/models/cartPole/cartPole.js","webpack:///./src/components/models/car/car.js","webpack:///./src/components/models/systems.js","webpack:///src/components/nav/Toolbar.vue","webpack:///./src/components/nav/Toolbar.vue?c50a","webpack:///./src/components/nav/Toolbar.vue","webpack:///./src/components/nav/Drawer.vue?b253","webpack:///./src/views/Home.vue?6ceb","webpack:///./README.md","webpack:///./src/views/Demo.vue?4c6b","webpack:///./src/components/models/ModelLayout.vue?ca8b","webpack:///src/components/models/ModelLayout.vue","webpack:///./src/components/models/ModelLayout.vue?dbf2","webpack:///./src/components/models/ModelLayout.vue?5919","webpack:///./src/components/worldMixin.js","webpack:///./src/components/systemMixin.js","webpack:///./src/components/environments/DirectCollocation/DirectCollocationPlugin.vue?46e7","webpack:///./src/components/planners/directCollocation.js","webpack:///./src/components/planners/trajectory.js","webpack:///./src/components/environments/utils/Section.vue?79cf","webpack:///src/components/environments/utils/Section.vue","webpack:///./src/components/environments/utils/Section.vue?9b5b","webpack:///./src/components/environments/utils/Section.vue","webpack:///./src/components/environments/utils/ArrayInput.vue?ed86","webpack:///src/components/environments/utils/ArrayInput.vue","webpack:///./src/components/environments/utils/ArrayInput.vue?b022","webpack:///./src/components/environments/utils/ArrayInput.vue","webpack:///./src/components/environments/utils/ValueInput.vue?a489","webpack:///src/components/environments/utils/ValueInput.vue","webpack:///./src/components/environments/utils/ValueInput.vue?0dd3","webpack:///./src/components/environments/utils/ValueInput.vue","webpack:///./src/components/environments/pluginMixin.js","webpack:///src/components/environments/DirectCollocation/DirectCollocationPlugin.vue","webpack:///./src/components/environments/DirectCollocation/DirectCollocationPlugin.vue?f8b2","webpack:///./src/components/environments/DirectCollocation/DirectCollocationPlugin.vue","webpack:///src/views/Demo.vue","webpack:///./src/views/Demo.vue?fbbd","webpack:///./src/views/Demo.vue","webpack:///src/views/Home.vue","webpack:///./src/views/Home.vue?e89c","webpack:///./src/views/Home.vue","webpack:///./src/components/environments/LQR/LQR.vue?e242","webpack:///./src/components/plots/TrajPlot.vue?5ed6","webpack:///src/components/plots/TrajPlot.vue","webpack:///./src/components/plots/TrajPlot.vue?aa71","webpack:///./src/components/plots/TrajPlot.vue","webpack:///./src/components/environments/LQR/LQRPlugin.vue?16a8","webpack:///./src/components/controllers/controller.js","webpack:///./src/components/models/linearSystem.js","webpack:///./src/components/controllers/LQR.js","webpack:///./src/components/environments/utils/MatrixInput.vue?2e41","webpack:///src/components/environments/utils/MatrixInput.vue","webpack:///./src/components/environments/utils/MatrixInput.vue?a4ff","webpack:///./src/components/environments/utils/MatrixInput.vue","webpack:///src/components/environments/LQR/LQRPlugin.vue","webpack:///./src/components/environments/LQR/LQRPlugin.vue?1703","webpack:///./src/components/environments/LQR/LQRPlugin.vue","webpack:///src/components/environments/LQR/LQR.vue","webpack:///./src/components/environments/LQR/LQR.vue?b130","webpack:///./src/components/environments/LQR/LQR.vue","webpack:///./src/components/environments/ValueIteration/ValueIteration.vue?4d24","webpack:///./src/components/plots/ValueIterationPlot.vue?ca13","webpack:///src/components/plots/ValueIterationPlot.vue","webpack:///./src/components/plots/ValueIterationPlot.vue?e69e","webpack:///./src/components/plots/ValueIterationPlot.vue","webpack:///./src/components/environments/ValueIteration/ValueIterationPlugin.vue?1884","webpack:///./src/components/planners/valueIterationPlanner2D.js","webpack:///src/components/environments/ValueIteration/ValueIterationPlugin.vue","webpack:///./src/components/environments/ValueIteration/ValueIterationPlugin.vue?7226","webpack:///./src/components/environments/ValueIteration/ValueIterationPlugin.vue","webpack:///src/components/environments/ValueIteration/ValueIteration.vue","webpack:///./src/components/environments/ValueIteration/ValueIteration.vue?eea7","webpack:///./src/components/environments/ValueIteration/ValueIteration.vue","webpack:///./src/components/environments/RRT/RRT.vue?0caa","webpack:///./src/components/plots/RRTPlot.vue?fa3d","webpack:///src/components/plots/RRTPlot.vue","webpack:///./src/components/plots/RRTPlot.vue?cc08","webpack:///./src/components/plots/RRTPlot.vue","webpack:///./src/components/environments/RRT/RRTPlugin.vue?9d6f","webpack:///./src/components/environments/utils/Blocks.vue?263f","webpack:///./src/components/twoUtils.js","webpack:///src/components/environments/utils/Blocks.vue","webpack:///./src/components/environments/utils/Blocks.vue?5fd1","webpack:///./src/components/environments/utils/Blocks.vue","webpack:///./src/components/planners/rrt.js","webpack:///src/components/environments/RRT/RRTPlugin.vue","webpack:///./src/components/environments/RRT/RRTPlugin.vue?398c","webpack:///./src/components/environments/RRT/RRTPlugin.vue","webpack:///src/components/environments/RRT/RRT.vue","webpack:///./src/components/environments/RRT/RRT.vue?2772","webpack:///./src/components/environments/RRT/RRT.vue","webpack:///./src/components/environments/Flatness/Flatness.vue?75df","webpack:///./src/components/environments/Flatness/FlatnessPlugin.vue?7137","webpack:///src/components/environments/Flatness/FlatnessPlugin.vue","webpack:///./src/components/environments/Flatness/FlatnessPlugin.vue?fd82","webpack:///./src/components/environments/Flatness/FlatnessPlugin.vue","webpack:///./src/components/planners/interactivePath.js","webpack:///src/components/environments/Flatness/Flatness.vue","webpack:///./src/components/environments/Flatness/Flatness.vue?69d4","webpack:///./src/components/environments/Flatness/Flatness.vue","webpack:///./src/components/environments/DirectCollocation/DirectCollocation.vue?f381","webpack:///src/components/environments/DirectCollocation/DirectCollocation.vue","webpack:///./src/components/environments/DirectCollocation/DirectCollocation.vue?1dc8","webpack:///./src/components/environments/DirectCollocation/DirectCollocation.vue","webpack:///./src/components/environments/MPC/MPC.vue?db0f","webpack:///./src/components/environments/MPC/MPCPlugin.vue?da5d","webpack:///./src/components/controllers/MPC.js","webpack:///src/components/environments/MPC/MPCPlugin.vue","webpack:///./src/components/environments/MPC/MPCPlugin.vue?0e18","webpack:///./src/components/environments/MPC/MPCPlugin.vue","webpack:///src/components/environments/MPC/MPC.vue","webpack:///./src/components/environments/MPC/MPC.vue?ccc8","webpack:///./src/components/environments/MPC/MPC.vue","webpack:///./src/components/environments/KalmanFilter/KalmanFilter.vue?5090","webpack:///./src/components/plots/KalmanPlot.vue?e583","webpack:///src/components/plots/KalmanPlot.vue","webpack:///./src/components/plots/KalmanPlot.vue?d700","webpack:///./src/components/plots/KalmanPlot.vue","webpack:///./src/components/environments/KalmanFilter/KalmanFilterPlugin.vue?64ef","webpack:///./src/components/environments/utils/Sensors.vue?a60c","webpack:///src/components/environments/utils/Sensors.vue","webpack:///./src/components/environments/utils/Sensors.vue?6bc4","webpack:///./src/components/environments/utils/Sensors.vue","webpack:///./src/components/estimators/kalmanFilter.js","webpack:///src/components/environments/KalmanFilter/KalmanFilterPlugin.vue","webpack:///./src/components/environments/KalmanFilter/KalmanFilterPlugin.vue?7591","webpack:///./src/components/environments/KalmanFilter/KalmanFilterPlugin.vue","webpack:///src/components/environments/KalmanFilter/KalmanFilter.vue","webpack:///./src/components/environments/KalmanFilter/KalmanFilter.vue?eff3","webpack:///./src/components/environments/KalmanFilter/KalmanFilter.vue","webpack:///./src/components/environments/ParticleFilter/ParticleFilter.vue?afe6","webpack:///./src/components/plots/ParticlePlot.vue?096c","webpack:///src/components/plots/ParticlePlot.vue","webpack:///./src/components/plots/ParticlePlot.vue?0033","webpack:///./src/components/plots/ParticlePlot.vue","webpack:///./src/components/environments/ParticleFilter/ParticleFilterPlugin.vue?8361","webpack:///./src/components/estimators/particleFilter.js","webpack:///src/components/environments/ParticleFilter/ParticleFilterPlugin.vue","webpack:///./src/components/environments/ParticleFilter/ParticleFilterPlugin.vue?a9ce","webpack:///./src/components/environments/ParticleFilter/ParticleFilterPlugin.vue","webpack:///src/components/environments/ParticleFilter/ParticleFilter.vue","webpack:///./src/components/environments/ParticleFilter/ParticleFilter.vue?f7e1","webpack:///./src/components/environments/ParticleFilter/ParticleFilter.vue","webpack:///./src/router/router.js","webpack:///src/components/nav/Drawer.vue","webpack:///./src/components/nav/Drawer.vue?5d62","webpack:///./src/components/nav/Drawer.vue?97b0","webpack:///src/App.vue","webpack:///./src/App.vue?b8d2","webpack:///./src/App.vue?b948","webpack:///./src/plugins/vuetify.js","webpack:///./src/main.js","webpack:///./src/App.vue?d1be","webpack:///./src/components/models/ModelLayout.vue?3754"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","jsonpScriptSrc","p","exports","module","l","e","promises","installedChunkData","promise","Promise","resolve","reject","onScriptComplete","script","document","createElement","charset","timeout","nc","setAttribute","src","error","Error","event","onerror","onload","clearTimeout","chunk","errorType","type","realSrc","target","message","name","request","undefined","setTimeout","head","appendChild","all","m","c","d","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","oe","err","console","jsonpArray","window","oldJsonpFunction","slice","_vm","this","_h","$createElement","_c","_self","directives","rawName","expression","ref","on","toggleDrawer","staticStyle","attrs","$route","path","staticRenderFns","color","dark","showBack","staticClass","navback","_v","$event","stopPropagation","$emit","_s","title","$bus","_e","Model","states","commands","params","shape","statesCommands","x0","eig","Matrix","trim","x","setState","graphics","GC","popException","u","set","clampSelf","STATE_BOUNDS","dt","bound","dx","dynamics","xNext","matAdd","mul","array","backward","map","val","reverse","xn","un","k","block","setBlock","forEach","idx","derivative","forward","controller","duration","arr","getCommand","vcat","matAddSelf","wrapAngle","angle","mod","Math","PI","sqr","pow","matFromDiag","diag","mat","Array","addNoise","cov","mean","rows","rdn","Random","normal","Gaussian","setMean","setCov","absDet","abs","det","invCov","inverse","delta","matSub","scalar","transpose","matMul","exp","sqrt","differenciate","traj","tau","dTraj","div","smooth","wrap","decay","smoothed","bounceTraj","createMarker","two","radius","stroke","marker","makeGroup","circle","makeCircle","linewidth","add","sa","ea","segment","makeArcSegment","fill","noStroke","createCircularForce","theta","fArc","noFill","fHead","makePolygon","force","setControl","visible","opacity","min","headAngle","rotation","translation","cos","sin","createTraj","nPts","lines","line","makeLine","update","transform","xy","vertices","y","SecondOrder","STATES","COMMANDS","mouseTarget","xVel","_","clamp","newX","scale","GEOM","cartWidth","cartHeight","mr","cart","makeRectangle","colors","teal","base","sides","fLine","red","sign","group","showControl","side","uh","green","darken4","mpcParams","worldToCanvas","ghost","pt","Q","R","simEps","simDuration","disengage","divergenceThres","max","targets","dump","uBounds","anchors","measurement","pos","dist","norm","covariance","processNoise","inputNoise","sensors","noise","freeze","show","swingup","Arm","keys","g","mu","T","dT","J","Jacc","identity","matMulSelf","hcat","jacobians","dJ","eps","Jeps","tDot","M","dqtC","tauG","Jr","tauExt","Jt","tauF","dq","Minv","dqtCdq","d2q","atan2","thetaCmd","xk","thickness","createArm","purple","lighten2","indigo","xRef","updateArm","xMin","xMax","deltas","geom","r1","c1","chroma","darken","markerFill","arms","arm","createPole","SimplePendulum","ddx","center","maxThetaDot","holdTime","swingupMPC","DoublePendulum","m1","l1","m2","l2","s2","t1","t2","t1d","t2d","s1","cdt","sdt","L","a1","a2","tau1","tau2","f1","f2","g1","g2","u1","u2","c2dt","s2dt","cdtp2","c2","dx1dt1","dx1dt2","dx1dt1d","dx1dt2d","dx2dt1","dx2dt2","dx2dt1d","dx2dt2d","dx1du1","dx1du2","dx2du1","dx2du2","trajSup","xShift","flipTraj","flipTrajMPC","Quadrotor2D","I","u0","dx2dt","dy2dt","dy2du1","dt2du1","mulSelf","dxo","body","blue","propHeight","propLength","prop","shaft","system","dxy","ddxy","atan","dtheta","ddtheta","a","b","CartPole","mp","mc","den","td","f","td2","dt2dt","dt2dt1","dx2du","dt2du","thetaVel","COLOR","COLOR_DARK","COLOR_RED","pole","xWeight","Car","maxAccel","maxDelta","v","tan","mx","my","dy","dot","cross","asin","dClipped","ac","dc","step","w","lw","ww","concat","makePath","flatten","automatic","car","wheels","CORNERS","wheel","distribution","range","systems","TAG","props","computed","systemName","routeName","routeQuery","showRightDrawer","created","methods","component","VAppBar","VAppBarNavIcon","VBtn","VIcon","VSpacer","VToolbarItems","VToolbar","VToolbarTitle","model","callback","$$v","drawer","navHome","_l","route","meta","icon","isEnv","scopedSlots","_u","fn","proxy","sidx","class","active","isActive","navSystem","NAME","icons","github","style","_m","domProps","markdownHtml","_t","noSheet","sheet","components","Boolean","watch","$refs","translateY","sheetHeight","easing","canvas","$store","windowSize","overlayStyle","position","top","left","width","sheetStyle","height","bottom","canvasStyle","background","display","containerStyle","overflow","mounted","$on","$nextTick","beforeDestroy","$off","VNavigationDrawer","FPS_ALPHA","FRAME_COLOR","fps","lastUpdate","Date","now","loop","mouseDragging","parentElement","clientHeight","clientWidth","Two","appendTo","canvasToWorld","addEventListener","ev","dragging","offsetX","offsetY","frame","updateFun","dtMeas","updateTimeMs","targetDtMs","reset","isMounted","createGraphics","plugin","stepSystem","mouseTargetEnabled","trackMouse","ready","updateSystem","updateGraphics","flush","$set","anchor","refInFor","deleteAnchor","addAnchor","running","runCollocation","download","defaultParams","maxTime","maxEval","DirectCollocation","assert","dim","algorithm","nlopt","Algorithm","LD_SLSQP","opt","Optimize","setMinObjective","grad","tEnd","addDynamicContraints","setBounds","lower","upper","uIdx","tIdx","INF","setPoint","low","hight","floor","log","isNaN","setLowerBounds","setUpperBounds","len","vec","res","iTol","nx","nu","nConst","dhdt","h","xkIdx","ukIdx","getVector","uk","fk","Jxk","xJacobian","Juk","uJacobian","xkn","ukn","fkn","xck","uck","fck","cIdx","Jxkn","Jukn","Jxck","Juck","Inx","dXckdXk","dXckdXkn","dXckdUk","dXckdUkn","dXckdH","dCdXk","dCdXkn","dCdUk","dCdUkn","dCdH","grad0","ret0","constraint","nGrad","ret","diff","tolVec","addEqualityMConstraint","setMaxtime","setMaxeval","optimize","success","unpack","xList","uList","first","last","unshift","vector","NaN","Trajectory","watchers","Set","tStart","fun","delete","cols","nextIdx","ratio","toFixed","String","VDivider","label","arrToStr","parseModel","validate","notify","strToArr","str","split","join","VTextField","_n","Number","parseFloat","$options","mixins","pluginMixin","Section","ArrayInput","ValueInput","disableMouse","trajectories","simTraj","collocation","load","setParams","rtn","navigator","clipboard","writeText","then","ModelLayout","DirectCollocationPlugin","worldMixin","systemMixin","SysClass","Demo","highlight","html","md","render","divStyle","handler","oldValue","newValue","immediate","displaylogo","displayModeBar","scrollZoom","showAxisDragHandles","responsive","getSeries","tList","hoverinfo","xaxis","fixedrange","yaxis","margin","pad","enabled","runLQR","Controller","LinearSystem","A","B","du","linearizeSystem","Jx","Ju","dx0","setCol","row","linearize","Jxn","Jun","print","LQR","K","sol","Solvers","careSolve","ones","simulate","xu0","matSubSelf","linsys","fromModel","delta_x","diagonal","diagArray","matrix","MatrixInput","linearTraj","controllerEnabled","solve","DT","linearSimulate","VCheckbox","TrajPlot","LQRPlugin","VChip","viPlanner","trajectory","onclick","valueIterationPlanner","names","removeWatcher","addWatcher","points","getXY","yList","V","trajData","runValueIteration","ValueIterationPlanner2D","bounds","yMin","yMax","yn","tableI","tableJ","policy","uMin","uMax","U","pack","table","meanTable","sk","maxUpdate","pk","avg","count","newVal","stationnary","nextPt","newPt","smoothTable","maxIter","currentV","minV","ni","nj","nextV","cost","createTransitionTable","JSON","stringify","sub","kx","maxDuration","sequence","Infinity","pt0","unpackPt","normSqr","ptSet","ku","has","unpackU","xf","loadDump","xPrev","converged","ValueIterationPlot","ValueIterationPlugin","rrt","createLine","x1","y0","x2","y1","appendLinesRec","node","next","adx","rng","x11","x22","nodes","shapes","initBlocks","runRRT","size","deleteBlock","addBlock","setDraggable","el","_renderer","elem","cursor","preventDefault","clientX","clientY","drag","mousemove","dragEnd","removeEventListener","mouseup","mousedown","blockDragged","blocks","tPrev","labelBlocks","createBlock","remove","text","weight","square","RRT","rrtParams","clear","random","dxn","minDist","minNode","newNode","append","findClosestNode","validFun","iterations","sample","extend","Blocks","run","RRTPlot","RRTPlugin","interactivePath","buildTraj","addUpdateListener","pathUpdated","InteractivePath","updateListeners","vHandle","dHandle","Path","Anchor","Commands","curve","editColor","handle","copy","controls","addSelf","ll","_this","Events","change","onUpdate","subSelf","right","multiplyScalar","Vue","nextTick","cx","cy","listener","getPointAt","discretize","FlatnessPlugin","systemRef","runMPC","MPC","DEBUG","refTraj","linTraj","P","SparseMatrix","q","At","TripletVector","In","negOnes","Ab","Bb","addDiag","testJacobian","uDiag","lb","ub","quadProgSolve","xTraj","x_n","u_n","ptList","optimizeInner","mpc","MPCPlugin","kalmanFilter","getGaussian","state","zeroline","sensorUpdate","sensor","deleteSensor","addSensor","sensorDragged","labelSensors","createSensor","createRadarSensor","radar","anim","round","direction","KalmanFilter","dP","z","zHat","H","PHt","Sensors","kalmanFilterParams","sigma","container","insertBefore","childNodes","updateSigma","predict","KalmanPlot","KalmanFilterPlugin","particleFilter","particles","px","particle","py","resample","Particle","constructor","newParticle","gaussian","density","ParticleFilter","cloneDeep","normalizeWeights","weights","W","newParticles","index","beta","mw","clone","particleFilterParams","createParticleGraphic","updateParticleGraphic","particleGraphics","tResample","ParticlePlot","ParticleFilterPlugin","use","VueRouter","env","ValueIteration","Flatness","envRoutes","rightDrawer","routes","Home","router","process","$router","toggle","open","VList","VListGroup","VListItem","VListItemAction","VListItemContent","VListItemIcon","VListItemTitle","Toolbar","Drawer","onResize","VApp","VMain","VProgressCircular","VRow","Resize","Vuetify","store","bus","Notifications","msg","config","productionTip","vuetify","App","$mount"],"mappings":"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","file":"js/app.2de7489c.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// script path function\n \tfunction jsonpScriptSrc(chunkId) {\n \t\treturn __webpack_require__.p + \"js/\" + ({}[chunkId]||chunkId) + \".\" + {\"chunk-2d0e6259\":\"659353d3\",\"chunk-2d20fcfa\":\"abc26475\"}[chunkId] + \".js\"\n \t}\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\tvar promises = [];\n\n\n \t\t// JSONP chunk loading for javascript\n\n \t\tvar installedChunkData = installedChunks[chunkId];\n \t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n \t\t\t// a Promise means \"currently loading\".\n \t\t\tif(installedChunkData) {\n \t\t\t\tpromises.push(installedChunkData[2]);\n \t\t\t} else {\n \t\t\t\t// setup Promise in chunk cache\n \t\t\t\tvar promise = new Promise(function(resolve, reject) {\n \t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n \t\t\t\t});\n \t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n \t\t\t\t// start chunk loading\n \t\t\t\tvar script = document.createElement('script');\n \t\t\t\tvar onScriptComplete;\n\n \t\t\t\tscript.charset = 'utf-8';\n \t\t\t\tscript.timeout = 120;\n \t\t\t\tif (__webpack_require__.nc) {\n \t\t\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n \t\t\t\t}\n \t\t\t\tscript.src = jsonpScriptSrc(chunkId);\n\n \t\t\t\t// create error before stack unwound to get useful stacktrace later\n \t\t\t\tvar error = new Error();\n \t\t\t\tonScriptComplete = function (event) {\n \t\t\t\t\t// avoid mem leaks in IE.\n \t\t\t\t\tscript.onerror = script.onload = null;\n \t\t\t\t\tclearTimeout(timeout);\n \t\t\t\t\tvar chunk = installedChunks[chunkId];\n \t\t\t\t\tif(chunk !== 0) {\n \t\t\t\t\t\tif(chunk) {\n \t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n \t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n \t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n \t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n \t\t\t\t\t\t\terror.type = errorType;\n \t\t\t\t\t\t\terror.request = realSrc;\n \t\t\t\t\t\t\tchunk[1](error);\n \t\t\t\t\t\t}\n \t\t\t\t\t\tinstalledChunks[chunkId] = undefined;\n \t\t\t\t\t}\n \t\t\t\t};\n \t\t\t\tvar timeout = setTimeout(function(){\n \t\t\t\t\tonScriptComplete({ type: 'timeout', target: script });\n \t\t\t\t}, 120000);\n \t\t\t\tscript.onerror = script.onload = onScriptComplete;\n \t\t\t\tdocument.head.appendChild(script);\n \t\t\t}\n \t\t}\n \t\treturn Promise.all(promises);\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/controls-js/\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--5-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--5-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--5-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Drawer.vue?vue&type=style&index=0&id=bff60a68&scoped=true&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-app',{directives:[{name:\"resize\",rawName:\"v-resize\",value:(_vm.onResize),expression:\"onResize\"}]},[_c('Drawer',{ref:\"drawer\"}),_c('Toolbar',{on:{\"toggleDrawer\":_vm.toggleDrawer}}),_c('v-main',[(_vm.loading)?_c('v-row',{staticStyle:{\"height\":\"100%\"},attrs:{\"align\":\"center\",\"justify\":\"center\"}},[_c('v-progress-circular',{attrs:{\"size\":40,\"color\":\"blue\",\"indeterminate\":\"\"}})],1):_c('router-view',{key:_vm.$route.path})],1),_c('notifications',{attrs:{\"group\":\"alert\",\"position\":\"bottom center\",\"width\":\"400px\",\"closeOnClick\":\"\",\"max\":3,\"classes\":\"notification-style\"}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-app-bar',{attrs:{\"app\":\"\",\"clipped-left\":\"\",\"clipped-right\":\"\",\"color\":_vm.color,\"dark\":_vm.dark,\"dense\":\"\"}},[(!_vm.showBack)?_c('v-app-bar-nav-icon',{on:{\"click\":function($event){$event.stopPropagation();return _vm.$emit('toggleDrawer')}}}):_c('v-toolbar-items',{staticStyle:{\"margin-left\":\"0px\"}},[_c('v-btn',{staticClass:\"mr-2\",attrs:{\"icon\":\"\"},on:{\"click\":_vm.navback}},[_c('v-icon',{attrs:{\"small\":\"\"}},[_vm._v(\"fas fa-chevron-left\")])],1)],1),_c('v-toolbar-title',{staticClass:\"headline\"},[_c('span',{staticClass:\"font-weight-light\"},[_vm._v(_vm._s(_vm.title))])]),_c('v-spacer'),_c('v-toolbar-items',[_c('v-btn',{attrs:{\"href\":\"https://github.com/BertrandBev/controls-js\",\"target\":\"_blank\",\"text\":\"\"}},[_c('span',{staticClass:\"mr-2\"},[_vm._v(\"Github\")]),_c('v-icon',[_vm._v(\"mdi-open-in-new\")])],1)],1),(_vm.showRightDrawer)?_c('v-btn',{attrs:{\"icon\":\"\",\"dark\":\"\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.$bus.$emit('toggleDrawer')}}},[_c('v-icon',[_vm._v(\"mdi-tune\")])],1):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import eig from '@eigen'\n\nclass Model {\n  static STATE_BOUNDS = 1000\n\n  constructor(states, commands, params) {\n    // Populate properties\n    this.states = states\n    this.commands = commands\n    this.shape = [this.states.length, this.commands.length]\n    this.statesCommands = [...states, ...commands]\n    this.params = params\n    // Set state\n    const x0 = params.x0 ? new eig.Matrix(params.x0) : this.trim().x;\n    this.setState(x0)\n    // Init graphics\n    this.graphics = {}\n  }\n\n  delete() {\n    eig.GC.popException(this.x);\n  }\n\n  trim() {\n    return { x: new eig.Matrix(this.shape[0], 1), u: new eig.Matrix(this.shape[1], 1) }\n  }\n\n  /**\n   * Set state\n   * @param {Matrix} x\n   */\n  setState(x) {\n    eig.GC.set(this, 'x', x)\n  }\n\n  /**\n   * Bound state x to appropriate domain\n   * @param {Matrix} x \n   */\n  bound(x) {\n    x.clampSelf(-Model.STATE_BOUNDS, Model.STATE_BOUNDS)\n  }\n\n  /**\n   * Returns dx/dt\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} dx\n   */\n  dynamics(x, u) {\n    throw new Error('Must be overridden')\n  }\n\n  /**\n   * Get next state from some state\n   * @param {Matrix} x - State\n   * @param {Matrix} u - Command\n   * @param {Number} dt - Timestep\n   * @param {Boolean} bound - Bound state to system domain\n   */\n  xNext(x, u, dt, bound = true) {\n    const dx = this.dynamics(x, u)\n    const xNext = x.matAdd(dx.mul(dt))\n    if (bound)\n      this.bound(xNext)\n    return xNext\n  }\n\n  /**\n   * Propagate state one timestep forward\n   * @param {Matrix} u - Command\n   * @param {Number} dt - Timestep\n   */\n  step(u, dt) {\n    const xNext = this.xNext(this.x, u, dt)\n    this.setState(xNext)\n  }\n\n  /**\n   * Reverse trajectory array\n   * @param {Array} array\n   */\n  reverse(array) {\n    const backward = array.map(val => eig.Matrix(val));\n    backward.reverse();\n    const [xn, un] = this.shape\n    // Shift backwards commands and tranform directions\n    for (let k = 0; k < backward.length; k++) {\n      if (k > 0) {\n        const block = backward[k].block(xn, 0, un, 1);\n        backward[k - 1].setBlock(xn, 0, block);\n      }\n      this.statesCommands.forEach((val, idx) => {\n        if (val.derivative) backward[k].set(idx, -backward[k].get(idx))\n      })\n    }\n    const forward = [...array]\n    forward.splice(array.length - 1, 1)\n    return [...forward, ...backward]\n  }\n\n  /**\n   * Simulate\n   */\n  simulate(controller, x0, dt, duration) {\n    let x = new eig.Matrix(x0)\n    const arr = []\n    for (let t = 0; t < duration; t += dt) {\n      const u = controller.getCommand(x, t);\n      const dx = this.dynamics(x, u);\n      arr.push(x.vcat(u))\n      x.matAddSelf(dx.mul(dt))\n    }\n    return arr\n  }\n}\n\nexport default Model","import eig from '@eigen'\n\nfunction wrapAngle(angle) {\n  let mod = (angle + Math.PI) % (2 * Math.PI)\n  if (mod < 0) { mod += 2 * Math.PI }\n  return mod - Math.PI\n}\n\nfunction sqr(val) {\n  return Math.pow(val, 2)\n}\n\nfunction matFromDiag(diag) {\n  const n = diag.length\n  const mat = [...Array(n)].map(() => [...Array(n)].map(() => 0))\n  for (let k = 0; k < n; k++) {\n    mat[k][k] = diag[k]\n  }\n  return mat\n}\n\nfunction addNoise(x, cov) {\n  // Add measurement noise (Consider adding that in a library)\n  const mean = new eig.Matrix(x.rows(), 1);\n  const rdn = eig.Random.normal(mean, cov, 1);\n  x.matAddSelf(rdn);\n}\n\n// A multivariate gaussian class\nclass Gaussian {\n  constructor(mean, cov) {\n    this.setMean(mean)\n    this.setCov(cov)\n  }\n\n  setMean(mean) {\n    eig.GC.set(this, 'mean', mean)\n  }\n\n  setCov(cov) {\n    this.absDet = Math.abs(cov.det());\n    const invCov = cov.inverse();\n    eig.GC.set(this, 'invCov', invCov)\n  }\n\n  delete() {\n    eig.GC.popException(this.mean)\n    eig.GC.popException(this.invCov)\n  }\n\n  density(x) {\n    const k = this.mean.rows();\n    const delta = x.matSub(this.mean);\n    const scalar = delta.transpose().matMul(this.invCov).matMul(delta).get(0, 0);\n    return Math.exp(-0.5 * scalar) / Math.sqrt(Math.pow(2 * Math.PI, k) * this.absDet)\n  }\n}\n\n\n/**\n * TODO: add to shared lib\n * @param {Array} traj \n * @param {Number} dt \n * @param {Number} tau Decay characteristic time for low-pass\n */\nfunction differenciate(traj, dt, tau = 1e-8, loop = false) {\n  const dTraj = []\n  for (let k = 0; k < traj.length; k++) {\n    const div = traj[(k + 1) % traj.length].matSub(traj[k % traj.length]).div(dt)\n    dTraj.push(div)\n  }\n  return smooth(dTraj, dt, tau)\n}\n\n/**\n * \n * @param {Array} traj \n * @param {Number} dt \n * @param {Number} tau Decay characteristic time for low-pass\n * @param {Boolean} wrap Wether the trajectory smoothing should wrap\n */\nfunction smooth(traj, dt, tau = 1e-8, wrap = true) {\n  if (traj.length === 0) {\n    return []\n  }\n  const decay = Math.exp(-2 * Math.PI * dt / tau)\n  let val = traj[0]\n  const smoothed = []\n  for (let k = 0; k < (wrap ? 2 : 1) * traj.length; k++) {\n    val = val.mul(decay).matAdd(traj[k % traj.length].mul(1 - decay))\n    if (!wrap || k >= traj.length) {\n      smoothed.push(val)\n    }\n  }\n  return smoothed\n}\n\nexport { wrapAngle, sqr, matFromDiag, addNoise, Gaussian, differenciate, smooth }","\nconst bounceTraj = {\n  dt: 0.04472625790685786,\n  x: [[-2.0000, 0.0000, 5.0000],\n  [-1.9947, 0.2294, 5.0000],\n  [-1.9790, 0.4587, 5.0000],\n  [-1.9527, 0.6881, 5.0000],\n  [-1.9158, 0.9175, 5.0000],\n  [-1.8685, 1.1468, 5.0000],\n  [-1.8106, 1.3762, 5.0000],\n  [-1.7422, 1.6056, 5.0000],\n  [-1.6633, 1.8349, 5.0000],\n  [-1.5739, 2.0643, 5.0000],\n  [-1.4739, 2.2937, 5.0000],\n  [-1.3634, 2.5230, 5.0000],\n  [-1.2424, 2.7524, 5.0000],\n  [-1.1109, 2.9818, 5.0000],\n  [-0.9689, 3.2111, 5.0000],\n  [-0.8163, 3.4405, 5.0000],\n  [-0.6532, 3.6698, 5.0000],\n  [-0.4796, 3.8992, 5.0000],\n  [-0.2955, 4.1286, 5.0000],\n  [-0.1008, 4.3579, 5.0000],\n  [0.1008, 4.3579, -5.0000],\n  [0.2955, 4.1286, -5.0000],\n  [0.4796, 3.8992, -5.0000],\n  [0.6532, 3.6698, -5.0000],\n  [0.8163, 3.4405, -5.0000],\n  [0.9689, 3.2111, -5.0000],\n  [1.1109, 2.9818, -5.0000],\n  [1.2424, 2.7524, -5.0000],\n  [1.3634, 2.5230, -5.0000],\n  [1.4739, 2.2937, -5.0000],\n  [1.5739, 2.0643, -5.0000],\n  [1.6633, 1.8349, -5.0000],\n  [1.7422, 1.6056, -5.0000],\n  [1.8106, 1.3762, -5.0000],\n  [1.8685, 1.1468, -5.0000],\n  [1.9158, 0.9175, -5.0000],\n  [1.9527, 0.6881, -5.0000],\n  [1.9790, 0.4587, -5.0000],\n  [1.9947, 0.2294, -5.0000],\n  [2.0000, 0.0000, -5.0000],\n  [1.9947, -0.2294, -5.0000],\n  [1.9790, -0.4587, -5.0000],\n  [1.9527, -0.6881, -5.0000],\n  [1.9158, -0.9175, -5.0000],\n  [1.8685, -1.1468, -5.0000],\n  [1.8106, -1.3762, -5.0000],\n  [1.7422, -1.6056, -5.0000],\n  [1.6633, -1.8349, -5.0000],\n  [1.5739, -2.0643, -5.0000],\n  [1.4739, -2.2937, -5.0000],\n  [1.3634, -2.5230, -5.0000],\n  [1.2424, -2.7524, -5.0000],\n  [1.1109, -2.9818, -5.0000],\n  [0.9689, -3.2111, -5.0000],\n  [0.8163, -3.4405, -5.0000],\n  [0.6532, -3.6698, -5.0000],\n  [0.4796, -3.8992, -5.0000],\n  [0.2955, -4.1286, -5.0000],\n  [0.1008, -4.3579, 5.0000],\n  [-0.1008, -4.3579, 5.0000],\n  [-0.2955, -4.1286, 5.0000],\n  [-0.4796, -3.8992, 5.0000],\n  [-0.6532, -3.6698, 5.0000],\n  [-0.8163, -3.4405, 5.0000],\n  [-0.9689, -3.2111, 5.0000],\n  [-1.1109, -2.9818, 5.0000],\n  [-1.2424, -2.7524, 5.0000],\n  [-1.3634, -2.5230, 5.0000],\n  [-1.4739, -2.2937, 5.0000],\n  [-1.5739, -2.0643, 5.0000],\n  [-1.6633, -1.8349, 5.0000],\n  [-1.7422, -1.6056, 5.0000],\n  [-1.8106, -1.3762, 5.0000],\n  [-1.8685, -1.1468, 5.0000],\n  [-1.9158, -0.9175, 5.0000],\n  [-1.9527, -0.6881, 5.0000],\n  [-1.9790, -0.4587, 5.0000],\n  [-1.9947, -0.2294, 5.0000],\n  [-2.0000, 0.0000, 5.0000]]\n}\n\nexport { bounceTraj }","const COLORS = {\n};\n\nfunction createMarker(two, radius, color, stroke = 0) {\n  const marker = two.makeGroup();\n  if (stroke > 0) {\n    const circle = two.makeCircle(0, 0, radius);\n    circle.stroke = color;\n    circle.linewidth = stroke;\n    marker.add(circle);\n  }\n  for (let k = 0; k < 4; k++) {\n    const [sa, ea] = [k * Math.PI / 2, (k + 1) * Math.PI / 2];\n    const segment = two.makeArcSegment(0, 0, 0, radius, sa, ea);\n    segment.fill = k % 2 === 0 ? '#ffffff' : color;\n    segment.noStroke();\n    // segment.linewidth = 3;\n    // segment.stroke = color;\n    marker.add(segment);\n  }\n  return marker;\n}\n\nfunction createCircularForce(two, radius, color) {\n  const theta = -5 * Math.PI / 4;\n  const [sa, ea] = [Math.PI / 4, theta];\n  const r = radius;\n  const fArc = two.makeArcSegment(0, 0, r, r, sa, ea);\n  fArc.stroke = color;\n  fArc.linewidth = 2;\n  fArc.noFill();\n  const fHead = two.makePolygon(0, 0, 6, 3);\n  fHead.fill = color;\n  const force = two.makeGroup(fArc, fHead);\n  const setControl = u => {\n    force.visible = !!u;\n    if (!u) return;\n    const opacity = Math.min(Math.abs(u) / 10, 1);\n    fArc.opacity = opacity;\n    fHead.opacity = opacity;\n    const headAngle = u < 0 ? sa : ea;\n    fHead.rotation = headAngle + (u < 0 ? Math.PI : 0);\n    fHead.translation.set(\n      r * Math.cos(headAngle),\n      r * Math.sin(headAngle)\n    );\n  };\n  setControl(0);\n  return { force, setControl };\n}\n\nfunction createTraj(two, nPts) {\n  const traj = {};\n  traj.data = [];\n  traj.lines = [...Array(nPts)].map(() => {\n    const line = two.makeLine(0, 0, 0, 0);\n    return line;\n  });\n  traj.update = (transform) => {\n    traj.data.forEach((x, idx) => {\n      const xy = transform(x);\n      traj.lines[idx].vertices[0].x = xy[0];\n      traj.lines[idx].vertices[0].y = xy[1];\n      traj.lines[idx].vertices[1].x = xy[0];\n      traj.lines[idx].vertices[1].y = xy[1];\n      if (idx > 0) {\n        traj.lines[idx - 1].vertices[1].x = xy[0];\n        traj.lines[idx - 1].vertices[1].y = xy[1];\n      }\n    });\n  };\n  return traj;\n}\n\nexport { createMarker, createCircularForce, createTraj, COLORS };","import eig from '@eigen';\nimport _ from 'lodash';\nimport colors from 'vuetify/lib/util/colors';\nimport Model from '@/components/models/model.js';\nimport { matFromDiag } from '@/components/math.js';\nimport { bounceTraj } from './trajectories.js';\nimport { createMarker, createTraj } from '../utils.js';\n\nclass SecondOrder extends Model {\n  static NAME = 'second order';\n  static TAG = 'secondOrder';\n  static STATES = Object.freeze([\n    { name: 'x', show: true },\n    { name: 'xDot', show: true, derivative: true },\n  ]);\n  static COMMANDS = Object.freeze([\n    { name: 'force' }\n  ]);\n\n  constructor(params = {}) {\n    super(SecondOrder.STATES, SecondOrder.COMMANDS, {\n      ...params,\n      m: 1\n    });\n  }\n\n  /**\n   * Bound state x to appropriate domain\n   * @param {Matrix} x \n   */\n  bound(x) {\n  }\n\n  /**\n   * Returns dx/dt\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} dx\n   */\n  dynamics(x, u) {\n    return new eig.Matrix([\n      x.get(1),\n      u.get(0) / this.params.m\n    ]);\n  }\n\n  /**\n   * Returns df/dx\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} df/dx\n   */\n  xJacobian(x, u) {\n    return new eig.Matrix([\n      [0, 1], [0, 0]\n    ]);\n  }\n\n  /**\n   * Returns df/du\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} df/du\n   */\n  uJacobian(x, u) {\n    return new eig.Matrix([\n      [0], [1 / this.params.m]\n    ]);\n  }\n\n  /**\n   * Mouse step\n   * @param {Number} dt \n   * @param {Array} mouseTarget \n   */\n  trackMouse(mouseTarget, dt) {\n    const { u } = this.trim();\n    const dx = this.dynamics(this.x, u);\n    const xVel = 10 * (mouseTarget[0] - this.x.get(0));\n    this.x.set(1, _.clamp(xVel, -15, 15));\n    dx.set(0, this.x.get(1));\n    // TODO: extract in schema\n    const newX = this.x.matAdd(dx.mul(dt));\n    this.bound(newX);\n    this.setState(newX);\n    return { u };\n  }\n\n  /**\n   * Draw model\n   */\n  createGraphics(two, scale) {\n    const GEOM = {\n      cartWidth: scale,\n      cartHeight: scale / 2,\n      mr: scale / 10 // Marker radius\n    };\n    // Cart\n    const cart = two.makeRectangle(0, 0, GEOM.cartWidth, GEOM.cartHeight);\n    cart.fill = colors.teal.base;\n    cart.linewidth = 2;\n\n    // Forces\n    const sides = [-GEOM.cartWidth / 2, GEOM.cartWidth / 2].map(x => {\n      const fLine = two.makeLine(x, 0, x, 0);\n      fLine.linewidth = 2;\n      fLine.stroke = colors.red.base;\n      const fHead = two.makePolygon(0, 0, 6, 3);\n      fHead.rotation = (Math.PI / 2) * Math.sign(x);\n      fHead.fill = colors.red.base;\n      return { group: two.makeGroup(fLine, fHead), fLine, fHead };\n    });\n\n    this.graphics.showControl = true;\n    this.graphics.setControl = u => {\n      sides.forEach((side, idx) => {\n        const uh = _.clamp(u.get(0) * 5, -100, 100);\n        side.group.visible = this.graphics.showControl &&\n          (idx - 0.5) * uh > 0 &&\n          Math.abs(uh) > 0.1;\n        side.fHead.translation.x = (Math.sign(uh) * GEOM.cartWidth) / 2 + uh;\n        side.fLine.vertices[1].x = side.fHead.translation.x;\n      });\n    };\n    this.graphics.cart = two.makeGroup(\n      cart,\n      sides[0].group,\n      sides[1].group\n    );\n\n    // Create marker\n    const marker = createMarker(two, GEOM.mr, colors.green.darken4, 4);\n    this.graphics.cart.add(marker);\n\n    // Create traj\n    this.graphics.traj = createTraj(two, this.mpcParams().nPts);\n  }\n\n  /**\n   * Update model\n   */\n  updateGraphics(worldToCanvas, params) {\n    const { u } = params;\n    const x = this.x;\n    this.graphics.cart.translation.set(...worldToCanvas([x.get(0), 0]));\n    if (u)\n      this.graphics.setControl(u);\n    this.graphics.cart.opacity = params.ghost ? 0.3 : 1;\n    this.graphics.traj.update((pt) => {\n      return worldToCanvas([pt.get(0), 0.1]);\n    });\n  }\n\n  /**\n   * LQR Params\n   */\n  lqrParams() {\n    return {\n      x0: [-2, 0],\n      Q: matFromDiag([10, 1]),\n      R: matFromDiag([1]),\n      simEps: 1,\n      simDuration: 4,\n      disengage: false,\n      divergenceThres: 1e10,\n    };\n  }\n\n  /**\n   * Plugin params\n   */\n  valueIterationParams() {\n    return {\n      x: { min: [-5, -2], max: [5, 2], nPts: [100, 100], targets: [[0, 0]] },\n      u: { min: [-2], max: [2], nPts: [2] },\n      dt: 0.05,\n    x0: [-2, 0],\n    dump: () => import('./viTable.json')\n    };\n  }\n\n  /**\n   * Direct collocation params\n   */\n  directCollocationParams() {\n    return {\n      nPts: 20,\n      uBounds: { min: [-5], max: [5] },\n      anchors: [{ t: 0, x: [-2, 0] }, { t: 1, x: [2, 0] }],\n      reverse: true,\n      traj: bounceTraj\n    };\n  }\n\n  /**\n   * MPC Params\n   */\n  mpcParams() {\n    return {\n      nPts: 10,\n      uBounds: { min: [-10], max: [10] },\n      dt: 1 / 10,\n      traj: bounceTraj\n    };\n  }\n\n  /**\n   * Kalman filter plugin parameters\n   */\n  kalmanFilterParams() {\n    function measurement(params, x) {\n      const pos = new eig.Matrix(params.pos);\n      const x0 = new eig.Matrix([x.get(0), 0]);\n      const dist = pos.matSub(x0).norm();\n      return new eig.Matrix([dist]);\n    }\n    return {\n      covariance: [[5, 0], [0, 5]],\n      processNoise: [[0, 0], [0, 0]],\n      inputNoise: [[0, 0], [0, 0]],\n      sensors: [\n        { type: 'radar', dt: 1, pos: [-2, 2], measurement, noise: [[5]] }\n      ]\n    };\n  }\n}\n\nconst traj = [];\n\nexport { traj };\nexport default SecondOrder;","const swingup = {\n  dt: 0.10915679928353673,\n  x: [[0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 5.0000],\n  [0.0310, 0.5376, 5.0000],\n  [0.1178, 0.9810, 5.0000],\n  [0.2472, 1.2832, 5.0000],\n  [0.4014, 1.4195, 5.0000],\n  [0.5407, 0.8422, -5.0000],\n  [0.5692, -0.3306, -5.0000],\n  [0.4697, -1.4049, -5.0000],\n  [0.2599, -2.2674, -5.0000],\n  [-0.0306, -2.8188, -5.0000],\n  [-0.3628, -3.0037, -5.0000],\n  [-0.6958, -2.8435, -5.0000],\n  [-0.9954, -2.4296, -5.0000],\n  [-1.2393, -1.8763, -5.0000],\n  [-1.4126, -1.1475, -2.6690],\n  [-1.4783, 0.1174, 5.0000],\n  [-1.3732, 1.7272, 5.0000],\n  [-1.0933, 3.1987, 5.0000],\n  [-0.6608, 4.4000, 5.0000],\n  [-0.1180, 5.1155, 5.0000],\n  [0.4702, 5.1955, 5.0000],\n  [1.0344, 4.7275, 5.0000],\n  [1.5278, 3.9923, 5.0000],\n  [1.9367, 3.2680, 5.0000],\n  [2.2726, 2.7184, 5.0000],\n  [2.5597, 2.4095, 5.0000],\n  [2.8132, 2.0054, -1.3786],\n  [3.0015, 1.3015, -5.0000],\n  [3.1071, 0.5949, -5.0000],\n  [3.1400, 0.0000, -5.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, -5.0000],\n  [3.1400, 0.0000, -5.0000],\n  [3.1071, -0.5949, -5.0000],\n  [3.0015, -1.3015, -1.3786],\n  [2.8132, -2.0054, 5.0000],\n  [2.5597, -2.4095, 5.0000],\n  [2.2726, -2.7184, 5.0000],\n  [1.9367, -3.2680, 5.0000],\n  [1.5278, -3.9923, 5.0000],\n  [1.0344, -4.7275, 5.0000],\n  [0.4702, -5.1955, 5.0000],\n  [-0.1180, -5.1155, 5.0000],\n  [-0.6608, -4.4000, 5.0000],\n  [-1.0933, -3.1987, 5.0000],\n  [-1.3732, -1.7272, 5.0000],\n  [-1.4783, -0.1174, -2.6690],\n  [-1.4126, 1.1475, -5.0000],\n  [-1.2393, 1.8763, -5.0000],\n  [-0.9954, 2.4296, -5.0000],\n  [-0.6958, 2.8435, -5.0000],\n  [-0.3628, 3.0037, -5.0000],\n  [-0.0306, 2.8188, -5.0000],\n  [0.2599, 2.2674, -5.0000],\n  [0.4697, 1.4049, -5.0000],\n  [0.5692, 0.3306, -5.0000],\n  [0.5407, -0.8422, 5.0000],\n  [0.4014, -1.4195, 5.0000],\n  [0.2472, -1.2832, 5.0000],\n  [0.1178, -0.9810, 5.0000],\n  [0.0310, -0.5376, 5.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000]]\n};\n\nconst trim = {\n  dt: 0.10915679928353673,\n  x: [[3.1400, 0.0000, 0.0000],\n  [3.1400, 0.0000, 0.0000]]\n};\n\nexport { trim, swingup };","import eig from '@eigen'\nimport _ from 'lodash'\nimport colors from 'vuetify/lib/util/colors'\nimport Model from '@/components/models/model.js'\nimport { wrapAngle, sqr, matFromDiag } from '@/components/math.js'\nimport chroma from 'chroma-js'\nimport { createMarker } from '../utils.js'\nimport { createCircularForce } from '../utils.js'\n\nclass Arm extends Model {\n  static NAME = 'arm';\n  static TAG = 'arm';\n\n  constructor(params = {}) {\n    // n is the number of links\n    const n = params['n'] || 3;\n    const states = [...Array(2 * n).keys()].map(k => ({\n      name: k < n ? `theta${k}` : `theta${k - n}Dot`,\n      show: k < n,\n      derivative: k >= n\n    }));\n    const commands = [...Array(n).keys()].map(k => ({\n      name: `t${k}`\n    }));\n    super(states, commands, {\n      m: 1,\n      l: 1,\n      g: 9.8,\n      n: n,\n      mu: 0.4,\n      ...params\n    })\n  }\n\n  trim() {\n    const n = this.params.n;\n    const x = [...Array(2 * n).keys()].map(k => (\n      k == 0 ? Math.PI : 0\n    ));\n    // const x = [Math.PI / 2, Math.PI / 2];\n    const u = [...Array(n).keys()].map(() => 0);\n    return {\n      x: new eig.Matrix(x),\n      u: new eig.Matrix(u)\n    }\n  }\n\n  /**\n   * Bound state x to appropriate domain\n   * @param {Matrix} x \n   */\n  bound(x) {\n    super.bound(x)\n    for (let k = 0; k < this.params.n; k++)\n      x.set(k, wrapAngle(x.get(k)));\n  }\n\n\n  /**\n   * Helper function to build jacobians\n   */\n  jacobians(x) {\n    // https://studywolf.wordpress.com/2013/09/02/robot-control-jacobians-velocity-and-force/\n    const T = [], dT = []; // T_(i+1)(i); dT/dtheta\n    for (let i = 0; i < this.params.n; i++) {\n      const c = Math.cos(x.get(i));\n      const s = Math.sin(x.get(i));\n      const l = this.params.l;\n      T.push(new eig.Matrix([\n        [c, -s, c * l], [s, c, s * l], [0, 0, 1]\n      ]));\n      dT.push(new eig.Matrix([\n        [-s, -c, -s * l], [c, -s, c * l], [0, 0, 0]\n      ]));\n    }\n    // Compute jacobians\n    const J = []; // J_i\n    const pos = new eig.Matrix([0, 0, 1]);\n    const Jacc = []; // dT_10/dtheta * T_21 * ...\n    for (let i = 0; i < this.params.n; i++)\n      Jacc.push(eig.Matrix.identity(3, 3));\n    for (let i = 0; i < this.params.n; i++) {\n      J.push(eig.Matrix(3, 0));\n      for (let j = 0; j < this.params.n; j++) {\n        Jacc[j].matMulSelf(j == i ? dT[i] : T[i]);\n        J[i] = J[i].hcat(Jacc[j].matMul(pos).mul(j > i ? 0 : 1));\n      }\n    }\n    return J;\n  }\n\n\n  /**\n   * Returns dx/dt\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} dx\n   */\n  dynamics(x, u) {\n    // https://scaron.info/teaching/equations-of-motion.html#case-of-manipulators\n    // Build jacobians\n    const J = this.jacobians(x);\n    // Differenciate jacobians\n    const dJ = [];\n    const eps = 1e-10\n    for (let i = 0; i < this.params.n; i++)\n      dJ.push(eig.Matrix(3, this.params.n));\n    for (let j = 0; j < this.params.n; j++) {\n      const dx = eig.Matrix(x);\n      dx.set(j, dx.get(j) + eps);\n      const Jeps = this.jacobians(dx);\n\n      const tDot = x.get(this.params.n + j);\n      for (let i = 0; i < this.params.n; i++) {\n        dJ[i].matAddSelf(Jeps[i].matSub(J[i]).mul(tDot / eps))\n      }\n    }\n\n    // u = new eig.Matrix([0, -2])\n\n    // Now compute the dynamics\n    const M = eig.Matrix(this.params.n, this.params.n);\n    const dqtC = eig.Matrix(this.params.n, this.params.n);\n    const tauG = eig.Matrix(this.params.n, 1);\n    const Jr = eig.Matrix(this.params.n, 1);\n    const tauExt = eig.Matrix(this.params.n, 1);\n    const g = new eig.Matrix([9.81, 0, 1]);\n    for (let i = 0; i < this.params.n; i++) {\n      const Jt = J[i].transpose();\n      M.matAddSelf(Jt.matMul(J[i]).mul(this.params.m));\n      dqtC.matAddSelf(Jt.matMul(dJ[i]).mul(this.params.m));\n      tauG.matAddSelf(Jt.matMul(g).mul(this.params.m));\n      Jr.set(i, 1);\n      const tauF = x.get(this.params.n + i) * this.params.mu;\n      tauExt.matAddSelf(Jr.mul(u.get(i) - tauF));\n    }\n\n    // Deduces the joint space acceleration vector\n    const dq = x.block(this.params.n, 0, this.params.n, 1);\n    const Minv = M.inverse();\n    const dqtCdq = dqtC.matMul(dq);\n    const d2q = Minv.matMul(tauG.matAdd(tauExt).matSub(dqtCdq));\n    return dq.vcat(d2q);\n  }\n\n  /**\n   * Returns df/dx\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} df/dx\n   */\n  xJacobian(x, u) {\n\n  }\n\n  /**\n   * Returns df/du\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} df/du\n   */\n  uJacobian(x, u) {\n\n  }\n\n  /**\n   * Mouse step\n   * @param {Array} mouseTarget \n   * @param {Number} dt \n   */\n  trackMouse(mouseTarget, dt) {\n    const { u } = this.trim()\n    const dx = this.dynamics(this.x, u)\n    const theta = Math.atan2(mouseTarget[1], mouseTarget[0]) + Math.PI / 2\n    for (let k = 0; k < this.params.n; k++) {\n      const thetaCmd = k == 0 ? theta : 0;\n      const xk = this.x.get(k);\n      this.x.set(this.params.n + k, 10 * wrapAngle(thetaCmd - xk));\n      dx.set(k, this.x.get(this.params.n + k));\n      dx.set(this.params.n + k, 0);\n    }\n    // // TODO: extract in schema\n    const newX = this.x.matAdd(dx.mul(dt));\n    this.bound(newX);\n    this.setState(newX);\n    return { u };\n  }\n\n  static createPole(two, geom, fill) {\n    const r1 = two.makeRectangle(\n      0,\n      geom.length / 2,\n      geom.thickness,\n      geom.length + geom.thickness\n    );\n    r1.fill = fill;\n    r1.linewidth = 2;\n    const c1 = two.makeCircle(0, geom.length, geom.radius);\n    c1.fill = chroma(fill).darken(1);\n    c1.linewidth = 2;\n    return two.makeGroup(r1, c1)\n  }\n\n  static createArm(two, geom, fill, markerFill, n) {\n    const arms = [];\n    let arm = null;\n    for (let k = 0; k < n; k++) {\n      const p = Arm.createPole(two, geom, fill);\n      if (!arm) {\n        arm = p;\n      } else {\n        arm.translation.set(0, geom.length);\n        arm = two.makeGroup(arm, p);\n      }\n      const { force, setControl } = createCircularForce(two, 3 * geom.radius / 2, colors.red.base);\n      arm = two.makeGroup(arm, force);\n      arms.push({ arm, setControl });\n    }\n    const marker = createMarker(two, 2 * geom.radius / 3, markerFill, 5);\n    arms.push(two.makeGroup(arm, marker));\n    arms.reverse();\n    return arms;\n  }\n\n  static updateArm(graphics, worldToCanvas, x, u) {\n    graphics[0].translation.set(...worldToCanvas([0, 0]))\n    for (let k = 0; k < graphics.length - 1; k++) {\n      graphics[k + 1].setControl(u ? u.get(k) : null);\n      graphics[k + 1].arm.rotation = -x.get(k);\n    }\n  }\n\n  /**\n   * Draw model\n   */\n  createGraphics(two, scale) {\n    const GEOM = {\n      length: scale,\n      radius: 14,\n      thickness: 8\n    }\n\n    // Assemble poles\n    this.graphics = Arm.createArm(two, GEOM, colors.purple.lighten2, colors.indigo.darken4, this.params.n);\n  }\n\n  /**\n   * Update model\n   */\n  updateGraphics(worldToCanvas, params) {\n    const { y, xRef, u } = params;\n    Arm.updateArm(this.graphics, worldToCanvas, this.x, u);\n  }\n\n  /**\n   * LQR Params\n   */\n  lqrParams() {\n    const x0 = [...Array(2 * this.params.n).keys()].map(k => (k == 0 ? Math.PI : 0) + Math.PI / 8);\n    const Q = [...Array(2 * this.params.n).keys()].map(k => k < this.params.n ? 10 : 1);\n    const R = [...Array(this.params.n).keys()].map(k => 1);\n    return {\n      x0: x0,\n      Q: matFromDiag(Q),\n      R: matFromDiag(R),\n      simEps: 1e-1,\n      simDuration: 3,\n      disengage: true,\n      divergenceThres: 500,\n    }\n  }\n\n  /**\n   * RRT params\n   */\n  rrtParams() {\n    const n = this.params.n;\n    const xMin = [...Array(n)].map(_ => -Math.PI);\n    const xMax = [...Array(n)].map(_ => Math.PI);\n    const wrap = [...Array(n)].map(_ => true);\n    const deltas = [...Array(n)].map(_ => Math.PI / 10);\n    return {\n      nPts: 400,\n      n,\n      xMin,\n      xMax,\n      wrap,\n      deltas,\n    }\n  }\n}\n\nexport default Arm","import eig from '@eigen';\nimport _ from 'lodash';\nimport { wrapAngle, sqr, matFromDiag } from '@/components/math.js';\nimport colors from 'vuetify/lib/util/colors';\nimport Model from '@/components/models/model.js';\nimport { swingup } from './trajectories';\nimport Arm from '../arm/arm.js';\nimport { createTraj } from '../utils.js';\n\nclass SimplePendulum extends Model {\n  static NAME = 'simple pendulum';\n  static TAG = 'simplePendulum';\n  static STATES = Object.freeze([\n    { name: 'theta', show: true },\n    { name: 'thetaDot', show: true, derivative: true },\n  ]);\n  static COMMANDS = Object.freeze([\n    { name: 'torque' }\n  ]);\n\n  constructor(params = {}) {\n    super(SimplePendulum.STATES, SimplePendulum.COMMANDS, {\n      ...params,\n      g: 9.81,\n      l: 1,\n      m: 1,\n      mu: 0.5,\n    });\n    // const x = params.x0 || new eig.Matrix(2, 1);\n    // eig.GC.set(this, 'x', x)\n  }\n\n  trim() {\n    return {\n      x: new eig.Matrix([Math.PI, 0]),\n      u: new eig.Matrix([0])\n    };\n  }\n\n  /**\n   * Bound state x to appropriate domain\n   * @param {Matrix} x \n   */\n  bound(x) {\n    super.bound(x);\n    x.set(0, wrapAngle(x.get(0)));\n  }\n\n  /**\n   * Returns dx/dt\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} dx\n   */\n  dynamics(x, u) {\n    // x = [theta, thetaDot]\n    const p = this.params;\n    const dx = new eig.Matrix(2, 1);\n    const s = Math.sin(x.get(0));\n    const ddx = (-p.m * p.g * p.l * s - p.mu * x.get(1) + u.get(0)) / (p.m * Math.pow(p.l, 2));\n    dx.set(0, x.get(1));\n    dx.set(1, ddx);\n    return dx;\n  }\n\n  /**\n   * Returns df/dx\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} df/dx\n   */\n  xJacobian(x, u) {\n    const p = this.params;\n    const c = Math.cos(x.get(0));\n    return new eig.Matrix([\n      [0, 1],\n      [-p.g / p.l * c, - p.mu / p.m * p.l]\n    ]);\n  }\n\n  /**\n   * Returns df/du\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} df/du\n   */\n  uJacobian(x, u) {\n    const p = this.params;\n    return new eig.Matrix([\n      [0], [1 / p.m / sqr(p.l)]\n    ]);\n  }\n\n  /**\n   * Mouse step\n   * @param {Array} mouseTarget \n   * @param {Number} dt \n   */\n  trackMouse(mouseTarget, dt) {\n    const { u } = this.trim();\n    const dx = this.dynamics(this.x, u);\n    const theta = Math.atan2(mouseTarget[1], mouseTarget[0]) + Math.PI / 2;\n    this.x.set(1, 10 * wrapAngle(theta - this.x.get(0)));\n    dx.set(0, this.x.get(1));\n    dx.set(1, 0);\n    const newX = this.x.matAdd(dx.mul(dt));\n    this.bound(newX);\n    this.setState(newX);\n    return { u };\n  }\n\n  /**\n   * Draw model\n   */\n  createGraphics(two, scale) {\n    const GEOM = {\n      length: scale,\n      thickness: 8,\n      radius: 16,\n    };\n    this.graphics.arm = Arm.createArm(two, GEOM, colors.green.lighten2, colors.green.darken4, 1);\n    \n    // Create traj\n    this.graphics.scale = scale;\n    this.graphics.traj = createTraj(two, this.mpcParams().nPts);\n  }\n\n  /**\n   * Update model\n   */\n  updateGraphics(worldToCanvas, params) {\n    // TODO: draw torque\n    const { u, ghost } = params;\n    Arm.updateArm(this.graphics.arm, worldToCanvas, this.x, u);\n    this.graphics.arm[0].opacity = ghost ? 0.3 : 1;\n    const center = worldToCanvas([0, 0]);\n    this.graphics.traj.update((pt) => {\n      return [\n        center[0] + this.graphics.scale * Math.sin(pt.get(0)),\n        center[1] + this.graphics.scale * Math.cos(pt.get(0))\n      ];\n    });\n  }\n\n  /**\n   * LQR Params\n   */\n  lqrParams() {\n    return {\n      Q: matFromDiag([10, 1]),\n      R: matFromDiag([1]),\n      simEps: 1e-1,\n      simDuration: 3,\n      disengage: false,\n      divergenceThres: 500,\n    };\n  }\n\n  /**\n   * Plugin params\n   */\n  valueIterationParams() {\n    const maxThetaDot = 2 * Math.sqrt(this.params.g / this.params.l);\n    return {\n      x: {\n        min: [-Math.PI, -maxThetaDot],\n        max: [Math.PI, maxThetaDot],\n        nPts: [100, 100],\n        targets: [[Math.PI, 0], [-Math.PI, 0]]\n      },\n      u: { min: [-2], max: [2], nPts: [2] },\n      dt: 0.06,\n      x0: [0, 0],\n      dump: () => import('./viTable.json')\n    };\n  }\n\n  /**\n   * Direct collocation params\n   */\n  directCollocationParams() {\n    return {\n      nPts: 30,\n      uBounds: { min: [-5], max: [5] },\n      anchors: [{ t: 0, x: [0, 0] }, { t: 1, x: [3.14, 0] }],\n      holdTime: 1,\n      reverse: true,\n      traj: swingup\n    };\n  }\n\n  /**\n   * MPC Params\n   */\n  mpcParams() {\n    return {\n      nPts: 10,\n      uBounds: { min: [-5], max: [5] },\n      dt: 1 / 10,\n      traj: swingup\n    };\n  }\n}\n\nexport default SimplePendulum;","const swingup = {\n  dt: 0.08968001145385139,\n  x: [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, -5.7017, 0.0000],\n  [-0.0047, 0.0045, 0.1090, -0.1137, 7.8064, 0.0000],\n  [0.0295, -0.0295, 0.5188, -0.5007, 2.0357, 0.0000],\n  [0.0634, -0.0591, 0.0305, 0.0427, -9.3072, 0.0000],\n  [0.0057, 0.0065, -1.4032, 1.4821, -20.0000, 0.0000],\n  [-0.1928, 0.2033, -2.6864, 2.4833, -20.0000, 0.0000],\n  [-0.4538, 0.4105, -2.8027, 1.7880, -15.6632, 0.0000],\n  [-0.6802, 0.5133, -1.8248, 0.3797, 18.3396, 0.0000],\n  [-0.7713, 0.4941, -0.1341, -0.7166, 20.0000, 0.0000],\n  [-0.7016, 0.3807, 1.6774, -1.8077, 20.0000, 0.0000],\n  [-0.4419, 0.1227, 4.1189, -4.0960, 20.0000, 0.0000],\n  [0.0631, -0.3840, 6.0305, -5.7228, 20.0000, 0.0000],\n  [0.5701, -0.7571, 5.0727, -2.3249, 20.0000, 0.0000],\n  [1.0464, -0.8252, 5.3283, 0.9074, 20.0000, 0.0000],\n  [1.5650, -0.5798, 5.7731, 4.3402, 20.0000, 0.0000],\n  [2.0712, -0.0636, 4.7821, 6.3804, 4.3350, 0.0000],\n  [2.4221, 0.5407, 2.8478, 6.4709, 18.6823, 0.0000],\n  [2.6023, 1.1161, 0.9821, 5.8800, 1.4458, 0.0000],\n  [2.6249, 1.6330, -0.2238, 5.2374, 20.0000, 0.0000],\n  [2.6030, 2.0735, -0.0730, 4.1480, 20.0000, 0.0000],\n  [2.6419, 2.3794, 1.0210, 2.3707, 20.0000, 0.0000],\n  [2.8013, 2.5116, 2.4247, 0.5172, 20.0000, 0.0000],\n  [3.0556, 2.5206, 2.7142, 0.0330, -7.9654, 0.0000],\n  [3.2713, 2.5456, 1.8743, 0.5155, -20.0000, 0.0000],\n  [3.4025, 2.6096, 0.9948, 0.8066, -20.0000, 0.0000],\n  [3.4603, 2.6899, 0.2623, 0.9171, -20.0000, 0.0000],\n  [3.4511, 2.7817, -0.4742, 1.0909, -20.0000, 0.0000],\n  [3.3665, 2.9025, -1.4070, 1.6047, -20.0000, 0.0000],\n  [3.2146, 3.0639, -1.4885, 1.5341, 10.0599, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 20.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 20.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 10.0599, 0.0000],\n  [3.2146, 3.0639, 1.4885, -1.5341, -20.0000, 0.0000],\n  [3.3665, 2.9025, 1.4070, -1.6047, -20.0000, 0.0000],\n  [3.4511, 2.7817, 0.4742, -1.0909, -20.0000, 0.0000],\n  [3.4603, 2.6899, -0.2623, -0.9171, -20.0000, 0.0000],\n  [3.4025, 2.6096, -0.9948, -0.8066, -20.0000, 0.0000],\n  [3.2713, 2.5456, -1.8743, -0.5155, -7.9654, 0.0000],\n  [3.0556, 2.5206, -2.7142, -0.0330, 20.0000, 0.0000],\n  [2.8013, 2.5116, -2.4247, -0.5172, 20.0000, 0.0000],\n  [2.6419, 2.3794, -1.0210, -2.3707, 20.0000, 0.0000],\n  [2.6030, 2.0735, 0.0730, -4.1480, 20.0000, 0.0000],\n  [2.6249, 1.6330, 0.2238, -5.2374, 1.4458, 0.0000],\n  [2.6023, 1.1161, -0.9821, -5.8800, 18.6823, 0.0000],\n  [2.4221, 0.5407, -2.8478, -6.4709, 4.3350, 0.0000],\n  [2.0712, -0.0636, -4.7821, -6.3804, 20.0000, 0.0000],\n  [1.5650, -0.5798, -5.7731, -4.3402, 20.0000, 0.0000],\n  [1.0464, -0.8252, -5.3283, -0.9074, 20.0000, 0.0000],\n  [0.5701, -0.7571, -5.0727, 2.3249, 20.0000, 0.0000],\n  [0.0631, -0.3840, -6.0305, 5.7228, 20.0000, 0.0000],\n  [-0.4419, 0.1227, -4.1189, 4.0960, 20.0000, 0.0000],\n  [-0.7016, 0.3807, -1.6774, 1.8077, 20.0000, 0.0000],\n  [-0.7713, 0.4941, 0.1341, 0.7166, 18.3396, 0.0000],\n  [-0.6802, 0.5133, 1.8248, -0.3797, -15.6632, 0.0000],\n  [-0.4538, 0.4105, 2.8027, -1.7880, -20.0000, 0.0000],\n  [-0.1928, 0.2033, 2.6864, -2.4833, -20.0000, 0.0000],\n  [0.0057, 0.0065, 1.4032, -1.4821, -9.3072, 0.0000],\n  [0.0634, -0.0591, -0.0305, -0.0427, 2.0357, 0.0000],\n  [0.0295, -0.0295, -0.5188, 0.5007, 7.8064, 0.0000],\n  [-0.0047, 0.0045, -0.1090, 0.1137, -5.7017, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000]]\n};\n\nconst swingupMPC = {\n  dt: 0.07214248870903087,\n  x: [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 13.9654, 0.0000],\n  [0.0337, -0.0332, 0.8431, -0.8203, 10.1090, 0.0000],\n  [0.1152, -0.1099, 1.3010, -1.1782, 8.6174, 0.0000],\n  [0.1967, -0.1771, 0.5906, -0.3445, -18.5342, 0.0000],\n  [0.1810, -0.1426, -1.0296, 1.2858, -20.0000, 0.0000],\n  [0.0425, 0.0153, -2.6732, 2.9274, -20.0000, 0.0000],\n  [-0.1926, 0.2592, -3.4667, 3.3495, -20.0000, 0.0000],\n  [-0.4472, 0.4747, -3.3579, 2.3634, -18.2052, 0.0000],\n  [-0.6914, 0.6050, -3.2815, 1.1520, -19.9604, 0.0000],\n  [-0.9263, 0.6433, -2.9372, -0.0949, 3.8244, 0.0000],\n  [-1.1085, 0.6023, -1.8817, -0.9105, 19.6717, 0.0000],\n  [-1.1954, 0.5224, -0.4530, -1.1934, 20.0000, 0.0000],\n  [-1.1748, 0.4282, 1.0105, -1.3762, 20.0000, 0.0000],\n  [-1.0451, 0.3092, 2.5152, -1.9506, 20.0000, 0.0000],\n  [-0.7942, 0.1144, 4.3996, -3.5809, 20.0000, 0.0000],\n  [-0.3554, -0.2823, 7.3986, -7.0289, 20.0000, 0.0000],\n  [0.1777, -0.7333, 6.4889, -4.2167, 20.0000, 0.0000],\n  [0.6353, -0.9139, 6.0910, -0.7257, 18.1196, 0.0000],\n  [1.0923, -0.8401, 6.2202, 2.6889, 7.3802, 0.0000],\n  [1.5417, -0.5323, 5.8012, 5.4497, 9.8245, 0.0000],\n  [1.9263, -0.0693, 4.4390, 6.8081, 9.5708, 0.0000],\n  [2.1824, 0.4426, 2.4344, 6.8786, 7.7052, 0.0000],\n  [2.2923, 0.9390, 0.6365, 6.5332, 15.5142, 0.0000],\n  [2.2917, 1.4122, -0.5447, 6.2676, 20.0000, 0.0000],\n  [2.2303, 1.8618, -0.9495, 5.7780, 20.0000, 0.0000],\n  [2.1806, 2.2419, -0.2525, 4.3728, 20.0000, 0.0000],\n  [2.1985, 2.5081, 0.7095, 2.8831, 20.0000, 0.0000],\n  [2.2801, 2.6778, 1.4705, 1.7468, 20.0000, 0.0000],\n  [2.4147, 2.7692, 2.1771, 0.7182, 20.0000, 0.0000],\n  [2.6046, 2.7817, 2.9759, -0.3991, 18.3944, 0.0000],\n  [2.8462, 2.7211, 3.4005, -1.0547, 4.1372, 0.0000],\n  [3.0827, 2.6551, 2.8403, -0.5793, -13.8352, 0.0000],\n  [3.2585, 2.6394, 1.9220, 0.1124, -20.0000, 0.0000],\n  [3.3705, 2.6642, 1.1408, 0.5069, -20.0000, 0.0000],\n  [3.4307, 2.7098, 0.4983, 0.7081, -20.0000, 0.0000],\n  [3.4451, 2.7684, -0.1101, 0.8817, -20.0000, 0.0000],\n  [3.4130, 2.8430, -0.7773, 1.1695, -20.0000, 0.0000],\n  [3.3253, 2.9490, -1.6416, 1.7666, -20.0000, 0.0000],\n  [3.1945, 3.0847, -1.4742, 1.5052, 18.2226, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 20.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 0.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 20.0000, 0.0000],\n  [3.1400, 3.1400, 0.0000, 0.0000, 18.2226, 0.0000],\n  [3.1945, 3.0847, 1.4742, -1.5052, -20.0000, 0.0000],\n  [3.3253, 2.9490, 1.6416, -1.7666, -20.0000, 0.0000],\n  [3.4130, 2.8430, 0.7773, -1.1695, -20.0000, 0.0000],\n  [3.4451, 2.7684, 0.1101, -0.8817, -20.0000, 0.0000],\n  [3.4307, 2.7098, -0.4983, -0.7081, -20.0000, 0.0000],\n  [3.3705, 2.6642, -1.1408, -0.5069, -20.0000, 0.0000],\n  [3.2585, 2.6394, -1.9220, -0.1124, -13.8352, 0.0000],\n  [3.0827, 2.6551, -2.8403, 0.5793, 4.1372, 0.0000],\n  [2.8462, 2.7211, -3.4005, 1.0547, 18.3944, 0.0000],\n  [2.6046, 2.7817, -2.9759, 0.3991, 20.0000, 0.0000],\n  [2.4147, 2.7692, -2.1771, -0.7182, 20.0000, 0.0000],\n  [2.2801, 2.6778, -1.4705, -1.7468, 20.0000, 0.0000],\n  [2.1985, 2.5081, -0.7095, -2.8831, 20.0000, 0.0000],\n  [2.1806, 2.2419, 0.2525, -4.3728, 20.0000, 0.0000],\n  [2.2303, 1.8618, 0.9495, -5.7780, 20.0000, 0.0000],\n  [2.2917, 1.4122, 0.5447, -6.2676, 15.5142, 0.0000],\n  [2.2923, 0.9390, -0.6365, -6.5332, 7.7052, 0.0000],\n  [2.1824, 0.4426, -2.4344, -6.8786, 9.5708, 0.0000],\n  [1.9263, -0.0693, -4.4390, -6.8081, 9.8245, 0.0000],\n  [1.5417, -0.5323, -5.8012, -5.4497, 7.3802, 0.0000],\n  [1.0923, -0.8401, -6.2202, -2.6889, 18.1196, 0.0000],\n  [0.6353, -0.9139, -6.0910, 0.7257, 20.0000, 0.0000],\n  [0.1777, -0.7333, -6.4889, 4.2167, 20.0000, 0.0000],\n  [-0.3554, -0.2823, -7.3986, 7.0289, 20.0000, 0.0000],\n  [-0.7942, 0.1144, -4.3996, 3.5809, 20.0000, 0.0000],\n  [-1.0451, 0.3092, -2.5152, 1.9506, 20.0000, 0.0000],\n  [-1.1748, 0.4282, -1.0105, 1.3762, 20.0000, 0.0000],\n  [-1.1954, 0.5224, 0.4530, 1.1934, 19.6717, 0.0000],\n  [-1.1085, 0.6023, 1.8817, 0.9105, 3.8244, 0.0000],\n  [-0.9263, 0.6433, 2.9372, 0.0949, -19.9604, 0.0000],\n  [-0.6914, 0.6050, 3.2815, -1.1520, -18.2052, 0.0000],\n  [-0.4472, 0.4747, 3.3579, -2.3634, -20.0000, 0.0000],\n  [-0.1926, 0.2592, 3.4667, -3.3495, -20.0000, 0.0000],\n  [0.0425, 0.0153, 2.6732, -2.9274, -20.0000, 0.0000],\n  [0.1810, -0.1426, 1.0296, -1.2858, -18.5342, 0.0000],\n  [0.1967, -0.1771, -0.5906, 0.3445, 8.6174, 0.0000],\n  [0.1152, -0.1099, -1.3010, 1.1782, 10.1090, 0.0000],\n  [0.0337, -0.0332, -0.8431, 0.8203, 13.9654, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000]]\n};\n\nexport { swingup, swingupMPC };","import eig from '@eigen';\nimport _ from 'lodash';\nimport colors from 'vuetify/lib/util/colors';\nimport Model from '@/components/models/model.js';\nimport { wrapAngle, sqr, matFromDiag } from '@/components/math.js';\nimport Arm from '../arm/arm.js';\nimport { swingup, swingupMPC } from './trajectories.js';\nimport { createTraj } from '../utils.js';\n\nclass DoublePendulum extends Model {\n  static NAME = 'double pendulum';\n  static TAG = 'doublePendulum';\n  static STATES = Object.freeze([\n    { name: 'theta1', show: true },\n    { name: 'theta2', show: true },\n    { name: 'theta1Dot', derivative: true },\n    { name: 'theta2Dot', derivative: true },\n  ]);\n  static COMMANDS = Object.freeze([\n    { name: 't1' },\n    { name: 't2' }\n  ]);\n\n  constructor(params = {}) {\n    super(DoublePendulum.STATES, DoublePendulum.COMMANDS, {\n      m1: 1,\n      l1: 1,\n      m2: 1,\n      l2: 1,\n      g: 9.8,\n      mu: 0.2,\n      s2: 0,\n      ...params\n    });\n  }\n\n  trim() {\n    return {\n      x: new eig.Matrix([Math.PI, Math.PI, 0, 0]),\n      u: new eig.Matrix([0, 0])\n    };\n  }\n\n  /**\n   * Bound state x to appropriate domain\n   * @param {Matrix} x \n   */\n  bound(x) {\n    super.bound(x);\n    x.set(0, wrapAngle(x.get(0)));\n    x.set(1, wrapAngle(x.get(1)));\n  }\n\n  /**\n   * Returns dx/dt\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} dx\n   */\n  dynamics(x, u) {\n    // https://diego.assencio.com/?index=1500c66ae7ab27bb0106467c68feebc6\n    const p = this.params;\n    const [t1, t2, t1d, t2d] = [x.get(0), x.get(1), x.get(2), x.get(3)];\n    const [s1, s2] = [Math.sin(x.get(0)), Math.sin(x.get(1))];\n    const dt = t1 - t2;\n    const [cdt, sdt] = [Math.cos(dt), Math.sin(dt)];\n    const M = p.m2 / (p.m1 + p.m2);\n    const L = p.l2 / p.l1;\n    const a1 = L * M * cdt;\n    const a2 = cdt / L;\n    const tau1 = -p.mu * t1d + u.get(0);\n    const tau2 = -p.mu * (t2d - t1d) + p.s2 * u.get(1);\n    const f1 = -L * M * sqr(t2d) * sdt - p.g / p.l1 * s1 + tau1 / sqr(p.l1) / (p.m1 + p.m2);\n    const f2 = sqr(t1d) * sdt / L - p.g / p.l2 * s2 + tau2 / p.m2 / sqr(p.l2);\n    const g1 = (f1 - a1 * f2) / (1 - a1 * a2);\n    const g2 = (-a2 * f1 + f2) / (1 - a1 * a2);\n    return new eig.Matrix([\n      t1d,\n      t2d,\n      g1,\n      g2\n    ]);\n  }\n\n  /**\n   * Returns df/dx\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} df/dx\n   */\n  xJacobian(x, u) {\n    const p = this.params;\n    const [t1, t2, t1d, t2d] = [x.get(0), x.get(1), x.get(2), x.get(3)];\n    let [u1, u2] = [u.get(0), u.get(1)];\n    u2 *= p.s2;\n    const [s1, s2] = [Math.sin(x.get(0)), Math.sin(x.get(1))];\n    const dt = t1 - t2;\n    const [cdt, sdt] = [Math.cos(dt), Math.sin(dt)];\n    // const M = p.m2 / (p.m1 + p.m2)\n    // const L = p.l2 / p.l1;\n\n    const c2dt = Math.cos(2 * t1 - 2 * t2);\n    const s2dt = Math.sin(2 * t1 - 2 * t2);\n    const cdtp2 = Math.cos(t1 - 2 * t2);\n    const [c1, c2] = [Math.cos(t1), Math.cos(t2)];\n\n    const dx1dt1 = ((p.g * c1) / p.l1 + (p.m2 * sqr(t1d) * sqr(cdt)) / (p.m1 + p.m2) - (p.l2 * p.m2 * sdt * ((u2 + p.mu * (t1d - t2d)) / (sqr(p.l2) * p.m2) - (p.g * s2) / p.l2 + (p.l1 * sqr(t1d) * sdt) / p.l2)) / (p.l1 * (p.m1 + p.m2)) + (p.l2 * p.m2 * sqr(t2d) * cdt) / (p.l1 * (p.m1 + p.m2))) / ((p.m2 * sqr(cdt)) / (p.m1 + p.m2) - 1) + (2 * p.m2 * cdt * sdt * ((p.g * s1) / p.l1 - (u1 - p.mu * t1d) / (sqr(p.l1) * (p.m1 + p.m2)) + (p.l2 * p.m2 * cdt * ((u2 + p.mu * (t1d - t2d)) / (sqr(p.l2) * p.m2) - (p.g * s2) / p.l2 + (p.l1 * sqr(t1d) * sdt) / p.l2)) / (p.l1 * (p.m1 + p.m2)) + (p.l2 * p.m2 * sqr(t2d) * sdt) / (p.l1 * (p.m1 + p.m2)))) / (sqr((p.m2 * sqr(cdt)) / (p.m1 + p.m2) - 1) * (p.m1 + p.m2));\n    const dx1dt2 = (2 * (p.m2 * cdt * sqr(p.l2) * sqr(t2d) + p.l1 * p.m2 * c2dt * p.l2 * sqr(t1d) + p.g * p.m2 * cdtp2 * p.l2 - p.mu * sdt * t1d + p.mu * sdt * t2d - u2 * sdt)) / (p.l1 * p.l2 * (2 * p.m1 + p.m2 - p.m2 * c2dt)) - (2 * p.m2 * cdt * sdt * (p.m1 + p.m2) * ((p.g * s1) / p.l1 - (u1 - p.mu * t1d) / (sqr(p.l1) * (p.m1 + p.m2)) + (cdt * (p.l1 * p.l2 * p.m2 * sdt * sqr(t1d) + p.mu * t1d + u2 - p.mu * t2d - p.g * p.l2 * p.m2 * s2)) / (p.l1 * p.l2 * (p.m1 + p.m2)) + (p.l2 * p.m2 * sqr(t2d) * sdt) / (p.l1 * (p.m1 + p.m2)))) / sqr(- p.m2 * sqr(cdt) + p.m1 + p.m2);\n    const dx1dt1d = -(p.l2 * p.m2 * t1d * s2dt * sqr(p.l1) + p.mu * cdt * p.l1 + p.l2 * p.mu) / (sqr(p.l1) * p.l2 * (p.m1 + p.m2 - p.m2 * sqr(cdt)));\n    const dx1dt2d = (- 2 * p.m2 * t2d * sdt * sqr(p.l2) + p.mu * cdt) / (p.l1 * p.l2 * (p.m1 + p.m2 - p.m2 * sqr(cdt)));\n    const dx2dt1 = - ((p.l1 * cdt * ((p.l2 * p.m2 * cdt * sqr(t2d)) / (p.l1 * (p.m1 + p.m2)) + (p.g * c1) / p.l1)) / p.l2 - (p.l1 * sdt * ((p.l2 * p.m2 * sdt * sqr(t2d)) / (p.l1 * (p.m1 + p.m2)) + (p.g * s1) / p.l1 - (u1 - p.mu * t1d) / (sqr(p.l1) * (p.m1 + p.m2)))) / p.l2 + (p.l1 * sqr(t1d) * cdt) / p.l2) / ((p.m2 * sqr(cdt)) / (p.m1 + p.m2) - 1) - (2 * p.m2 * cdt * sdt * ((u2 + p.mu * (t1d - t2d)) / (sqr(p.l2) * p.m2) - (p.g * s2) / p.l2 + (p.l1 * cdt * ((p.l2 * p.m2 * sdt * sqr(t2d)) / (p.l1 * (p.m1 + p.m2)) + (p.g * s1) / p.l1 - (u1 - p.mu * t1d) / (sqr(p.l1) * (p.m1 + p.m2)))) / p.l2 + (p.l1 * sqr(t1d) * sdt) / p.l2)) / (sqr((p.m2 * sqr(cdt)) / (p.m1 + p.m2) - 1) * (p.m1 + p.m2));\n    const dx2dt2 = ((p.g * c2) / p.l2 - (p.l1 * sdt * ((p.l2 * p.m2 * sdt * sqr(t2d)) / (p.l1 * (p.m1 + p.m2)) + (p.g * s1) / p.l1 - (u1 - p.mu * t1d) / (sqr(p.l1) * (p.m1 + p.m2)))) / p.l2 + (p.l1 * sqr(t1d) * cdt) / p.l2 + (p.m2 * sqr(t2d) * sqr(cdt)) / (p.m1 + p.m2)) / ((p.m2 * sqr(cdt)) / (p.m1 + p.m2) - 1) + (2 * p.m2 * cdt * sdt * ((u2 + p.mu * (t1d - t2d)) / (sqr(p.l2) * p.m2) - (p.g * s2) / p.l2 + (p.l1 * cdt * ((p.l2 * p.m2 * sdt * sqr(t2d)) / (p.l1 * (p.m1 + p.m2)) + (p.g * s1) / p.l1 - (u1 - p.mu * t1d) / (sqr(p.l1) * (p.m1 + p.m2)))) / p.l2 + (p.l1 * sqr(t1d) * sdt) / p.l2)) / (sqr((p.m2 * sqr(cdt)) / (p.m1 + p.m2) - 1) * (p.m1 + p.m2));\n    const dx2dt1d = ((p.m1 + p.m2) * (p.mu / (sqr(p.l2) * p.m2) + (2 * p.l1 * t1d * sdt) / p.l2) + (p.mu * cdt) / (p.l1 * p.l2)) / (p.m1 + p.m2 - p.m2 * sqr(cdt));\n    const dx2dt2d = -(- t2d * s2dt * sqr(p.l2) * sqr(p.m2) + p.mu * p.m2 + p.m1 * p.mu) / (sqr(p.l2) * p.m2 * (p.m1 + p.m2 - p.m2 * sqr(cdt)));\n\n    return new eig.Matrix([\n      [0, 0, 1, 0],\n      [0, 0, 0, 1],\n      [dx1dt1, dx1dt2, dx1dt1d, dx1dt2d],\n      [dx2dt1, dx2dt2, dx2dt1d, dx2dt2d]\n    ]);\n  }\n\n  /**\n   * Returns df/du\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} df/du\n   */\n  uJacobian(x, u) {\n    const p = this.params;\n    const [t1, t2] = [x.get(0), x.get(1)];\n    const dt = t1 - t2;\n    const cdt = Math.cos(dt);\n    const dx1du1 = 1 / (sqr(p.l1) * (p.m1 + p.m2 - p.m2 * sqr(cdt)));\n    const dx1du2 = -cdt / (p.l1 * p.l2 * (p.m1 + p.m2 - p.m2 * sqr(cdt)));\n    const dx2du1 = -cdt / (p.l1 * p.l2 * (p.m1 + p.m2 - p.m2 * sqr(cdt)));\n    const dx2du2 = (p.m1 + p.m2) / (sqr(p.l2) * p.m2 * (p.m1 + p.m2 - p.m2 * sqr(cdt)));\n    return new eig.Matrix([\n      [0, 0], [0, 0], [dx1du1, dx1du2 * p.s2], [dx2du1, dx2du2 * p.s2]\n    ]);\n  }\n\n  /**\n   * Mouse step\n   * @param {Array} mouseTarget \n   * @param {Number} dt \n   */\n  trackMouse(mouseTarget, dt) {\n    const { u } = this.trim();\n    const dx = this.dynamics(this.x, u);\n    const theta = Math.atan2(mouseTarget[1], mouseTarget[0]) + Math.PI / 2;\n    this.x.set(2, 10 * wrapAngle(theta - this.x.get(0)));\n    this.x.set(3, 10 * wrapAngle(this.x.get(0) - this.x.get(1)));\n    dx.set(0, this.x.get(2));\n    dx.set(2, 0);\n    // TODO: extract in schema\n    const newX = this.x.matAdd(dx.mul(dt));\n    this.bound(newX);\n    this.setState(newX);\n    return { u };\n  }\n\n\n  /**\n   * Draw model\n   */\n  createGraphics(two, scale) {\n    const GEOM = {\n      length: scale,\n      radius: 14,\n      thickness: 8\n    };\n    this.graphics.arm = Arm.createArm(two, GEOM, colors.indigo.lighten2, colors.indigo.darken4, 2);\n    // Create traj\n    this.graphics.scale = scale;\n    this.graphics.traj = createTraj(two, this.mpcParams().nPts);\n    this.graphics.trajSup = createTraj(two, this.mpcParams().nPts);\n  }\n\n  /**\n   * Update model\n   */\n  updateGraphics(worldToCanvas, params) {\n    const { y, xRef, u, ghost } = params;\n    const xShift = eig.Matrix(this.x);\n    xShift.set(1, xShift.get(1) - xShift.get(0));\n    this.graphics.arm[0].opacity = ghost ? 0.3 : 1;\n    Arm.updateArm(this.graphics.arm, worldToCanvas, xShift, u);\n    const center = worldToCanvas([0, 0]);\n    this.graphics.traj.update((pt) => {\n      return [\n        center[0] + this.graphics.scale * Math.sin(pt.get(0)),\n        center[1] + this.graphics.scale * Math.cos(pt.get(0))\n      ];\n    });\n    this.graphics.trajSup.data = this.graphics.traj.data;\n    this.graphics.trajSup.update((pt) => {\n      return [\n        center[0] + this.graphics.scale * (Math.sin(pt.get(0)) + Math.sin(pt.get(1))),\n        center[1] + this.graphics.scale * (Math.cos(pt.get(0)) + Math.cos(pt.get(1)))\n      ];\n    });\n  }\n\n  /**\n   * LQR Params\n   */\n  lqrParams() {\n    return {\n      Q: matFromDiag([10, 10, 1, 1]),\n      R: matFromDiag([1, 1]),\n      simEps: 1e-1,\n      simDuration: 4,\n      disengage: true,\n      divergenceThres: 500,\n    };\n  }\n\n  /**\n   * Direct collocation params\n   */\n  directCollocationParams() {\n    return {\n      nPts: 30,\n      uBounds: { min: [-20, -0], max: [20, 0] },\n      anchors: [{ t: 0, x: [0, 0, 0, 0] }, { t: 1, x: [3.14, 3.14, 0, 0] }],\n      holdTime: 1,\n      reverse: true,\n      traj: swingup\n    };\n  }\n\n  /**\n  * MPC Params\n  */\n  mpcParams() {\n    return {\n      nPts: 20,\n      uBounds: { min: [-20, -0], max: [20, 0] },\n      dt: 1 / 10,\n      traj: swingupMPC\n    };\n  }\n}\n\nexport default DoublePendulum;","\nconst flipTraj = {\n  dt: 0.08630639823503299,\n  x: [[-2.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 20.0000],\n  [-1.9994, 0.0420, -0.0413, 0.0250, 0.9254, -0.9085, 0.0000, 20.0000],\n  [-1.9909, 0.1679, -0.1651, 0.1996, 1.8416, -1.8170, 0.0000, 20.0000],\n  [-1.9542, 0.3751, -0.3714, 0.6682, 2.7025, -2.7255, 0.0000, 20.0000],\n  [-1.8569, 0.6539, -0.6603, 1.5504, 3.3924, -3.6340, 0.0000, 20.0000],\n  [-1.6584, 0.9802, -1.0317, 2.8945, 3.7083, -4.5424, 0.0000, 20.0000],\n  [-1.3391, 1.3017, -1.4754, 3.9500, 3.2212, -5.1115, 0.0000, 5.0571],\n  [-0.9664, 1.5536, -1.9467, 4.1779, 2.3161, -5.2264, 0.0000, 0.0000],\n  [-0.5855, 1.7226, -2.4223, 4.2191, 1.3907, -5.2533, 0.0000, 1.1845],\n  [-0.2004, 1.8058, -2.9012, 4.2474, 0.4541, -5.2802, 0.0000, 0.0000],\n  [0.1855, 1.8054, -3.3803, 4.2444, -0.4760, -5.2606, 0.8645, 0.0000],\n  [0.5701, 1.7192, -3.8569, 4.2258, -1.4087, -5.2377, 0.1429, 0.0000],\n  [0.9538, 1.5505, -4.3326, 4.2209, -2.3040, -5.2344, 0.0000, 0.0000],\n  [1.3301, 1.2997, -4.8045, 3.9851, -3.2105, -5.1156, 5.2343, 0.0000],\n  [1.6520, 0.9791, -5.2483, 2.9205, -3.6990, -4.5424, 20.0000, 0.0000],\n  [1.8528, 0.6534, -5.6197, 1.5726, -3.3875, -3.6340, 20.0000, 0.0000],\n  [1.9519, 0.3749, -5.9086, 0.6853, -2.7003, -2.7255, 20.0000, 0.0000],\n  [1.9899, 0.1679, -6.1149, 0.2111, -1.8409, -1.8170, 20.0000, 0.0000],\n  [1.9992, 0.0420, -6.2387, 0.0308, -0.9253, -0.9085, 20.0000, 0.0000],\n  [2.0000, 0.0000, -6.2800, 0.0000, 0.0000, 0.0000, 20.0000, 0.0000],\n  [1.9992, 0.0420, -6.2387, -0.0308, 0.9253, 0.9085, 20.0000, 0.0000],\n  [1.9899, 0.1679, -6.1149, -0.2111, 1.8409, 1.8170, 20.0000, 0.0000],\n  [1.9519, 0.3749, -5.9086, -0.6853, 2.7003, 2.7255, 20.0000, 0.0000],\n  [1.8528, 0.6534, -5.6197, -1.5726, 3.3875, 3.6340, 20.0000, 0.0000],\n  [1.6520, 0.9791, -5.2483, -2.9205, 3.6990, 4.5424, 5.2343, 0.0000],\n  [1.3301, 1.2997, -4.8045, -3.9851, 3.2105, 5.1156, 0.0000, 0.0000],\n  [0.9538, 1.5505, -4.3326, -4.2209, 2.3040, 5.2344, 0.1429, 0.0000],\n  [0.5701, 1.7192, -3.8569, -4.2258, 1.4087, 5.2377, 0.8645, 0.0000],\n  [0.1855, 1.8054, -3.3803, -4.2444, 0.4760, 5.2606, 0.0000, 0.0000],\n  [-0.2004, 1.8058, -2.9012, -4.2474, -0.4541, 5.2802, 0.0000, 1.1845],\n  [-0.5855, 1.7226, -2.4223, -4.2191, -1.3907, 5.2533, 0.0000, 0.0000],\n  [-0.9664, 1.5536, -1.9467, -4.1779, -2.3161, 5.2264, 0.0000, 5.0571],\n  [-1.3391, 1.3017, -1.4754, -3.9500, -3.2212, 5.1115, 0.0000, 20.0000],\n  [-1.6584, 0.9802, -1.0317, -2.8945, -3.7083, 4.5424, 0.0000, 20.0000],\n  [-1.8569, 0.6539, -0.6603, -1.5504, -3.3924, 3.6340, 0.0000, 20.0000],\n  [-1.9542, 0.3751, -0.3714, -0.6682, -2.7025, 2.7255, 0.0000, 20.0000],\n  [-1.9909, 0.1679, -0.1651, -0.1996, -1.8416, 1.8170, 0.0000, 20.0000],\n  [-1.9994, 0.0420, -0.0413, -0.0250, -0.9254, 0.9085, 0.0000, 20.0000],\n  [-2.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 20.0000]]\n};\n\nconst flipTrajMPC = {\n  dt: 0.07917123999790385,\n  x: [[-2.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 11.7191, 0.0000],\n  [-2.0002, 0.0125, 0.0229, -0.0096, 0.3757, 0.5924, 17.0150, 0.0000],\n  [-2.0027, 0.0530, 0.0889, -0.0501, 0.4262, 0.8638, 0.0000, 3.8536],\n  [-2.0102, 0.0836, 0.1456, -0.1632, 0.5069, 0.4152, 0.0000, 17.9013],\n  [-2.0328, 0.1520, 0.1495, -0.3862, 1.1475, -0.3181, 0.0000, 17.6678],\n  [-2.0728, 0.2729, 0.0932, -0.5702, 1.7863, -1.0479, 0.0000, 17.7290],\n  [-2.1234, 0.4478, -0.0237, -0.6290, 2.4656, -1.7931, 0.0000, 18.4160],\n  [-2.1702, 0.6819, -0.2038, -0.4561, 3.2291, -2.5852, 0.0000, 20.0000],\n  [-2.1890, 0.9801, -0.4510, 0.0642, 3.9808, -3.4099, 0.0000, 20.0000],\n  [-2.1483, 1.3329, -0.7662, 0.9956, 4.5247, -4.2346, 0.0000, 20.0000],\n  [-2.0136, 1.7154, -1.1495, 2.3311, 4.6664, -5.0593, 0.0000, 20.0000],\n  [-1.7562, 2.0854, -1.6007, 3.9335, 4.1846, -5.8840, 0.0000, 20.0000],\n  [-1.3656, 2.3838, -2.1200, 5.4992, 2.9189, -6.7087, 0.0000, 20.0000],\n  [-0.8603, 2.5438, -2.6910, 6.6544, 0.8247, -6.9420, 15.5805, 6.8996],\n  [-0.2952, 2.5243, -3.2506, 6.9091, -1.0940, -6.6507, 5.4500, 0.0000],\n  [0.2717, 2.3888, -3.7929, 6.8452, -2.1166, -6.5383, 0.0000, 0.0000],\n  [0.8191, 2.1679, -4.3213, 6.1901, -3.3406, -6.1477, 18.9482, 0.0000],\n  [1.2679, 1.8447, -4.7964, 4.6819, -4.3766, -5.3778, 18.3892, 0.0000],\n  [1.5916, 1.4649, -5.2078, 3.1793, -4.7240, -4.5864, 20.0000, 0.0000],\n  [1.7985, 1.0811, -5.5520, 1.8961, -4.5097, -3.7617, 20.0000, 0.0000],\n  [1.9147, 0.7305, -5.8282, 0.9849, -3.9502, -2.9370, 20.0000, 0.0000],\n  [1.9707, 0.4344, -6.0364, 0.4278, -3.2099, -2.1123, 20.0000, 0.0000],\n  [1.9929, 0.2030, -6.1766, 0.1474, -2.3950, -1.2876, 20.0000, 0.0000],\n  [1.9993, 0.0485, -6.2531, 0.0265, -1.2477, -0.6184, 20.0000, 7.5437],\n  [2.0000, 0.0000, -6.2800, 0.0000, 0.0000, 0.0000, 20.0000, 7.5437],\n  [1.9993, 0.0485, -6.2531, -0.0265, 1.2477, 0.6184, 20.0000, 0.0000],\n  [1.9929, 0.2030, -6.1766, -0.1474, 2.3950, 1.2876, 20.0000, 0.0000],\n  [1.9707, 0.4344, -6.0364, -0.4278, 3.2099, 2.1123, 20.0000, 0.0000],\n  [1.9147, 0.7305, -5.8282, -0.9849, 3.9502, 2.9370, 20.0000, 0.0000],\n  [1.7985, 1.0811, -5.5520, -1.8961, 4.5097, 3.7617, 20.0000, 0.0000],\n  [1.5916, 1.4649, -5.2078, -3.1793, 4.7240, 4.5864, 18.3892, 0.0000],\n  [1.2679, 1.8447, -4.7964, -4.6819, 4.3766, 5.3778, 18.9482, 0.0000],\n  [0.8191, 2.1679, -4.3213, -6.1901, 3.3406, 6.1477, 0.0000, 0.0000],\n  [0.2717, 2.3888, -3.7929, -6.8452, 2.1166, 6.5383, 5.4500, 0.0000],\n  [-0.2952, 2.5243, -3.2506, -6.9091, 1.0940, 6.6507, 15.5805, 6.8996],\n  [-0.8603, 2.5438, -2.6910, -6.6544, -0.8247, 6.9420, 0.0000, 20.0000],\n  [-1.3656, 2.3838, -2.1200, -5.4992, -2.9189, 6.7087, 0.0000, 20.0000],\n  [-1.7562, 2.0854, -1.6007, -3.9335, -4.1846, 5.8840, 0.0000, 20.0000],\n  [-2.0136, 1.7154, -1.1495, -2.3311, -4.6664, 5.0593, 0.0000, 20.0000],\n  [-2.1483, 1.3329, -0.7662, -0.9956, -4.5247, 4.2346, 0.0000, 20.0000],\n  [-2.1890, 0.9801, -0.4510, -0.0642, -3.9808, 3.4099, 0.0000, 20.0000],\n  [-2.1702, 0.6819, -0.2038, 0.4561, -3.2291, 2.5852, 0.0000, 18.4160],\n  [-2.1234, 0.4478, -0.0237, 0.6290, -2.4656, 1.7931, 0.0000, 17.7290],\n  [-2.0728, 0.2729, 0.0932, 0.5702, -1.7863, 1.0479, 0.0000, 17.6678],\n  [-2.0328, 0.1520, 0.1495, 0.3862, -1.1475, 0.3181, 0.0000, 17.9013],\n  [-2.0102, 0.0836, 0.1456, 0.1632, -0.5069, -0.4152, 0.0000, 3.8536],\n  [-2.0027, 0.0530, 0.0889, 0.0501, -0.4262, -0.8638, 17.0150, 0.0000],\n  [-2.0002, 0.0125, 0.0229, 0.0096, -0.3757, -0.5924, 11.7191, 0.0000],\n  [-2.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 11.7191, 0.0000]]\n}\n\nconst trimTraj = {\n  dt: 0.07917123999790385,\n  x: [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 9.81 / 2, 9.81 / 2],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 9.81 / 2, 9.81 / 2]]\n};\n\nexport { trimTraj, flipTraj, flipTrajMPC };","import eig from '@eigen';\nimport _ from 'lodash';\nimport chroma from 'chroma-js';\nimport colors from 'vuetify/lib/util/colors';\nimport Model from '@/components/models/model.js';\nimport { wrapAngle, sqr, matFromDiag, smooth, differenciate } from '@/components/math.js';\nimport { flipTraj, flipTrajMPC } from './trajectories.js';\nimport { createMarker, createTraj } from '../utils.js';\n\nclass Quadrotor2D extends Model {\n  static NAME = 'quadrotor';\n  static TAG = 'quadrotor2D';\n  static STATES = Object.freeze([\n    { name: 'x', show: true },\n    { name: 'y', show: true },\n    { name: 'theta', show: true },\n    { name: 'yDot', derivative: true },\n    { name: 'xDot', derivative: true },\n    { name: 'thetaDot', derivative: true },\n  ]);\n  static COMMANDS = Object.freeze([\n    { name: 't1' },\n    { name: 't2' }\n  ]);\n\n  constructor(params = {}) {\n    super(Quadrotor2D.STATES, Quadrotor2D.COMMANDS, {\n      g: 9.81,\n      l: 1,\n      m: 1,\n      I: 1,\n      // mu: 0.5, TODO: add natural damping\n      ...params\n    });\n  }\n\n  trim() {\n    const u0 = this.params.g * this.params.m / 2;\n    return { x: new eig.Matrix(6, 1), u: new eig.Matrix([u0, u0]) };\n  }\n\n  /**\n   * Bound state x to appropriate domain\n   * @param {Matrix} x \n   */\n  bound(x) {\n    x.set(2, wrapAngle(x.get(2)));\n  }\n\n  /**\n   * Returns dx/dt\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} dx\n   */\n  dynamics(x, u) {\n    // x = [x, y, theta, dx, dy, dtheta]\n    const p = this.params;\n    const [c, s] = [Math.cos(x.get(2)), Math.sin(x.get(2))];\n    const [u1, u2] = [u.get(0), u.get(1)];\n    const ddx = new eig.Matrix([\n      -(u1 + u2) * s / p.m,\n      (u1 + u2) * c / p.m - p.g,\n      p.l / 2 * (u1 - u2) / p.I\n    ]);\n    const dx = x.block(3, 0, 3, 1);\n    return dx.vcat(ddx);\n  }\n\n  /**\n   * Returns df/dx\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} df/dx\n   */\n  xJacobian(x, u) {\n    const p = this.params;\n    const [c, s] = [Math.cos(x.get(2)), Math.sin(x.get(2))];\n    const [u1, u2] = [u.get(0), u.get(1)];\n    const dx2dt = -(u1 + u2) * c / p.m;\n    const dy2dt = -(u1 + u2) * s / p.m;\n    return new eig.Matrix([\n      [0, 0, 0, 1, 0, 0],\n      [0, 0, 0, 0, 1, 0],\n      [0, 0, 0, 0, 0, 1],\n      [0, 0, dx2dt, 0, 0, 0],\n      [0, 0, dy2dt, 0, 0, 0],\n      [0, 0, 0, 0, 0, 0]\n    ]);\n  }\n\n  /**\n   * Returns df/du\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} df/du\n   */\n  uJacobian(x, u) {\n    const p = this.params;\n    const [c, s] = [Math.cos(x.get(2)), Math.sin(x.get(2))];\n    const dx2du1 = -s / p.m;\n    const dy2du1 = c / p.m;\n    const dt2du1 = p.l / 2 / p.I;\n    return new eig.Matrix([\n      [0, 0], [0, 0], [0, 0], [dx2du1, dx2du1], [dy2du1, dy2du1], [dt2du1, -dt2du1]\n    ]);\n  }\n\n  /**\n   * Mouse step\n   * @param {Number} dt \n   * @param {Array} mouseTarget \n   */\n  trackMouse(mouseTarget, dt) {\n    const { u } = this.trim();\n    u.mulSelf(0);\n    const dxo = new eig.Matrix([\n      mouseTarget[0] - this.x.get(0),\n      mouseTarget[1] - this.x.get(1),\n      -this.x.get(2)\n    ]).mul(10).clamp(-10, 10);\n    const dx = dxo.vcat(new eig.Matrix(3, 1));\n    this.x.setBlock(3, 0, dxo.block(0, 0, 3, 1));\n    // TODO: extract in schema\n    const newX = this.x.matAdd(dx.mul(dt));\n    this.bound(newX);\n    this.setState(newX);\n    return { u };\n  }\n\n  /**\n   * Draw model\n   */\n  createGraphics(two, scale) {\n    const GEOM = {\n      thickness: 8,\n      length: scale,\n      mr: scale / 10\n    };\n\n    const body = two.makeRectangle(0, 0, GEOM.length, GEOM.thickness);\n    body.fill = colors.blue.base;\n    body.linewidth = 2;\n\n    // Create propellers\n    const propHeight = -1.5 * GEOM.thickness;\n    const propLength = GEOM.length / 4;\n    this.graphics.force = [null, null];\n    const sides = [(3 * GEOM.length) / 7, (-3 * GEOM.length) / 7].map(x => {\n      const prop = two.makeLine(\n        x - propLength,\n        propHeight,\n        x + propLength,\n        propHeight\n      );\n      prop.linewidth = 3;\n      prop.fill = colors.green.base;\n      const shaft = two.makeLine(x, -3, x, propHeight);\n      shaft.linewidth = 2;\n      shaft.fill = colors.green.base;\n      // Motors?\n\n      // Forces\n      const fLine = two.makeLine(x, propHeight, x, propHeight - 10);\n      fLine.linewidth = 2;\n      fLine.stroke = colors.red.base;\n      const fHead = two.makePolygon(x, propHeight - 10, 6, 3);\n      fHead.fill = colors.red.base;\n\n      return {\n        prop: two.makeGroup(prop, shaft, fLine, fHead),\n        fLine,\n        fHead\n      };\n    });\n    this.graphics.setControl = u => {\n      sides.forEach((side, idx) => {\n        side.fHead.visible = side.fLine.visible = !!u;\n        if (!u) return;\n        const uh = _.clamp(u.get(idx) * 5, -100, 100);\n        side.fHead.translation.y = propHeight - uh;\n        side.fHead.rotation = uh > 0 ? 0 : Math.PI;\n        side.fLine.vertices[1].y = side.fHead.translation.y;\n      });\n    };\n\n    this.graphics.system = two.makeGroup(\n      body,\n      sides[0].prop,\n      sides[1].prop\n    );\n\n    // Create marker\n    const marker = createMarker(two, GEOM.mr, colors.blue.darken4, 4);\n    this.graphics.system.add(marker);\n\n    // Create traj\n    this.graphics.traj = createTraj(two, this.mpcParams().nPts);\n  }\n\n  /**\n   * Update model\n   */\n  updateGraphics(worldToCanvas, params) {\n    const { u } = params;\n    const x = this.x;\n    this.graphics.system.translation.set(...worldToCanvas([x.get(0), x.get(1)]));\n    this.graphics.system.rotation = -x.get(2);\n    this.graphics.setControl(u);\n    this.graphics.system.opacity = params.ghost ? 0.3 : 1;\n    this.graphics.traj.update((pt) => {\n      return worldToCanvas([pt.get(0), pt.get(1)]);\n    });\n  }\n\n  /**\n   * Differential flatness solution for an x, y trajectory\n   * @returns [x; u]\n   */\n  differentialFlatness(xy, dt) {\n    const p = this.params;\n    // Differenciate trajectory\n    xy = smooth(xy, dt, 1);\n    const dxy = differenciate(xy, dt, 1, true);\n    const ddxy = differenciate(dxy, dt, 1, true);\n    const theta = ddxy.map(val => {\n      const t = Math.atan(-val.get(0) / (val.get(1) + p.g));\n      return new eig.Matrix([t]);\n    });\n    const dtheta = differenciate(theta, dt, 1, true);\n    const ddtheta = differenciate(dtheta, dt, 1, true);\n    return xy.map((val, idx) => {\n      // compute u\n      const a = p.m * Math.sqrt(sqr(ddxy[idx].get(0)) + sqr(ddxy[idx].get(1) + p.g)) / 2;\n      const b = p.I * ddtheta[idx].get(0) / p.l;\n      const u = new eig.Matrix([a + b, a - b]);\n      return val.vcat(theta[idx]).vcat(dxy[idx]).vcat(dtheta[idx]).vcat(u);\n    });\n  }\n\n\n  /**\n   * LQR Params\n   */\n  lqrParams() {\n    return {\n      x0: [-2, 0, 0, 0, 0, 0],\n      Q: matFromDiag([10, 10, 10, 1, 1, 1]),\n      R: matFromDiag([1, 1]),\n      simEps: 0.1,\n      simDuration: 5,\n      disengage: false,\n      divergenceThres: 100,\n    };\n  }\n\n  /**\n   * Direct collocation params\n   */\n  directCollocationParams() {\n    // return {\n    //   nPts: 20,\n    //   uBounds: { min: [0, 0], max: [20, 20] },\n    //   anchors: [{ t: 0, x: [0, 0, 0, 0, 0, 0] }, { t: 1, x: [0, 1, 0, 0, 0, 0] }],\n    //   holdTime: 0,\n    //   reverse: true\n    // }\n    return {\n      nPts: 20,\n      uBounds: { min: [0, 0], max: [20, 20] },\n      anchors: [{ t: 0, x: [-2, 0, 0, 0, 0, 0] }, { t: 1, x: [2, 0, -6.28, 0, 0, 0] }],\n      holdTime: 0,\n      reverse: true,\n      traj: flipTraj\n    };\n  }\n\n  /**\n   * MPC Params\n   */\n  mpcParams() {\n    return {\n      nPts: 10,\n      uBounds: { min: [-10, -10], max: [25, 25] },\n      dt: 1 / 10, // 1 / 60,\n      traj: flipTrajMPC\n    };\n  }\n}\n\nexport default Quadrotor2D;","const swingup = {\n  dt: 0.09926270822947234,\n  x: [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, -10.0000],\n  [-0.0526, 0.0522, -1.0230, 1.0051, -10.0000],\n  [-0.2091, 0.2017, -2.0170, 1.8711, -10.0000],\n  [-0.4643, 0.4262, -2.9376, 2.4411, -10.0000],\n  [-0.8021, 0.6832, -3.5616, 2.4463, -5.8533],\n  [-1.1630, 0.8960, -3.2328, 1.5154, 9.8330],\n  [-1.4483, 0.9822, -2.3738, 0.1949, 6.9799],\n  [-1.6507, 0.9362, -1.5185, -1.1202, 10.0000],\n  [-1.7531, 0.7473, -0.4587, -2.5749, 10.0000],\n  [-1.7409, 0.4045, 0.7104, -4.1004, 10.0000],\n  [-1.6085, -0.0865, 1.8278, -5.3580, 10.0000],\n  [-1.4042, -0.6394, 1.8607, -5.0605, -4.2416],\n  [-1.2613, -1.0893, 0.8576, -3.6672, -10.0000],\n  [-1.2192, -1.4005, 0.0961, -2.4585, -2.8066],\n  [-1.2238, -1.6000, -0.1438, -1.4358, -1.0141],\n  [-1.2274, -1.6948, 0.2396, -0.3919, 10.0000],\n  [-1.1577, -1.6780, 1.1162, 0.7169, 10.0000],\n  [-0.9996, -1.5496, 1.9529, 1.7663, 10.0000],\n  [-0.7890, -1.3166, 1.8412, 2.8126, -10.0000],\n  [-0.6567, -0.9594, 0.7020, 4.1958, -10.0000],\n  [-0.6521, -0.4447, -0.6321, 5.8482, -10.0000],\n  [-0.7799, 0.2278, -1.7546, 7.0568, -10.0000],\n  [-0.9524, 0.9249, -1.2237, 6.1475, 10.0000],\n  [-1.0038, 1.4776, 0.1753, 4.7203, 10.0000],\n  [-0.9253, 1.9143, 1.3216, 3.8731, 10.0000],\n  [-0.7364, 2.2901, 2.3474, 3.5291, 10.0000],\n  [-0.4649, 2.6398, 2.7277, 3.1765, -2.9038],\n  [-0.2120, 2.9206, 2.0705, 2.2083, -10.0000],\n  [-0.0528, 3.0866, 1.0303, 1.0494, -10.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, -10.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, -10.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, -10.0000],\n  [-0.0528, 3.0866, 1.0303, 1.0494, -10.0000],\n  [-0.2120, 2.9206, 2.0705, 2.2083, -2.9038],\n  [-0.4649, 2.6398, 2.7277, 3.1765, 10.0000],\n  [-0.7364, 2.2901, 2.3474, 3.5291, 10.0000],\n  [-0.9253, 1.9143, 1.3216, 3.8731, 10.0000],\n  [-1.0038, 1.4776, 0.1753, 4.7203, 10.0000],\n  [-0.9524, 0.9249, -1.2237, 6.1475, -10.0000],\n  [-0.7799, 0.2278, -1.7546, 7.0568, -10.0000],\n  [-0.6521, -0.4447, -0.6321, 5.8482, -10.0000],\n  [-0.6567, -0.9594, 0.7020, 4.1958, -10.0000],\n  [-0.7890, -1.3166, 1.8412, 2.8126, 10.0000],\n  [-0.9996, -1.5496, 1.9529, 1.7663, 10.0000],\n  [-1.1577, -1.6780, 1.1162, 0.7169, 10.0000],\n  [-1.2274, -1.6948, 0.2396, -0.3919, -1.0141],\n  [-1.2238, -1.6000, -0.1438, -1.4358, -2.8066],\n  [-1.2192, -1.4005, 0.0961, -2.4585, -10.0000],\n  [-1.2613, -1.0893, 0.8576, -3.6672, -4.2416],\n  [-1.4042, -0.6394, 1.8607, -5.0605, 10.0000],\n  [-1.6085, -0.0865, 1.8278, -5.3580, 10.0000],\n  [-1.7409, 0.4045, 0.7104, -4.1004, 10.0000],\n  [-1.7531, 0.7473, -0.4587, -2.5749, 10.0000],\n  [-1.6507, 0.9362, -1.5185, -1.1202, 6.9799],\n  [-1.4483, 0.9822, -2.3738, 0.1949, 9.8330],\n  [-1.1630, 0.8960, -3.2328, 1.5154, -5.8533],\n  [-0.8021, 0.6832, -3.5616, 2.4463, -10.0000],\n  [-0.4643, 0.4262, -2.9376, 2.4411, -10.0000],\n  [-0.2091, 0.2017, -2.0170, 1.8711, -10.0000],\n  [-0.0526, 0.0522, -1.0230, 1.0051, -10.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000]]\n};\n\nconst swingupMPC = {\n  dt: 0.12169516451329707,\n  x: [[0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, -10.0000],\n  [-0.0777, 0.0767, -1.2410, 1.2087, -10.0000],\n  [-0.2580, 0.2427, -1.2431, 1.0193, 9.2645],\n  [-0.3361, 0.2753, 0.0063, -0.5154, 10.0000],\n  [-0.2544, 0.1144, 1.3007, -2.0356, 10.0000],\n  [-0.0141, -0.2187, 2.5254, -3.2053, 10.0000],\n  [0.3506, -0.6387, 3.1599, -3.2877, 3.7714],\n  [0.7242, -0.9827, 2.5840, -2.0345, -10.0000],\n  [0.9706, -1.1324, 1.3831, -0.3863, -10.0000],\n  [1.0710, -1.0808, 0.2199, 1.2208, -10.0000],\n  [1.0206, -0.8224, -1.0592, 2.9524, -10.0000],\n  [0.7980, -0.3359, -2.5255, 4.8374, -10.0000],\n  [0.3996, 0.3581, -3.7484, 6.0397, -10.0000],\n  [-0.0659, 1.0706, -3.3462, 5.0316, 7.3020],\n  [-0.4006, 1.6013, -2.0263, 3.5639, 10.0000],\n  [-0.5769, 1.9836, -0.8274, 2.6472, 10.0000],\n  [-0.6110, 2.2818, 0.2758, 2.2069, 10.0000],\n  [-0.5078, 2.5535, 1.3847, 2.2270, 10.0000],\n  [-0.2887, 2.8354, 1.9232, 2.1718, -0.3442],\n  [-0.0781, 3.0608, 1.2539, 1.2871, -10.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, -10.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [0.0000, 3.1400, 0.0000, 0.0000, -10.0000],\n  [-0.0781, 3.0608, -1.2539, -1.2871, -10.0000],\n  [-0.2860, 2.8381, -1.8587, -2.1082, 0.7075],\n  [-0.4919, 2.5694, -1.2602, -2.0957, 10.0000],\n  [-0.5799, 2.3161, -0.1569, -2.0392, 10.0000],\n  [-0.5318, 2.0425, 0.9308, -2.4151, 10.0000],\n  [-0.3448, 1.6949, 2.0871, -3.2331, 10.0000],\n  [-0.0117, 1.2141, 3.2186, -4.5469, 5.3899],\n  [0.4257, 0.5665, 3.5018, -5.5923, -10.0000],\n  [0.8060, -0.1028, 2.4832, -4.8765, -10.0000],\n  [1.0281, -0.6065, 1.0626, -3.1269, -10.0000],\n  [1.0762, -0.8831, -0.2655, -1.3242, -10.0000],\n  [0.9666, -0.9413, -1.4835, 0.3854, -10.0000],\n  [0.7044, -0.7855, -2.7363, 2.1263, -10.0000],\n  [0.3229, -0.4427, -3.0159, 3.0282, 8.5836],\n  [0.0071, -0.0982, -1.9831, 2.3503, 10.0000],\n  [-0.1629, 0.1188, -0.7305, 1.0718, 10.0000],\n  [-0.1743, 0.1623, 0.5499, -0.3828, 10.0000],\n  [-0.0639, 0.0630, 0.9104, -0.8828, -4.6821],\n  [0.0000, 0.0000, 0.0000, 0.0000, -10.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000],\n  [0.0000, 0.0000, 0.0000, 0.0000, 0.0000]]\n};\n\nconst topToTop = {\n  dt: 0.09230116159897456,\n  x: [[-2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [-2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [-2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [-2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [-2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [-2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [-2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [-2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [-2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [-2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [-2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [-2.0000, 3.1400, 0.0000, 0.0000, -10.0000],\n  [-2.0457, 3.0939, -0.9577, -0.9733, -10.0000],\n  [-2.1832, 2.9512, -1.9247, -2.0368, -10.0000],\n  [-2.4127, 2.7010, -2.8725, -3.2201, -10.0000],\n  [-2.6998, 2.3585, -2.8297, -3.7476, 10.0000],\n  [-2.9241, 1.9939, -1.8626, -3.9650, 10.0000],\n  [-3.0528, 1.5867, -0.8080, -4.6429, 10.0000],\n  [-3.0719, 1.0911, 0.4485, -5.8315, 10.0000],\n  [-2.9676, 0.4619, 1.6542, -7.3036, 4.1852],\n  [-2.8000, -0.2533, 1.5011, -7.2369, -10.0000],\n  [-2.7206, -0.8682, 0.1423, -5.6155, -10.0000],\n  [-2.7422, -1.3463, -0.2944, -4.5286, 10.0000],\n  [-2.7464, -1.7363, 0.2344, -3.6041, 10.0000],\n  [-2.6915, -2.0286, 0.9456, -2.4910, 10.0000],\n  [-2.5612, -2.2077, 1.8015, -1.2436, 10.0000],\n  [-2.3452, -2.2641, 2.7276, 0.0664, 10.0000],\n  [-2.0404, -2.1951, 3.6500, 1.3732, 10.0000],\n  [-1.6507, -2.0041, 4.4945, 2.6102, 10.0000],\n  [-1.1870, -1.7012, 5.1879, 3.7064, 10.0000],\n  [-0.6864, -1.3012, 5.0500, 4.6926, -6.2118],\n  [-0.2549, -0.7912, 3.9015, 6.0768, -10.0000],\n  [0.0508, -0.1314, 2.5495, 7.6723, -10.0000],\n  [0.2686, 0.6212, 2.2831, 7.7266, -2.2551],\n  [0.5298, 1.2993, 3.3518, 6.4203, 10.0000],\n  [0.8963, 1.8624, 4.0691, 5.4378, -5.7294],\n  [1.2722, 2.3354, 3.6937, 4.4279, -10.0000],\n  [1.5873, 2.7010, 2.8725, 3.2201, -10.0000],\n  [1.8168, 2.9512, 1.9247, 2.0368, -10.0000],\n  [1.9543, 3.0939, 0.9577, 0.9733, -10.0000],\n  [2.0000, 3.1400, 0.0000, 0.0000, -10.0000],\n  [2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [2.0000, 3.1400, 0.0000, 0.0000, 0.0000],\n  [2.0000, 3.1400, 0.0000, 0.0000, 0.0000]]\n};\n\nexport { swingup, swingupMPC, topToTop };","import eig from '@eigen';\nimport _ from 'lodash';\nimport { wrapAngle, sqr, matFromDiag } from '@/components/math.js';\nimport Model from '@/components/models/model.js';\nimport { createMarker, createTraj } from '../utils.js';\nimport colors from 'vuetify/lib/util/colors';\nimport { swingup, swingupMPC, topToTop } from './trajectory.js';\n\nclass CartPole extends Model {\n  static NAME = 'cart pole';\n  static TAG = 'cartPole';\n  static STATES = Object.freeze([\n    { name: 'x', show: true },\n    { name: 'theta', angle: true, min: -Math.PI, max: Math.PI, show: true },\n    { name: 'xDot' },\n    { name: 'thetaDot' }\n  ]);\n  static COMMANDS = Object.freeze([\n    { name: 'force' }\n  ]);\n\n  constructor(params = {}) {\n    super(CartPole.STATES, CartPole.COMMANDS, {\n      ...params,\n      g: 9.81,\n      l: 1,\n      mp: 0.2,\n      mc: 1,\n      mu: 0.5,\n    });\n  }\n\n  trim() {\n    return {\n      x: new eig.Matrix([0, Math.PI, 0, 0]),\n      u: new eig.Matrix([0])\n    };\n  }\n\n  /**\n   * Bound state x to appropriate domain\n   * @param {Matrix} x \n   */\n  bound(x) {\n    super.bound(x);\n    x.set(1, wrapAngle(x.get(1)));\n  }\n\n  /**\n   * Returns dx/dt\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} dx\n   */\n  dynamics(x, u) {\n    // x = [x, theta, dx, dtheta]\n    const p = this.params;\n    const [c, s] = [Math.cos(x.get(1)), Math.sin(x.get(1))];\n    const dx = x.block(2, 0, 2, 1);\n    const den = p.mc + p.mp * sqr(s);\n    const ddx = new eig.Matrix([\n      (u.get(0) + p.mp * s * (p.l * sqr(x.get(3)) + p.g * c)) / den, //- p.mu * x.get(2),\n      -(u.get(0) * c + p.mp * p.l * sqr(x.get(3)) * c * s + (p.mp + p.mc) * p.g * s) / p.l / den //- p.mu * x.get(3)\n    ]);\n    return dx.vcat(ddx);\n  }\n\n  /**\n   * Returns df/dx\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} df/dx\n   */\n  xJacobian(x, u) {\n    const p = this.params;\n    const td = x.get(3);\n    const f = u.get(0);\n    const [c, s] = [Math.cos(x.get(1)), Math.sin(x.get(1))];\n    const [c2, s2, td2] = [sqr(c), sqr(s), sqr(td)];\n    const den = p.mp * s2 + p.mc;\n    const dx2dt = (p.mp * c * (p.l * td2 + p.g * c) - p.g * p.mp * s2) / den - (2 * p.mp * c * s * (f + p.mp * s * (p.l * td2 + p.g * c))) / sqr(den);\n    const dx2dt1 = (2 * p.l * p.mp * td * s) / den;\n    const dt2dt = (f * s - p.g * c * (p.mc + p.mp) - p.l * p.mp * td2 * c2 + p.l * p.mp * td2 * s2) / (p.l * den) + (2 * p.mp * c * s * (p.l * p.mp * c * s * td2 + f * c + p.g * s * (p.mc + p.mp))) / (p.l * sqr(den));\n    const dt2dt1 = -(2 * p.mp * td * c * s) / den;\n    return new eig.Matrix([\n      [0, 0, 1, 0],\n      [0, 0, 0, 1],\n      [0, dx2dt, 0, dx2dt1],\n      [0, dt2dt, 0, dt2dt1]\n    ]);\n  }\n\n  /**\n   * Returns df/du\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} df/du\n   */\n  uJacobian(x, u) {\n    const p = this.params;\n    const [c, s] = [Math.cos(x.get(1)), Math.sin(x.get(1))];\n    const s2 = sqr(s);\n    const dx2du = 1 / (p.mp * s2 + p.mc);\n    const dt2du = -c / (p.l * (p.mp * s2 + p.mc));\n    return new eig.Matrix([\n      [0], [0], [dx2du], [dt2du]\n    ]);\n  }\n\n  /**\n   * Mouse step\n   * @param {Array} mouseTarget \n   * @param {Number} dt \n   */\n  trackMouse(mouseTarget, dt) {\n    const { u } = this.trim();\n    const dx = this.dynamics(this.x, u);\n    // Control cart\n    const xVel = 10 * (mouseTarget[0] - this.x.get(0));\n    const thetaVel = 10 * wrapAngle(Math.PI - this.x.get(1));\n    this.x.set(2, _.clamp(xVel, -15, 15));\n    this.x.set(3, thetaVel);\n    dx.set(0, this.x.get(2));\n    dx.set(1, this.x.get(3));\n    dx.set(2, 0);\n    dx.set(3, 0);\n    const newX = this.x.matAdd(dx.mul(dt));\n    this.bound(newX);\n    this.setState(newX);\n    return { u };\n  }\n\n  /**\n   * Draw model\n   */\n  createGraphics(two, scale) {\n    const COLOR = \"#00897B\";\n    const COLOR_DARK = \"#1565C0\";\n    const COLOR_RED = \"#F44336\";\n\n    const GEOM = {\n      thickness: 8,\n      radius: 14,\n      length: scale,\n      cartWidth: 96, // TODO: base on scale?\n      cartHeight: 48 // TODO: base on scale?\n    };\n\n    // Cart\n    const cart = two.makeRectangle(0, 0, GEOM.cartWidth, GEOM.cartHeight);\n    cart.fill = COLOR_DARK;\n    cart.linewidth = 2;\n\n    // Pole\n    const shaft = two.makeRectangle(\n      0,\n      GEOM.length / 2,\n      GEOM.thickness,\n      GEOM.length + GEOM.thickness\n    );\n    shaft.fill = COLOR;\n    shaft.linewidth = 2;\n    const circle = two.makeCircle(0, GEOM.length, GEOM.radius);\n    circle.fill = COLOR_DARK;\n    circle.linewidth = 2;\n    const pole = two.makeGroup(shaft, circle);\n\n    // Marker\n    const marker = createMarker(two, 2 * GEOM.radius / 3, colors.indigo.darken4, 5);\n\n    // Forces\n    const sides = [-GEOM.cartWidth / 2, GEOM.cartWidth / 2].map(x => {\n      const fLine = two.makeLine(x, 0, x, 0);\n      fLine.linewidth = 2;\n      fLine.stroke = COLOR_RED;\n      const fHead = two.makePolygon(0, 0, 6, 3);\n      fHead.rotation = (Math.PI / 2) * Math.sign(x);\n      fHead.fill = COLOR_RED;\n      const group = two.makeGroup(fLine, fHead);\n      group.visible = false;\n      return { group, fLine, fHead };\n    });\n    const setControl = u => {\n      if (u)\n        sides.forEach((side, idx) => {\n          const uh = _.clamp(u.get(0) * 5, -100, 100);\n          side.group.visible = (idx - 0.5) * uh > 1e-2;\n          side.fHead.translation.x = (Math.sign(uh) * GEOM.cartWidth) / 2 + uh;\n          side.fLine.vertices[1].x = side.fHead.translation.x;\n        });\n    };\n    this.graphics = {\n      setControl,\n      cart: two.makeGroup(cart, pole, marker, sides[0].group, sides[1].group),\n      pole\n    };\n    // Create traj\n    this.graphics.scale = GEOM.length;\n    this.graphics.traj = createTraj(two, this.mpcParams().nPts);\n  }\n\n  /**\n   * Update model\n   */\n  updateGraphics(worldToCanvas, params) {\n    // TODO: draw torque\n    const { u, ghost } = params;\n    const x = this.x;\n    // TEMP\n    // x.set(0, 0);\n    // x.set(1, Math.PI - Math.PI / 8);\n    // x.set(2, 0);\n    // x.set(3, 0);\n    this.graphics.cart.opacity = ghost ? 0.3 : 1;\n    this.graphics.pole.rotation = -x.get(1);\n    this.graphics.cart.translation.set(...worldToCanvas([x.get(0), 0]));\n    this.graphics.setControl(u);\n    this.graphics.traj.update((pt) => {\n      const center = worldToCanvas([pt.get(0), 0]);\n      return [\n        center[0] + this.graphics.scale * Math.sin(pt.get(1)),\n        center[1] + this.graphics.scale * Math.cos(pt.get(1))\n      ];\n    });\n  }\n\n  /**\n   * LQR Params\n   */\n  lqrParams() {\n    return {\n      x0: [-2, Math.PI, 0, 0],\n      Q: matFromDiag([10, 10, 1, 1]),\n      R: matFromDiag([1]),\n      simEps: 1e-1,\n      simDuration: 5,\n      disengage: false,\n      divergenceThres: 500,\n    };\n  }\n\n  /**\n   * Direct collocation params\n   */\n  directCollocationParams() {\n    return {\n      nPts: 30,\n      uBounds: { min: [-10], max: [10] },\n      anchors: [{ t: 0, x: [0, 0, 0, 0] }, { t: 1, x: [0, 3.14, 0, 0] }],\n      holdTime: 1,\n      // reverse: true,\n      traj: swingup,\n    };\n  }\n\n  /**\n   * MPC Params\n   */\n  mpcParams() {\n    return {\n      nPts: 20,\n      uBounds: { min: [-10], max: [10] },\n      dt: 1 / 10,\n      traj: swingupMPC,\n      // traj: topToTop,\n      xWeight: [100, 100, 0.1, 0.1],\n    };\n  }\n}\n\nexport default CartPole;","import eig from '@eigen';\nimport _ from 'lodash';\nimport colors from 'vuetify/lib/util/colors';\nimport Model from '@/components/models/model.js';\nimport { matFromDiag } from '@/components/math.js';\nimport Two from \"two.js\";\nimport { wrapAngle } from '@/components/math.js';\nimport { createMarker } from '../utils.js';\n\nclass Car extends Model {\n  static TAG = 'car';\n  static NAME = 'car';\n  static STATES = Object.freeze([\n    { name: 'x', show: true },\n    { name: 'y', show: true },\n    { name: 'theta', show: true },\n    { name: 'v', show: false }\n  ]);\n  static COMMANDS = Object.freeze([\n    { name: 'accel' },\n    { name: 'delta' }\n  ]);\n\n  constructor(params = {}) {\n    super(Car.STATES, Car.COMMANDS, {\n      ...params,\n      l: 1,\n      mu: 0.5, // s^-1.kg^-1\n      maxAccel: 20,\n      maxDelta: Math.PI / 4\n    });\n  }\n\n  trim() {\n    return {\n      x: new eig.Matrix([0, 0, Math.PI / 2, 0]),\n      u: new eig.Matrix([0, 0]),\n    };\n  }\n\n  /**\n   * Bound state x to appropriate domain\n   * @param {Matrix} x \n   */\n  bound(x) {\n    super.bound(x);\n    x.set(2, wrapAngle(x.get(2)));\n  }\n\n  /**\n   * Returns dx/dt\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} dx\n   */\n  dynamics(x, u) {\n    const p = this.params;\n    const theta = x.get(2);\n    const v = x.get(3);\n    const delta = u.get(1);\n    return new eig.Matrix([\n      Math.cos(theta) * v,\n      Math.sin(theta) * v,\n      v * Math.tan(delta) / p.l,\n      u.get(0) - v * p.mu\n    ]);\n  }\n\n  /**\n   * Mouse step\n   * @param {Number} dt \n   * @param {Array} mouseTarget \n   */\n  trackMouse(mouseTarget, dt) {\n    const p = this.params;\n    const [x, y] = [this.x.get(0), this.x.get(1)];\n    const [theta, v] = [this.x.get(2), this.x.get(3)];\n    const [mx, my] = [mouseTarget[0], mouseTarget[1]];\n    const d = Math.sqrt(Math.pow(mx - x, 2) + Math.pow(my - y, 2));\n    const [dx, dy] = [Math.cos(theta), Math.sin(theta)];\n    const dot = dx * (mx - x) + dy * (my - y);\n    const cross = dx * (my - y) - dy * (mx - x);\n    const dtheta = dot < 0 ?\n    Math.sign(cross) * p.maxDelta :\n    Math.asin(cross / Math.max(d, 1e-3));\n    // Controller\n    const dClipped = Math.max(d - 0.1, 0);\n    const ac = _.clamp(10 * (dClipped - v * 0.5), -p.maxAccel, p.maxAccel);\n    const dc = _.clamp(dtheta, -p.maxDelta, p.maxDelta);\n    const u = new eig.Matrix([ac, dc]);\n    this.step(u, dt);\n    return { u };\n  }\n\n  /**\n   * Draw model\n   */\n  createGraphics(two, scale) {\n    const GEOM = {\n      l: scale / 2,\n      w: 3 * scale / 10,\n      a1: 0.6, // back wheel lateral clearance\n      a2: 0.4, // front wheel lateral clearance\n      b: 0.6,  // wheel horizontal clearance\n      c: 0.3,  // wheel casing start\n      // wheels\n      lw: scale / 4,\n      ww: scale / 12,\n      // marker\n      mr: scale / 12\n    };\n    // Create car\n    let anchors = [\n      [-GEOM.l, GEOM.w * GEOM.a1],\n      [-GEOM.l * GEOM.b, GEOM.w * GEOM.a1],\n      [-GEOM.l * GEOM.c, GEOM.w],\n      [GEOM.l * GEOM.c, GEOM.w],\n      [GEOM.l * GEOM.b, GEOM.w * GEOM.a2],\n      [GEOM.l, GEOM.w * GEOM.a2]\n    ];\n    anchors = anchors.concat(anchors.map(([i, j]) => [i, -j]).reverse());\n    const path = two.makePath(..._.flatten(anchors), false);\n    path.automatic = false;\n    path.fill = colors.blue.base;\n    path.stroke = colors.blue.darken4;\n    path.linewidth = 3;\n    this.graphics.car = two.makeGroup(path);\n\n    const marker = createMarker(two, GEOM.mr, colors.blue.darken4, 5);\n    this.graphics.car.add(marker);\n\n    // Create wheels\n    this.graphics.wheels = [];\n    const CORNERS = [[-1, -1], [-1, 1], [1, -1], [1, 1]];\n    CORNERS.forEach(([i, j], idx) => {\n      const wheel = two.makeRectangle(0, 0, GEOM.lw, GEOM.ww);\n      wheel.translation.set(\n        i * (GEOM.l - GEOM.lw / 6),\n        j * (GEOM.w - GEOM.ww / 2)\n      );\n      wheel.noStroke();\n      wheel.fill = '#000000';\n      this.graphics.wheels[idx] = wheel;\n      this.graphics.car.add(wheel);\n    });\n\n    this.graphics.showControl = true;\n    this.graphics.setControl = u => {\n      const delta = u.get(1);\n      this.graphics.wheels[2].rotation = -delta;\n      this.graphics.wheels[3].rotation = -delta;\n    };\n  }\n\n  /**\n   * Update model\n   */\n  updateGraphics(worldToCanvas, params) {\n    const { u } = params;\n    const x = this.x;\n    this.graphics.car.translation.set(...worldToCanvas([x.get(0), x.get(1)]));\n    this.graphics.car.rotation = -x.get(2);\n    this.graphics.setControl(u);\n  }\n\n  /**\n   * Kalman filter plugin parameters\n   */\n  kalmanFilterParams() {\n    function measurement(params, x) {\n      const pos = new eig.Matrix(params.pos);\n      const dist = pos.matSub(x.block(0, 0, 2, 1)).norm();\n      return new eig.Matrix([dist]);\n    }\n    return {\n      covariance: [[5, 0, 0, 0], [0, 5, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]],\n      processNoise: [[0.1, 0, 0, 0], [0, 0.1, 0, 0], [0, 0, 0.02, 0], [0, 0, 0, 0]],\n      inputNoise: [[0, 0], [0, 0]],\n      sensors: [\n        { type: 'radar', dt: 1, pos: [-2, 2], measurement, noise: [[1]] },\n        { type: 'radar', dt: 1, pos: [2, 2], measurement, noise: [[1]] }\n      ]\n    };\n  }\n\n  /**\n   * Particle filter plugin parameters\n   */\n  particleFilterParams() {\n    function measurement(params, x) {\n      const pos = new eig.Matrix(params.pos);\n      const dist = pos.matSub(x.block(0, 0, 2, 1)).norm();\n      return new eig.Matrix([dist]);\n    }\n    return {\n      nPts: 30,\n      dt: 1,\n      distribution: 'exact',\n      processNoise: [[0.02, 0, 0, 0], [0, 0.02, 0, 0], [0, 0, 0.1, 0], [0, 0, 0, 0.1]],\n      range: { // For uniform distribution generation\n        min: [-3, -3, -Math.PI, 0],\n        max: [3, 3, Math.PI, 10]\n      },\n      type: '2d',\n      sensors: [\n        { type: 'radar', dt: 1, pos: [-4, 4], measurement, noise: [[2]] },\n        { type: 'radar', dt: 1, pos: [-4, -4], measurement, noise: [[2]] },\n        { type: 'radar', dt: 1, pos: [4, -4], measurement, noise: [[2]] },\n        { type: 'radar', dt: 1, pos: [4, 4], measurement, noise: [[2]] }\n      ]\n    };\n  }\n}\n\nconst traj = [];\n\nexport { traj };\nexport default Car;","import SecondOrder from \"@/components/models/secondOrder/secondOrder.js\";\nimport SimplePendulum from \"@/components/models/simplePendulum/simplePendulum.js\";\nimport DoublePendulum from \"@/components/models/doublePendulum/doublePendulum.js\";\nimport Quadrotor2D from \"@/components/models/quadrotor2D/quadrotor2D.js\";\nimport CartPole from \"@/components/models/cartPole/cartPole.js\";\nimport Arm from \"@/components/models/arm/arm.js\";\nimport Car from \"@/components/models/car/car.js\";\n\n\nconst systems = {\n  [SecondOrder.TAG]: SecondOrder,\n  [SimplePendulum.TAG]: SimplePendulum,\n  [DoublePendulum.TAG]: DoublePendulum,\n  [Quadrotor2D.TAG]: Quadrotor2D,\n  [CartPole.TAG]: CartPole,\n  [Arm.TAG]: Arm,\n  [Car.TAG]: Car,\n};\n\nexport default systems","<template lang=\"pug\">\nv-app-bar(app clipped-left clipped-right\n          :color='color'\n          :dark='dark'\n          dense)\n  //* Left action\n  v-app-bar-nav-icon(v-if='!showBack'\n                     @click.stop=\"$emit('toggleDrawer')\")\n  v-toolbar-items(v-else\n                  style='margin-left: 0px')\n    v-btn.mr-2(icon @click='navback')\n      v-icon(small) fas fa-chevron-left\n  //* Content\n  v-toolbar-title.headline\n    span.font-weight-light {{ title }}\n  v-spacer\n  v-toolbar-items\n    v-btn(href='https://github.com/BertrandBev/controls-js', target='_blank', text)\n      span.mr-2 Github\n      v-icon mdi-open-in-new\n  //* Right action\n  v-btn(v-if='showRightDrawer'\n        icon\n        dark\n        @click.stop=\"$bus.$emit('toggleDrawer')\")\n    v-icon mdi-tune\n</template>\n\n<script>\nimport _ from \"lodash\";\nimport Systems from \"@/components/models/systems.js\";\n\nexport default {\n  props: {},\n\n  computed: {\n    title() {\n      const routeTitle = this.$route.meta.title;\n      const params = this.$route.params;\n      if (params.systemName) {\n        // System route\n        const systemClass = Systems[params.systemName];\n        return `${routeTitle} - ${systemClass.NAME}`;\n      }\n      return this.$route.name;\n    },\n\n    showBack() {\n      return false;\n    },\n\n    dark() {\n      return true;\n    },\n\n    routeName() {\n      return _.get(this.$route, \"name\");\n    },\n\n    color() {\n      return _.get(\n        {\n          home: \"#004D40\"\n        },\n        this.routeName,\n        \"primary\"\n      );\n    },\n\n    routeQuery() {\n      return _.get(this.$route, \"query\", {});\n    },\n\n    showRightDrawer() {\n      return _.get(this.$route, \"meta.rightDrawer\", false);\n    }\n  },\n\n  created() {},\n\n  methods: {\n    navback() {\n      this.$bus.$emit(\"navback\");\n    }\n  }\n};\n</script>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Toolbar.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Toolbar.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Toolbar.vue?vue&type=template&id=2a96bf4e&lang=pug&\"\nimport script from \"./Toolbar.vue?vue&type=script&lang=js&\"\nexport * from \"./Toolbar.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VAppBar } from 'vuetify/lib/components/VAppBar';\nimport { VAppBarNavIcon } from 'vuetify/lib/components/VAppBar';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VToolbarItems } from 'vuetify/lib/components/VToolbar';\nimport { VToolbarTitle } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VAppBar,VAppBarNavIcon,VBtn,VIcon,VSpacer,VToolbarItems,VToolbarTitle})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-navigation-drawer',{attrs:{\"app\":\"\",\"clipped\":\"\"},model:{value:(_vm.drawer),callback:function ($$v) {_vm.drawer=$$v},expression:\"drawer\"}},[_c('v-list',{attrs:{\"dense\":\"\"}},[_c('v-list-item',{on:{\"click\":_vm.navHome}},[_c('v-list-item-icon',[_c('v-icon',[_vm._v(\"mdi-home\")])],1),_c('v-list-item-title',[_vm._v(\"Home\")])],1),_c('v-divider'),_vm._l((_vm.envRoutes),function(route,idx){return _c('v-list-group',{key:(\"env_\" + idx),attrs:{\"prepend-icon\":route.meta.icon,\"value\":_vm.isEnv(route.name)},scopedSlots:_vm._u([{key:\"activator\",fn:function(){return [_c('v-list-item-title',[_vm._v(_vm._s(route.meta.title))])]},proxy:true}],null,true)},_vm._l((route.meta.systems),function(system,sidx){return _c('v-list-item',{key:(\"env_\" + idx + \"_system_\" + sidx),staticClass:\"ml-3\",class:{ active: _vm.isActive(route, system) },on:{\"click\":function () { return _vm.navSystem(route, system); }}},[_c('v-list-item-title',[_vm._v(_vm._s(system.NAME))]),_c('v-list-item-icon',[_c('v-icon',[_vm._v(_vm._s(_vm.icons[sidx]))])],1)],1)}),1)})],2),_c('v-divider'),_c('v-list',{staticStyle:{\"flex\":\"0 0 auto\"},attrs:{\"dense\":\"\"}},[_c('v-list-item',{on:{\"click\":_vm.github}},[_c('v-list-item-action',[_c('v-icon',[_vm._v(\"mdi-github\")])],1),_c('v-list-item-content',[_c('v-list-item-title',[_vm._v(\"Github\")])],1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticStyle:{\"display\":\"flex\",\"flex-direction\":\"column\",\"align-items\":\"center\"}},[_c('div',{style:(_vm.divStyle)},[_c('Demo',{staticStyle:{\"position\":\"absolute\"}}),_vm._m(0)],1),_c('div',{staticStyle:{\"width\":\"100%\",\"max-width\":\"960px\",\"padding\":\"40px\"},domProps:{\"innerHTML\":_vm._s(_vm.markdownHtml)}})])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticStyle:{\"position\":\"absolute\",\"display\":\"flex\",\"width\":\"100%\",\"justify-content\":\"center\"}},[_c('span',{staticClass:\"display-1 blue--text\",staticStyle:{\"margin-top\":\"32px\"}},[_vm._v(\"Controls JS\")])])}]\n\nexport { render, staticRenderFns }","export default \"[![Website shields.io](https://img.shields.io/website-up-down-green-red/http/shields.io.svg)](https://bertrandbev.github.io/controls-js/#/)\\n[![GitHub license](https://img.shields.io/github/license/Naereen/StrapDown.js.svg)](https://github.com/Naereen/StrapDown.js/blob/master/LICENSE)\\n\\n<p align=\\\"center\\\">\\n  <img width=\\\"340\\\" src=\\\"/src/assets/logo.png\\\">\\n</p>\\n\\n# Controls.js\\n\\nControls.js is a sandbox showcasing a few modern controls techiques directly in the browser.\\n\\nIt harnesses [eigen-js](https://github.com/BertrandBev/eigen-js) for all linear algebra and quadratic programming, and [nlopt-js](https://github.com/BertrandBev/nlopt-js) for non-linear optimization.\\n\\n[Home](https://bertrandbev.github.io/controls-js/#/)\\n\\n## Environments\\n\\n![alt text](https://api.iconify.design/mdi-matrix.svg?color=purple&width=25&height=25) &nbsp;   [Linear quadratic regulation](https://bertrandbev.github.io/controls-js/#/lqr/cartPole)\\n\\n> This environment demonstrates [linear quadratic regulation](https://en.wikipedia.org/wiki/Linear%E2%80%93quadratic_regulator) of a few test systems around unstable trim points\\n\\n![alt text](https://api.iconify.design/mdi-restore.svg?color=purple&width=25&height=25) &nbsp;   [Value iteration](https://bertrandbev.github.io/controls-js/#/valueIteration/simplePendulum)\\n\\n> A simple pendulum dynamics phase plane is discretized and [the value iteration](https://en.wikipedia.org/wiki/Markov_decision_process#Value_iteration) algorithm is run to obtain a swingup policy\\n\\n![alt text](https://api.iconify.design/mdi-infinity.svg?color=purple&width=25&height=25) &nbsp;   [Differential flatness](https://bertrandbev.github.io/controls-js/#/flatness/quadrotor2D)\\n\\n> A [differentially flat](https://en.wikipedia.org/wiki/Flatness_(systems_theory)) system, a 2D quadcopter, follows a custom spatial trajectory\\n\\n![alt text](https://api.iconify.design/mdi-vector-curve.svg?color=purple&width=25&height=25) &nbsp;   [Direct collocation](https://bertrandbev.github.io/controls-js/#/directCollocation/cartPole)\\n\\n> Nonlinear trajectory optimisation is demonstrated on a few dynamical systems using [direct collocation](https://en.wikipedia.org/wiki/Trajectory_optimization)\\n\\n![alt text](https://api.iconify.design/mdi-camera-timer.svg?color=purple&width=25&height=25) &nbsp;   [Model predictive control](https://bertrandbev.github.io/controls-js/#/mpc/cartPole)\\n\\n> [Model predictive control](https://en.wikipedia.org/wiki/Model_predictive_control) is used to dynamically stabilize the systems in the previous section around their optimized trajectories for robust tracking.\\n\\n![alt text](https://api.iconify.design/mdi-chart-bell-curve.svg?color=purple&width=25&height=25) &nbsp;   [Kalman Filter](https://bertrandbev.github.io/controls-js/#/kalmanFilter/car)\\n\\n> A [kalman filter](https://en.wikipedia.org/wiki/Kalman_filter) estimator tracks a 2d top down car's state based on radar measurements\\n\\n![alt text](https://api.iconify.design/mdi-dots-hexagon.svg?color=purple&width=25&height=25) &nbsp;   [Particle Filter](https://bertrandbev.github.io/controls-js/#/particleFilter/car)\\n\\n> A [particle filter](https://en.wikipedia.org/wiki/Particle_filter) estimator tracks a 2d top down car's state based on radar measurements using a swarm of simulated particles\\n\";","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"canvas\",style:(_vm.canvasStyle)},[_c('div',{ref:\"canvas\",staticClass:\"canvas\"}),_c('DirectCollocationPlugin',{directives:[{name:\"show\",rawName:\"v-show\",value:(false),expression:\"false\"}],ref:\"plugin\",attrs:{\"system\":_vm.system,\"disableMouse\":true},on:{\"activate\":function () {}}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{style:(_vm.containerStyle)},[_c('div',{ref:\"canvas\",style:(_vm.canvasStyle)},[_vm._t(\"canvas\")],2),_c('div',{style:(_vm.overlayStyle)},[_vm._t(\"overlay\")],2),(!_vm.noSheet)?_c('div',{ref:\"sheet\",staticClass:\"blue\",style:(_vm.sheetStyle)},[_c('div',{staticClass:\"bottomBar\"},[_vm._t(\"bar\"),_c('v-spacer'),_c('v-btn',{attrs:{\"dark\":\"\",\"text\":\"\"},on:{\"click\":function($event){_vm.sheet = !_vm.sheet}}},[_c('v-icon',{staticClass:\"mr-1\",attrs:{\"dark\":\"\"}},[_vm._v(_vm._s(_vm.sheet ? \"mdi-chevron-down\" : \"mdi-chevron-up\"))]),_vm._v(_vm._s(_vm.sheet ? \"close\" : \"open\"))],1)],2),_vm._t(\"sheet\")],2):_vm._e(),_c('v-navigation-drawer',{attrs:{\"app\":\"\",\"clipped\":\"\",\"right\":\"\",\"width\":\"300px\"},model:{value:(_vm.drawer),callback:function ($$v) {_vm.drawer=$$v},expression:\"drawer\"}},[_vm._t(\"drawer\")],2)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\ndiv(:style='containerStyle')\n  //* Main canvas\n  div(ref='canvas'\n      :style='canvasStyle')\n    slot(name='canvas')\n  //* Overlay\n  div(:style='overlayStyle')\n    slot(name='overlay')\n  //* Bottom sheet\n  div.blue(v-if='!noSheet'\n           ref='sheet'\n           :style='sheetStyle')\n    //* Bottom toolbar\n    div.bottomBar\n      slot(name='bar')\n      v-spacer\n      v-btn(dark\n            text\n            @click='sheet = !sheet')\n        v-icon.mr-1(dark) {{ sheet ? \"mdi-chevron-down\" : \"mdi-chevron-up\" }}\n        | {{ sheet ? \"close\" : \"open\" }}\n    //* Plot\n    slot(name='sheet')\n  //* Nav drawer\n  v-navigation-drawer(v-model='drawer'\n                      app clipped right\n                      width='300px')\n    slot(name='drawer')\n</template>\n\n<script>\nimport anime from \"animejs\";\n\nexport default {\n  components: {},\n\n  props: {\n    noSheet: Boolean\n  },\n\n  data: () => ({\n    sheet: true,\n    drawer: null\n  }),\n\n  watch: {\n    sheet() {\n      anime({\n        targets: this.$refs.sheet,\n        translateY: this.sheet ? 0 : this.sheetHeight,\n        easing: \"easeInOutCubic\",\n        duration: 300\n      });\n      anime({\n        targets: this.$refs.canvas,\n        translateY: this.sheet ? -this.sheetHeight / 2 : 0,\n        easing: \"easeInOutCubic\",\n        duration: 300\n      });\n    }\n  },\n\n  computed: {\n    sheetHeight() {\n      return this.$store.windowSize.y / 2;\n    },\n\n    overlayStyle() {\n      return {\n        position: \"absolute\",\n        top: \"0px\",\n        left: \"0px\",\n        width: \"100%\"\n      };\n    },\n\n    sheetStyle() {\n      const translateY = 0; // this.sheet ? 0 : this.sheetHeight;\n      return {\n        width: `100%`, //`${this.$store.windowSize.x}px`,\n        height: `${this.sheetHeight}px`,\n        position: \"absolute\",\n        bottom: `0px`,\n        transform: `translateY(${translateY}px)`\n      };\n    },\n\n    canvasStyle() {\n      const translateY = -this.sheetHeight / 2; // this.sheet ? -this.sheetHeight / 2 : 0;\n      return {\n        position: 'relative',\n        width: `100%`, //`${this.$store.windowSize.x}px`,\n        height: `${this.$store.windowSize.y}px`,\n        transform: `translateY(${translateY}px)`,\n        background:\n          'url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAATUlEQVRYR+3VMQoAMAhD0Xq3HNs75QgtdOqsg1C+u5C8JWF7r8ELAiCAAAIIIIBARyAz75BLKg96a47HA5RrP48tAQIggAACCCDwhcABvG5/oRsc6n0AAAAASUVORK5CYII=\")',\n        // background: 'white',\n        center: \"center\",\n        display: \"flex\",\n        \"flex-direction\": \"row\",\n        \"justify-content\": \"center\",\n        \"align-items\": \"center\"\n      };\n    },\n\n    containerStyle() {\n      return {\n        width: `100%`, //`${this.$store.windowSize.x}px`,\n        height: `${this.$store.windowSize.y}px`,\n        display: \"flex\",\n        \"flex-direction\": \"row\",\n        \"justify-content\": \"center\",\n        \"align-items\": \"center\",\n        background: \"#00796B\",\n        position: \"relative\",\n        overflow: \"hidden\"\n      };\n    }\n  },\n\n  mounted() {\n    this.$bus.$on(\"toggleDrawer\", this.toggleDrawer);\n    this.$nextTick(() => {\n      // this.drawer = this.$store.windowSize.x > 1264;\n    });\n  },\n\n  beforeDestroy() {\n    this.$bus.$off(\"toggleDrawer\", this.toggleDrawer);\n  },\n\n  methods: {\n    toggleDrawer() {\n      this.drawer = !this.drawer;\n    }\n  }\n};\n</script>\n\n<style>\n.bottomBar {\n  width: 100%;\n  height: 38px;\n  margin-top: -38px;\n  display: flex;\n  flex-direction: row;\n  background-color: #1875d2;\n  overflow: hidden;\n}\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ModelLayout.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ModelLayout.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ModelLayout.vue?vue&type=template&id=036d894b&lang=pug&\"\nimport script from \"./ModelLayout.vue?vue&type=script&lang=js&\"\nexport * from \"./ModelLayout.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ModelLayout.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VNavigationDrawer } from 'vuetify/lib/components/VNavigationDrawer';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VIcon,VNavigationDrawer,VSpacer})\n","import Two from \"two.js\";\n\nconst FPS_ALPHA = 0.98;\nconst FRAME_COLOR = \"#455A64\";\n\nexport default {\n  data: () => ({\n    // FPS computation\n    fps: 60,\n    lastUpdate: Date.now(),\n    // Private variables\n    t: 0, // Simulated time\n    two: null,\n    mouseTarget: null,\n    loop: null,\n  }),\n\n  computed: {\n    mouseDragging() {\n      return this.mouseTarget !== null\n    },\n\n    canvas() {\n      throw new Error('This method must be overidden')\n    },\n\n    height() {\n      return this.canvas.parentElement.clientHeight;\n    },\n\n    width() {\n      return this.canvas.parentElement.clientWidth;\n    },\n\n    scale() {\n      throw new Error('This method must be overidden')\n    },\n\n    dt() {\n      throw new Error('This method must be overidden')\n    }\n  },\n\n  mounted() {\n    const canvas = this.$refs.canvas;\n    const params = { width: this.width, height: this.height };\n    this.two = new Two(params).appendTo(canvas);\n\n    // Add helper functions\n    this.two.scale = this.scale;\n    this.two.canvas = canvas;\n    this.two.worldToCanvas = this.worldToCanvas;\n    this.two.canvasToWorld = this.canvasToWorld;\n\n    // Add mouse events\n    document.addEventListener(\"mouseup\", ev => {\n      this.dragging = false;\n      this.mouseTarget = null;\n    });\n    canvas.addEventListener(\"mousedown\", ev => {\n      this.dragging = true;\n      this.mouseTarget = this.canvasToWorld([ev.offsetX, ev.offsetY]);\n    });\n    canvas.addEventListener(\"mousemove\", ev => {\n      if (this.dragging) {\n        this.mouseTarget = this.canvasToWorld([ev.offsetX, ev.offsetY]);\n      }\n    });\n\n    // Frame\n    const frame = this.two.makeGroup(\n      this.two.makeLine(-this.width / 3, 0, this.width / 3, 0),\n      this.two.makeLine(0, -this.width / 6, 0, this.width / 6)\n    );\n    frame.translation.set(this.width / 2, this.height / 2);\n    frame.fill = FRAME_COLOR;\n\n    // Start loop\n    const updateFun = () => {\n      const now = Date.now();\n      this.t += this.dt\n      try {\n        this.update();\n      } catch (e) {\n        console.error(e)\n      }\n      this.two.update();\n      const dtMeas = (Date.now() - this.lastUpdate) / 1000\n      this.fps = this.fps * FPS_ALPHA + (1 - FPS_ALPHA) / dtMeas\n      this.lastUpdate = Date.now();\n      const updateTimeMs = Date.now() - now\n      const targetDtMs = Math.max(0, this.dt * 1000 - updateTimeMs)\n      this.loop = setTimeout(updateFun, targetDtMs);\n    };\n\n    this.$nextTick(() => {\n      updateFun();\n    })\n  },\n\n  beforeDestroy() {\n    clearTimeout(this.loop)\n  },\n\n  methods: {\n    canvasToWorld(pos) {\n      return [\n        (pos[0] - this.width / 2) / this.scale,\n        -(pos[1] - this.height / 2) / this.scale\n      ];\n    },\n\n    worldToCanvas(pos) {\n      return [\n        pos[0] * this.scale + this.width / 2,\n        -pos[1] * this.scale + this.height / 2\n      ];\n    },\n\n    update() {\n      throw new Error('This method must be overidden')\n    },\n\n    reset() {\n      this.t = 0\n    }\n  }\n}","import _ from 'lodash'\nimport eig from \"@eigen\";\n\nexport default {\n  data: () => ({\n    system: null,\n    isMounted: false\n  }),\n\n  computed: {\n  },\n\n  mounted() {\n    this.isMounted = true;\n    this.createGraphics();\n  },\n\n  methods: {\n    createGraphics() {\n      this.system.createGraphics(this.two, this.scale);\n      const plugin = this.$refs.plugin;\n      plugin.createGraphics(this.two);\n    },\n\n    reset() {\n      this.$refs.plugin.reset();\n    },\n\n    update() {\n      const plugin = this.$refs.plugin;\n      // TODO: add FPS meter\n      let params = {};\n      // Update system\n      const stepSystem = !plugin || plugin.stepSystem();\n      const mouseTargetEnabled = !plugin || plugin.mouseTargetEnabled;\n      if (mouseTargetEnabled && this.mouseTarget && stepSystem) {\n        params = this.system.trackMouse(this.mouseTarget, this.dt);\n      } else if (plugin && plugin.ready()) {\n        params = plugin.updateSystem(this.t, this.dt);\n      } else if (stepSystem) {\n        params = this.system.trim();\n        this.system.step(params.u, this.dt);\n      }\n      params.t = this.t;\n      params.dt = this.dt;\n      // Update plugins\n      if (plugin) plugin.update(params);\n      // Graphic update\n      this.system.updateGraphics(this.worldToCanvas, params);\n      // Run GC\n      eig.GC.flush();\n    }\n  }\n}","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Section',{attrs:{\"title\":\"Direct Collocation\"}},[_c('ValueInput',{ref:\"nPts\",attrs:{\"value\":_vm.params.nPts,\"label\":\"Point count\"},on:{\"update:value\":function($event){return _vm.$set(_vm.params, \"nPts\", $event)}}}),_c('div',{staticClass:\"mb-3 mt-3\",staticStyle:{\"display\":\"flex\",\"align-items\":\"center\"}},[_c('ArrayInput',{ref:\"uMin\",staticStyle:{\"flex\":\"1 0 auto\",\"width\":\"0px\"},attrs:{\"array\":_vm.params.uBounds.min,\"label\":\"uMin\"},on:{\"update:array\":function($event){return _vm.$set(_vm.params.uBounds, \"min\", $event)}}}),_c('ArrayInput',{ref:\"uMax\",staticClass:\"ml-2\",staticStyle:{\"flex\":\"1 0 auto\",\"width\":\"0px\"},attrs:{\"array\":_vm.params.uBounds.max,\"label\":\"uMax\"},on:{\"update:array\":function($event){return _vm.$set(_vm.params.uBounds, \"max\", $event)}}})],1),_vm._l((_vm.params.anchors),function(anchor,idx){return _c('div',{key:(\"anchor_\" + (anchor.key || idx)),staticClass:\"mb-3\",staticStyle:{\"display\":\"flex\",\"align-items\":\"center\"}},[_c('ValueInput',{ref:(\"time_\" + idx),refInFor:true,staticStyle:{\"flex\":\"0 0 auto\",\"width\":\"48px\"},attrs:{\"value\":anchor.t,\"label\":\"t\"},on:{\"update:value\":function($event){return _vm.$set(anchor, \"t\", $event)}}}),_c('ArrayInput',{ref:(\"anchor_\" + idx),refInFor:true,staticClass:\"ml-2\",staticStyle:{\"flex\":\"1 0 auto\",\"width\":\"0px\"},attrs:{\"array\":anchor.x,\"label\":\"x\"},on:{\"update:array\":function($event){return _vm.$set(anchor, \"x\", $event)}}}),_c('v-btn',{attrs:{\"icon\":\"\",\"color\":\"red\"},on:{\"click\":function($event){return _vm.deleteAnchor(idx)}}},[_c('v-icon',[_vm._v(\"mdi-delete\")])],1)],1)}),_c('v-btn',{attrs:{\"outlined\":\"\",\"color\":\"green\"},on:{\"click\":_vm.addAnchor}},[_vm._v(\"+ add\")]),_c('v-btn',{staticClass:\"mt-2\",attrs:{\"outlined\":\"\",\"disabled\":_vm.running,\"loading\":_vm.running,\"color\":\"primary\"},on:{\"click\":_vm.runCollocation}},[_vm._v(\"run collocation\")]),_c('v-btn',{staticClass:\"mt-2\",attrs:{\"outlined\":\"\",\"color\":\"primary\"},on:{\"click\":_vm.download}},[_vm._v(\"Download\")])],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import _ from 'lodash'\nimport nlopt from '@nlopt'\nimport eig from '@eigen'\n\n/**\n * Direct collocation params\n * @param {Number} nPts \n * @param {Number} uBounds {min, max} \n * @param {Array} anchors [{t in [0, 1], x}]\n */\nconst defaultParams = {\n  maxTime: 60,\n  maxEval: 1e6\n}\n\nclass DirectCollocation {\n  static FREE = NaN;\n\n  /**\n   * \n   * @param {Object} system \n   */\n  constructor(system) {\n    this.system = system\n  }\n\n  setParams(params) {\n    // Control params\n    console.assert(params.nPts >= 2, \"The number of points must be positive\")\n    this.params = {\n      ...defaultParams,\n      ...params\n    }\n    this.n = params.nPts\n    // Compute dimensionality\n    this.shape = this.system.shape\n    this.dim = (this.shape[0] + this.shape[1]) * this.n + 1\n    const algorithm = nlopt.Algorithm.LD_SLSQP;\n    this.opt = new nlopt.Optimize(algorithm, this.dim)\n\n    // Set objective\n    this.opt.setMinObjective((x, grad) => {\n      const tEnd = x[this.dim - 1]\n      if (grad) {\n        for (let k = 0; k < this.dim - 1; k++) {\n          grad[k] = 0\n        }\n        grad[this.dim - 1] = 1\n      }\n      return tEnd\n    }, 1e-5);\n\n    // Add dynamic constraint\n    this.addDynamicContraints()\n\n    // Set bounds\n    this.setBounds(params.uBounds, params.anchors)\n  }\n\n  delete() {\n    nlopt.GC.flush()\n  }\n\n  setBounds(uBounds, anchors) {\n    const lower = []\n    const upper = []\n    const x0 = []\n    const uIdx = this.n * this.shape[0]\n    const tIdx = this.dim - 1\n    const INF = 1e500;\n    function setPoint(low, hight, x) {\n      lower.push(low)\n      upper.push(hight)\n      x0.push(x)\n    }\n    for (let k = 0; k < this.dim; k++) {\n      if (k < uIdx) {\n        // x\n        setPoint(-INF, INF, 0)\n      } else if (k < tIdx) {\n        // u\n        const min = uBounds.min[(k - uIdx) % this.shape[1]]\n        const max = uBounds.max[(k - uIdx) % this.shape[1]]\n        setPoint(min, max, (min + max) / 2)\n      } else {\n        // tEnd\n        setPoint(0.1, INF, 1)\n      }\n    }\n    // Add anchors\n    anchors.forEach(a => {\n      const idx = _.clamp(Math.floor(a.t * this.n), 0, this.n - 1) * this.shape[0]\n      console.log(a.x)\n      for (let k = 0; k < this.shape[0]; k++) {\n        if (!isNaN(a.x[k])) {\n          upper[idx + k] = a.x[k];\n          lower[idx + k] = a.x[k];\n          x0[idx + k] = a.x[k];\n        }\n      }\n    })\n    // TODO: add initial guess\n    this.opt.setLowerBounds(lower)\n    this.opt.setUpperBounds(upper)\n    this.x0 = x0\n  }\n\n  getVector(arr, idx, len) {\n    const vec = new eig.Matrix(len, 1)\n    for (let k = 0; k < len; k++) {\n      vec.set(k, arr[idx + k])\n    }\n    return vec\n  }\n\n  // res[nConst] = function(x)\n\n  constraint(x, grad, res, iTol = 0) {\n    // Not useful if put back in function below\n    const nx = this.shape[0]\n    const nu = this.shape[1]\n    const nConst = (this.n - 1) * nx\n\n    const a = Date.now()\n    // Retreive initial values\n    const dhdt = 1 / (this.n - 1)\n    const h = x[this.dim - 1] * dhdt\n    let xkIdx = 0\n    let ukIdx = nx * this.n;\n    let xk = this.getVector(x, 0, nx);\n    let uk = this.getVector(x, nx * this.n, nu)\n    let fk = this.system.dynamics(xk, uk);\n\n    // Derivatives initial values\n    let Jxk = grad ? this.system.xJacobian(xk, uk) : null;\n    let Juk = grad ? this.system.uJacobian(xk, uk) : null;\n\n\n    // console.log('## ITER')\n    // const xc = []\n    // x.forEach(val => xc.push(val))\n    // console.log('x', xc)\n    // console.log('JS ', x[0], x[1], x[this.dim - 2], x[this.dim - 1]);\n\n    // Zero-out gradient\n    if (grad) {\n      for (let i = 0; i < nConst * this.dim; i++) {\n        grad[i] = 0;\n      }\n    }\n\n    // Loop for all colocation points\n    let max = 0\n    for (let k = 0; k < this.n - 1; k++) {\n      const xkn = this.getVector(x, xkIdx + nx, nx)\n      const ukn = this.getVector(x, ukIdx + nu, nu);\n      const fkn = this.system.dynamics(xkn, ukn);\n      // Compute collocation point\n      const xck = xk.matAdd(xkn).div(2).matAdd(fk.matSub(fkn).mul(h / 8));\n      const uck = uk.matAdd(ukn).div(2);\n      const fck = this.system.dynamics(xck, uck);\n      // Add constraint\n      const c = xk.matSub(xkn).matAdd(fk.matAdd(fck.mul(4)).matAdd(fkn).mul(h / 6))\n      for (let i = 0; i < nx; i++) {\n        const cIdx = k * nx + i;\n        if (iTol !== 0) {\n          res[cIdx] = - Math.sign(iTol) * c.get(i);\n        } else {\n          res[cIdx] = c.get(i);\n        }\n        max = Math.max(max, Math.pow(c.get(i), 2))\n      }\n\n      // Compute jacobians\n      if (grad) {\n        let Jxkn = this.system.xJacobian(xkn, ukn)\n        let Jukn = this.system.uJacobian(xkn, ukn)\n        let Jxck = this.system.xJacobian(xck, uck)\n        let Juck = this.system.uJacobian(xck, uck)\n        // Compute derivatives\n        const Inx = eig.Matrix.identity(nx, nx)\n        const dXckdXk = Inx.div(2).matAdd(Jxk.mul(h / 8))\n        const dXckdXkn = Inx.div(2).matSub(Jxkn.mul(h / 8))\n        const dXckdUk = Juk.mul(h / 8)\n        const dXckdUkn = Jukn.mul(-h / 8)\n        const dXckdH = fk.matSub(fkn).div(8)\n        // Cost derivatives\n        const dCdXk = Inx.matAdd(Jxk.matAdd(Jxck.matMul(dXckdXk).mul(4)).mul(h / 6))\n        const dCdXkn = Inx.mul(-1).matAdd(Jxkn.matAdd(Jxck.matMul(dXckdXkn).mul(4)).mul(h / 6))\n        const dCdUk = Juk.matAdd(Jxck.matMul(dXckdUk).mul(4)).matAdd(Juck.mul(2)).mul(h / 6)\n        const dCdUkn = Jukn.matAdd(Jxck.matMul(dXckdUkn).mul(4)).matAdd(Juck.mul(2)).mul(h / 6)\n        const dCdH = fk.matAdd(fck.mul(4)).matAdd(fkn).div(6).matAdd(Jxck.matMul(dXckdH).mul(h * 4 / 6))\n        // Populate gradients\n        for (let i = 0; i < nx; i++) {\n          const cIdx = k * nx + i;\n          // Handle x values\n          for (let j = 0; j < nx; j++) {\n            grad[cIdx * this.dim + xkIdx + j] = dCdXk.get(i, j)\n            grad[cIdx * this.dim + xkIdx + nx + j] = dCdXkn.get(i, j)\n          }\n          // Handle u values\n          for (let j = 0; j < nu; j++) {\n            grad[cIdx * this.dim + ukIdx + j] = dCdUk.get(i, j)\n            grad[cIdx * this.dim + ukIdx + nu + j] = dCdUkn.get(i, j)\n          }\n          // Handle t\n          grad[cIdx * this.dim + this.dim - 1] = dCdH.get(i, 0) * dhdt\n        }\n        // Propagate values\n        Jxk = Jxkn;\n        Juk = Jukn;\n      }\n\n      // Propagate values\n      xk = xkn;\n      uk = ukn;\n      fk = fkn;\n      xkIdx += nx;\n      ukIdx += nu;\n\n\n      // TEMP\n      // console.log(`${k} -------`)\n      // xk.print(`xk ${k}`)\n      // xkn.print(`xkn ${k} (idx ${xknIdx})`)\n      // xck.print(`xck ${k}`)\n      // uk.print(`uk ${k}`)\n      // ukn.print(`ukn ${k} (idx ${uknIdx})`)\n      // uck.print(`uck ${k}`)\n      // fk.print(`fk ${k}`)\n      // fkn.print(`fkn ${k}`)\n      // fck.print(`fck ${k}`)\n\n\n\n    }\n    console.log('iteration time', Date.now() - a);\n\n    // TEMP\n\n\n    // if (grad)\n    // console.log('JS ', grad[0], grad[nConst * this.dim - 1]);\n    // console.log('JS RES', res[0], res[nConst - 1])\n\n    // if (iter++ % 100 == 0)\n    //   console.log(`Iteration ${iter}; max constraint ${max}`)\n    // eig.GC.flush()\n    // console.log('elapsed', new Date() - d, 'ms')\n  }\n\n  testGrad() {\n    const nx = this.shape[0]\n    const nu = this.shape[1]\n    const nConst = (this.n - 1) * nx\n    const x0 = [...Array(this.dim)].map((_, idx) => idx + 1)\n    const grad0 = [...Array(this.dim * nConst)].map(() => 0)\n    const ret0 = [...Array(nConst)].map(() => 0)\n    this.constraint(x0, grad0, ret0)\n\n    const eps = 1e-8\n    const nGrad = [...Array(this.dim * nConst)].map(() => 0)\n    for (let k = 0; k < this.dim; k++) {\n      const x = [...x0]\n      const grad = [...grad0].map(() => 0)\n      const ret = [...ret0].map(() => 0);\n      x[k] += eps;\n      this.constraint(x, grad, ret)\n      for (let l = 0; l < nConst; l++) {\n        nGrad[l * this.dim + k] = (ret[l] - ret0[l]) / eps\n      }\n    }\n    // Test gradients\n    const diff = []\n    for (let k = 0; k < this.dim * nConst; k++) {\n      diff.push(Math.abs(nGrad[k] - grad0[k]) < 1e-4 ? 0 : nGrad[k] - grad0[k])\n    }\n    console.log('function tested')\n    console.log('x0', x0)\n    console.log('ret0', ret0)\n    console.log('grad0', grad0)\n    console.log('grad', nGrad)\n    console.log('diff', diff)\n  }\n\n  addDynamicContraints() {\n    const [nx, nu] = this.shape;\n    const nConst = (this.n - 1) * nx\n    const tolVec = [...Array(nConst)].map(() => 1e-4);\n    this.opt.addEqualityMConstraint((x, grad, res) => {\n      this.constraint(x, grad, res);\n    }, tolVec);\n    // const tolVec2 = nlopt.Vector.fromArray([...Array(nConst)].map(() => 1e-4))\n    // this.opt.addInequalityMConstraint(nlopt.VectorFunction.fromLambda((x, grad, res) => {\n    //   this.constraint(x, grad, res, -1);\n    // }), tolVec2)\n  }\n\n  optimize() {\n    this.opt.setMaxtime(this.params.maxTime)\n    this.opt.setMaxeval(this.params.maxEval)\n    const res = this.opt.optimize(this.x0)\n    console.log('Optimization returned ', res, res.x)\n    if (!res.success) {\n      console.log('Optimization failed')\n      return null\n    }\n    let [xList, uList, tEnd] = this.unpack(res.x)\n    console.log('tEnd', tEnd);\n    let arr = xList.map((x, idx) => {\n      return new eig.Matrix(x).vcat(new eig.Matrix(uList[idx]))\n    })\n    tEnd = Math.max(tEnd, 0.1); // Safeguard for hold loop\n    const dt = tEnd / xList.length;\n    // Array hold\n    const first = eig.Matrix(arr[0]);\n    const last = eig.Matrix(arr[arr.length - 1]);\n    const [nx, nu] = this.shape;\n    for (let k = nx; k < nx + nu; k++) {\n      first.set(k, 0);\n      last.set(k, 0);\n    }\n    for (let k = 0; k < this.params.holdTime / dt; k++) {\n      arr.unshift(first);\n      arr.push(last);\n    }\n    // Array reverse\n    if (this.params.reverse) {\n      arr = this.system.reverse(arr)\n    }\n    return { x: arr, dt }\n  }\n\n  unpack(vector) {\n    const xList = []\n    const uList = []\n    let tEnd = vector[this.dim - 1]\n    const uIdx = this.n * this.shape[0]\n    const tIdx = this.dim - 1\n    function slice(idx, len) {\n      return [...Array(len)].map((_, k) => vector[idx + k])\n    }\n    for (let k = 0; k < uIdx; k += this.shape[0]) {\n      xList.push(slice(k, this.shape[0]))\n    }\n    for (let k = uIdx; k < this.dim - 1; k += this.shape[1]) {\n      uList.push(slice(k, this.shape[1]))\n    }\n    return [xList, uList, tEnd]\n  }\n}\n\nexport default DirectCollocation","import _ from 'lodash';\nimport eig from \"@eigen\";\n\nclass Trajectory {\n  /**\n   * Constructor\n   * @param {Bool} loop whether the time wraps around\n   */\n  constructor(system, loop = true) {\n    this.array = [];\n    this.loop = loop;\n    this.watchers = new Set();\n    this.system = system;\n  }\n\n  getLegend() {\n    return this.system.statesCommands;\n  }\n\n  /**\n   * Check if the interoplator is ready\n   */\n  ready() {\n    return this.array.length > 0;\n  }\n\n  /**\n   * Return trajectory dimension\n   */\n  dim() {\n    return !this.ready() ? 0 : this.array[0].rows();\n  }\n\n  /**\n   * Reset starting time\n   */\n  reset(t) {\n    this.tStart = t; // Date.now() / 1000\n  }\n\n  /**\n   * Clear traj\n   */\n  clear() {\n    this.array = [];\n  }\n\n  /**\n   * Add update callback\n   */\n  addWatcher(fun) {\n    this.watchers.add(fun);\n  }\n\n  /**\n   * Add update callback\n   */\n  removeWatcher(fun) {\n    this.watchers.delete(fun);\n  }\n\n  /**\n   * Create a trajectory based on an array of matrices\n   * @param {Array} array of matrices\n   * @param {Number} dt \n   */\n  set(array, dt) {\n    eig.GC.popException(this.array);\n    console.assert(dt > 0, 'The time must be positive');\n    console.assert(array.length > 0, 'The array must have at least one element');\n    // Control array content\n    const rows = this.system.shape[0] + this.system.shape[1];\n    array.forEach(val => {\n      console.assert(val.rows() === rows && val.cols() === 1,\n        `The values must be of shape [x; u]; expected ${[rows, 1]}, got ${[val.rows(), val.cols()]}`);\n    });\n    eig.GC.set(this, 'array', array);\n    this.dt = dt;\n    this.tStart = 0; //Date.now() / 1000\n    this.duration = (this.array.length - 1) * this.dt;\n    this.watchers.forEach(fun => fun());\n  }\n\n  /**\n   * Get interpolated value\n   * @param {Number} t time of interpolation\n   */\n  get(t) {\n    t -= this.tStart;\n    // t -= Math.floor(t / this.duration) * this.duration\n    let idx = Math.max(0, Math.floor(t / this.dt));\n    idx = this.loop ? idx % this.array.length : Math.min(this.array.length - 1, idx);\n    var nextIdx = (idx + 1) % this.array.length;\n    if (!this.loop && nextIdx < idx) nextIdx = idx;\n    let ratio = (t - idx * this.dt) / this.dt;\n    ratio -= Math.floor(ratio);\n    return this.array.length < 2 ?\n      this.array[0] :\n      this.array[idx].mul(1 - ratio).matAdd(this.array[nextIdx].mul(ratio));\n  }\n\n  /**\n   * Get interpolated state\n   * @param {Number} t \n   */\n  getState(t) {\n    return this.get(t).block(0, 0, this.system.shape[0], 1);\n  }\n\n  /**\n   * Get interpolated command\n   * @param {Number} t \n   */\n  getCommand(t) {\n    return this.get(t).block(this.system.shape[0], 0, this.system.shape[1], 1);\n  }\n\n  /**\n   * Delete trajectory\n   */\n  delete() {\n    eig.GC.popException(this.array);\n    this.array = null;\n  }\n\n  /**\n   * Load trajectory from a dump\n   * @param {Object} dump \n   */\n  load(dump) {\n    this.set(dump.x.map(x => new eig.Matrix(x)), dump.dt);\n  }\n\n  /**\n   * Get a string version of the trajectory\n   */\n  dump() {\n    let rows = `dt: ${this.dt},\\n` + 'x: [';\n    this.array.forEach((vec, idx) => {\n      rows += '[';\n      for (let k = 0; k < vec.length(); k += 1) {\n        rows += `${vec.get(k).toFixed(4)}` + (k < vec.length() - 1 ? ',' : '');\n      }\n      rows += ']' + (idx === this.array.length - 1 ? ']' : ',\\n');\n    });\n    return rows;\n  }\n}\n\n/**\n * Test // TODO: use a test framework TODO: refactor\n */\nfunction testTrajectory() {\n  const array = [1, 2, 3, 7];\n  const ip = new Trajectory(array, 0.5);\n  let val = [ip.get(0), ip.get(1), ip.get(1.5), ip.get(0.25)];\n  let expected = [1, 3, 7, 1.5];\n  console.assert(_.isEqual(val, expected), `Expected ${expected}, got ${val}`);\n  console.log('Test successful');\n}\n\nexport default Trajectory;","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"pa-2\",staticStyle:{\"display\":\"flex\",\"flex-direction\":\"column\"}},[_c('div',{staticClass:\"mb-2\",staticStyle:{\"display\":\"flex\",\"align-items\":\"center\"}},[_c('v-divider',{staticClass:\"mr-2\"}),_c('span',[_vm._v(_vm._s(_vm.title))]),_c('v-divider',{staticClass:\"ml-2\"})],1),_vm._t(\"default\")],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\n  div.pa-2(style='display: flex; flex-direction: column')\n    div.mb-2(style='display: flex; align-items: center')\n      v-divider.mr-2\n      span {{ title }}\n      v-divider.ml-2\n    slot\n</template>\n\n<script>\nexport default {\n  props: {\n    title: String\n  }\n};\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Section.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Section.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Section.vue?vue&type=template&id=747ad2b8&lang=pug&\"\nimport script from \"./Section.vue?vue&type=script&lang=js&\"\nexport * from \"./Section.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VDivider } from 'vuetify/lib/components/VDivider';\ninstallComponents(component, {VDivider})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-text-field',{attrs:{\"label\":_vm.label,\"outlined\":\"\",\"dense\":\"\",\"hide-details\":\"\"},model:{value:(_vm.model),callback:function ($$v) {_vm.model=$$v},expression:\"model\"}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\nv-text-field(v-model=\"model\", :label=\"label\", outlined, dense, hide-details)\n</template>\n\n<script>\nexport default {\n  props: {\n    array: Array,\n    label: String,\n  },\n\n  data: () => ({\n    model: \"\",\n    error: null,\n  }),\n\n  created() {\n    this.model = this.arrToStr(this.array);\n  },\n\n  watch: {\n    model() {\n      this.parseModel();\n    },\n  },\n\n  methods: {\n    validate() {\n      if (this.error) {\n        this.$bus.notify(\"error\", this.error);\n      }\n      return !this.error;\n    },\n\n    parseModel() {\n      this.error = null;\n      try {\n        const arr = this.strToArr(this.model);\n        if (arr.length !== this.array.length) {\n          this.error = `The array \"${this.label}\" [${this.model}] should have ${this.array.length} elements`;\n        } else {\n          this.$emit(\"update:array\", arr);\n        }\n      } catch (e) {\n        this.error = `The array \"${this.label}\" [${this.model}] could not be parsed`;\n      }\n    },\n\n    strToArr(str) {\n      return str.split(\",\").map((i) => parseFloat(i));\n    },\n\n    arrToStr(arr) {\n      return arr.join(\", \");\n    },\n  },\n};\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ArrayInput.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ArrayInput.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ArrayInput.vue?vue&type=template&id=87771f92&lang=pug&\"\nimport script from \"./ArrayInput.vue?vue&type=script&lang=js&\"\nexport * from \"./ArrayInput.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VTextField } from 'vuetify/lib/components/VTextField';\ninstallComponents(component, {VTextField})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-text-field',{attrs:{\"label\":_vm.label,\"outlined\":\"\",\"dense\":\"\",\"hide-details\":\"\"},model:{value:(_vm.model),callback:function ($$v) {_vm.model=_vm._n($$v)},expression:\"model\"}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\n  v-text-field(v-model.number='model'\n               :label='label'\n               outlined\n               dense\n               hide-details)\n</template>\n\n<script>\nexport default {\n  props: {\n    value: Number,\n    label: String\n  },\n\n  data: () => ({\n    model: 0,\n    error: null\n  }),\n\n  created() {\n    this.model = this.value;\n  },\n\n  watch: {\n    model() {\n      this.parseModel();\n    }\n  },\n\n  methods: {\n    validate() {\n      if (this.error) {\n        this.$bus.notify(\"error\", this.error);\n      }\n      return !this.error;\n    },\n\n    parseModel() {\n      this.error = null;\n      if (isNaN(parseFloat(this.model))) {\n        this.error = `The value \"${this.label}\" should be defined`;\n      } else {\n        this.$emit(\"update:value\", this.model);\n      }\n    }\n  }\n};\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ValueInput.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ValueInput.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ValueInput.vue?vue&type=template&id=7aad3242&lang=pug&\"\nimport script from \"./ValueInput.vue?vue&type=script&lang=js&\"\nexport * from \"./ValueInput.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VTextField } from 'vuetify/lib/components/VTextField';\ninstallComponents(component, {VTextField})\n","export default {\n  data: () => ({\n    active: false\n  }),\n\n  computed: {\n    name() {\n      return this.$options.name\n    },\n\n    mouseTargetEnabled() {\n      return true; // Override if needed\n    }\n  },\n\n  methods: {\n    createGraphics(two) {\n      // Override if needed\n    },\n\n    update(t, dt) {\n      // Override if needed\n    },\n\n    stepSystem() {\n      // Override if needed\n      return true;\n    },\n\n    reset() {\n      throw new Error('must be overridden')\n    },\n\n    ready() {\n      throw new Error('must be overridden')\n    },\n\n    updateSystem(t, dt) {\n      throw new Error('must be overridden')\n    }\n  }\n}","<template lang=\"pug\">\nSection(title='Direct Collocation')\n  ValueInput(ref='nPts'\n              :value.sync='params.nPts'\n              label='Point count')\n  div.mb-3.mt-3(style='display: flex; align-items: center')\n    ArrayInput(ref='uMin'\n               style='flex: 1 0 auto; width: 0px'\n               :array.sync='params.uBounds.min'\n               label='uMin')\n    ArrayInput.ml-2(ref='uMax'\n               style='flex: 1 0 auto; width: 0px'\n               :array.sync='params.uBounds.max'\n               label='uMax')\n  div.mb-3(v-for='anchor, idx in params.anchors'\n           :key='`anchor_${anchor.key || idx}`'\n           style='display: flex; align-items: center')\n    ValueInput(:ref='`time_${idx}`'\n               style='flex: 0 0 auto; width: 48px'\n               :value.sync='anchor.t'\n               label='t')\n    ArrayInput.ml-2(:ref='`anchor_${idx}`'\n               style='flex: 1 0 auto; width: 0px'\n               :array.sync='anchor.x'\n               label='x')\n    v-btn(icon\n          color='red'\n          @click='deleteAnchor(idx)')\n      v-icon mdi-delete\n  v-btn(@click='addAnchor'\n        outlined\n        color='green') + add\n  v-btn.mt-2(@click='runCollocation'\n             outlined\n             :disabled='running'\n             :loading='running'\n             color='primary') run collocation\n  v-btn.mt-2(@click='download'\n             outlined\n             color='primary') Download\n</template>\n\n<script>\nimport DirectCollocation from \"@/components/planners/directCollocation.js\";\nimport Trajectory from \"@/components/planners/trajectory.js\";\nimport Section from \"@/components/environments/utils/Section.vue\";\nimport ArrayInput from \"@/components/environments/utils/ArrayInput.vue\";\nimport ValueInput from \"@/components/environments/utils/ValueInput.vue\";\nimport eig from \"@eigen\";\nimport _ from \"lodash\";\nimport pluginMixin from \"@/components/environments/pluginMixin.js\";\n\nexport default {\n  name: \"DirectCollocationPlugin\",\n\n  mixins: [pluginMixin],\n\n  components: {\n    Section,\n    ArrayInput,\n    ValueInput\n  },\n\n  props: {\n    system: Object,\n    disableMouse: Boolean,\n  },\n\n  data: () => ({\n    collocation: null,\n    running: false,\n    simTraj: null,\n    params: {}\n  }),\n\n  computed: {\n    trajectories() {\n      return [this.simTraj];\n    },\n\n    mouseTargetEnabled() {\n      return !this.disableMouse;\n    }\n  },\n\n  created() {\n    this.params = _.cloneDeep(this.system.directCollocationParams());\n    this.collocation = new DirectCollocation(this.system);\n    this.simTraj = new Trajectory(this.system, true);\n    if (this.params.traj) {\n      this.simTraj.load(this.params.traj);\n      this.reset();\n    }\n  },\n\n  methods: {\n    reset() {\n      if (this.simTraj.ready()) {\n        const x0 = this.simTraj.getState(0);\n        this.system.setState(x0);\n      }\n    },\n\n    ready() {\n      return this.simTraj.ready();\n    },\n\n    updateSystem(t, dt) {\n      if (this.ready()) {\n        const u = this.simTraj.getCommand(t);\n        const x = this.simTraj.getState(t);\n        this.system.setState(x);\n        return { u };\n      }\n    },\n\n    addAnchor() {\n      const nx = this.system.shape[0];\n      const x0 = [...Array(nx)].map(() => 0);\n      this.params.anchors.push({ t: 0, x: x0, key: Math.random() });\n    },\n\n    deleteAnchor(idx) {\n      this.params.anchors.splice(idx, 1);\n    },\n\n    runCollocation() {\n      // Get from system\n      this.running = true;\n      setTimeout(() => {\n        this.optimize();\n        this.running = false;\n        this.$emit(\"activate\", this);\n      }, 25);\n    },\n\n    optimize() {\n      // Parse parameters\n      const validation = _.values(this.$refs)\n        .filter(input => input.validate)\n        .map(input => input.validate());\n      if (_.every(validation)) {\n        this.collocation.setParams(this.params);\n        const rtn = this.collocation.optimize();\n        if (rtn) {\n          this.simTraj.set(rtn.x, rtn.dt);\n          this.reset();\n        } else {\n          this.$bus.notify(\"error\", \"Optimization failed\");\n        }\n      }\n    },\n\n    download() {\n      const dump = this.simTraj.dump();\n      console.log(dump);\n      navigator.clipboard.writeText(dump).then(function() {\n        console.log('Async: Copying to clipboard was successful!');\n      }, function(err) {\n        console.error('Async: Could not copy text: ', err);\n      });\n    }\n  }\n};\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DirectCollocationPlugin.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DirectCollocationPlugin.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./DirectCollocationPlugin.vue?vue&type=template&id=108a10e4&lang=pug&\"\nimport script from \"./DirectCollocationPlugin.vue?vue&type=script&lang=js&\"\nexport * from \"./DirectCollocationPlugin.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\ninstallComponents(component, {VBtn,VIcon})\n","<template lang='pug'>\ndiv(ref=\"canvas\"\n    :style='canvasStyle')\n  .canvas(ref=\"canvas\")\n  DirectCollocationPlugin(\n    v-show=\"false\",\n    ref=\"plugin\",\n    :system=\"system\",\n    @activate=\"() => {}\",\n    :disableMouse='true'\n  )\n</template>\n\n<script>\nimport ModelLayout from \"@/components/models/ModelLayout.vue\";\nimport worldMixin from \"@/components/worldMixin.js\";\nimport systemMixin from \"@/components/systemMixin.js\";\nimport DirectCollocationPlugin from \"@/components/environments/DirectCollocation/DirectCollocationPlugin.vue\";\nimport Systems from \"@/components/models/systems.js\";\n\nexport default {\n  name: \"demo\",\n\n  components: {\n    ModelLayout,\n    DirectCollocationPlugin,\n  },\n\n  mixins: [worldMixin, systemMixin],\n\n  props: {\n    systemName: String,\n  },\n\n  data: () => ({}),\n\n  created() {\n    const SysClass = Systems.cartPole;\n    this.system = new SysClass();\n  },\n\n  mounted() {},\n\n  computed: {\n    canvas() {\n      return this.$refs.canvas;\n    },\n\n    scale() {\n      return 96;\n    },\n\n    dt() {\n      return 1 / 60;\n    },\n\n    canvasStyle() {\n      // const translateY = -this.sheetHeight / 2; // this.sheet ? -this.sheetHeight / 2 : 0;\n      return {\n        // position: \"relative\",\n        width: `100%`,\n        // height: `${this.$store.windowSize.y}px`,\n        // transform: `translateY(${translateY}px)`,\n        background:\n          'url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAATUlEQVRYR+3VMQoAMAhD0Xq3HNs75QgtdOqsg1C+u5C8JWF7r8ELAiCAAAIIIIBARyAz75BLKg96a47HA5RrP48tAQIggAACCCDwhcABvG5/oRsc6n0AAAAASUVORK5CYII=\")',\n        // background: 'white',\n        center: \"center\",\n        display: \"flex\",\n        \"flex-direction\": \"row\",\n        \"justify-content\": \"center\",\n        \"align-items\": \"center\",\n      };\n    },\n  },\n\n  methods: {\n    reset() {\n      worldMixin.methods.reset.call(this);\n      systemMixin.methods.reset.call(this);\n    },\n  },\n};\n</script>\n\n<style>\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Demo.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Demo.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Demo.vue?vue&type=template&id=b5cc9134&lang=pug&\"\nimport script from \"./Demo.vue?vue&type=script&lang=js&\"\nexport * from \"./Demo.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<template lang=\"pug\">\ndiv(style=\"display: flex; flex-direction: column; align-items: center\")\n  div(:style=\"divStyle\")\n    Demo(style=\"position: absolute\")\n    div(style=\"position: absolute; display: flex; width: 100%;justify-content: center\")\n      span.display-1.blue--text(style=\"margin-top: 32px\") Controls JS\n  div(\n    style=\"width: 100%; max-width: 960px; padding: 40px\",\n    v-html=\"markdownHtml\"\n  )\n</template>\n\n<script>\nimport markdown from \"!raw-loader!../../README.md\";\nimport MarkdownIt from \"markdown-it\";\nimport Demo from \"./Demo.vue\";\n\nexport default {\n  components: {\n    Demo,\n  },\n\n  data: () => ({\n    markdown,\n  }),\n\n  computed: {\n    markdownHtml() {\n      const highlight = function (str, lang) {\n        return (\n          '<pre class=\"hljs\"><span>' +\n          md.utils.escapeHtml(str) +\n          \"</span></pre>\"\n        );\n      };\n      const md = new MarkdownIt({\n        highlight,\n        html: true,\n      });\n      return md.render(markdown);\n    },\n\n    divStyle() {\n      return {\n        width: `100%`,\n        height: `${this.$store.windowSize.y}px`,\n        position: \"relative\",\n      };\n    },\n  },\n\n  mounted() {},\n\n  methods: {},\n};\n</script>\n\n<style>\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Home.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Home.vue?vue&type=template&id=892ed2f6&lang=pug&\"\nimport script from \"./Home.vue?vue&type=script&lang=js&\"\nexport * from \"./Home.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ModelLayout',{scopedSlots:_vm._u([{key:\"canvas\",fn:function(){return [_c('div',{ref:\"canvas\",staticClass:\"canvas\"})]},proxy:true},{key:\"overlay\",fn:function(){return [_c('div',{staticStyle:{\"display\":\"flex\"}},[_c('v-chip',{staticClass:\"ma-2\",attrs:{\"label\":\"\",\"color\":\"red\",\"text-color\":\"white\"}},[_vm._v(\"Dynamic\")]),_c('v-spacer'),_c('span',{staticClass:\"ma-2\"},[_vm._v(\"fps: \"+_vm._s(_vm.fps.toFixed(0)))])],1)]},proxy:true},{key:\"drawer\",fn:function(){return [_c('LQRPlugin',{ref:\"plugin\",attrs:{\"system\":_vm.system},on:{\"activate\":function () {}}})]},proxy:true},(_vm.isMounted)?{key:\"sheet\",fn:function(){return [_c('TrajPlot',{attrs:{\"trajectories\":_vm.$refs.plugin.trajectories}})]},proxy:true}:null,{key:\"bar\",fn:function(){return [_c('v-btn',{attrs:{\"text\":\"\",\"dark\":\"\"},on:{\"click\":_vm.reset}},[_vm._v(\"reset\")])]},proxy:true}],null,true)})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticStyle:{\"width\":\"100%\",\"height\":\"100%\"}},[_c('div',{ref:\"div\",staticStyle:{\"width\":\"100%\",\"height\":\"100%\"}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\n  div(style='width: 100%; height: 100%;')\n    div(style='width: 100%; height: 100%;'\n        ref='div')\n</template>\n\n<script>\nimport Plotly from \"plotly.js-dist\";\nimport _ from \"lodash\";\n\nexport default {\n  name: \"TrajPlot\",\n\n  props: {\n    trajectories: Array // [ trajs ]\n  },\n\n  data: () => ({\n    series: [],\n  }),\n\n  computed: {},\n\n  watch: {\n    trajectories: {\n      handler(newValue, oldValue) {\n        if (oldValue) {\n          oldValue.forEach(traj => traj.removeWatcher(this.update));\n        }\n        if (newValue) {\n          newValue.forEach(traj => traj.addWatcher(this.update));\n        }\n        this.update();\n      },\n      immediate: true\n    }\n  },\n\n  mounted() {\n    const config = {\n      displaylogo: false,\n      displayModeBar: false,\n      scrollZoom: false,\n      showAxisDragHandles: false,\n      responsive: true\n    };\n    Plotly.newPlot(this.$refs.div, [], [], config);\n    this.update()\n  },\n\n  beforeDestroy() {\n    this.trajectories.forEach(traj => traj.removeWatcher(this.update));\n  },\n\n  methods: {\n    getSeries(traj, idx) {\n      const xList = [];\n      const tList = [];\n      traj.array.forEach((val, k) => {\n        tList.push(k * traj.dt);\n        xList.push(val.get(idx));\n      });\n      return [tList, xList];\n    },\n\n    update() {\n      const data = [];\n      if (!this.$refs.div) return;\n      this.trajectories.forEach((traj, trajId) => {\n        if (!traj.ready()) return;\n        const dim = traj.dim();\n        for (let idx = 0; idx < dim; idx++) {\n          const [t, x] = this.getSeries(traj, idx);\n          let name = _.get(traj.getLegend(), `[${idx}].name`, `${idx}`);\n          name = this.trajectories.length > 0 ? `t${trajId}_${name}` : name;\n          const show = _.get(traj.getLegend(), `[${idx}].show`, false);\n          data.push({\n            x: t,\n            y: x,\n            type: \"scatter\",\n            name,\n            hoverinfo: \"skip\",\n            line: { dash: trajId > 0 ? \"dashdot\" : \"solid\" },\n            visible: show || \"legendonly\"\n          });\n        }\n      });\n      const layout = {\n        xaxis: {\n          title: \"time (t)\",\n          fixedrange: true\n          //   zeroline: false\n        },\n        yaxis: {\n          fixedrange: true\n        },\n        margin: {\n          l: 40,\n          r: 100,\n          b: 60,\n          t: 30,\n          pad: 10\n        }\n        // legend: {\n        //   orientation: \"h\",\n        //   x: 0,\n        //   y: -0.1\n        // }\n      };\n      Plotly.react(this.$refs.div, data, layout);\n    }\n  }\n};\n</script>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TrajPlot.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./TrajPlot.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TrajPlot.vue?vue&type=template&id=31e432e2&lang=pug&\"\nimport script from \"./TrajPlot.vue?vue&type=script&lang=js&\"\nexport * from \"./TrajPlot.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Section',{attrs:{\"title\":\"LQR\"}},[_c('MatrixInput',{attrs:{\"matrix\":_vm.params.Q,\"label\":\"Q\"}}),_c('MatrixInput',{staticClass:\"mt-2\",attrs:{\"matrix\":_vm.params.R,\"label\":\"R\"}}),_c('ValueInput',{staticClass:\"mt-3\",attrs:{\"value\":_vm.params.simDuration,\"label\":\"Sim duration\"},on:{\"update:value\":function($event){return _vm.$set(_vm.params, \"simDuration\", $event)}}}),_c('ValueInput',{staticClass:\"mt-3\",attrs:{\"value\":_vm.params.simEps,\"label\":\"Sim disturbance\"},on:{\"update:value\":function($event){return _vm.$set(_vm.params, \"simEps\", $event)}}}),_c('div',{staticClass:\"mt-3\",staticStyle:{\"display\":\"flex\",\"align-items\":\"center\"}},[_c('v-checkbox',{staticClass:\"pa-0 pb-4\",attrs:{\"label\":\"Auto disengage\",\"hide-details\":\"\",\"small\":\"\"},model:{value:(_vm.params.disengage),callback:function ($$v) {_vm.$set(_vm.params, \"disengage\", $$v)},expression:\"params.disengage\"}}),_c('v-btn',{staticClass:\"ml-3\",attrs:{\"outlined\":\"\",\"color\":\"red\",\"disabled\":_vm.enabled},on:{\"click\":function($event){_vm.enabled = true}}},[_vm._v(\"Engage\")])],1),_c('v-btn',{staticClass:\"mt-2\",attrs:{\"outlined\":\"\",\"color\":\"primary\"},on:{\"click\":_vm.runLQR}},[_vm._v(\"update LQR\")])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import eig from '@eigen'\n\nclass Controller {\n  constructor(system) {\n    this.system = system\n  }\n}\n\nexport default Controller","import eig from '@eigen'\nimport Model from './model.js'\n\nclass LinearSystem extends Model {\n  constructor(x0, u0, A, B, states, commands) {\n    super(states, commands, {})\n    eig.GC.set(this, 'x0', x0)\n    eig.GC.set(this, 'u0', u0)\n    eig.GC.set(this, 'A', A)\n    eig.GC.set(this, 'B', B)\n  }\n\n  delete() {\n    ['x0', 'u0', 'A', 'B'].forEach(k => eig.GC.popException(this[k]))\n  }\n\n  trim() {\n    return { x: new eig.Matrix(this.shape[0], 1), u: new eig.Matrix(this.shape[1], 1) }\n  }\n\n  /**\n   * Returns dx/dt\n   * @param {Matrix} x\n   * @param {Matrix} u\n   * @returns {Matrix} dx\n   */\n  dynamics(x, u) {\n    const dx = x.matSub(this.x0)\n    const du = u.matSub(this.u0)\n    return this.A.matMul(dx).matAdd(this.B.matMul(du))\n  }\n\n  /**\n   * Create linear system from system\n   * @param {Object} system \n   * @param {Matrix} x0 \n   * @param {Matrix} u0 \n   */\n  static fromModel(system, x0, u0) {\n    const [Jx, Ju] = LinearSystem.linearizeSystem(system, x0, u0)\n    return new LinearSystem(x0, u0, Jx, Ju, system.states, system.commands)\n  }\n\n  /**\n   * Linearize function about x0\n   * @param {Function} fun function of interest\n   * @param {Matrix} x0 equilibrium state\n   * @returns {Matrix} A (df/dx at x0)\n   */\n  static linearize(fun, x0) {\n    const eps = 1e-8\n    const dx0 = fun(x0);\n    const [m, n] = [dx0.rows(), x0.rows()]\n    // TODO: extract in C lib ?\n    function setCol(mat, row, vec) {\n      for (let k = 0; k < vec.rows(); k++) {\n        mat.set(k, row, vec.get(k))\n      }\n    }\n    // Populate A matrix\n    let A = new eig.Matrix(m, n);\n    for (let k = 0; k < n; k += 1) {\n      const x = new eig.Matrix(x0);\n      x.set(k, x.get(k) + eps);\n      const dx = fun(x).matSub(dx0).div(eps);\n      setCol(A, k, dx);\n    }\n    return A;\n  }\n\n  /**\n   * Linearize system about x0 & u0\n   * @param {Object} system system of interest\n   * @param {Matrix} x0 equilibrium state\n   * @param {Matrix} u0 equilibrium command\n   * @returns {Matrix} [Jx, Ju]\n   */\n  static linearizeSystem(system, x0, u0) {\n    const Jx = LinearSystem.linearize(x => system.dynamics(x, u0), x0);\n    const Ju = LinearSystem.linearize(u => system.dynamics(x0, u), u0);\n    return [Jx, Ju]\n  }\n\n  /**\n   * Test jacobian functions\n   */\n  static testJacobian(system) {\n    const [xn, un] = system.shape\n    const x0 = new eig.Matrix(xn, 1);\n    for (let i = 0; i < xn; i++) {\n      x0.set(i, i * 2.8 + 13.7);\n    }\n    const u0 = new eig.Matrix(un, 1);\n    for (let i = 0; i < un; i++) {\n      u0.set(i, i * 2.8 + 13.7);\n    }\n    const [Jxn, Jun] = LinearSystem.linearizeSystem(system, x0, u0)\n    const Jx = system.xJacobian(x0, u0)\n    const Ju = system.uJacobian(x0, u0)\n    Jx.matSub(Jxn).print('Jx diff')\n    Ju.matSub(Jun).print('Ju diff')\n  }\n}\n\nexport default LinearSystem","import eig from '@eigen'\nimport _ from 'lodash'\nimport Controller from './controller.js'\nimport LinearSystem from '@/components/models/linearSystem.js'\n\nclass LQR extends Controller {\n  /**\n   * Build a LQR controller to stabilize the system around x0\n   * @param {Object} system system of interest\n   * @param {Array} x0 equilibrium state\n   * @param {Array} u0 equilibrium command\n   */\n  constructor(system, x0, u0) {\n    super(system)\n    this.system = system\n    eig.GC.set(this, 'x0', x0)\n    eig.GC.set(this, 'u0', u0)\n    const [xn, un] = this.system.shape\n  }\n\n  ready() {\n    return !!this.K\n  }\n\n  solve(params) {\n    const [Jx, Ju] = LinearSystem.linearizeSystem(this.system, this.x0, this.u0)\n    const Q = new eig.Matrix(params.Q)\n    const R = new eig.Matrix(params.R)\n    const sol = eig.Solvers.careSolve(Jx, Ju, Q, R);\n    eig.GC.set(this, 'K', sol.K)\n  }\n\n  simulate(dx, dt, duration) {\n    const xn = this.system.shape[0]\n    const x0 = this.x0.matAdd(eig.Matrix.ones(xn, 1).mul(dx))\n    const arr = this.system.simulate(this, x0, dt, duration)\n    const xu0 = this.x0.vcat(this.u0)\n    arr.forEach(x => x.matSubSelf(xu0))\n    return arr\n  }\n\n  linearSimulate(dx, dt, duration) {\n    const linsys = LinearSystem.fromModel(this.system, this.x0, this.u0)\n    const xn = this.system.shape[0]\n    const x0 = this.x0.matAdd(eig.Matrix.ones(xn, 1).mul(dx))\n    const arr = linsys.simulate(this, x0, dt, duration)\n    const xu0 = this.x0.vcat(this.u0)\n    arr.forEach(x => x.matSubSelf(xu0))\n    linsys.delete();\n    return arr\n  }\n\n  /**\n   * Get command\n   * @returns {Array} u command\n   */\n  getCommand(x, t) {\n    const delta_x = this.x0.matSub(x || this.system.x)\n    this.system.bound(delta_x)\n    return this.K.matMul(delta_x).matAdd(this.u0).clamp(-1000, 1000) // TODO: use system actuator limits\n  }\n}\n\nexport default LQR","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticStyle:{\"display\":\"flex\",\"flex-direction\":\"column\"}},[_c('div',{staticStyle:{\"display\":\"flex\",\"justify-content\":\"center\"}},[_c('span',{staticClass:\"ml-2 black--text\",staticStyle:{\"align-self\":\"center\"}},[_vm._v(_vm._s(_vm.label)+\":\")]),_c('v-spacer'),_c('v-btn',{attrs:{\"small\":\"\",\"color\":\"blue\",\"dark\":\"\",\"depressed\":_vm.diagonal,\"outlined\":!_vm.diagonal},on:{\"click\":function($event){_vm.diagonal = true}}},[_vm._v(\"diagonal\")]),_c('v-btn',{staticClass:\"ml-1\",attrs:{\"small\":\"\",\"color\":\"blue\",\"dark\":\"\",\"depressed\":!_vm.diagonal,\"outlined\":_vm.diagonal},on:{\"click\":function($event){_vm.diagonal = false}}},[_vm._v(\"full\")])],1),(_vm.matrix)?_c('div',{staticStyle:{\"display\":\"flex\",\"flex-direction\":\"column\"}},[(_vm.diagonal)?_c('ArrayInput',{staticClass:\"mt-1\",staticStyle:{\"display\":\"flex\"},attrs:{\"array\":_vm.diagArray},on:{\"update:array\":function($event){_vm.diagArray=$event}}}):_vm._l((_vm.rows),function(row){return _c('ArrayInput',{key:(\"row_\" + row),staticClass:\"mt-1\",staticStyle:{\"display\":\"flex\"},attrs:{\"array\":_vm.matrix[row - 1]},on:{\"update:array\":function($event){return _vm.$set(_vm.matrix, row - 1, $event)}}})})],2):_vm._e()])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\n  div(style='display: flex; flex-direction: column;')\n    //* Selector\n    div(style='display: flex; justify-content: center')\n      span.ml-2.black--text(style='align-self: center') {{ label }}:\n      v-spacer\n      v-btn(small\n            @click='diagonal = true'\n            color='blue'\n            dark\n            :depressed='diagonal'\n            :outlined='!diagonal') diagonal\n      v-btn.ml-1(small\n            @click='diagonal = false'\n            color='blue'\n            dark\n            :depressed='!diagonal'\n            :outlined='diagonal') full\n    //* Matrix input\n    div(v-if='matrix'\n        style='display: flex; flex-direction: column')\n      ArrayInput.mt-1(style='display: flex;'\n                 v-if='diagonal'\n                 :array.sync='diagArray')\n      ArrayInput.mt-1(v-else\n                  v-for='row in rows'\n                  :key='`row_${row}`'\n                  style='display: flex;'\n                  :array.sync='matrix[row - 1]')\n\n        //- v-text-field.ml-1.mt-1(v-for='col in cols'\n        //-             :key='`col_${col}`'\n        //-             :value='getVal(row - 1, col - 1)'\n        //-             @input='val => setVal(row - 1, col - 1, val)'\n        //-             outlined\n        //-             dense\n        //-             small\n        //-             hide-details)\n</template>\n\n<script>\nimport eig from \"@eigen\";\nimport ArrayInput from \"./ArrayInput.vue\";\n\nexport default {\n  components: {\n    ArrayInput\n  },\n\n  data: () => ({\n    diagonal: true,\n    diagArray: []\n  }),\n\n  props: {\n    matrix: Array,\n    label: String\n  },\n\n  created() {\n    this.diagArray = [...Array(this.matrix.length)].map(\n      (v, idx) => this.matrix[idx][idx]\n    );\n  },\n\n  watch: {\n    diagArray() {\n      this.diagArray.forEach((v, idx) => (this.matrix[idx][idx] = v));\n    },\n\n    diagonal() {\n      if (!this.diagonal) return;\n      // Clear off diagonal terms\n      for (let i = 0; i < this.matrix.length; i++) {\n        for (let j = i + 1; j < this.matrix[0].length; j++) {\n          this.matrix[i][j] = 0;\n          this.matrix[j][i] = 0;\n        }\n        this.diagArray[i] = this.matrix[i][i];\n      }\n    }\n  },\n\n  computed: {\n    rows() {\n      return this.diagonal ? 1 : this.matrix.length;\n    }\n\n    // cols() {\n    //   return this.matrix[0].length;\n    // }\n  },\n\n  methods: {\n    // getVal(i, j) {\n    //   if (this.diagonal) i = j;\n    //   return this.matrix[i][j];\n    // },\n    // setVal(i, j, value) {\n    //   if (this.diagonal) i = j;\n    //   const val = parseFloat(value) || 0;\n    //   this.matrix[i][j] = val;\n    // }\n  }\n};\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MatrixInput.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MatrixInput.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MatrixInput.vue?vue&type=template&id=3039d92c&lang=pug&\"\nimport script from \"./MatrixInput.vue?vue&type=script&lang=js&\"\nexport * from \"./MatrixInput.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VSpacer})\n","<template lang=\"pug\">\nSection(title='LQR')\n  MatrixInput(:matrix='params.Q'\n              label='Q')\n  MatrixInput.mt-2(:matrix='params.R'\n              label='R')\n  ValueInput.mt-3(:value.sync='params.simDuration'\n             label='Sim duration')\n  ValueInput.mt-3(:value.sync='params.simEps'\n             label='Sim disturbance')\n  div.mt-3(style='display: flex; align-items: center')\n    v-checkbox.pa-0.pb-4(v-model='params.disengage'\n                         label='Auto disengage'\n                         hide-details\n                         small)\n    v-btn.ml-3(@click='enabled = true'\n               outlined color='red'\n               :disabled='enabled') Engage\n  v-btn.mt-2(@click='runLQR'\n             outlined\n             color='primary') update LQR\n</template>\n\n<script>\nimport LQR from \"@/components/controllers/LQR.js\";\nimport Trajectory from \"@/components/planners/trajectory.js\";\nimport Section from \"@/components/environments/utils/Section.vue\";\nimport pluginMixin from \"@/components/environments/pluginMixin.js\";\nimport MatrixInput from \"@/components/environments/utils/MatrixInput.vue\";\nimport ValueInput from \"@/components/environments/utils/ValueInput.vue\";\nimport eig from \"@eigen\";\nimport _ from \"lodash\";\n\nconst DT = 1 / 60;\n\nexport default {\n  name: \"LQRPlugin\",\n\n  mixins: [pluginMixin],\n\n  components: {\n    Section,\n    MatrixInput,\n    ValueInput\n  },\n\n  props: {\n    system: Object\n  },\n\n  data: () => ({\n    controller: null,\n    linearTraj: null,\n    simTraj: null,\n    // Parameters\n    params: {},\n    enabled: true\n  }),\n\n  computed: {\n    trajectories() {\n      return [this.linearTraj, this.simTraj];\n    },\n\n    controllerEnabled() {\n      return !this.params.disengage || this.enabled;\n    }\n  },\n\n  created() {\n    const { x, u } = this.system.trim();\n    // Populate matrices\n    this.params = _.cloneDeep(this.system.lqrParams());\n    this.controller = new LQR(this.system, x, u);\n    this.simTraj = new Trajectory(this.system, false);\n    this.linearTraj = new Trajectory(this.system, false);\n    this.runLQR();\n    // Set init state if needed\n    if (this.params.x0) {\n      this.system.setState(new eig.Matrix(this.params.x0));\n    }\n  },\n\n  methods: {\n    reset() {\n      const { x } = this.system.trim();\n      this.system.setState(x);\n      this.enabled = true;\n    },\n\n    ready() {\n      return this.controllerEnabled && this.controller.ready();\n    },\n\n    updateSystem(t, dt) {\n      if (this.ready()) {\n        const u = this.controller.getCommand(this.system.x, t);\n        if (this.params.disengage && u.norm() > this.params.divergenceThres) {\n          this.enabled = false;\n        }\n        this.system.step(u, dt);\n        return { u };\n      }\n    },\n\n    runLQR() {\n      this.controller.solve(this.params);\n      // Simulate the system\n      const duration = this.params.simDuration;\n      const dx = this.params.simEps;\n      let arr = this.controller.simulate(dx, DT, duration);\n      this.simTraj.set(arr, DT);\n      arr = this.controller.linearSimulate(dx, DT, duration);\n      this.linearTraj.set(arr, DT);\n      this.$emit(\"activate\", this);\n    }\n  }\n};\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./LQRPlugin.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./LQRPlugin.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./LQRPlugin.vue?vue&type=template&id=9efc2024&lang=pug&\"\nimport script from \"./LQRPlugin.vue?vue&type=script&lang=js&\"\nexport * from \"./LQRPlugin.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCheckbox } from 'vuetify/lib/components/VCheckbox';\ninstallComponents(component, {VBtn,VCheckbox})\n","<template lang='pug'>\nModelLayout\n  template(v-slot:canvas)\n    div.canvas(ref='canvas')\n  template(v-slot:overlay)\n    div(style=\"display: flex\")\n      v-chip.ma-2(label, color=\"red\", text-color=\"white\") Dynamic\n      v-spacer\n      span.ma-2 fps: {{ fps.toFixed(0) }}\n  template(v-slot:drawer)\n    LQRPlugin(ref='plugin'\n              :system='system'\n              @activate='() => {}')\n  template(v-if='isMounted'\n           v-slot:sheet)\n    TrajPlot(:trajectories='$refs.plugin.trajectories')\n  template(v-slot:bar)\n    v-btn(text dark\n          @click='reset') reset\n</template>\n\n<script>\nimport ModelLayout from \"@/components/models/ModelLayout.vue\";\nimport worldMixin from \"@/components/worldMixin.js\";\nimport systemMixin from \"@/components/systemMixin.js\";\nimport TrajPlot from \"@/components/plots/TrajPlot.vue\";\nimport LQRPlugin from \"@/components/environments/LQR/LQRPlugin.vue\";\nimport Systems from \"@/components/models/systems.js\";\n\nexport default {\n  name: \"lqr\",\n\n  meta: {\n    title: \"LQR\",\n    icon: \"mdi-matrix\",\n    systems: [\n      Systems.secondOrder,\n      Systems.arm,\n      Systems.cartPole,\n      Systems.quadrotor2D,\n    ]\n  },\n\n  components: {\n    ModelLayout,\n    TrajPlot,\n    LQRPlugin\n  },\n\n  mixins: [worldMixin, systemMixin],\n\n  props: {\n    systemName: String\n  },\n\n  data: () => ({\n  }),\n\n  computed: {\n    canvas() {\n      return this.$refs.canvas;\n    },\n\n    scale() {\n      return 96;\n    },\n\n    dt() {\n      return 1 / 60;\n    }\n  },\n\n  created() {\n    const SysClass = Systems[this.systemName];\n    if (!SysClass) console.error(\"Unsupported system\", this.systemName);\n    else this.system = new SysClass();\n  },\n\n  mounted() {\n  },\n\n  methods: {\n    reset() {\n      worldMixin.methods.reset.call(this);\n      systemMixin.methods.reset.call(this);\n    }\n  }\n};\n</script>\n\n<style>\n</style>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./LQR.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./LQR.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./LQR.vue?vue&type=template&id=57648a25&lang=pug&\"\nimport script from \"./LQR.vue?vue&type=script&lang=js&\"\nexport * from \"./LQR.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VChip } from 'vuetify/lib/components/VChip';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VChip,VSpacer})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ModelLayout',{scopedSlots:_vm._u([{key:\"canvas\",fn:function(){return [_c('div',{ref:\"canvas\",staticClass:\"canvas\"})]},proxy:true},{key:\"overlay\",fn:function(){return [_c('div',{staticStyle:{\"display\":\"flex\"}},[_c('v-chip',{staticClass:\"ma-2\",attrs:{\"label\":\"\",\"color\":\"blue\",\"text-color\":\"white\"}},[_vm._v(\"Kinematic\")]),_c('v-spacer'),_c('span',{staticClass:\"ma-2\"},[_vm._v(\"fps: \"+_vm._s(_vm.fps.toFixed(0)))])],1)]},proxy:true},{key:\"drawer\",fn:function(){return [_c('ValueIterationPlugin',{ref:\"plugin\",attrs:{\"system\":_vm.system}})]},proxy:true},(_vm.mounted)?{key:\"sheet\",fn:function(){return [_c('ValueIterationPlot',{attrs:{\"valueIterationPlanner\":_vm.$refs.plugin.viPlanner,\"trajectory\":_vm.$refs.plugin.trajectory},on:{\"onclick\":_vm.onclick}})]},proxy:true}:null,{key:\"bar\",fn:function(){return [_c('v-btn',{attrs:{\"text\":\"\",\"dark\":\"\"},on:{\"click\":_vm.reset}},[_vm._v(\"reset\")])]},proxy:true}],null,true)})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"div\",staticStyle:{\"width\":\"100%\",\"height\":\"100%\"}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\ndiv(style=\"width: 100%; height: 100%\", ref=\"div\")\n</template>\n\n<script>\nimport Plotly from \"plotly.js-dist\";\nimport _ from \"lodash\";\n\nexport default {\n  name: \"ValueIterationPlot\",\n\n  props: {\n    valueIterationPlanner: Object,\n    trajectory: Object,\n  },\n\n  data: () => ({\n    series: [],\n  }),\n\n  computed: {\n    names() {\n      return this.valueIterationPlanner.system.states.map((st) => st.name);\n    },\n  },\n\n  watch: {\n    trajectory: {\n      handler(newValue, oldValue) {\n        if (oldValue) oldValue.removeWatcher(this.update);\n        if (newValue) newValue.addWatcher(this.update);\n        this.update();\n      },\n      immediate: true,\n    },\n  },\n\n  mounted() {\n    const config = {\n      displaylogo: false,\n      displayModeBar: false,\n      scrollZoom: false,\n      showAxisDragHandles: false,\n      responsive: true,\n    };\n    Plotly.newPlot(this.$refs.div, [], [], config);\n    this.$refs.div.on(\"plotly_click\", (data) => {\n      this.onclick(data);\n    });\n\n    // Add watchers\n    this.valueIterationPlanner.addWatcher(this.update);\n    this.update();\n  },\n\n  beforeDestroy() {\n    this.valueIterationPlanner.removeWatcher(this.update);\n    this.trajectory.removeWatcher(this.update);\n  },\n\n  methods: {\n    onclick(data) {\n      if (data.points && data.points.length > 0) {\n        const pt = data.points[0];\n        this.$emit(\"onclick\", [pt.x, pt.y]);\n      }\n    },\n\n    getXY() {\n      const xList = [];\n      const yList = [];\n      this.trajectory.array.forEach((val, k) => {\n        xList.push(val.get(0));\n        yList.push(val.get(1));\n      });\n      return [xList, yList];\n    },\n\n    update() {\n      if (!this.$refs.div || !this.valueIterationPlanner.V)\n        return;\n      const vi = this.valueIterationPlanner;\n      const V = vi.V[0].map((_, colIndex) => vi.V.map(row => row[colIndex]));\n      const data = [\n        {\n          z: V,\n          x0: vi.xMin,\n          dx: (vi.xMax - vi.xMin) / vi.xn,\n          y0: vi.yMin,\n          dy: (vi.yMax - vi.yMin) / vi.xn,\n          type: \"heatmap\",\n        },\n      ];\n      // Add trajectory\n      if (this.trajectory && this.trajectory.ready()) {\n        const [x, y] = this.getXY();\n        const trajData = {\n          x,\n          y,\n          type: \"scatter\",\n          line: { color: 'white'},\n          hoverinfo: 'skip',\n        };\n        data.push(trajData);\n      }\n      const layout = {\n        xaxis: { title: this.names[0], fixedrange: true },\n        yaxis: { title: this.names[1], fixedrange: true },\n        margin: {\n          l: 70,\n          r: 100,\n          b: 60,\n          t: 30,\n          pad: 10,\n        },\n      };\n      Plotly.react(this.$refs.div, data, layout);\n    },\n  },\n};\n</script>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ValueIterationPlot.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ValueIterationPlot.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ValueIterationPlot.vue?vue&type=template&id=60ca2062&lang=pug&\"\nimport script from \"./ValueIterationPlot.vue?vue&type=script&lang=js&\"\nexport * from \"./ValueIterationPlot.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Section',{attrs:{\"title\":\"Value Iteration\"}},[_c('ValueInput',{ref:\"dt\",attrs:{\"value\":_vm.params.dt,\"label\":\"Timestep\"},on:{\"update:value\":function($event){return _vm.$set(_vm.params, \"dt\", $event)}}}),_c('ArrayInput',{ref:\"pointCount\",staticClass:\"mt-3\",attrs:{\"array\":_vm.params.x.nPts,\"label\":\"State point count\"},on:{\"update:array\":function($event){return _vm.$set(_vm.params.x, \"nPts\", $event)}}}),_c('ArrayInput',{ref:\"uMin\",staticClass:\"mt-3\",attrs:{\"array\":_vm.params.u.min,\"label\":\"uMin\"},on:{\"update:array\":function($event){return _vm.$set(_vm.params.u, \"min\", $event)}}}),_c('ArrayInput',{ref:\"uMax\",staticClass:\"mt-3\",attrs:{\"array\":_vm.params.u.max,\"label\":\"uMax\"},on:{\"update:array\":function($event){return _vm.$set(_vm.params.u, \"max\", $event)}}}),_c('ArrayInput',{ref:\"uPointCount\",staticClass:\"mt-3\",attrs:{\"array\":_vm.params.u.nPts,\"label\":\"u point count\"},on:{\"update:array\":function($event){return _vm.$set(_vm.params.u, \"nPts\", $event)}}}),_c('v-btn',{staticClass:\"mt-3\",attrs:{\"outlined\":\"\",\"disabled\":_vm.running,\"loading\":_vm.running,\"color\":\"primary\"},on:{\"click\":_vm.runValueIteration}},[_vm._v(\"run value iteration\")])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import _ from 'lodash';\nimport eig from \"@eigen\";\nimport Trajectory from '@/components/planners/trajectory.js';\nimport { Grid } from './utils.js';\nimport { smooth } from '@/components/math.js';\n\nclass ValueIterationPlanner2D {\n  /**\n   * Create a ValueIterationPlanner\n   * @param {Object} system System of interest\n   */\n  constructor(system) {\n    this.system = system;\n    this.watchers = new Set();\n    // Value iteration result\n    this.V = [[]];\n    this.bounds = {};\n  }\n\n  /**\n   * Add update callback\n   */\n  addWatcher(fun) {\n    this.watchers.add(fun);\n  }\n\n  /**\n   * Add update callback\n   */\n  removeWatcher(fun) {\n    this.watchers.delete(fun);\n  }\n\n  getMatrix() {\n    return this.V;\n  }\n\n  setParams(params) {\n    this.params = params;\n    this.xMin = this.params.x.min[0];\n    this.xMax = this.params.x.max[0];\n    this.yMin = this.params.x.min[1];\n    this.yMax = this.params.x.max[1];\n    this.xn = this.params.x.nPts[0];\n    this.yn = this.params.x.nPts[1];\n    this.un = this.params.u.nPts[0];\n    this.dt = this.params.dt;\n    // Init V & transition tables\n    this.tableI = [];\n    this.tableJ = [];\n    this.V = [...Array(this.xn)].map(() => [...Array(this.yn)].map(() => null));\n    this.policy = [...Array(this.xn)].map(() => [...Array(this.yn)].map(() => 0));\n    for (let k = 0; k < this.un; k++) {\n      this.tableI.push([...Array(this.xn)].map(() => [...Array(this.yn)].map(() => null)));\n      this.tableJ.push([...Array(this.xn)].map(() => [...Array(this.yn)].map(() => null)));\n    }\n    this.points = [];\n    for (let i = 0; i < this.xn; i++)\n      for (let j = 0; j < this.yn; j++)\n        this.points.push({ i, j });\n    const uMin = this.params.u.min[0];\n    const uMax = this.params.u.max[0];\n    this.U = [...Array(this.un).keys()].map(idx => {\n      return new eig.Matrix([uMin + idx * (uMax - uMin)]);\n    });\n    // Populate targets\n    if (!this.params.x.targets) throw new Error(\"The system must define valid targets\");\n    this.params.x.targets.forEach(target => {\n      const pt = this.pack(new eig.Matrix(target));\n      this.V[pt.i][pt.j] = 0;\n    });\n  }\n\n  unpackU(uk) {\n    const u = this.params.u.min[0] + uk / (this.un - 1) *\n      (this.params.u.max[0] - this.params.u.min[0]);\n    return new eig.Matrix([u]);\n  }\n\n  pack(x) {\n    let i = (x.get(0) - this.xMin) / (this.xMax - this.xMin);\n    i = Math.max(0, Math.min(this.xn - 1, Math.floor(i * this.xn)));\n    let j = (x.get(1) - this.yMin) / (this.yMax - this.yMin);\n    j = Math.max(0, Math.min(this.yn - 1, Math.floor(j * this.yn)));\n    return { i, j };\n  }\n\n  unpackPt(pt) {\n    return this.unpack(pt.i, pt.j);\n  }\n\n  unpack(i, j) {\n    return new eig.Matrix([\n      this.xMin + ((i + 0.5) / this.xn) * (this.xMax - this.xMin),\n      this.yMin + ((j + 0.5) / this.yn) * (this.yMax - this.yMin)\n    ]);\n  }\n\n  smoothTable(table) {\n    // this.un = 1;\n    // this.xn = 3;\n    // this.yn = 3;\n    // this.points = [];\n    // for (let i = 0; i < this.xn; i++)\n    //   for (let j = 0; j < this.yn; j++)\n    //     this.points.push({ i, j });\n    // table = {0: [\n    //   [null, null, 6],\n    //   [null, null, null],\n    //   [3, null, null],\n    // ]};\n    const meanTable = table.map(t => t.map(t => t.map(t => t ?? 0)));\n    for (let sk = 0; sk < 100; sk++) {\n      let maxUpdate = 0;\n      for (let uk = 0; uk < this.un; uk++) {\n        for (let pk = 0; pk < this.points.length; pk++) {\n          const pt = this.points[pk];\n          if (table[uk][pt.i][pt.j] != null) continue;\n          let avg = 0;\n          let count = 0;\n          if (pt.i > 0) { count += 1; avg += meanTable[uk][pt.i - 1][pt.j]; }\n          if (pt.i < this.xn - 1) { count += 1; avg += meanTable[uk][pt.i + 1][pt.j]; }\n          if (pt.j > 0) { count += 1; avg += meanTable[uk][pt.i][pt.j - 1]; }\n          if (pt.j < this.yn - 1) { count += 1; avg += meanTable[uk][pt.i][pt.j + 1]; }\n          avg /= Math.max(count, 1);\n          maxUpdate = Math.max(maxUpdate, Math.abs(meanTable[uk][pt.i][pt.j] - avg));\n          meanTable[uk][pt.i][pt.j] = avg;\n        }\n        // console.log('maxUpdate', maxUpdate);\n        // console.log('meanTable', meanTable);\n      }\n      if (maxUpdate < 1e-1) break;\n    }\n    // Now clamp table\n    for (let uk = 0; uk < this.un; uk++) {\n      this.points.forEach(pt => {\n        const newVal = meanTable[uk][pt.i][pt.j];\n        if (table[uk][pt.i][pt.j] == null)\n          table[uk][pt.i][pt.j] = Math.floor(newVal);\n      });\n    }\n  }\n\n  /**\n   * Create transition table\n   */\n  createTransitionTable() {\n    const a = Date.now();\n    let stationnary = 0;\n    for (let uk = 0; uk < this.un; uk++) {\n      const u = this.U[uk];\n      this.points.forEach(pt => {\n        const x = this.unpack(pt.i, pt.j);\n        const xNext = this.system.xNext(x, u, this.dt, false);\n        const nextPt = this.pack(xNext);\n        const newPt = nextPt.i != pt.i || nextPt.j != pt.j;\n        // console.log('i,j', [pt.i, pt.j], 'x,y', [x.get(0), x.get(1)], 'u', u.get(0), '=>', 'x,y', [xNext.get(0), xNext.get(1)], 'newPt', newPt);\n        if (newPt) {\n          this.tableI[uk][pt.i][pt.j] = nextPt.i; //  nextPt;\n          this.tableJ[uk][pt.i][pt.j] = nextPt.j; //  nextPt;\n        }\n        else {\n          stationnary += 1;\n        }\n      });\n    }\n    const ratio = 100 * stationnary / (this.points.length * this.un);\n    console.log(`Stationnary ratio: ${ratio.toFixed(2)}%`);\n    if (ratio > 80) return false;\n    // Transition created. Now smooth table\n    this.smoothTable(this.tableI);\n    this.smoothTable(this.tableJ);\n    // console.log('tableI:', this.tableI);\n    // console.log('tableJ:', this.tableJ);\n  }\n\n  /**\n   * Running cost associated with triplet x, u, dt\n   */\n  cost() {\n    return this.dt;\n  }\n\n  /**\n   * Run a step of value iteration\n   */\n  runValueIteration(maxIter = 1000) {\n    for (let k = 0; k < maxIter; k++) {\n      let maxUpdate = 0;\n      // console.log('V before', JSON.parse(JSON.stringify(this.V)));\n      this.points.forEach(pt => {\n        const currentV = this.V[pt.i][pt.j];\n        let minV = currentV;\n        for (let uk = 0; uk < this.un; uk++) {\n          const ni = this.tableI[uk][pt.i][pt.j];\n          const nj = this.tableJ[uk][pt.i][pt.j];\n          if ((ni != pt.i || nj != pt.j) && this.V[ni][nj] != null) {\n            const nextV = this.cost() + this.V[ni][nj];\n            if (minV == null || nextV < minV) {\n              // console.log([pt.i, pt.j], 'next', [ni, nj], 'nextV', nextV);\n              minV = nextV;\n              this.policy[pt.i][pt.j] = uk;\n            }\n          }\n        }\n        const delta = Math.abs((this.V[pt.i][pt.j] ?? 0) - (minV ?? 0));\n        maxUpdate = Math.max(maxUpdate, delta);\n        this.V[pt.i][pt.j] = minV;\n      });\n      // console.log('V after', JSON.parse(JSON.stringify(this.V)));\n      if (maxUpdate < 1e-3) {\n        console.log(`Successfully converged in ${k} iterations`);\n        // console.log('bestU', this.policy);\n        return true;\n      }\n    }\n    console.log(`Could not converge after ${maxIter} iterations`);\n    return false;\n  }\n\n  run(params, maxIter = 1000) {\n    // Init params\n    this.setParams(params);\n    // Create transition table\n    this.createTransitionTable();\n    // Run VI\n    this.runValueIteration(maxIter);\n    // Update watchers\n    this.watchers.forEach(fun => fun());\n    // Dump\n    this.dump();\n  }\n\n  dump() {\n    // Dump result to clipboard\n    navigator.clipboard.writeText(JSON.stringify({\n      V: this.V.map((sub) => sub.map(v => v.toFixed(2))),\n      tableI: this.tableI,\n      tableJ: this.tableJ,\n      policy: this.policy,\n    })).then(() => console.log(\"dumped to clipboard\"));\n  }\n\n  parse(params, dump) {\n    this.setParams(params);\n    // Parse result from dump\n    this.V = dump.V.map((sub) => sub.map(v => parseFloat(v)));\n    this.tableI = dump.tableI;\n    this.tableJ = dump.tableJ;\n    this.policy = dump.policy;\n    // Notify watchers\n    this.watchers.forEach(fun => fun());\n  }\n\n  getControl(x) {\n    x = this.V.clamp(x);\n    const kx = this.V.pack(x);\n    return this.U.unpack(this.policy[kx]);\n  }\n\n  /**\n   * Simulate\n   * @param {Trajectory} trajectory - the trajectory to be set\n   * @param {Number} duration\n   */\n  simulate(x0, trajectory, maxDuration) {\n    let sequence = [];\n    // Find closest value in table\n    let dist = Infinity;\n    let pt;\n    this.points.forEach(pt0 => {\n      const x = this.unpackPt(pt0);\n      const d = x0.matSub(x).normSqr();\n      if (d < dist) {\n        dist = d;\n        pt = pt0;\n      }\n    });\n    if (pt == null) return;\n    // Now start for x\n    const ptSet = new Set();\n    for (let t = 0; t <= maxDuration; t += this.dt) {\n      const ku = this.policy[pt.i][pt.j];\n      const ni = this.tableI[ku][pt.i][pt.j];\n      const nj = this.tableJ[ku][pt.i][pt.j];\n      const newPt = { i: ni, j: nj };\n      if (ptSet.has(newPt)) break;\n      const x = this.unpack(ni, nj);\n      const u = this.unpackU(ku);\n      sequence.push(x.vcat(u));\n      // Check for target\n      const v = this.V[ni][nj];\n      if (v == 0) break;\n      pt = newPt;\n      ptSet.add(newPt);\n    }\n    const xf = sequence[sequence.length - 1];\n    // sequence = smooth(sequence, this.dt, 1, false);\n    sequence.push(xf);\n    trajectory.set(sequence, this.dt);\n  }\n}\n\nexport default ValueIterationPlanner2D;","<template lang=\"pug\">\nSection(title=\"Value Iteration\")\n  ValueInput(ref=\"dt\", :value.sync=\"params.dt\", label=\"Timestep\")\n  ArrayInput.mt-3(\n    ref=\"pointCount\",\n    :array.sync=\"params.x.nPts\",\n    label=\"State point count\"\n  )\n  ArrayInput.mt-3(ref=\"uMin\", :array.sync=\"params.u.min\", label=\"uMin\")\n  ArrayInput.mt-3(ref=\"uMax\", :array.sync=\"params.u.max\", label=\"uMax\")\n  ArrayInput.mt-3(\n    ref=\"uPointCount\",\n    :array.sync=\"params.u.nPts\",\n    label=\"u point count\"\n  )\n  v-btn.mt-3(\n    @click=\"runValueIteration\",\n    outlined,\n    :disabled=\"running\",\n    :loading=\"running\",\n    color=\"primary\"\n  ) run value iteration\n  //- v-btn.mt-2(@click=\"simulate\", outlined, color=\"primary\") simulate\n</template>\n\n<script>\nimport ValueInput from \"@/components/environments/utils/ValueInput.vue\";\nimport ArrayInput from \"@/components/environments/utils/ArrayInput.vue\";\nimport ValueIterationPlanner2D from \"@/components/planners/valueIterationPlanner2D.js\";\nimport Trajectory from \"@/components/planners/trajectory.js\";\nimport Section from \"@/components/environments/utils/Section.vue\";\nimport eig from \"@eigen\";\nimport _ from \"lodash\";\nimport pluginMixin from \"@/components/environments/pluginMixin.js\";\n\nexport default {\n  name: \"ValueIterationPlugin\",\n\n  mixins: [pluginMixin],\n\n  components: {\n    Section,\n    ValueInput,\n    ArrayInput,\n  },\n\n  props: {\n    system: Object,\n  },\n\n  data: () => ({\n    viPlanner: null,\n    running: false,\n    xPrev: null,\n    // Parameters\n    params: {},\n  }),\n\n  computed: {},\n\n  created() {\n    this.viPlanner = new ValueIterationPlanner2D(this.system);\n    this.trajectory = new Trajectory(this.system, false);\n    this.params = _.cloneDeep(this.system.valueIterationParams());\n    this.loadDump();\n  },\n\n  methods: {\n    async loadDump() {\n      const dump = await this.params.dump();\n      this.viPlanner.parse(this.params, dump.default);\n      this.simulate();\n    },\n\n    ready() {\n      return this.trajectory.ready();\n    },\n\n    reset() {\n      if (this.ready()) {\n        this.trajectory.reset(0);\n      } else {\n        const { x } = this.system.trim();\n        this.system.setState(x);\n      }\n    },\n\n    simulate(x0) {\n      if (!x0) x0 = new eig.Matrix(this.params.x0);\n      this.viPlanner.simulate(x0, this.trajectory, 30);\n      this.trajectory.reset(this.t ?? 0);\n    },\n\n    updateSystem(t, dt) {\n      if (this.ready()) {\n        this.t = t;\n        if (this.xPrev && this.system.x !== this.xPrev) {\n          console.log(\"Delta detected, re-run\");\n          this.simulate(this.system.x);\n        }\n        const u = this.trajectory.getCommand(t);\n        const x = this.trajectory.getState(t);\n        eig.GC.set(this, \"xPrev\", x);\n        this.system.setState(x);\n        return { u };\n      }\n\n      return { u: new eig.Matrix([0]) };\n    },\n\n    runValueIteration() {\n      // Get from system\n      this.running = true;\n      try {\n        const converged = this.viPlanner.run(this.params);\n        if (converged) this.simulate();\n      } catch (e) {\n        console.log(e);\n      }\n      this.running = false;\n    },\n  },\n};\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ValueIterationPlugin.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ValueIterationPlugin.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ValueIterationPlugin.vue?vue&type=template&id=cb89cfa6&lang=pug&\"\nimport script from \"./ValueIterationPlugin.vue?vue&type=script&lang=js&\"\nexport * from \"./ValueIterationPlugin.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\ninstallComponents(component, {VBtn})\n","<template lang='pug'>\nModelLayout\n  template(v-slot:canvas)\n    div.canvas(ref='canvas')\n  template(v-slot:overlay)\n    div(style='display: flex;')\n      v-chip.ma-2(label\n            color='blue'\n            text-color='white') Kinematic\n      v-spacer\n      span.ma-2 fps: {{ fps.toFixed(0) }}\n  template(v-slot:drawer)\n    ValueIterationPlugin(ref='plugin'\n                         :system='system')\n  template(v-if='mounted'\n           v-slot:sheet)\n    ValueIterationPlot(\n      :valueIterationPlanner='$refs.plugin.viPlanner'\n      :trajectory='$refs.plugin.trajectory'\n      @onclick='onclick')\n  template(v-slot:bar)\n    v-btn(text dark\n          @click='reset') reset\n</template>\n\n<script>\nimport eig from \"@eigen\";\nimport ModelLayout from \"@/components/models/ModelLayout.vue\";\nimport worldMixin from \"@/components/worldMixin.js\";\nimport systemMixin from \"@/components/systemMixin.js\";\nimport ValueIterationPlot from \"@/components/plots/ValueIterationPlot.vue\";\nimport ValueIterationPlugin from \"@/components/environments/ValueIteration/ValueIterationPlugin.vue\";\nimport Systems from \"@/components/models/systems.js\";\n\nexport default {\n  name: \"valueIteration\",\n\n  meta: {\n    title: \"Value iteration\",\n    icon: \"mdi-restore\",\n    systems: [Systems.simplePendulum]\n  },\n\n  components: {\n    ModelLayout,\n    ValueIterationPlot,\n    ValueIterationPlugin\n  },\n\n  mixins: [worldMixin, systemMixin],\n\n  props: {\n    systemName: String\n  },\n\n  data: () => ({\n    mounted: false // TODO: built-in way?\n  }),\n\n  computed: {\n    canvas() {\n      return this.$refs.canvas;\n    },\n\n    scale() {\n      return 96;\n    },\n\n    dt() {\n      return 1 / 60;\n    }\n  },\n\n  created() {\n    const SysClass = Systems[this.systemName];\n    if (!SysClass) console.error(\"Unsupported system\", this.systemName);\n    else this.system = new SysClass();\n  },\n\n  mounted() {\n    this.createGraphics();\n    this.mounted = true;\n  },\n\n  methods: {\n    reset() {\n      worldMixin.methods.reset.call(this);\n      systemMixin.methods.reset.call(this);\n    },\n\n    update() {\n      systemMixin.methods.update.call(this);\n      // systemMixin.update();\n      // console.log('update called')\n    },\n\n    onclick(pt) {\n      console.log('onclick', pt)\n      this.$refs.plugin.simulate(\n        new eig.Matrix(pt)\n      );\n    }\n  }\n};\n</script>\n\n<style>\n</style>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ValueIteration.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ValueIteration.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ValueIteration.vue?vue&type=template&id=4507afaa&lang=pug&\"\nimport script from \"./ValueIteration.vue?vue&type=script&lang=js&\"\nexport * from \"./ValueIteration.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VChip } from 'vuetify/lib/components/VChip';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VChip,VSpacer})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ModelLayout',{scopedSlots:_vm._u([{key:\"canvas\",fn:function(){return [_c('div',{ref:\"canvas\",staticClass:\"canvas\"})]},proxy:true},{key:\"overlay\",fn:function(){return [_c('span',{staticClass:\"ma-2\"},[_vm._v(\"fps: \"+_vm._s(_vm.fps.toFixed(0)))])]},proxy:true},{key:\"drawer\",fn:function(){return [_c('RRTPlugin',{ref:\"plugin\",attrs:{\"system\":_vm.system},on:{\"activate\":function () {}}})]},proxy:true},(_vm.isMounted)?{key:\"sheet\",fn:function(){return [_c('RRTPlot',{attrs:{\"rrt\":_vm.$refs.plugin.rrt}})]},proxy:true}:null,{key:\"bar\",fn:function(){return [_c('v-btn',{attrs:{\"text\":\"\",\"dark\":\"\"},on:{\"click\":_vm.reset}},[_vm._v(\"reset\")])]},proxy:true}],null,true)})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"div\",staticStyle:{\"width\":\"100%\",\"height\":\"100%\"}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\n  div(style='width: 100%; height: 100%;'\n      ref='div')\n</template>\n\n<script>\nimport Plotly from \"plotly.js-dist\";\nimport _ from \"lodash\";\nimport eig from '@eigen'\n\nexport default {\n  name: \"RRTPlot\",\n\n  props: {\n    rrt: Object // [ trajs ]\n  },\n\n  data: () => ({\n    series: []\n  }),\n\n  computed: {\n    names() {\n      // return this.valueIterationPlanner.system.states.map(st => st.name);\n      return [\"x axis\", \"y axis\"]\n    }\n  },\n\n  watch: {},\n\n  mounted() {\n    const config = {\n      displaylogo: false,\n      displayModeBar: false,\n      scrollZoom: false,\n      showAxisDragHandles: false,\n      responsive: true\n    };\n    Plotly.newPlot(this.$refs.div, [], [], config);\n\n    //\n    this.$refs.div.addEventListener('click', ev => {\n      // console.log('click event', ev)\n      let x = ev.clientX;\n      let y = ev.clientY;\n      // Normalize\n      const xi = (x - 88) / (865 - 88);\n      const xj = (y - 679) / (1151 - 679);\n      const i = (xi * 2 - 1) * 3;\n      const j = -(xj * 2 - 1) * 3;\n      // console.log('i', i, 'j', j);\n      this.rrt.extend(new eig.Matrix([i, j]));\n      this.update();\n    })\n\n    // Add watchers\n    this.rrt.addWatcher(this.update);\n    this.update();\n  },\n\n  beforeDestroy() {\n    this.rrt.removeWatcher(this.update);\n  },\n\n  methods: {\n    createLine(x1, x2) {\n      return {\n        type: 'line',\n        opacity: 0.7,\n        line: { color: 'red', width: 2.5 },\n        x0: x1.get(0),\n        y0: x1.get(1),\n        x1: x2.get(0),\n        y1: x2.get(1),\n      };\n    },\n\n    appendLinesRec(lines, node) {\n      if (!node) return;\n      node.next.forEach(subNode => {\n        // Handle wrapping\n        const x1 = node.x;\n        const x2 = subNode.x;\n        const dx = x2.matSub(x1);\n        const x11 = new eig.Matrix(x1);\n        const x22 = new eig.Matrix(x2);\n        let split = false;\n        for (let k = 0; k < 2; k++) {\n          if (!this.rrt.params.wrap[k]) continue;\n          const rng = this.rrt.params.xMax[k] - this.rrt.params.xMin[k];\n          const adx = Math.abs(dx.get(k));\n          if (adx > rng / 2) {\n            x11.set(k, x11.get(k) + Math.sign(dx.get(k)) * rng);\n            x22.set(k, x22.get(k) - Math.sign(dx.get(k)) * rng);\n            split = true;\n          }\n        }\n        // Draw lines\n        if (split) {\n          lines.push(this.createLine(x1, x22));\n          lines.push(this.createLine(x2, x11));\n        } else {\n          lines.push(this.createLine(x1, x2));\n        }\n        this.appendLinesRec(lines, subNode);\n      })\n    },\n\n    update() {\n      const lines = []\n      this.appendLinesRec(lines, this.rrt.nodes[0])\n      const layout = {\n        xaxis: { \n          title: this.names[0],\n          range: [ this.rrt.params.xMin[0], this.rrt.params.xMax[0] ],\n          fixedrange: true\n        },\n        yaxis: {\n          title: this.names[1],\n          range: [ this.rrt.params.xMin[1], this.rrt.params.xMax[1] ],\n          fixedrange: true\n        },\n        shapes: lines,\n        margin: {\n          l: 70,\n          r: 100,\n          b: 60,\n          t: 30,\n          pad: 10\n        }\n      };\n      Plotly.react(this.$refs.div, [], layout);\n    }\n  }\n};\n</script>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RRTPlot.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RRTPlot.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RRTPlot.vue?vue&type=template&id=1dabb1f2&lang=pug&\"\nimport script from \"./RRTPlot.vue?vue&type=script&lang=js&\"\nexport * from \"./RRTPlot.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Section',{attrs:{\"title\":\"RRT\"}},[_c('Blocks',{ref:\"blocks\",staticClass:\"mt-2\",attrs:{\"initBlocks\":_vm.initBlocks}}),_c('ValueInput',{ref:\"nPts\",staticClass:\"mt-2\",attrs:{\"value\":_vm.params.nPts,\"label\":\"Point count\"},on:{\"update:value\":function($event){return _vm.$set(_vm.params, \"nPts\", $event)}}}),_c('v-btn',{staticClass:\"mt-2\",attrs:{\"outlined\":\"\",\"color\":\"primary\"},on:{\"click\":_vm.runRRT}},[_vm._v(\"run RRT\")])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticStyle:{\"display\":\"flex\",\"flex-direction\":\"column\"}},[_c('span',{staticClass:\"font-weight-light mt-2\"},[_vm._v(\"Blocks\")]),_vm._l((_vm.blocks),function(block,idx){return _c('div',{key:(\"block_\" + (block.key || idx)),staticClass:\"mb-3 mt-2\",staticStyle:{\"display\":\"flex\",\"align-items\":\"center\"}},[_c('span',{staticClass:\"font-weight-light\"},[_vm._v(_vm._s(idx)+\" -\")]),_c('ValueInput',{ref:(\"time_\" + idx),refInFor:true,staticClass:\"ml-2\",attrs:{\"value\":block.size,\"label\":\"size\"},on:{\"update:value\":function($event){return _vm.$set(block, \"size\", $event)}}}),_c('v-btn',{attrs:{\"icon\":\"\",\"color\":\"red\"},on:{\"click\":function($event){return _vm.deleteBlock(idx)}}},[_c('v-icon',[_vm._v(\"mdi-delete\")])],1)],1)}),_c('v-btn',{attrs:{\"outlined\":\"\",\"color\":\"green\"},on:{\"click\":_vm.addBlock}},[_vm._v(\"+ add\")])],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\nfunction setDraggable(shape, params = {}) {\n  const el = shape._renderer.elem\n\n  // el.style.cursor = 'move'\n  el.addEventListener('mousemove', e => {\n    shape.scale = params.scale || 1.5\n    el.style.cursor = 'pointer'\n  })\n  el.addEventListener('mouseleave', e => {\n    shape.scale = 1\n  })\n  el.addEventListener('mousedown', e => {\n    e.preventDefault();\n    let anchor = [e.clientX, e.clientY];\n    // Create functions\n    function drag(e) {\n      e.preventDefault();\n      shape.translation.x += e.clientX - anchor[0]\n      shape.translation.y += e.clientY - anchor[1]\n      anchor = [e.clientX, e.clientY];\n      shape.scale = params.scale || 1.5\n      const pos = [shape.translation.x, shape.translation.y]\n      if (params.mousemove) params.mousemove(pos);\n    }\n    function dragEnd(e) {\n      e.preventDefault();\n      window.removeEventListener('mousemove', drag)\n      window.removeEventListener('mouseup', dragEnd);\n      shape.scale = 1\n      if (params.mouseup) params.mouseup();\n    }\n    window.addEventListener('mousemove', drag);\n    window.addEventListener('mouseup', dragEnd);\n    if (params.mousedown) params.mousedown();\n  })\n}\n\nexport { setDraggable }","<template lang=\"pug\">\ndiv(style='display: flex; flex-direction: column')\n  span.font-weight-light.mt-2 Blocks\n  div.mb-3.mt-2(v-for='block, idx in blocks'\n           :key='`block_${block.key || idx}`'\n           style='display: flex; align-items: center')\n    span.font-weight-light {{ idx }} -\n    ValueInput.ml-2(:ref='`time_${idx}`'\n                    :value.sync='block.size'\n                    label='size')\n    //- style='flex: 0 0 auto; width: 48px'\n    v-btn(icon\n          color='red'\n          @click='deleteBlock(idx)')\n      v-icon mdi-delete\n  v-btn(@click='addBlock'\n        outlined\n        color='green') + add\n</template>\n\n<script>\nimport anime from \"animejs\";\nimport { setDraggable } from \"@/components/twoUtils.js\";\nimport colors from \"vuetify/lib/util/colors\";\n// import MatrixInput from \"./MatrixInput.vue\";\n// import ArrayInput from \"./ArrayInput.vue\";\nimport ValueInput from \"./ValueInput.vue\";\nimport _ from \"lodash\";\n\nexport default {\n  components: {\n    ValueInput\n  },\n\n  data: () => ({\n    two: null,\n    blocks: []\n  }),\n\n  props: {\n    initBlocks: Array\n  },\n\n  computed: {\n    blockDragged() {\n      return _.some(this.blocks.map(s => s.dragged));\n    }\n  },\n\n  created() {\n    this.reset();\n  },\n\n  methods: {\n    reset() {\n      // [...Array(this.blocks.length)].forEach(() => this.deleteBlock(0));\n      this.blocks.forEach(s => {\n        s.tPrev = 0;\n      });\n    },\n\n    createGraphics(two) {\n      this.two = two;\n      // Create handles\n      this.blocks = _.cloneDeep(this.initBlocks);\n      this.blocks.forEach(block => this.createBlock(block));\n      this.labelBlocks();\n      this.reset();\n    },\n\n    addBlock() {\n      // if (this.blocks.length === 0) return;\n      const block = { pos: [0, 0], size: 32 };\n      this.createBlock(block);\n      this.blocks.push(block);\n      this.labelBlocks();\n    },\n\n    deleteBlock(idx) {\n      this.two.remove(this.blocks[idx].graphics);\n      this.blocks.splice(idx, 1);\n      this.labelBlocks();\n    },\n\n    createBlock(block) {\n      const size = block.size;\n      const radius = 4;\n      const square = this.two.makeRoundedRectangle(0, 0, size, size, radius);\n      const text = this.two.makeText(\"\", 0, 1.5);\n      text.size = 14;\n      text.weight = \"bolder\";\n      text.fill = \"#ffffff\";\n      square.linewidth = 3;\n      square.stroke = colors.blueGrey.darken4;\n      square.fill = colors.blueGrey.base;\n      const group = this.two.makeGroup(square, text);\n      const pos = this.two.worldToCanvas(block.pos);\n      group.translation.set(...pos);\n      block.graphics = group;\n      block.text = text;\n      this.two.update();\n      const params = {\n        scale: 1.1,\n        mousedown: () => {\n          this.$set(block, \"dragged\", true);\n        },\n        mouseup: () => {\n          this.$set(block, \"dragged\", false);\n        },\n        mousemove: pos => {\n          block.pos = this.two.canvasToWorld(pos);\n        }\n      };\n      this.$nextTick(() => {\n        setDraggable(group, params);\n      });\n    },\n\n    labelBlocks() {\n      this.blocks.forEach((block, idx) => {\n        block.text.value = `${idx}`;\n      });\n    },\n\n    update(t) {}\n  }\n};\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Blocks.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Blocks.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Blocks.vue?vue&type=template&id=483dcf11&lang=pug&\"\nimport script from \"./Blocks.vue?vue&type=script&lang=js&\"\nexport * from \"./Blocks.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\ninstallComponents(component, {VBtn,VIcon})\n","import _ from 'lodash'\nimport eig from '@eigen'\n\nclass RRT {\n  constructor(system) {\n    this.system = system;\n    this.params = system.rrtParams();\n    this.watchers = new Set();\n    // Initialize graph\n    this.clear();\n  }\n\n  /**\n   * Add update callback\n   */\n  addWatcher(fun) {\n    this.watchers.add(fun)\n  }\n\n  /**\n   * Add update callback\n   */\n  removeWatcher(fun) {\n    this.watchers.delete(fun)\n  }\n\n  sample() {\n    const n = this.system.shape[0] / 2;\n    const x = eig.Matrix.random(n, 1);\n    const xMin = this.params.xMin;\n    const xMax = this.params.xMax;\n    for (let k = 0; k < n; k++)\n      x.set(k, xMin[k] + (x.get(k) + 1) / 2 * (xMax[k] - xMin[k]));\n    return x;\n  }\n\n  step(x1, x2) {\n    let dx = x2.matSub(x1);\n    const x22 = new eig.Matrix(x2);\n    for (let k = 0; k < dx.length(); k++) {\n      if (!this.params.wrap[k]) continue;\n      const rng = this.params.xMax[k] - this.params.xMin[k];\n      const adx = Math.abs(dx.get(k));\n      if (adx > rng / 2)\n        x22.set(k, x22.get(k) - Math.sign(dx.get(k)) * rng);\n    }\n    dx = x22.matSub(x1);\n    const dxn = dx.norm();\n    const xNext = eig.Matrix(x1);\n    for (let k = 0; k < dx.length(); k++) {\n      const eps = Math.min(this.params.deltas[k], dxn);\n      xNext.set(k, xNext.get(k) + dx.get(k) / dxn * eps);\n    }\n    this.system.bound(xNext);\n\n\n    // Handle wrapping\n    // const dx = x2.matSub(x1);\n    // const x2n = x2.matAdd(dx);\n    // this.system.bound(x2n);\n    // x2n.matSubSelf(x1);\n    // const x1next = new eig.Matrix(x1);\n    // for (let k = 0; k < dx.length(); k++) {\n    //   const sign = Math.abs(x2n.get(k)) < Math.abs(dx.get(k)) ? 1 : -1;\n    //   const eps = this.params.deltas[k];\n    //   x1next.set(k, x1next.get(k) + sign * eps);\n    // }\n    return xNext;\n  }\n\n  dist(x1, x2) {\n    // Norm in wrapped space\n    const dx = x2.matSub(x1);\n    for (let k = 0; k < dx.length(); k++) {\n      if (!this.params.wrap[k]) continue;\n      const rng = this.params.xMax[k] - this.params.xMin[k];\n      const adx = Math.abs(dx.get(k));\n      if (adx > rng / 2)\n        dx.set(k, rng - adx);\n    }\n    return dx.norm();\n  }\n\n  findClosestNode(x) {\n    let minDist = Infinity;\n    let minNode = null;\n    this.nodes.forEach(node => {\n      const dist = this.dist(x, node.x);\n      if (dist < minDist) {\n        minNode = node;\n        minDist = dist;\n      }\n    });\n    return minNode;\n  }\n\n  append(x, node = null) {\n    // Optional node\n    const newNode = {\n      next: []\n    };\n    eig.GC.set(newNode, 'x', x);\n    if (node)\n      node.next.push(newNode);\n    this.nodes.push(newNode);\n  }\n\n  clear() {\n    eig.GC.popException(this.nodes);\n    this.nodes = [];\n    this.append(this.system.x.block(0, 0, this.params.n, 1))\n  }\n\n  extend(x) {\n    const node = this.findClosestNode(x);\n    if (node) {\n      // Take a step in x direction\n      const xNext = this.step(node.x, x);\n      this.append(xNext, node);\n    } else {\n      // Only append x for now\n      this.append(x);\n    }\n  }\n\n  run(validFun, iterations) {\n    // Clear graph\n    this.clear();\n    for (let k = 0; k < iterations; k++) {\n      const x = this.sample();\n      if (!validFun(x))\n        continue;\n      this.extend(x)\n    }\n    console.log('nodes', this.nodes)\n    this.watchers.forEach(fun => fun());\n  }\n}\n\nexport default RRT","<template lang=\"pug\">\nSection(title='RRT')\n  Blocks.mt-2(ref='blocks'\n              :initBlocks='initBlocks')\n  ValueInput.mt-2(ref='nPts'\n              :value.sync='params.nPts'\n              label='Point count')\n  v-btn.mt-2(@click='runRRT'\n      outlined\n      color='primary') run RRT\n</template>\n\n<script>\nimport Blocks from \"@/components/environments/utils/Blocks.vue\";\nimport Section from \"@/components/environments/utils/Section.vue\";\nimport pluginMixin from \"@/components/environments/pluginMixin.js\";\nimport MatrixInput from \"@/components/environments/utils/MatrixInput.vue\";\nimport ValueInput from \"@/components/environments/utils/ValueInput.vue\";\nimport RRT from \"@/components/planners/rrt.js\";\nimport eig from \"@eigen\";\nimport _ from \"lodash\";\n\nexport default {\n  name: \"RRTPlugin\",\n\n  mixins: [pluginMixin],\n\n  components: {\n    Section,\n    MatrixInput,\n    ValueInput,\n    Blocks\n  },\n\n  props: {\n    system: Object\n  },\n\n  data: () => ({\n    params: {},\n    rrt: null\n  }),\n\n  computed: {\n    initBlocks() {\n      return [{ pos: [1, 1], size: 32 }];\n    },\n\n    mouseTargetEnabled() {\n      return !this.$refs.blocks.blockDragged;\n    }\n  },\n\n  created() {\n    this.rrt = new RRT(this.system);\n    this.params = this.system.rrtParams();\n  },\n\n  methods: {\n    runRRT() {\n      this.rrt.run(() => true, this.params.nPts);\n    },\n\n    createGraphics(two) {\n      // Create blocks\n      this.$refs.blocks.createGraphics(two);\n    },\n\n    reset() {\n      const { x, u } = this.system.trim();\n      this.system.setState(x);\n      // this.system.step(u, 0.01);\n    },\n\n    ready() {\n      return false;\n    },\n\n    updateSystem(t, dt) {\n      return {};\n    }\n  }\n};\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RRTPlugin.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RRTPlugin.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RRTPlugin.vue?vue&type=template&id=0ac0c257&lang=pug&\"\nimport script from \"./RRTPlugin.vue?vue&type=script&lang=js&\"\nexport * from \"./RRTPlugin.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\ninstallComponents(component, {VBtn})\n","<template lang='pug'>\nModelLayout\n  template(v-slot:canvas)\n    div.canvas(ref='canvas')\n  template(v-slot:overlay)\n    span.ma-2 fps: {{ fps.toFixed(0) }}\n  template(v-slot:drawer)\n    RRTPlugin(ref='plugin'\n              :system='system'\n              @activate='() => {}')\n  template(v-if='isMounted'\n           v-slot:sheet)\n    RRTPlot(:rrt='$refs.plugin.rrt')\n  template(v-slot:bar)\n    v-btn(text dark\n          @click='reset') reset\n</template>\n\n<script>\nimport ModelLayout from \"@/components/models/ModelLayout.vue\";\nimport worldMixin from \"@/components/worldMixin.js\";\nimport systemMixin from \"@/components/systemMixin.js\";\nimport RRTPlot from \"@/components/plots/RRTPlot.vue\";\nimport RRTPlugin from \"@/components/environments/RRT/RRTPlugin.vue\";\nimport Systems from \"@/components/models/systems.js\";\n\nexport default {\n  name: \"rrt\",\n\n  meta: {\n    title: \"RRT\",\n    icon: \"mdi-robot-industrial\",\n    systems: [Systems.arm]\n  },\n\n  components: {\n    ModelLayout,\n    RRTPlot,\n    RRTPlugin\n  },\n\n  mixins: [worldMixin, systemMixin],\n\n  props: {\n    systemName: String\n  },\n\n  data: () => ({\n  }),\n\n  computed: {\n    canvas() {\n      return this.$refs.canvas;\n    },\n\n    scale() {\n      return 96;\n    },\n\n    dt() {\n      return 1 / 60;\n    }\n  },\n\n  created() {\n    const SysClass = Systems[this.systemName];\n    if (!SysClass) console.error(\"Unsupported system\", this.systemName);\n    else this.system = new SysClass();\n  },\n\n  methods: {\n    reset() {\n      worldMixin.methods.reset.call(this);\n      systemMixin.methods.reset.call(this);\n    }\n  }\n};\n</script>\n\n<style>\n</style>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RRT.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./RRT.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./RRT.vue?vue&type=template&id=75cb5c87&lang=pug&\"\nimport script from \"./RRT.vue?vue&type=script&lang=js&\"\nexport * from \"./RRT.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\ninstallComponents(component, {VBtn})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ModelLayout',{scopedSlots:_vm._u([{key:\"canvas\",fn:function(){return [_c('div',{ref:\"canvas\",staticClass:\"canvas\"})]},proxy:true},{key:\"overlay\",fn:function(){return [_c('div',{staticStyle:{\"display\":\"flex\"}},[_c('v-chip',{staticClass:\"ma-2\",attrs:{\"label\":\"\",\"color\":\"blue\",\"text-color\":\"white\"}},[_vm._v(\"Kinematic\")]),_c('v-spacer'),_c('span',{staticClass:\"ma-2\"},[_vm._v(\"fps: \"+_vm._s(_vm.fps.toFixed(0)))])],1)]},proxy:true},{key:\"drawer\",fn:function(){return [_c('FlatnessPlugin',{ref:\"plugin\",attrs:{\"system\":_vm.system,\"interactivePath\":_vm.interactivePath},on:{\"activate\":function () {}}})]},proxy:true},(_vm.isMounted)?{key:\"sheet\",fn:function(){return [_c('TrajPlot',{attrs:{\"trajectories\":_vm.$refs.plugin.trajectories}})]},proxy:true}:null,{key:\"bar\",fn:function(){return [_c('v-btn',{attrs:{\"text\":\"\",\"dark\":\"\"},on:{\"click\":_vm.reset}},[_vm._v(\"reset\")])]},proxy:true}],null,true)})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Section',{attrs:{\"title\":\"Diff. Flatness\"}},[_c('ValueInput',{staticClass:\"mt-3\",attrs:{\"value\":_vm.params.duration,\"label\":\"Travel duration\"},on:{\"update:value\":function($event){return _vm.$set(_vm.params, \"duration\", $event)}}}),_c('v-btn',{staticClass:\"mt-2\",attrs:{\"outlined\":\"\",\"color\":\"primary\"},on:{\"click\":_vm.buildTraj}},[_vm._v(\"update trajectory\")])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\nSection(title='Diff. Flatness')\n  ValueInput.mt-3(:value.sync='params.duration'\n             label='Travel duration')\n  v-btn.mt-2(@click='buildTraj'\n             outlined\n             color='primary') update trajectory\n</template>\n\n<script>\nimport Trajectory from \"@/components/planners/trajectory.js\";\nimport Section from \"@/components/environments/utils/Section.vue\";\nimport pluginMixin from \"@/components/environments/pluginMixin.js\";\nimport MatrixInput from \"@/components/environments/utils/MatrixInput.vue\";\nimport ValueInput from \"@/components/environments/utils/ValueInput.vue\";\nimport eig from \"@eigen\";\nimport _ from \"lodash\";\n\nconst DT = 1 / 60;\n\nexport default {\n  name: \"FlatnessPlugin\",\n\n  mixins: [pluginMixin],\n\n  components: {\n    Section,\n    MatrixInput,\n    ValueInput\n  },\n\n  props: {\n    system: Object,\n    interactivePath: Object\n  },\n\n  data: () => ({\n    simTraj: null,\n    // Parameters\n    params: {\n      duration: 5\n    }\n  }),\n\n  computed: {\n    trajectories() {\n      return [this.simTraj];\n    }\n  },\n\n  created() {\n    const { x, u } = this.system.trim();\n    // Populate matrices\n    this.simTraj = new Trajectory(this.system, true);\n  },\n\n  mounted() {\n    this.$nextTick(() => this.buildTraj());\n  },\n\n\n  watch: {\n    interactivePath() {\n      if (this.interactivePath) {\n        this.interactivePath.addUpdateListener(this.pathUpdated);\n      }\n    }\n  },\n\n  methods: {\n    pathUpdated() {\n      this.simTraj.clear();\n    },\n\n    reset() {\n      this.buildTraj();\n    },\n\n    ready() {\n      return this.simTraj.ready();\n    },\n\n    stepSystem() {\n      return false;\n    },\n\n    updateSystem(t, dt) {\n      if (this.ready()) {\n        const u = this.simTraj.getCommand(t);\n        const x = this.simTraj.getState(t);\n        this.system.setState(x);\n        return { u };\n      }\n    },\n\n    buildTraj() {\n      this.simTraj.clear();\n      const xy = this.interactivePath.getTraj(this.params.duration / DT);\n      const arr = this.system.differentialFlatness(xy, DT);\n      this.simTraj.set(arr, DT);\n    }\n  }\n};\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FlatnessPlugin.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./FlatnessPlugin.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./FlatnessPlugin.vue?vue&type=template&id=6b163a5b&lang=pug&\"\nimport script from \"./FlatnessPlugin.vue?vue&type=script&lang=js&\"\nexport * from \"./FlatnessPlugin.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\ninstallComponents(component, {VBtn})\n","import Two from \"two.js\";\nimport _ from 'lodash'\nimport Vue from 'vue'\nimport colors from 'vuetify/lib/util/colors'\nimport eig from \"@eigen\"\nimport { setDraggable } from '@/components/twoUtils.js'\n\n// TODO: allow for open path (and non differentiable ?)\nclass InteractivePath {\n  constructor(two, worldToCanvas, canvasToWorld) {\n    this.worldToCanvas = worldToCanvas\n    this.canvasToWorld = canvasToWorld\n    this.updateListeners = []\n\n    const length = 300\n    const vHandle = 100\n    const dHandle = 140\n\n    this.path = new Two.Path([\n      // new Two.Anchor(0, 0),\n      new Two.Anchor(-length, 0, 0, vHandle, 0, -vHandle, Two.Commands.curve),\n      new Two.Anchor(0, 0, -dHandle, -dHandle, dHandle, dHandle, Two.Commands.curve),\n      new Two.Anchor(length, 0, 0, vHandle, 0, -vHandle, Two.Commands.curve),\n      new Two.Anchor(0, 0, dHandle, -dHandle, -dHandle, dHandle, Two.Commands.curve),\n      new Two.Anchor(-length, 0, 0, vHandle, 0, -vHandle, Two.Commands.curve)\n    ], false)\n    this.path.automatic = false;\n    this.path.noFill()\n    this.path.stroke = colors.purple.base;\n    this.path.linewidth = 3\n    this.group = two.makeGroup(this.path)\n\n    const vertices = this.path.vertices\n    for (let k = 1; k < vertices.length; k++) {\n      const anchor = vertices[k]\n\n      const radius = 20;\n      const editColor = colors.red.base;\n\n\n      const handle = two.makeCircle(0, 0, radius / 4);\n      const l = two.makeCircle(0, 0, radius / 4);\n      // var r = two.makeCircle(0, 0, radius / 4);\n\n      handle.translation.copy(anchor);\n      l.translation.copy(anchor.controls.left).addSelf(anchor);\n      // r.translation.copy(anchor.controls.right).addSelf(anchor);\n      handle.noStroke().fill = l.noStroke().fill = editColor;\n      // r.noStroke().fill \n\n      const ll = new Two.Path([\n        new Two.Anchor().copy(handle.translation),\n        new Two.Anchor().copy(l.translation)\n      ]);\n      // var rl = new Two.Path([\n      //   new Two.Anchor().copy(handle.translation),\n      //   new Two.Anchor().copy(r.translation)\n      // ]);\n      ll.noFill().stroke = editColor;\n      // rl.noFill().stroke = editColor;\n\n      this.group.add(ll, handle, l);\n\n      const _this = this\n      handle.translation.bind(Two.Events.change, function () {\n        anchor.copy(this);\n        l.translation.copy(anchor.controls.left).addSelf(this);\n        ll.vertices[0].copy(this);\n        ll.vertices[1].copy(l.translation);\n        if (k === vertices.length - 1) {\n          vertices[0].copy(this)\n        }\n        _this.onUpdate()\n        // r.translation.copy(anchor.controls.right).addSelf(this);\n        // rl.vertices[0].copy(this);\n        // rl.vertices[1].copy(r.translation);\n      });\n      l.translation.bind(Two.Events.change, function () {\n        anchor.controls.left.copy(this).subSelf(anchor);\n        let controls = k === vertices.length - 1 ? vertices[0].controls.right : anchor.controls.right;\n        controls.copy(this).subSelf(anchor).multiplyScalar(-1);\n        ll.vertices[1].copy(this);\n        _this.onUpdate()\n      });\n      // r.translation.bind(Two.Events.change, function () {\n      //   anchor.controls.right.copy(this).subSelf(anchor);\n      //   anchor.controls.left.copy(this).subSelf(anchor).multiplyScalar(-1);\n      //   rl.vertices[1].copy(this);\n      // });\n\n      // Add Interactivity\n      Vue.nextTick(() => {\n        setDraggable(handle);\n        setDraggable(l);\n      })\n      // setDraggable(r);\n    }\n\n    // Center path\n    const [cx, cy] = worldToCanvas([0, 0])\n    this.group.translation.set(cx, cy);\n  }\n\n  addUpdateListener(listener) {\n    this.updateListeners.push(listener)\n  }\n\n  onUpdate() {\n    this.updateListeners.forEach(l => l())\n  }\n\n  discretize(nPts) {\n    const traj = []\n    for (let k = 0; k < nPts; k++) {\n      const t = k / nPts;\n      traj.push(this.path.getPointAt(t))\n    }\n    return traj\n  }\n\n  getTraj(nPts) {\n    const [cx, cy] = this.worldToCanvas([0, 0])\n    return this.discretize(nPts).map(val => {\n      return new eig.Matrix(this.canvasToWorld([val.x + cx, val.y + cy]));\n    });\n  }\n}\n\nexport default InteractivePath","<template lang='pug'>\nModelLayout\n  template(v-slot:canvas)\n    div.canvas(ref='canvas')\n  template(v-slot:overlay)\n    div(style='display: flex;')\n      v-chip.ma-2(label\n            color='blue'\n            text-color='white') Kinematic\n      v-spacer\n      span.ma-2 fps: {{ fps.toFixed(0) }}\n  template(v-slot:drawer)\n    FlatnessPlugin(ref='plugin'\n                   :system='system'\n                   :interactivePath='interactivePath' \n                   @activate='() => {}')\n  template(v-if='isMounted'\n           v-slot:sheet)\n    TrajPlot(:trajectories='$refs.plugin.trajectories')\n  template(v-slot:bar)\n    v-btn(text dark\n          @click='reset') reset\n</template>\n\n<script>\nimport ModelLayout from \"@/components/models/ModelLayout.vue\";\nimport worldMixin from \"@/components/worldMixin.js\";\nimport systemMixin from \"@/components/systemMixin.js\";\nimport TrajPlot from \"@/components/plots/TrajPlot.vue\";\nimport FlatnessPlugin from \"@/components/environments/Flatness/FlatnessPlugin.vue\";\nimport Systems from \"@/components/models/systems.js\";\nimport InteractivePath from \"@/components/planners/interactivePath.js\";\n\nexport default {\n  name: \"flatness\",\n\n  meta: {\n    title: \"Flatness\",\n    icon: \"mdi-infinity\",\n    systems: [\n      Systems.quadrotor2D,\n    ]\n  },\n\n  components: {\n    ModelLayout,\n    TrajPlot,\n    FlatnessPlugin\n  },\n\n  mixins: [worldMixin, systemMixin],\n\n  props: {\n    systemName: String\n  },\n\n  data: () => ({\n    interactivePath: null\n  }),\n\n  computed: {\n    canvas() {\n      return this.$refs.canvas;\n    },\n\n    scale() {\n      return 96;\n    },\n\n    dt() {\n      return 1 / 60;\n    }\n  },\n\n  created() {\n    const SysClass = Systems[this.systemName];\n    if (!SysClass) console.error(\"Unsupported system\", this.systemName);\n    else this.system = new SysClass();\n  },\n\n  mounted() {\n    // Create interactive path\n    this.interactivePath = new InteractivePath(\n      this.two,\n      this.worldToCanvas,\n      this.canvasToWorld\n    );\n  },\n\n  methods: {\n    reset() {\n      worldMixin.methods.reset.call(this);\n      systemMixin.methods.reset.call(this);\n    }\n  }\n};\n</script>\n\n<style>\n</style>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Flatness.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Flatness.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Flatness.vue?vue&type=template&id=06a334af&lang=pug&\"\nimport script from \"./Flatness.vue?vue&type=script&lang=js&\"\nexport * from \"./Flatness.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VChip } from 'vuetify/lib/components/VChip';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VChip,VSpacer})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ModelLayout',{scopedSlots:_vm._u([{key:\"canvas\",fn:function(){return [_c('div',{ref:\"canvas\",staticClass:\"canvas\"})]},proxy:true},{key:\"overlay\",fn:function(){return [_c('div',{staticStyle:{\"display\":\"flex\"}},[_c('v-chip',{staticClass:\"ma-2\",attrs:{\"label\":\"\",\"color\":\"blue\",\"text-color\":\"white\"}},[_vm._v(\"Kinematic\")]),_c('v-spacer'),_c('span',{staticClass:\"ma-2\"},[_vm._v(\"fps: \"+_vm._s(_vm.fps.toFixed(0)))])],1)]},proxy:true},{key:\"drawer\",fn:function(){return [_c('DirectCollocationPlugin',{ref:\"plugin\",attrs:{\"system\":_vm.system},on:{\"activate\":function () {}}})]},proxy:true},(_vm.isMounted)?{key:\"sheet\",fn:function(){return [_c('TrajPlot',{attrs:{\"trajectories\":_vm.$refs.plugin.trajectories}})]},proxy:true}:null,{key:\"bar\",fn:function(){return [_c('v-btn',{attrs:{\"text\":\"\",\"dark\":\"\"},on:{\"click\":_vm.reset}},[_vm._v(\"reset\")])]},proxy:true}],null,true)})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang='pug'>\nModelLayout\n  template(v-slot:canvas)\n    div.canvas(ref='canvas')\n  template(v-slot:overlay)\n    div(style='display: flex;')\n      v-chip.ma-2(label\n            color='blue'\n            text-color='white') Kinematic\n      v-spacer\n      span.ma-2 fps: {{ fps.toFixed(0) }}\n  template(v-slot:drawer)\n    DirectCollocationPlugin(ref='plugin'\n                            :system='system'\n                            @activate='() => {}')\n  template(v-if='isMounted'\n           v-slot:sheet)\n    TrajPlot(:trajectories='$refs.plugin.trajectories')\n  template(v-slot:bar)\n    v-btn(text dark\n          @click='reset') reset\n</template>\n\n<script>\nimport ModelLayout from \"@/components/models/ModelLayout.vue\";\nimport worldMixin from \"@/components/worldMixin.js\";\nimport systemMixin from \"@/components/systemMixin.js\";\nimport TrajPlot from \"@/components/plots/TrajPlot.vue\";\nimport DirectCollocationPlugin from \"@/components/environments/DirectCollocation/DirectCollocationPlugin.vue\";\nimport Systems from \"@/components/models/systems.js\";\n\nexport default {\n  name: \"directCollocation\",\n\n  meta: {\n    title: \"Direct Collocation\",\n    icon: \"mdi-vector-curve\",\n    systems: [\n      Systems.secondOrder,\n      Systems.simplePendulum,\n      Systems.doublePendulum,\n      Systems.cartPole,\n      Systems.quadrotor2D\n    ]\n  },\n\n  components: {\n    ModelLayout,\n    TrajPlot,\n    DirectCollocationPlugin\n  },\n\n  mixins: [worldMixin, systemMixin],\n\n  props: {\n    systemName: String\n  },\n\n  data: () => ({\n  }),\n\n  computed: {\n    canvas() {\n      return this.$refs.canvas;\n    },\n\n    scale() {\n      return 96;\n    },\n\n    dt() {\n      return 1 / 60;\n    }\n  },\n\n  created() {\n    const SysClass = Systems[this.systemName];\n    if (!SysClass) console.error(\"Unsupported system\", this.systemName);\n    else this.system = new SysClass();\n  },\n\n  mounted() {\n  },\n\n  methods: {\n    reset() {\n      worldMixin.methods.reset.call(this);\n      systemMixin.methods.reset.call(this);\n    }\n  }\n};\n</script>\n\n<style>\n</style>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DirectCollocation.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./DirectCollocation.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./DirectCollocation.vue?vue&type=template&id=12a9e727&lang=pug&\"\nimport script from \"./DirectCollocation.vue?vue&type=script&lang=js&\"\nexport * from \"./DirectCollocation.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VChip } from 'vuetify/lib/components/VChip';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VChip,VSpacer})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ModelLayout',{scopedSlots:_vm._u([{key:\"canvas\",fn:function(){return [_c('div',{ref:\"canvas\",staticClass:\"canvas\"})]},proxy:true},{key:\"overlay\",fn:function(){return [_c('div',{staticStyle:{\"display\":\"flex\"}},[_c('v-chip',{staticClass:\"ma-2\",attrs:{\"label\":\"\",\"color\":\"red\",\"text-color\":\"white\"}},[_vm._v(\"Dynamic\")]),_c('v-spacer'),_c('span',{staticClass:\"ma-2\"},[_vm._v(\"fps: \"+_vm._s(_vm.fps.toFixed(0)))])],1)]},proxy:true},{key:\"drawer\",fn:function(){return [_c('MPCPlugin',{ref:\"plugin\",attrs:{\"system\":_vm.system,\"systemRef\":_vm.systemRef},on:{\"activate\":function () {}}})]},proxy:true},(_vm.isMounted)?{key:\"sheet\",fn:function(){return [_c('TrajPlot',{attrs:{\"trajectories\":_vm.$refs.plugin.trajectories}})]},proxy:true}:null,{key:\"bar\",fn:function(){return [_c('v-btn',{attrs:{\"text\":\"\",\"dark\":\"\"},on:{\"click\":_vm.reset}},[_vm._v(\"reset\")])]},proxy:true}],null,true)})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Section',{attrs:{\"title\":\"MPC\"}},[_c('ValueInput',{ref:\"nPts\",attrs:{\"value\":_vm.params.nPts,\"label\":\"Point count\"},on:{\"update:value\":function($event){return _vm.$set(_vm.params, \"nPts\", $event)}}}),_c('div',{staticClass:\"mb-3 mt-3\",staticStyle:{\"display\":\"flex\",\"align-items\":\"center\"}},[_c('ArrayInput',{ref:\"uMin\",staticStyle:{\"flex\":\"1 0 auto\",\"width\":\"0px\"},attrs:{\"array\":_vm.params.uBounds.min,\"label\":\"uMin\"},on:{\"update:array\":function($event){return _vm.$set(_vm.params.uBounds, \"min\", $event)}}}),_c('ArrayInput',{ref:\"uMax\",staticClass:\"ml-2\",staticStyle:{\"flex\":\"1 0 auto\",\"width\":\"0px\"},attrs:{\"array\":_vm.params.uBounds.max,\"label\":\"uMax\"},on:{\"update:array\":function($event){return _vm.$set(_vm.params.uBounds, \"max\", $event)}}})],1),_c('ValueInput',{ref:\"dt\",staticStyle:{\"flex\":\"0 0 auto\",\"width\":\"48px\"},attrs:{\"value\":_vm.params.dt,\"label\":\"dt\"},on:{\"update:value\":function($event){return _vm.$set(_vm.params, \"dt\", $event)}}}),_c('v-btn',{staticClass:\"mt-2\",attrs:{\"outlined\":\"\",\"color\":\"primary\"},on:{\"click\":_vm.runMPC}},[_vm._v(\"run MPC optimisation\")])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import eig from '@eigen';\nimport Controller from './controller.js';\nimport LinearSystem from '../models/linearSystem.js';\n\nclass MPC extends Controller {\n  static DEBUG = false;\n  /**\n   * Create a MPC instance\n   * @param {Object} system \n   * @param {Trajectory} trajectory \n   * @param {Number} dt \n   */\n  constructor(system, trajectory, dt, n, uBounds) {\n    super(system);\n    this.system = system;\n    this.trajectory = trajectory;\n    this.dt = dt;\n    this.n = MPC.DEBUG ? 3 : n;\n    this.uBounds = uBounds;\n    // TODO: pass as argument\n    this.params = this.system.mpcParams();\n  }\n\n  optimizeInner(refTraj, linTraj, dx0) {\n    // Minimize 0.5 xT.P.x + qT.x\n    // Suject to l <= Ax <= u\n\n    // Solve MPC starting at t\n    const a = Date.now();\n    const [xn, un] = this.system.shape;\n    const dim = (xn + un) * this.n;\n\n    // Create cost matrix\n    const P = eig.SparseMatrix.identity(dim, dim).mul(1);\n    for (let n = 0; n < xn * this.n; n += 1) {\n      if (this.params.xWeight) {\n        // Use params weighting\n        P.set(n, n, this.params.xWeight[n % xn]);\n      } else if ((n % xn) < xn / 2) {\n        // Default weighting\n        P.set(n, n, 100);\n      }\n    }\n    for (let n = xn * this.n; n < dim; n++) {\n      P.set(n, n, 0.01);\n    }\n    const q = new eig.Matrix(dim, 1);\n\n    // Create dynamic constraints\n    const At = new eig.TripletVector(20); // TODO figure out reserve\n    const In = eig.Matrix.identity(xn, xn);\n    const negOnes = eig.Matrix.ones(xn, 1).mul(-1);\n    for (let n = 0; n < this.n; n++) {\n      const pt = linTraj[n];\n      const x0 = pt.block(0, 0, xn, 1);\n      const u0 = pt.block(xn, 0, un, 1);\n      if (n >= this.n - 1) {\n        continue;\n      }\n\n      // Build constraint matrices\n      const Ab = this.system.xJacobian(x0, u0).mul(this.dt).matAdd(In);\n      const Bb = this.system.uJacobian(x0, u0).mul(this.dt);\n\n      if (MPC.DEBUG) {\n        x0.print(\"x0\");\n        u0.print(\"u0\");\n        Ab.print(`A_${n}`);\n        Bb.print(`B_${n}`);\n      }\n\n      At.addBlock(n * xn, n * xn, Ab);\n      At.addDiag(n * xn, (n + 1) * xn, negOnes);\n      At.addBlock(n * xn, this.n * xn + n * un, Bb);\n\n      if (MPC.DEBUG) {\n        console.log('=== testing jacobian');\n        LinearSystem.testJacobian(this.system);\n        console.log('=== jacobian tested!');\n      }\n    }\n    At.addDiag((this.n - 1) * xn, 0, negOnes.mul(-1));\n    const uDiag = eig.Matrix.ones(un * this.n, 1);\n    At.addDiag(this.n * xn, this.n * xn, uDiag);\n    const A = new eig.SparseMatrix(dim, dim, At);\n    const lb = new eig.Matrix(dim, 1);\n    const ub = new eig.Matrix(dim, 1);\n    this.system.bound(dx0);\n    // dx0.print('dx0');\n    lb.setBlock((this.n - 1) * xn, 0, dx0);\n    ub.setBlock((this.n - 1) * xn, 0, dx0);\n    for (let k = this.n * xn; k < dim; k++) {\n      lb.set(k, this.uBounds.min[k % un]);\n      ub.set(k, this.uBounds.max[k % un]);\n    }\n\n    // Solve quadratic program\n    const x = eig.Solvers.quadProgSolve(P, q, A, lb, ub);\n\n    if (MPC.DEBUG) {\n      dx0.print(\"dx0\");\n      (new eig.SparseMatrix(P)).print(\"P\");\n      q.print(\"q\");\n      (new eig.SparseMatrix(A)).print(\"A\");\n      lb.print('lb');\n      ub.print('ub');\n      x.print('result');\n    }\n\n    const xTraj = [];\n    for (let n = 0; n < this.n; n += 1) {\n      const pt = refTraj[n];\n      const x0 = pt.block(0, 0, xn, 1);\n      const u0 = pt.block(xn, 0, un, 1);\n      const x_n = x.block(n * xn, 0, xn, 1).matAdd(x0);\n      const u_n = x.block(this.n * xn + n * un, 0, un, 1).matAdd(u0);\n      xTraj.push(x_n.vcat(u_n));\n    }\n\n    return xTraj;\n  }\n\n  optimize(t) {\n    // Prepare first pass\n    const ptList = [];\n    for (let n = 0; n < this.n; n++) {\n      const pt = this.trajectory.get(t + n * this.dt);\n      ptList.push(pt);\n    }\n    const [xn, un] = this.system.shape;\n    const x0 = ptList[0].block(0, 0, xn, 1);\n    const dx0 = this.system.x.matSub(x0);\n\n    // const traj = this.optimizeInner(ptList, ptList, dx0);\n    return this.optimizeInner(ptList, ptList, dx0);\n  }\n}\n\nexport default MPC;","<template lang=\"pug\">\nSection(title=\"MPC\")\n  ValueInput(ref=\"nPts\", :value.sync=\"params.nPts\", label=\"Point count\")\n  .mb-3.mt-3(style=\"display: flex; align-items: center\")\n    ArrayInput(\n      ref=\"uMin\",\n      style=\"flex: 1 0 auto; width: 0px\",\n      :array.sync=\"params.uBounds.min\",\n      label=\"uMin\"\n    )\n    ArrayInput.ml-2(\n      ref=\"uMax\",\n      style=\"flex: 1 0 auto; width: 0px\",\n      :array.sync=\"params.uBounds.max\",\n      label=\"uMax\"\n    )\n  ValueInput(\n    ref=\"dt\",\n    style=\"flex: 0 0 auto; width: 48px\",\n    :value.sync=\"params.dt\",\n    label=\"dt\"\n  )\n  v-btn.mt-2(@click=\"runMPC\", outlined, color=\"primary\") run MPC optimisation\n</template>\n\n<script>\nimport Trajectory from \"@/components/planners/trajectory.js\";\nimport Section from \"@/components/environments/utils/Section.vue\";\nimport ArrayInput from \"@/components/environments/utils/ArrayInput.vue\";\nimport ValueInput from \"@/components/environments/utils/ValueInput.vue\";\nimport eig from \"@eigen\";\nimport _ from \"lodash\";\nimport pluginMixin from \"@/components/environments/pluginMixin.js\";\nimport MPC from \"@/components/controllers/MPC.js\";\n\nexport default {\n  name: \"MPCPlugin\",\n\n  mixins: [pluginMixin],\n\n  components: {\n    Section,\n    ArrayInput,\n    ValueInput,\n  },\n\n  props: {\n    system: Object,\n    systemRef: Object,\n  },\n\n  data: () => ({\n    mpc: null,\n    trajectory: null,\n    params: {},\n  }),\n\n  computed: {\n    trajectories() {\n      return [this.trajectory];\n    },\n  },\n\n  created() {\n    this.params = _.cloneDeep(this.system.mpcParams());\n    // Create trajectory\n    this.trajectory = new Trajectory(this.system, true);\n    this.trajectory.load(this.params.traj);\n    // Create mpc\n    this.mpc = new MPC(\n      this.system,\n      this.trajectory,\n      this.params.dt,\n      this.params.nPts,\n      this.params.uBounds\n    );\n    this.reset();\n  },\n\n  methods: {\n    reset() {\n      if (this.trajectory.ready()) {\n        const x0 = this.trajectory.getState(0);\n        this.system.setState(x0);\n      }\n    },\n\n    ready() {\n      return this.trajectory.ready();\n    },\n\n    runMPC() {\n      const xTraj = this.mpc.optimize(0);\n    },\n\n    updateSystem(t, dt) {\n      if (this.ready() && !MPC.DEBUG) {\n        // Update system ref\n        const x = this.trajectory.getState(t);\n        this.systemRef.setState(x);\n        // return { u };\n        // Update system\n        const [xn, un] = this.system.shape;\n        const xTraj = this.mpc.optimize(t);\n        const u = xTraj[0].block(xn, 0, un, 1);\n        // console.log(\n        //   \"TRAJ u:\",\n        //   this.trajectory.getCommand(t).get(0),\n        //   \"mpc u:\",\n        //   u.get(0)\n        // );\n        this.system.step(u, dt);\n        if (this.system.graphics.traj) this.system.graphics.traj.data = xTraj;\n        return { u };\n      }\n      return {};\n\n      // Temp mdp command\n    },\n  },\n};\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MPCPlugin.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MPCPlugin.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MPCPlugin.vue?vue&type=template&id=4ad76234&lang=pug&\"\nimport script from \"./MPCPlugin.vue?vue&type=script&lang=js&\"\nexport * from \"./MPCPlugin.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\ninstallComponents(component, {VBtn})\n","<template lang='pug'>\nModelLayout\n  template(v-slot:canvas)\n    .canvas(ref=\"canvas\")\n  template(v-slot:overlay)\n    div(style=\"display: flex\")\n      v-chip.ma-2(label, color=\"red\", text-color=\"white\") Dynamic\n      v-spacer\n      span.ma-2 fps: {{ fps.toFixed(0) }}\n  template(v-slot:drawer)\n    MPCPlugin(\n      ref=\"plugin\",\n      :system=\"system\",\n      :systemRef=\"systemRef\",\n      @activate=\"() => {}\"\n    )\n  template(v-if=\"isMounted\", v-slot:sheet)\n    TrajPlot(:trajectories=\"$refs.plugin.trajectories\")\n  template(v-slot:bar)\n    v-btn(text, dark, @click=\"reset\") reset\n</template>\n\n<script>\nimport ModelLayout from \"@/components/models/ModelLayout.vue\";\nimport worldMixin from \"@/components/worldMixin.js\";\nimport systemMixin from \"@/components/systemMixin.js\";\nimport TrajPlot from \"@/components/plots/TrajPlot.vue\";\nimport MPCPlugin from \"@/components/environments/MPC/MPCPlugin.vue\";\nimport Systems from \"@/components/models/systems.js\";\n\nexport default {\n  name: \"mpc\",\n\n  meta: {\n    title: \"MPC\",\n    icon: \"mdi-camera-timer\",\n    systems: [\n      Systems.secondOrder,\n      Systems.simplePendulum,\n      Systems.doublePendulum,\n      Systems.cartPole,\n      Systems.quadrotor2D,\n    ],\n  },\n\n  components: {\n    ModelLayout,\n    TrajPlot,\n    MPCPlugin,\n  },\n\n  mixins: [worldMixin, systemMixin],\n\n  props: {\n    systemName: String,\n  },\n\n  data: () => ({\n    systemRef: null,\n  }),\n\n  computed: {\n    canvas() {\n      return this.$refs.canvas;\n    },\n\n    scale() {\n      return 96;\n    },\n\n    dt() {\n      return 1 / 60;\n    },\n  },\n\n  created() {\n    const SysClass = Systems[this.systemName];\n    if (!SysClass) throw new Error(\"Unsupported system\", this.systemName);\n    this.system = new SysClass();\n    this.systemRef = new SysClass();\n  },\n\n  mounted() {\n    this.systemRef.createGraphics(this.two, this.scale);\n  },\n\n  methods: {\n    reset() {\n      worldMixin.methods.reset.call(this);\n      systemMixin.methods.reset.call(this);\n    },\n\n    update() {\n      systemMixin.methods.update.call(this);\n      // Update ref system\n      this.systemRef.updateGraphics(this.worldToCanvas, {\n        // Set transparency & no controls\n        ghost: true,\n      });\n    },\n  },\n};\n</script>\n\n<style>\n</style>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MPC.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MPC.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MPC.vue?vue&type=template&id=11966de8&lang=pug&\"\nimport script from \"./MPC.vue?vue&type=script&lang=js&\"\nexport * from \"./MPC.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VChip } from 'vuetify/lib/components/VChip';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VBtn,VChip,VSpacer})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ModelLayout',{scopedSlots:_vm._u([{key:\"canvas\",fn:function(){return [_c('div',{ref:\"canvas\",staticClass:\"canvas\"})]},proxy:true},{key:\"overlay\",fn:function(){return [_c('span',{staticClass:\"ma-2\"},[_vm._v(\"fps: \"+_vm._s(_vm.fps.toFixed(0)))])]},proxy:true},{key:\"drawer\",fn:function(){return [_c('KalmanFilterPlugin',{ref:\"plugin\",attrs:{\"system\":_vm.system},on:{\"activate\":function () {}}})]},proxy:true},(_vm.isMounted)?{key:\"sheet\",fn:function(){return [_c('KalmanPlot',{attrs:{\"kalmanFilter\":_vm.$refs.plugin.kalmanFilter}})]},proxy:true}:null,{key:\"bar\",fn:function(){return [_c('v-btn',{attrs:{\"text\":\"\",\"dark\":\"\"},on:{\"click\":_vm.reset}},[_vm._v(\"reset\")])]},proxy:true}],null,true)})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticStyle:{\"width\":\"100%\",\"height\":\"100%\"}},[_c('div',{ref:\"div\",staticStyle:{\"width\":\"100%\",\"height\":\"100%\"}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\n  div(style='width: 100%; height: 100%;')\n    div(style='width: 100%; height: 100%;'\n        ref='div')\n</template>\n\n<script>\nimport Plotly from \"plotly.js-dist\";\nimport _ from \"lodash\";\n\nexport default {\n  name: \"KalmanPlot\",\n\n  props: {\n    kalmanFilter: Object\n  },\n\n  data: () => ({\n    tPrev: 0\n  }),\n\n  computed: {},\n\n  watch: {},\n\n  mounted() {\n    const config = {\n      displaylogo: false,\n      displayModeBar: false,\n      scrollZoom: false,\n      showAxisDragHandles: false,\n      responsive: true\n    };\n    Plotly.newPlot(this.$refs.div, [], [], config);\n    this.kalmanFilter.addWatcher(() => {\n      this.update();\n    });\n  },\n\n  beforeDestroy() {\n    // this.trajectories.forEach(traj => traj.removeWatcher(this.update));\n  },\n\n  methods: {\n    getGaussian(mu, sigma, nPts) {\n      const s = 1 / (sigma * Math.sqrt(2 * Math.PI));\n      const [x, y] = [[], []];\n      const step = (6 * sigma) / nPts;\n      for (let k = mu - 3 * sigma; k < mu + 3 * sigma; k += step) {\n        const val = s * Math.exp(-0.5 * Math.pow((k - mu) / sigma, 2));\n        x.push(k);\n        y.push(val);\n      }\n      return { x, y };\n    },\n\n    update() {\n      if (!this.$refs.div || !this.kalmanFilter.ready()) return;\n      if (Date.now() - this.tPrev < 200) return;\n      this.tPrev = Date.now();\n      const sys = this.kalmanFilter.system;\n      const mean = this.kalmanFilter.x;\n      const cov = this.kalmanFilter.P;\n      const data = sys.states.map((state, idx) => {\n        const { x, y } = this.getGaussian(\n          mean.get(idx),\n          cov.get(idx, idx),\n          40\n        );\n        return {\n          x,\n          y,\n          name: state.name,\n          type: \"scatter\",\n          // xaxis: `x${idx}`,\n          // yaxis: `y${idx}`\n        };\n      });\n      const layout = {\n        // grid: { rows: 2, columns: 2, pattern: \"independent\" },\n        xaxis: {\n          zeroline: false\n        },\n        // yaxis: {\n        //   zeroline: false\n        // },\n        margin: {\n          l: 40,\n          r: 100,\n          b: 60,\n          t: 30,\n          pad: 10\n        }\n        // legend: {\n        //   orientation: \"h\",\n        //   x: 0,\n        //   y: -0.1\n        // }\n      };\n      Plotly.react(this.$refs.div, data, layout);\n    }\n  }\n};\n</script>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./KalmanPlot.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./KalmanPlot.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./KalmanPlot.vue?vue&type=template&id=b0dcb3ce&lang=pug&\"\nimport script from \"./KalmanPlot.vue?vue&type=script&lang=js&\"\nexport * from \"./KalmanPlot.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Section',{attrs:{\"title\":\"Kalman Filter\"}},[_c('MatrixInput',{staticClass:\"mt-2\",attrs:{\"label\":\"Init. covariance\",\"matrix\":_vm.params.covariance},on:{\"update:matrix\":function($event){return _vm.$set(_vm.params, \"covariance\", $event)}}}),_c('MatrixInput',{staticClass:\"mt-2\",attrs:{\"label\":\"Process noise\",\"matrix\":_vm.params.processNoise},on:{\"update:matrix\":function($event){return _vm.$set(_vm.params, \"processNoise\", $event)}}}),_c('MatrixInput',{staticClass:\"mt-2\",attrs:{\"label\":\"Input noise\",\"matrix\":_vm.params.inputNoise},on:{\"update:matrix\":function($event){return _vm.$set(_vm.params, \"inputNoise\", $event)}}}),_c('Sensors',{ref:\"sensors\",attrs:{\"system\":_vm.system,\"params\":_vm.params},on:{\"update\":_vm.sensorUpdate}}),_c('v-btn',{staticClass:\"mt-2\",attrs:{\"outlined\":\"\",\"color\":\"primary\"},on:{\"click\":_vm.reset}},[_vm._v(\"reset filter\")])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticStyle:{\"display\":\"flex\",\"flex-direction\":\"column\"}},[_c('span',{staticClass:\"font-weight-light mt-2\"},[_vm._v(\"Sensors\")]),_vm._l((_vm.sensors),function(sensor,idx){return _c('div',{key:(\"sensor_\" + (sensor.key || idx)),staticClass:\"mb-3 mt-2\",staticStyle:{\"display\":\"flex\",\"align-items\":\"center\"}},[_c('span',{staticClass:\"font-weight-light\"},[_vm._v(_vm._s(idx)+\" -\")]),_c('ValueInput',{ref:(\"time_\" + idx),refInFor:true,staticClass:\"ml-2\",attrs:{\"value\":sensor.dt,\"label\":\"dt\"},on:{\"update:value\":function($event){return _vm.$set(sensor, \"dt\", $event)}}}),_c('v-btn',{attrs:{\"icon\":\"\",\"color\":\"red\"},on:{\"click\":function($event){return _vm.deleteSensor(idx)}}},[_c('v-icon',[_vm._v(\"mdi-delete\")])],1)],1)}),_c('v-btn',{attrs:{\"outlined\":\"\",\"disabled\":_vm.params.sensors.length === 0,\"color\":\"green\"},on:{\"click\":_vm.addSensor}},[_vm._v(\"+ add\")])],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\ndiv(style='display: flex; flex-direction: column')\n  span.font-weight-light.mt-2 Sensors\n  div.mb-3.mt-2(v-for='sensor, idx in sensors'\n           :key='`sensor_${sensor.key || idx}`'\n           style='display: flex; align-items: center')\n    span.font-weight-light {{ idx }} -\n    ValueInput.ml-2(:ref='`time_${idx}`'\n                    :value.sync='sensor.dt'\n                    label='dt')\n    //- style='flex: 0 0 auto; width: 48px'\n    v-btn(icon\n          color='red'\n          @click='deleteSensor(idx)')\n      v-icon mdi-delete\n  v-btn(@click='addSensor'\n        outlined\n         :disabled='params.sensors.length === 0'\n        color='green') + add\n</template>\n\n<script>\nimport anime from \"animejs\";\nimport { setDraggable } from \"@/components/twoUtils.js\";\nimport colors from \"vuetify/lib/util/colors\";\n// import MatrixInput from \"./MatrixInput.vue\";\n// import ArrayInput from \"./ArrayInput.vue\";\nimport ValueInput from \"./ValueInput.vue\";\nimport _ from \"lodash\";\n\nexport default {\n  components: {\n    ValueInput\n  },\n\n  data: () => ({\n    two: null,\n    sensors: []\n  }),\n\n  props: {\n    params: Object,\n    system: Object\n  },\n\n  computed: {\n    sensorDragged() {\n      return _.some(this.sensors.map(s => s.dragged));\n    }\n  },\n\n  created() {\n    this.reset();\n  },\n\n  methods: {\n    reset() {\n      // [...Array(this.sensors.length)].forEach(() => this.deleteSensor(0));\n      this.sensors.forEach(s => {\n        s.tPrev = 0;\n      });\n    },\n\n    createGraphics(two) {\n      this.two = two;\n      // Create handles\n      this.sensors = _.cloneDeep(this.params.sensors);\n      this.sensors.forEach(sensor => this.createSensor(sensor));\n      this.labelSensors();\n      this.reset();\n    },\n\n    addSensor() {\n      if (this.params.sensors.length === 0) return;\n      const sensor = _.cloneDeep(this.params.sensors[0]);\n      sensor.pos = [0, 0];\n      this.createSensor(sensor);\n      this.sensors.push(sensor);\n      this.labelSensors();\n    },\n\n    deleteSensor(idx) {\n      this.two.remove(this.sensors[idx].graphics);\n      this.sensors.splice(idx, 1);\n      this.labelSensors();\n    },\n\n    createRadarSensor(sensor) {\n      const radius = 18;\n      const radar = this.two.makeCircle(0, 0, radius);\n      const text = this.two.makeText(\"\", 0, 1.5);\n      text.size = 14;\n      text.weight = \"bolder\";\n      text.fill = \"#ffffff\";\n      radar.linewidth = 3;\n      radar.stroke = colors.green.darken4;\n      radar.fill = colors.green.base;\n      const group = this.two.makeGroup(radar, text);\n      const pos = this.two.worldToCanvas(sensor.pos);\n      group.translation.set(...pos);\n      sensor.graphics = group;\n      sensor.text = text;\n      sensor.anim = () => {\n        anime({\n          targets: group,\n          scale: 1.2,\n          round: 1000,\n          direction: \"alternate\",\n          easing: \"easeInOutSine\",\n          duration: 200,\n          update: () => this.two.update()\n        });\n      };\n      this.two.update();\n      const params = {\n        scale: 1.1,\n        mousedown: () => {\n          this.$set(sensor, \"dragged\", true);\n        },\n        mouseup: () => {\n          this.$set(sensor, \"dragged\", false);\n        },\n        mousemove: pos => {\n          sensor.pos = this.two.canvasToWorld(pos);\n        }\n      };\n      this.$nextTick(() => {\n        setDraggable(group, params);\n      });\n    },\n\n    createSensor(sensor) {\n      switch (sensor.type) {\n        case \"radar\":\n          this.createRadarSensor(sensor);\n      }\n    },\n\n    labelSensors() {\n      this.sensors.forEach((sensor, idx) => {\n        sensor.text.value = `${idx}`;\n      });\n    },\n\n    update(t) {\n      // Run update step\n      this.sensors\n        .filter(sensor => {\n          const tPrev = sensor.tPrev || 0;\n          return t - tPrev > sensor.dt;\n        })\n        .forEach(sensor => {\n          this.$emit(\"update\", sensor);\n          sensor.anim();\n          sensor.tPrev = t;\n        });\n    }\n  }\n};\n</script>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Sensors.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Sensors.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Sensors.vue?vue&type=template&id=1f6a6c6a&lang=pug&\"\nimport script from \"./Sensors.vue?vue&type=script&lang=js&\"\nexport * from \"./Sensors.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\ninstallComponents(component, {VBtn,VIcon})\n","import eig from '@eigen';\nimport LinearSystem from '@/components/models/linearSystem.js';\nimport { addNoise } from '@/components/math.js';\n\nclass KalmanFilter {\n  constructor(system) {\n    this.system = system;\n    this.watchers = new Set();\n  }\n\n  ready() {\n    return !!this.P && !!this.Q;\n  }\n\n  reset(P, Q) {\n    // Init mean & covariance\n    const x = new eig.Matrix(this.system.x);\n    // Store data\n    eig.GC.set(this, 'x', x);\n    eig.GC.set(this, 'P', P);\n    eig.GC.set(this, 'Q', Q);\n  }\n\n  predict(u, dt) {\n    // Retrieve system jacobian\n    const [Jx, Ju] = LinearSystem.linearizeSystem(this.system, this.x, u); // TODO: use real jacobian if available\n    // Transform mean & covariance matrices\n    const dx = this.system.dynamics(this.x, u).mul(dt);\n    this.x.matAddSelf(dx);\n    this.system.bound(this.x);\n    const dP = Jx.matMul(this.P).matMul(Jx.transpose()).matAdd(this.Q).mul(dt);\n    this.P.matAddSelf(dP);\n    // Notify watchers\n    this.watchers.forEach(fun => fun());\n  }\n\n  update(sensor) {\n    // Take measurement\n    const z = sensor.measurement(sensor, this.system.x);\n    const zHat = sensor.measurement(sensor, this.x);\n    // Add measurement noise\n    const cov = new eig.Matrix(sensor.noise);\n    addNoise(z, cov);\n    const H = LinearSystem.linearize(x => sensor.measurement(sensor, x), this.x);\n    const R = new eig.Matrix(sensor.noise);\n    // Compute Kalman gain\n    const PHt = this.P.matMul(H.transpose());\n    const K = PHt.matMul((H.matMul(PHt).matAdd(R)).inverse());\n    // Update mean & covariance\n    this.x.matAddSelf(K.matMul(z.matSub(zHat)));\n    this.P.matSubSelf(K.matMul(H).matMul(this.P));\n    // Notify watchers\n    this.watchers.forEach(fun => fun());\n  }\n\n  /**\n   * Add update callback\n   */\n  addWatcher(fun) {\n    this.watchers.add(fun);\n  }\n\n  /**\n   * Add update callback\n   */\n  removeWatcher(fun) {\n    this.watchers.delete(fun);\n  }\n}\n\nexport default KalmanFilter;","<template lang=\"pug\">\nSection(title=\"Kalman Filter\")\n  MatrixInput.mt-2(label=\"Init. covariance\", :matrix.sync=\"params.covariance\")\n  MatrixInput.mt-2(label=\"Process noise\", :matrix.sync=\"params.processNoise\")\n  MatrixInput.mt-2(label=\"Input noise\", :matrix.sync=\"params.inputNoise\")\n  Sensors(\n    ref=\"sensors\",\n    :system=\"system\",\n    :params=\"params\",\n    @update=\"sensorUpdate\"\n  )\n  v-btn.mt-2(@click=\"reset\", outlined, color=\"primary\") reset filter\n</template>\n\n<script>\nimport Sensors from \"@/components/environments/utils/Sensors.vue\";\nimport Section from \"@/components/environments/utils/Section.vue\";\nimport pluginMixin from \"@/components/environments/pluginMixin.js\";\nimport ValueInput from \"@/components/environments/utils/ValueInput.vue\";\nimport MatrixInput from \"@/components/environments/utils/MatrixInput.vue\";\nimport ArrayInput from \"@/components/environments/utils/ArrayInput.vue\";\nimport KalmanFilter from \"@/components/estimators/kalmanFilter.js\";\nimport eig from \"@eigen\";\nimport _ from \"lodash\";\nimport colors from \"vuetify/lib/util/colors\";\n\nconst DT = 1 / 60;\n\nexport default {\n  name: \"KalmanFilterPlugin\",\n\n  mixins: [pluginMixin],\n\n  components: {\n    Section,\n    ValueInput,\n    MatrixInput,\n    ArrayInput,\n    Sensors,\n  },\n\n  props: {\n    system: Object,\n  },\n\n  data: () => ({\n    two: null,\n    sigma: null,\n    kalmanFilter: null,\n    // Parameters\n    params: {},\n  }),\n\n  computed: {\n    mouseTargetEnabled() {\n      return !this.$refs.sensors.sensorDragged;\n    },\n  },\n\n  created() {\n    this.kalmanFilter = new KalmanFilter(this.system);\n    this.params = this.system.kalmanFilterParams();\n  },\n\n  mounted() {\n    console.log(\"sensors\", this.$refs.sensors);\n    this.reset();\n  },\n\n  watch: {},\n\n  methods: {\n    createGraphics(two) {\n      this.two = two;\n      // Create sensors\n      console.log(\"create graphics\", this.$refs.sensors);\n      this.$refs.sensors.createGraphics(two);\n      // Create sigma on screen\n      const container = two.canvas.parentNode;\n      this.sigma = document.createElement(\"div\");\n      this.sigma.style.width = \"0px\";\n      this.sigma.style.height = \"0px\";\n      this.sigma.style.position = \"absolute\";\n      this.sigma.style.background =\n        \"radial-gradient(closest-side, #1f96f2 0%, rgba(0, 174, 255, 0) 100%)\";\n      container.insertBefore(this.sigma, container.childNodes[0]);\n    },\n\n    updateSigma() {\n      if (!this.sigma) return;\n      const scale = 2;\n      // const P = new eig.Matrix([[10, 2], [3, 4]]);\n      const P = this.kalmanFilter.P.block(0, 0, 2, 2);\n      const x = this.kalmanFilter.x.block(0, 0, 2, 1);\n      const pos = this.two.worldToCanvas([x.get(0), x.get(1)]);\n      const center = this.two.worldToCanvas([0, 0]);\n      pos[0] -= center[0];\n      pos[1] -= center[1];\n      // P.print(\"P\");\n      const svd = eig.Decompositions.svd(P, true);\n      const sign = Math.sign(svd.U.det());\n      const theta = Math.atan2(svd.U.get(0, 1), svd.U.get(0, 0)) * sign;\n      const size = [\n        svd.sv.get(0) * this.two.scale * scale,\n        svd.sv.get(1) * this.two.scale * scale,\n      ];\n      this.sigma.style[\"pointer-events\"] = \"none\";\n      this.sigma.style.left = `calc(50% + ${pos[0] - size[0] / 2}px)`;\n      this.sigma.style.top = `calc(50% + ${pos[1] - size[1] / 2}px)`;\n      this.sigma.style.width = `${size[0]}px`;\n      this.sigma.style.height = `${size[1]}px`;\n      this.sigma.style.transform = `rotate(${theta}rad)`;\n    },\n\n    // Could be shared w/ dircol\n    reset() {\n      const P = new eig.Matrix(this.params.covariance);\n      const Q = new eig.Matrix(this.params.processNoise);\n      this.kalmanFilter.reset(P, Q);\n      this.$refs.sensors.reset();\n    },\n\n    update(params) {\n      // if (params)\n      //   return;\n      // Inject process noise at u\n      const mean = new eig.Matrix(2, 1);\n      const cov = new eig.Matrix(this.params.inputNoise);\n      const rdn = eig.Random.normal(mean, cov, 1);\n      const u = params.u.matAdd(rdn);\n\n      // Run prediction step\n      this.kalmanFilter.predict(u, params.dt);\n\n      // Run update step\n      this.$refs.sensors.update(params.t);\n      this.updateSigma();\n    },\n\n    sensorUpdate(sensor) {\n      this.kalmanFilter.update(sensor);\n    },\n\n    ready() {\n      return false;\n    },\n\n    updateSystem(t, dt) {},\n  },\n};\n</script>\n\n<style>\n</style>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./KalmanFilterPlugin.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./KalmanFilterPlugin.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./KalmanFilterPlugin.vue?vue&type=template&id=6fa3d0a9&lang=pug&\"\nimport script from \"./KalmanFilterPlugin.vue?vue&type=script&lang=js&\"\nexport * from \"./KalmanFilterPlugin.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\ninstallComponents(component, {VBtn})\n","<template lang='pug'>\nModelLayout\n  template(v-slot:canvas)\n    div.canvas(ref='canvas')\n  template(v-slot:overlay)\n    span.ma-2 fps: {{ fps.toFixed(0) }}\n  template(v-slot:drawer)\n    KalmanFilterPlugin(ref='plugin'\n              :system='system'\n              @activate='() => {}')\n  template(v-if='isMounted'\n           v-slot:sheet)\n    KalmanPlot(:kalmanFilter='$refs.plugin.kalmanFilter')\n    //- TrajPlot(:trajectories='$refs.plugin.trajectories')\n  template(v-slot:bar)\n    v-btn(text dark\n          @click='reset') reset\n</template>\n\n<script>\nimport ModelLayout from \"@/components/models/ModelLayout.vue\";\nimport worldMixin from \"@/components/worldMixin.js\";\nimport systemMixin from \"@/components/systemMixin.js\";\nimport TrajPlot from \"@/components/plots/TrajPlot.vue\";\nimport KalmanPlot from \"@/components/plots/KalmanPlot.vue\";\nimport KalmanFilterPlugin from \"@/components/environments/KalmanFilter/KalmanFilterPlugin.vue\";\nimport Systems from \"@/components/models/systems.js\";\n\nexport default {\n  name: \"kalmanFilter\",\n\n  meta: {\n    title: \"Kalman Filter\",\n    icon: \"mdi-chart-bell-curve\",\n    systems: [\n      // Systems.secondOrder,\n      Systems.car,\n    ]\n  },\n\n  components: {\n    ModelLayout,\n    TrajPlot,\n    KalmanPlot,\n    KalmanFilterPlugin\n  },\n\n  mixins: [worldMixin, systemMixin],\n\n  props: {\n    systemName: String\n  },\n\n  data: () => ({\n  }),\n\n  computed: {\n    canvas() {\n      return this.$refs.canvas;\n    },\n\n    scale() {\n      return 96;\n    },\n\n    dt() {\n      return 1 / 60;\n    }\n  },\n\n  created() {\n    const SysClass = Systems[this.systemName];\n    if (!SysClass) console.error(\"Unsupported system\", this.systemName);\n    else this.system = new SysClass();\n  },\n\n  mounted() {\n  },\n\n  methods: {\n    reset() {\n      worldMixin.methods.reset.call(this);\n      systemMixin.methods.reset.call(this);\n    }\n  }\n};\n</script>\n\n<style>\n</style>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./KalmanFilter.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./KalmanFilter.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./KalmanFilter.vue?vue&type=template&id=a9d1a1d2&lang=pug&\"\nimport script from \"./KalmanFilter.vue?vue&type=script&lang=js&\"\nexport * from \"./KalmanFilter.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\ninstallComponents(component, {VBtn})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ModelLayout',{scopedSlots:_vm._u([{key:\"canvas\",fn:function(){return [_c('div',{ref:\"canvas\",staticClass:\"canvas\"})]},proxy:true},{key:\"overlay\",fn:function(){return [_c('span',{staticClass:\"ma-2\"},[_vm._v(\"fps: \"+_vm._s(_vm.fps.toFixed(0)))])]},proxy:true},{key:\"drawer\",fn:function(){return [_c('ParticleFilterPlugin',{ref:\"plugin\",attrs:{\"system\":_vm.system},on:{\"activate\":function () {}}})]},proxy:true},(_vm.isMounted)?{key:\"sheet\",fn:function(){return [_c('ParticlePlot',{attrs:{\"particleFilter\":_vm.$refs.plugin.particleFilter}})]},proxy:true}:null,{key:\"bar\",fn:function(){return [_c('v-btn',{attrs:{\"text\":\"\",\"dark\":\"\"},on:{\"click\":_vm.reset}},[_vm._v(\"reset\")])]},proxy:true}],null,true)})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticStyle:{\"width\":\"100%\",\"height\":\"100%\"}},[_c('div',{ref:\"div\",staticStyle:{\"width\":\"100%\",\"height\":\"100%\"}})])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template lang=\"pug\">\ndiv(style=\"width: 100%; height: 100%\")\n  div(style=\"width: 100%; height: 100%\", ref=\"div\")\n</template>\n\n<script>\nimport Plotly from \"plotly.js-dist\";\nimport _ from \"lodash\";\n\nexport default {\n  name: \"ParticlePlot\",\n\n  props: {\n    particleFilter: Object,\n  },\n\n  data: () => ({\n    tPrev: 0,\n  }),\n\n  computed: {},\n\n  watch: {},\n\n  mounted() {\n    const config = {\n      displaylogo: false,\n      displayModeBar: false,\n      scrollZoom: false,\n      showAxisDragHandles: false,\n      responsive: true,\n    };\n    Plotly.newPlot(this.$refs.div, [], [], config);\n    this.particleFilter.addWatcher(() => {\n      this.update();\n    });\n  },\n\n  beforeDestroy() {\n    // this.trajectories.forEach(traj => traj.removeWatcher(this.update));\n  },\n\n  methods: {\n    update() {\n      if (!this.$refs.div || !this.particleFilter.ready()) return;\n      if (Date.now() - this.tPrev < 500) return;\n      this.tPrev = Date.now();\n      const particles = this.particleFilter.particles;\n      const px = [];\n      const py = [];\n      particles.forEach((particle) => {\n        px.push(particle.system.x.get(0));\n        py.push(particle.system.x.get(1));\n      });\n      const data = [\n        {\n          x: px,\n          type: \"histogram\",\n          opacity: 0.5,\n          marker: {\n            color: \"green\",\n          },\n          name: \"x\", \n        },\n        {\n          x: py,\n          type: \"histogram\",\n          opacity: 0.5,\n          marker: {\n            color: \"red\",\n          },\n          name: \"y\", \n        },\n      ];\n      const layout = {\n        // grid: { rows: 2, columns: 2, pattern: \"independent\" },\n        xaxis: {\n          zeroline: false,\n        },\n        // yaxis: {\n        //   zeroline: false\n        // },\n        margin: {\n          l: 40,\n          r: 100,\n          b: 60,\n          t: 30,\n          pad: 10,\n        },\n        // legend: {\n        //   orientation: \"h\",\n        //   x: 0,\n        //   y: -0.1\n        // }\n      };\n      Plotly.react(this.$refs.div, data, layout);\n    },\n  },\n};\n</script>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ParticlePlot.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ParticlePlot.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ParticlePlot.vue?vue&type=template&id=316e977c&lang=pug&\"\nimport script from \"./ParticlePlot.vue?vue&type=script&lang=js&\"\nexport * from \"./ParticlePlot.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('Section',{attrs:{\"title\":\"Particle Filter\"}},[_c('ValueInput',{attrs:{\"value\":_vm.params.nPts,\"label\":\"Point number\"},on:{\"update:value\":function($event){return _vm.$set(_vm.params, \"nPts\", $event)}}}),_c('ValueInput',{staticClass:\"mt-2\",attrs:{\"value\":_vm.params.dt,\"label\":\"Resampling period\"},on:{\"update:value\":function($event){return _vm.$set(_vm.params, \"dt\", $event)}}}),_c('MatrixInput',{staticClass:\"mt-2\",attrs:{\"matrix\":_vm.params.processNoise,\"label\":\"Process noise\"},on:{\"update:matrix\":function($event){return _vm.$set(_vm.params, \"processNoise\", $event)}}}),_c('Sensors',{ref:\"sensors\",staticClass:\"mt-2\",attrs:{\"system\":_vm.system,\"params\":_vm.params},on:{\"update\":_vm.sensorUpdate}}),_c('v-btn',{staticClass:\"mt-2\",attrs:{\"outlined\":\"\",\"color\":\"purple\"},on:{\"click\":_vm.resample}},[_vm._v(\"resample\")]),_c('v-btn',{staticClass:\"mt-2\",attrs:{\"outlined\":\"\",\"color\":\"primary\"},on:{\"click\":_vm.reset}},[_vm._v(\"reset filter\")])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import eig from '@eigen';\nimport _ from 'lodash';\nimport { addNoise, Gaussian } from '@/components/math.js';\n\n\nclass Particle {\n  constructor(system, params) {\n    this.params = params;\n    this.system = new system.constructor();\n    this.weight = 1;\n    switch (params.distribution) {\n      case 'exact':\n        // Copy state\n        this.system.setState(system.x);\n        break;\n      case 'uniform': {\n        // Sample state uniformely\n        const x = eig.Matrix.random(system.shape[0], 1);\n        for (let k = 0; k < x.rows(); k++) {\n          const min = params.range.min[k];\n          const max = params.range.max[k];\n          this.system.x.set(k, min + (max - min) * x.get(k));\n        }\n        break;\n      }\n      case 'normal': {\n        // Sample state from a multimodal gaussian density\n        break;\n      }\n    }\n  }\n\n  clone() {\n    const newParticle = new Particle(this.system, this.params);\n    newParticle.system.setState(this.system.x);\n    return newParticle;\n  }\n\n  delete() {\n    this.system.delete();\n  }\n\n  predict(u, dt) {\n    this.system.step(u, dt);\n    // Add process noise\n    const cov = new eig.Matrix(this.params.processNoise).mul(dt);\n    addNoise(this.system.x, cov);\n  }\n\n  update(sensor, z) {\n    // Simulate measurement\n    const zHat = sensor.measurement(sensor, this.system.x);\n    // Create gaussian if needed TODO: clear on parameter update\n    if (!sensor.gaussian) {\n      const mean = new eig.Matrix(zHat.rows(), 1);\n      const cov = new eig.Matrix(sensor.noise);\n      sensor.gaussian = new Gaussian(mean, cov);\n    }\n    // Update weight according to measurement likelihood\n    const val = sensor.gaussian.density(zHat.matSub(z));\n    this.weight *= val;\n  }\n}\n\nclass ParticleFilter {\n  constructor(system) {\n    this.system = system;\n    this.particles = [];\n    this.watchers = new Set();\n  }\n\n  ready() {\n    return true;\n  }\n\n  reset(params) {\n    this.params = _.cloneDeep(params);\n    this.particles.forEach(p => p.delete());\n    this.particles = [];\n    for (let k = 0; k < params.nPts; k++) {\n      const p = new Particle(this.system, params);\n      this.particles.push(p);\n    }\n    this.normalizeWeights();\n  }\n\n  predict(u, dt) {\n    this.particles.forEach(particle => particle.predict(u, dt));\n    // Notify watchers\n    this.watchers.forEach(fun => fun());\n  }\n\n  normalizeWeights() {\n    // Pseudo-normalize weight (~soft max?)\n    const weights = this.particles.map(p => p.weight);\n    const max = _.max(weights);\n    const W = max; // TEMP (find better way)\n    this.particles.forEach(p => p.weight /= W);\n  }\n\n  update(sensor) {\n    // Take measurement\n    const z = sensor.measurement(sensor, this.system.x);\n    // Add measurement noise\n    const cov = new eig.Matrix(sensor.noise);\n    addNoise(z, cov);\n    // Update particles\n    this.particles.forEach(particle => particle.update(sensor, z));\n    this.normalizeWeights();\n    // Notify watchers\n    this.watchers.forEach(fun => fun());\n  }\n\n  resample() {\n    // Stochastic sampling algorithm\n    const n = this.particles.length;\n    const newParticles = [];\n    let index = Math.floor(Math.random() * n);\n    let beta = 0.0;\n    const weights = this.particles.map(p => p.weight);\n    const mw = _.max(weights);\n    for (let k = 0; k < n; k++) {\n      beta += Math.random() * 2.0 * mw;\n      while (beta > weights[index]) {\n        beta -= weights[index];\n        index = (index + 1) % n;\n      }\n      const newParticle = this.particles[index].clone();\n      newParticles.push(newParticle);\n    }\n    this.particles.forEach(p => p.delete());\n    this.particles = newParticles;\n  }\n\n\n  /**\n   * Add update callback\n   */\n  addWatcher(fun) {\n    this.watchers.add(fun);\n  }\n\n  /**\n   * Add update callback\n   */\n  removeWatcher(fun) {\n    this.watchers.delete(fun);\n  }\n}\n\nexport default ParticleFilter;","<template lang=\"pug\">\nSection(title='Particle Filter')\n  ValueInput(:value.sync='params.nPts'\n             label='Point number')\n  ValueInput.mt-2(:value.sync='params.dt'\n                  label='Resampling period')\n  MatrixInput.mt-2(:matrix.sync='params.processNoise'\n                   label='Process noise')\n  Sensors.mt-2(ref='sensors'\n              :system='system'\n              :params='params'\n              @update='sensorUpdate')\n  v-btn.mt-2(@click='resample'\n             outlined\n             color='purple') resample\n  v-btn.mt-2(@click='reset'\n             outlined\n             color='primary') reset filter\n</template>\n\n<script>\nimport eig from \"@eigen\";\nimport _ from \"lodash\";\nimport Section from \"@/components/environments/utils/Section.vue\";\nimport pluginMixin from \"@/components/environments/pluginMixin.js\";\nimport ValueInput from \"@/components/environments/utils/ValueInput.vue\";\nimport MatrixInput from \"@/components/environments/utils/MatrixInput.vue\";\nimport ArrayInput from \"@/components/environments/utils/ArrayInput.vue\";\nimport Sensors from \"@/components/environments/utils/Sensors.vue\";\nimport ParticleFilter from \"@/components/estimators/particleFilter.js\";\nimport { setDraggable } from \"@/components/twoUtils.js\";\nimport colors from \"vuetify/lib/util/colors\";\nimport chroma from \"chroma-js\";\n\nconst DT = 1 / 60;\n\nexport default {\n  name: \"ParticleFilterPlugin\",\n\n  mixins: [pluginMixin],\n\n  components: {\n    Section,\n    ValueInput,\n    MatrixInput,\n    ArrayInput,\n    Sensors\n  },\n\n  props: {\n    system: Object,\n    interactivePath: Object\n  },\n\n  data: () => ({\n    two: null,\n    // Parameters\n    particleGraphics: [],\n    params: {},\n    // Update\n    tResample: 0\n  }),\n\n  computed: {\n    sensors() {\n      return this.$refs.sensors;\n    },\n\n    mouseTargetEnabled() {\n      return !this.sensors.sensorDragged;\n    }\n  },\n\n  created() {\n    this.particleFilter = new ParticleFilter(this.system);\n    this.params = this.system.particleFilterParams();\n  },\n\n  mounted() {\n    this.reset();\n  },\n\n  watch: {},\n\n  methods: {\n    createGraphics(two) {\n      this.two = two;\n      // Create sensors\n      this.sensors.createGraphics(two);\n      // Create particles\n      this.updateGraphics();\n    },\n\n    createParticleGraphic() {\n      if (!this.two) return;\n      let particle;\n      switch (this.params.type) {\n        case \"2d\": {\n          const rad = 8;\n          const circle = this.two.makeCircle(0, 0, rad);\n          circle.noStroke();\n          const line = this.two.makeLine(0, 0, rad, 0);\n          line.stroke = \"#000000\";\n          const group = this.two.makeGroup(circle, line);\n          const scale = chroma.scale([colors.red.base, colors.green.base]);\n          const setColor = weight => {\n            circle.fill = scale(weight);\n          };\n          this.particleGraphics.push({ group, setColor });\n          break;\n        }\n        default:\n          throw new Error(this.params.type + \" unsupported\");\n      }\n    },\n\n    updateParticleGraphic(particle, graphic) {\n      switch (this.params.type) {\n        case \"2d\": {\n          const x = particle.system.x;\n          const pos = this.two.worldToCanvas([x.get(0), x.get(1)]);\n          graphic.group.translation.set(...pos);\n          graphic.group.rotation = -x.get(2);\n          graphic.setColor(particle.weight);\n          break;\n        }\n      }\n    },\n\n    updateGraphics() {\n      // Match particle number\n      const maxParticles = 50;\n      const particles = this.particleFilter.particles;\n      const nPts = Math.min(maxParticles, particles.length);\n      for (let k = this.particleGraphics.length; k < nPts; k++) {\n        this.createParticleGraphic();\n      }\n      for (\n        let k = this.particleGraphics.length - 1;\n        k >= particles.length;\n        k--\n      ) {\n        this.two.remove(this.particleGraphics[k].group);\n        this.particleGraphics.splice(k, 1);\n      }\n      // Update particle state\n      this.particleGraphics.forEach((g, idx) => {\n        const particle = particles[idx];\n        this.updateParticleGraphic(particle, g);\n      });\n    },\n\n    // Could be shared w/ dircol\n    reset() {\n      // const P = new eig.Matrix(this.params.covariance);\n      // const Q = new eig.Matrix(this.params.processNoise);\n      this.particleFilter.reset(this.params);\n      this.sensors.reset();\n    },\n\n    resample() {\n      this.particleFilter.resample();\n    },\n\n    update(params) {\n      this.particleFilter.predict(params.u, params.dt);\n      this.updateGraphics();\n      // Run update sensors\n      this.sensors.update(params.t);\n      // Resample if needed\n      const now = Date.now() / 1000;\n      if (now - this.tResample > this.params.dt) {\n        this.resample();\n        this.tResample = now;\n      }\n    },\n\n    sensorUpdate(sensor) {\n      this.particleFilter.update(sensor);\n    },\n\n    ready() {\n      return false;\n    },\n\n    updateSystem(t, dt) {}\n  }\n};\n</script>\n\n<style>\n</style>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ParticleFilterPlugin.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ParticleFilterPlugin.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ParticleFilterPlugin.vue?vue&type=template&id=b85ce460&lang=pug&\"\nimport script from \"./ParticleFilterPlugin.vue?vue&type=script&lang=js&\"\nexport * from \"./ParticleFilterPlugin.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\ninstallComponents(component, {VBtn})\n","<template lang='pug'>\nModelLayout\n  template(v-slot:canvas)\n    div.canvas(ref='canvas')\n  template(v-slot:overlay)\n    span.ma-2 fps: {{ fps.toFixed(0) }}\n  template(v-slot:drawer)\n    ParticleFilterPlugin(ref='plugin'\n              :system='system'\n              @activate='() => {}')\n  template(v-if='isMounted'\n           v-slot:sheet)\n    ParticlePlot(:particleFilter='$refs.plugin.particleFilter')\n  template(v-slot:bar)\n    v-btn(text dark\n          @click='reset') reset\n</template>\n\n<script>\nimport ModelLayout from \"@/components/models/ModelLayout.vue\";\nimport worldMixin from \"@/components/worldMixin.js\";\nimport systemMixin from \"@/components/systemMixin.js\";\nimport TrajPlot from \"@/components/plots/TrajPlot.vue\";\nimport ParticlePlot from \"@/components/plots/ParticlePlot.vue\";\nimport ParticleFilterPlugin from \"@/components/environments/ParticleFilter/ParticleFilterPlugin.vue\";\nimport Systems from \"@/components/models/systems.js\";\n\nexport default {\n  name: \"particleFilter\",\n\n  meta: {\n    title: \"Particle Filter\",\n    icon: \"mdi-dots-hexagon\",\n    systems: [\n      Systems.car,\n    ]\n  },\n\n  components: {\n    ModelLayout,\n    ParticlePlot,\n    ParticleFilterPlugin\n  },\n\n  mixins: [worldMixin, systemMixin],\n\n  props: {\n    systemName: String\n  },\n\n  data: () => ({\n  }),\n\n  computed: {\n    canvas() {\n      return this.$refs.canvas;\n    },\n\n    scale() {\n      return 48;\n    },\n\n    dt() {\n      return 1 / 60;\n    }\n  },\n\n  created() {\n    const SysClass = Systems[this.systemName];\n    if (!SysClass) console.error(\"Unsupported system\", this.systemName);\n    else this.system = new SysClass();\n  },\n\n  mounted() {\n  },\n\n  methods: {\n    reset() {\n      worldMixin.methods.reset.call(this);\n      systemMixin.methods.reset.call(this);\n    }\n  }\n};\n</script>\n\n<style>\n</style>","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ParticleFilter.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ParticleFilter.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ParticleFilter.vue?vue&type=template&id=dc479296&lang=pug&\"\nimport script from \"./ParticleFilter.vue?vue&type=script&lang=js&\"\nexport * from \"./ParticleFilter.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\ninstallComponents(component, {VBtn})\n","import Vue from 'vue'\nimport VueRouter from 'vue-router'\n// Environments\nimport Home from \"@/views/Home.vue\";\nimport LQR from \"@/components/environments/LQR/LQR.vue\";\nimport ValueIteration from \"@/components/environments/ValueIteration/ValueIteration.vue\";\nimport RRT from \"@/components/environments/RRT/RRT.vue\";\nimport Flatness from \"@/components/environments/Flatness/Flatness.vue\";\nimport DirectCollocation from \"@/components/environments/DirectCollocation/DirectCollocation.vue\";\nimport MPC from \"@/components/environments/MPC/MPC.vue\";\nimport KalmanFilter from \"@/components/environments/KalmanFilter/KalmanFilter.vue\";\nimport ParticleFilter from \"@/components/environments/ParticleFilter/ParticleFilter.vue\";\n\nVue.use(VueRouter)\n\nconst env = [\n  LQR,\n  ValueIteration,\n  // RRT,\n  Flatness,\n  DirectCollocation,\n  MPC,\n  KalmanFilter,\n  ParticleFilter,\n];\nconst envRoutes = env.map(env => ({\n  component: env,\n  name: env.name,\n  path: `/${env.name}/:systemName`,\n  props: true,\n  meta: {\n    ...env.meta,\n    rightDrawer: true,\n  }\n}));\n\nconst routes = [\n  {\n    path: '/',\n    component: Home,\n  },\n  ...envRoutes\n]\n\nconst router = new VueRouter({\n  // mode: 'history',\n  base: process.env.BASE_URL,\n  routes\n})\n\nexport { envRoutes }\nexport default router\n","<template lang=\"pug\">\nv-navigation-drawer(v-model='drawer'\n                    app clipped)\n  v-list(dense)\n    //* Header\n    v-list-item(@click='navHome')\n      v-list-item-icon\n        v-icon mdi-home\n      v-list-item-title Home\n    v-divider\n    //* Environments\n    v-list-group(v-for='route, idx in envRoutes'\n                 :key='`env_${idx}`'\n                 :prepend-icon='route.meta.icon'\n                 :value='isEnv(route.name)')\n      template(v-slot:activator)\n        v-list-item-title {{ route.meta.title }}\n      v-list-item.ml-3(v-for='system, sidx, in route.meta.systems'\n                  :key='`env_${idx}_system_${sidx}`'\n                  :class='{ active: isActive(route, system) }'\n                  @click='() => navSystem(route, system)')\n        v-list-item-title {{ system.NAME }}\n        v-list-item-icon\n          v-icon {{ icons[sidx] }}\n  //* Footer\n  v-divider\n  v-list(dense style='flex: 0 0 auto')\n    v-list-item(@click='github')\n      v-list-item-action\n        v-icon mdi-github\n      v-list-item-content\n        v-list-item-title Github\n</template>\n\n<script>\nimport { envRoutes } from \"@/router/router.js\";\nimport _ from \"lodash\";\n\nconst icons = [\n  \"mdi-alpha\",\n  \"mdi-beta\",\n  \"mdi-gamma\",\n  \"mdi-delta\",\n  \"mdi-epsilon\"\n];\n\nexport default {\n  data: () => ({\n    drawer: null,\n    envRoutes,\n    icons\n  }),\n\n  props: {\n    value: Boolean\n  },\n\n  computed: {},\n\n  mounted() {\n    this.$nextTick(() => {\n      // this.drawer = this.$store.windowSize.x > 1264;\n    });\n  },\n\n  methods: {\n    navHome() {\n      this.$router.push({ path: '/' });\n    },\n\n    toggle() {\n      this.drawer = !this.drawer;\n    },\n\n    github() {\n      window.open(\"https://github.com/BertrandBev/controls-js\", \"_blank\");\n    },\n\n    isEnv(env) {\n      return this.$route.name === env;\n    },\n\n    isActive(route, system) {\n      return (\n        this.isEnv(route.name) && this.$route.params.systemName === system.TAG\n      );\n    },\n\n    navSystem(route, system) {\n      if (this.isActive(route, system)) return;\n      this.$router.push({\n        name: route.name,\n        params: { systemName: system.TAG }\n      });\n    }\n  }\n};\n</script>\n\n<style scoped>\n.active {\n  background-color: rgba(0, 0, 0, 0.05);\n}\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Drawer.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--11-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Drawer.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Drawer.vue?vue&type=template&id=bff60a68&scoped=true&lang=pug&\"\nimport script from \"./Drawer.vue?vue&type=script&lang=js&\"\nexport * from \"./Drawer.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Drawer.vue?vue&type=style&index=0&id=bff60a68&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"bff60a68\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VDivider } from 'vuetify/lib/components/VDivider';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VList } from 'vuetify/lib/components/VList';\nimport { VListGroup } from 'vuetify/lib/components/VList';\nimport { VListItem } from 'vuetify/lib/components/VList';\nimport { VListItemAction } from 'vuetify/lib/components/VList';\nimport { VListItemContent } from 'vuetify/lib/components/VList';\nimport { VListItemIcon } from 'vuetify/lib/components/VList';\nimport { VListItemTitle } from 'vuetify/lib/components/VList';\nimport { VNavigationDrawer } from 'vuetify/lib/components/VNavigationDrawer';\ninstallComponents(component, {VDivider,VIcon,VList,VListGroup,VListItem,VListItemAction,VListItemContent,VListItemIcon,VListItemTitle,VNavigationDrawer})\n","<template lang='pug'>\nv-app(v-resize=\"onResize\")\n  Drawer(ref='drawer')\n  Toolbar(@toggleDrawer='toggleDrawer')\n  v-main\n    //* Loading row\n    v-row(v-if='loading'\n          align='center'\n          justify='center'\n          style='height: 100%')\n      v-progress-circular(:size='40'\n                          color='blue'\n                          indeterminate)\n    //* Content\n    router-view(:key='$route.path'\n                v-else)\n  //* Notifications\n  notifications(group='alert'\n                position='bottom center'\n                width='400px'\n                closeOnClick\n                :max='3'\n                classes='notification-style')\n</template>\n\n<script>\nimport eig from \"@eigen\";\nimport Toolbar from \"@/components/nav/Toolbar.vue\";\nimport Drawer from \"@/components/nav/Drawer.vue\";\n\nexport default {\n  name: \"App\",\n\n  components: {\n    Toolbar,\n    Drawer\n  },\n\n  data: () => ({\n    loading: true // TEMP\n  }),\n\n  created() {\n    eig.ready.then(() => {\n      this.loading = false;\n    });\n  },\n\n  mounted() {\n    this.onResize();\n  },\n\n  methods: {\n    onResize() {\n      this.$store.windowSize.x =\n        window.innerWidth -\n        this.$vuetify.application.left -\n        this.$vuetify.application.right;\n      this.$store.windowSize.y =\n        window.innerHeight - this.$vuetify.application.top;\n    },\n\n    toggleDrawer() {\n      this.$refs.drawer.toggle();\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\">\n.notification-style {\n  padding: 10px;\n  margin: 0 5px 5px;\n  font-size: 16px;\n  color: white;\n  border-left: 5px solid #187fe7;\n  &.type-info {\n    background: #44a4fc;\n    border-left-color: #187fe7;\n  }\n  &.type-warn {\n    background: #ffb648;\n    border-left-color: #f48a06;\n  }\n  &.type-error {\n    background: #d32f2f;\n    border-left-color: #b71c1c;\n  }\n  &.type-success {\n    background: #68cd86;\n    border-left-color: #42a85f;\n  }\n}\n</style>","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--11-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--11-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=635b066e&lang=pug&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VApp } from 'vuetify/lib/components/VApp';\nimport { VMain } from 'vuetify/lib/components/VMain';\nimport { VProgressCircular } from 'vuetify/lib/components/VProgressCircular';\nimport { VRow } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VApp,VMain,VProgressCircular,VRow})\n\n\n/* vuetify-loader */\nimport installDirectives from \"!../node_modules/vuetify-loader/lib/runtime/installDirectives.js\"\nimport Resize from 'vuetify/lib/directives/resize'\ninstallDirectives(component, {Resize})\n","import Vue from 'vue';\nimport Vuetify from 'vuetify/lib';\n\nVue.use(Vuetify);\n\nexport default new Vuetify({\n});\n","import Vue from 'vue'\nimport App from './App.vue'\nimport router from './router/router.js'\n// import store from './store'\nimport vuetify from './plugins/vuetify';\nimport Notifications from 'vue-notification'\n\n// Add simple store\nconst store = new Vue({\n  data: () => ({\n    windowSize: { x: 0, y: 0 }\n  })\n})\nVue.prototype.$store = store\n\n// Add bus\nconst bus = new Vue()\nVue.prototype.$bus = bus\n\n// Add notification handler\nVue.use(Notifications)\nbus.notify = (type, msg) => {\n  Vue.notify({\n    group: \"alert\",\n    title: { error: \"Error\", success: \"Success\" }[type],\n    text: msg,\n    type: { error: \"type-error\", success: \"type-success\" }[type],\n    duration: 6000\n  });\n}\n\nVue.config.productionTip = false\nnew Vue({\n  router,\n  store,\n  vuetify,\n  render: h => h(App)\n}).$mount('#app')\n","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--5-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--5-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--5-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ModelLayout.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}